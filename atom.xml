<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ¡¥å¤´æ‰“å­—å‘˜</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-07-24T06:25:11.751Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Henry</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>GStreamerå­¦ä¹ ç¬”è®°--GObjectç±»å¯¹è±¡</title>
    <link href="http://example.com/2021/07/17/gstreamer%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Gobject%E7%B1%BB%E5%AF%B9%E8%B1%A1/"/>
    <id>http://example.com/2021/07/17/gstreamer%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Gobject%E7%B1%BB%E5%AF%B9%E8%B1%A1/</id>
    <published>2021-07-17T08:48:47.000Z</published>
    <updated>2021-07-24T06:25:11.751Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="GStreamerå­¦ä¹ ç¬”è®°â€“GObjectç±»å¯¹è±¡"><a href="#GStreamerå­¦ä¹ ç¬”è®°â€“GObjectç±»å¯¹è±¡" class="headerlink" title="GStreamerå­¦ä¹ ç¬”è®°â€“GObjectç±»å¯¹è±¡"></a>GStreamerå­¦ä¹ ç¬”è®°â€“GObjectç±»å¯¹è±¡</h1><h2 id="Gobjectç±»å®šä¹‰"><a href="#Gobjectç±»å®šä¹‰" class="headerlink" title="Gobjectç±»å®šä¹‰"></a>Gobjectç±»å®šä¹‰</h2><p>ç»´åŸºç™¾ç§‘ï¼š<strong>GObject</strong>ï¼Œæ˜¯ä¸€ä¸ªåœ¨<a href="https://zh.wikipedia.org/wiki/LGPL">LGPL</a>ä¸‹å‘å¸ƒçš„<a href="https://zh.wikipedia.org/wiki/%E8%87%AA%E7%94%B1%E8%BD%AF%E4%BB%B6">è‡ªç”±</a><a href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E5%BA%93">è½¯ä»¶åº“</a>ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªè½»ä¾¿çš„<a href="https://zh.wikipedia.org/w/index.php?title=%E5%AF%B9%E8%B1%A1%E7%B3%BB%E7%BB%9F&action=edit&redlink=1">å¯¹è±¡ç³»ç»Ÿ</a>å¹¶æ”¯æŒé€æ˜çš„å¤šè¯­è¨€äº’é€šã€‚GObjectè¢«è®¾è®¡ä¸ºå¯ä»¥ç›´æ¥ä½¿ç”¨åœ¨<a href="https://zh.wikipedia.org/wiki/C%E8%AF%AD%E8%A8%80">C</a>ç¨‹åºä¸­ï¼Œä¹Ÿå¯ä»¥è¢«å°è£…è‡³å…¶ä»–è¯­è¨€ï¼Œä¾‹å¦‚<a href="https://zh.wikipedia.org/wiki/C%2B%2B">C++</a>ï¼Œ<a href="https://zh.wikipedia.org/wiki/Java">Java</a>ï¼Œ<a href="https://zh.wikipedia.org/wiki/Python">Python</a>ï¼Œä»¥åŠå¯ä»¥ç”ŸæˆCä»£ç çš„<a href="https://zh.wikipedia.org/wiki/Vala">Vala</a>ï¼ˆç”±æ­¤å¤§å¤§ç®€åŒ–äº†<code>GObject</code>ä»£ç çš„ä¹¦å†™ï¼‰ç­‰ç­‰ã€‚</p><p><code>Gstreamer</code>æ¡†æ¶æ˜¯åŸºäºæ’ä»¶çš„ï¼ŒåŒæ—¶æ’ä»¶æ˜¯å¯ä»¥åŠ¨æ€çš„æ³¨å†Œã€åˆ›å»ºï¼Œ<code>gstreamer</code>åŸºäº<code>Gobject</code>å¼€å‘ï¼Œä¸‹é¢æ¥äº†è§£ä¸€ä¸‹<code>gstreamer</code>æ˜¯å¦‚ä½•é€šè¿‡<code>Gobject</code>å®Œæˆè‡ªå®šä¹‰ç±»çš„æ³¨å†Œã€‚</p><p>åœ¨æ¯ä¸ªç±»çš„<code>c</code>æ–‡ä»¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä»¥ä¸‹è¿™æ ·çš„ä¸€ä¸ªå®å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">G_DEFINE_TYPE (GstV4l2Allocator, gst_v4l2_allocator, GST_TYPE_ALLOCATOR);</span><br></pre></td></tr></table></figure><p><code>G_DEFINE_TYPE</code>æ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>G_DEFINE_TYPE</code>å®æ˜¯å¦‚ä½•å®Œæˆå‘<code>Gobject</code>ç³»ç»Ÿå®Œæˆç±»çš„æ³¨å†Œå‘¢ï¼Ÿ</p><p>å°†<code>G_DEFINE_TYPE</code>å±•å¼€å¯ä»¥çœ‹åˆ°ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> G_DEFINE_TYPE(TN, t_n, T_P)</span></span><br><span class="line"><span class="comment">/******* </span></span><br><span class="line"><span class="comment"> *TN  ---&gt; TypeName</span></span><br><span class="line"><span class="comment"> *t_n ---&gt; type_name</span></span><br><span class="line"><span class="comment"> *T_P ---&gt; TYPE_PARENT</span></span><br><span class="line"><span class="comment"> *_f_ ---&gt; 0</span></span><br><span class="line"><span class="comment"> *_c_ ---&gt; &#123;&#125;</span></span><br><span class="line"><span class="comment">******/</span></span><br><span class="line"><span class="comment">/*****   ä»¥ä¸‹ä¸ºå®å±•å¼€   *****/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span>     type_name##_init              (TypeName        *self); </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span>     type_name##_class_init        (TypeName##Class *klass); </span><br><span class="line"><span class="keyword">static</span> gpointer type_name##_parent_class = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">static</span> gint     TypeName##_private_offset;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span>     type_name##_class_intern_init (gpointer klass)</span><br><span class="line">&#123;</span><br><span class="line">  type_name##_parent_class = g_type_class_peek_parent (klass);</span><br><span class="line">  <span class="keyword">if</span> (TypeName##_private_offset != <span class="number">0</span>)</span><br><span class="line">    g_type_class_adjust_private_offset (klass, &amp;TypeName##_private_offset);</span><br><span class="line">  type_name##_class_init ((TypeName##Class*) klass);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> gpointer</span><br><span class="line">type_name##_get_instance_private (TypeName *self)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (G_STRUCT_MEMBER_P (self, TypeName##_private_offset));</span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">GType </span><br><span class="line">type_name##_get_type (<span class="keyword">void</span>) </span><br><span class="line">&#123; </span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">volatile</span> gsize g_define_type_id__volatile = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">/* Prelude goes here */</span></span><br><span class="line">  <span class="keyword">if</span> (g_once_init_enter (&amp;g_define_type_id__volatile))</span><br><span class="line">    &#123;</span><br><span class="line">      GType g_define_type_id =</span><br><span class="line">        g_type_register_static_simple (TYPE_PARENT,</span><br><span class="line">                                       g_intern_static_string (#TypeName),</span><br><span class="line">                                       <span class="keyword">sizeof</span> (TypeName##Class),</span><br><span class="line">                                       (GClassInitFunc)(<span class="keyword">void</span> (*)(<span class="keyword">void</span>)) type_name##_class_intern_init,</span><br><span class="line">                                       <span class="keyword">sizeof</span> (TypeName),</span><br><span class="line">                                       (GInstanceInitFunc)(<span class="keyword">void</span> (*)(<span class="keyword">void</span>)) type_name##_init,</span><br><span class="line">                                       (GTypeFlags) flags);</span><br><span class="line">      &#123; <span class="comment">/* custom code follows */</span></span><br><span class="line">      &#123;_C_;&#125;</span><br><span class="line">        <span class="comment">/* following custom code */</span></span><br><span class="line">      &#125;</span><br><span class="line">      g_once_init_leave (&amp;g_define_type_id__volatile, g_define_type_id);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> g_define_type_id__volatile;</span><br><span class="line">&#125; <span class="comment">/* closes type_name##_get_type() */</span></span><br></pre></td></tr></table></figure><h2 id="å‘Gobjectç³»ç»Ÿæ³¨å†Œç±»"><a href="#å‘Gobjectç³»ç»Ÿæ³¨å†Œç±»" class="headerlink" title="å‘Gobjectç³»ç»Ÿæ³¨å†Œç±»"></a>å‘Gobjectç³»ç»Ÿæ³¨å†Œç±»</h2><p><code>G_DEFINE_TYPE</code>å®šä¹‰å¦‚ä¸Šï¼Œé‚£ä¹ˆï¼Œæœ€ç»ˆå®ƒæ˜¯å¦‚ä½•å‘<code>Gobject</code>ç³»ç»Ÿæ³¨å†Œè¯¥ç±»çš„å‘¢ï¼Ÿ<br><code>Gobject</code>ç³»ç»Ÿä¸ºä»€ä¹ˆçŸ¥é“ä½ æ–°æ·»åŠ äº†ä¸€ä¸ªåå«<code>TypeName</code>çš„ç±»ï¼Œæ˜¯å› ä¸ºä½ é€šè¿‡<code>g_type_register_static_simple()</code>å‡½æ•°å‘Šè¯‰å®ƒï¼Œæˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªæ–°ç±»ï¼Œä½ ç™»è®°ä¸€ä¸‹<code>g_type_register_static_simple()</code>å‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">GLIB_AVAILABLE_IN_ALL</span></span><br><span class="line"><span class="function">GType <span class="title">g_type_register_static_simple</span>     <span class="params">(GType                       parent_type,</span></span></span><br><span class="line"><span class="params"><span class="function"> <span class="keyword">const</span> gchar                *type_name,</span></span></span><br><span class="line"><span class="params"><span class="function"> guint                       class_size,</span></span></span><br><span class="line"><span class="params"><span class="function"> GClassInitFunc              class_init,</span></span></span><br><span class="line"><span class="params"><span class="function"> guint                       instance_size,</span></span></span><br><span class="line"><span class="params"><span class="function"> GInstanceInitFunc           instance_init,</span></span></span><br><span class="line"><span class="params"><span class="function"> GTypeFlags             flags)</span></span>;</span><br></pre></td></tr></table></figure><p>å‡½æ•°å£°æ˜çš„å‰é¢<code>GLIB_AVAILABLE_IN_ALL</code>å°±æ˜¯ä¸€ä¸ª<code>extern</code>å…³é”®è¯ï¼Œä»å‡½æ•°å£°æ˜æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œå‘<code>Gobject</code>ç³»ç»Ÿæ³¨å†Œä¸€ä¸ªç±»ï¼Œéœ€è¦å‘Šè¯‰<code>Gobject</code>ç³»ç»Ÿï¼Œæˆ‘ç°åœ¨éœ€è¦æ³¨å†Œä¸€ä¸ªæ–°ç±»ï¼Œå®ƒçˆ¶ç±»çš„ç±»å‹æ˜¯<code>parent_type</code>ï¼Œå¤§å°æ˜¯<code>class_size</code>ï¼Œç±»çš„åˆå§‹åŒ–å‡½æ•°æ˜¯<code>class_init</code>ï¼Œç±»çš„å®ä¾‹å¤§å°ä»¥åŠåˆå§‹åŒ–å‡½æ•°ï¼Œè¿˜æœ‰è¿™ä¸ªç±»æœ‰ä»€ä¹ˆ<code>flags</code>ï¼Œé€šè¿‡å‘Šè¯‰<code>Gobject</code>ï¼Œå®ƒå°±ä¼šå°†æ–°ç±»ç™»è®°åœ¨çº¿ã€‚</p><p>é€šè¿‡<code>G_DEFINE_TYPE</code>å®çš„å±•å¼€å¯ä»¥çŸ¥é“ï¼Œåœ¨<code>type_name##_get_type()</code>å‡½æ•°ä¸­è°ƒç”¨åˆ°<code>g_type_register_static_simple()</code>å‡½æ•°ï¼Œé‚£ä¹ˆï¼Œç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Œç¨‹åºä¼šå‘<code>Gobject</code>ç³»ç»Ÿæ³¨å†Œè¯¥æ–°ç±»å‘¢ï¼Ÿ<br>æ¯”å¦‚æˆ‘ä»¬æ˜¯è¦æ³¨å†Œä¸€ä¸ªåå«<code>TestObject</code>çš„ç±»ï¼Œé‚£ä¹ˆå°±æ˜¯é€šè¿‡<code>TestObject_get_type()</code>å‡½æ•°å®Œæˆ<code>estObject</code>çš„æ³¨å†Œç™»è®°ã€‚<br>åœ¨æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>TestObject</code>çš„å®ä¾‹æ—¶ï¼Œä¼šé€šè¿‡è°ƒç”¨<code>g_object_new()</code>å‡½æ•°å®Œæˆï¼Œåœ¨è°ƒç”¨<code>g_object_new</code>å‡½æ•°ï¼Œéœ€è¦ä¼ è¿›ç›¸åº”çš„å‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å°†<code>TestObject_get_type()</code>å‡½æ•°çš„è¿”å›å€¼ä¼ é€’ç»™å®ƒï¼Œå³æ¼”å˜æˆä»¥ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TestObject *testObject = ï¼ˆTestObject *ï¼‰g_object_new (TestObject_get_type(), <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»º<code>TestObject</code>å®ä¾‹å¯¹è±¡çš„æ—¶å€™ï¼Œå°†ä¼šè°ƒç”¨<code>TestObject_get_type()</code>å‡½æ•°å¾—åˆ°ç›¸åº”çš„ç±»å‹ï¼Œè€Œåœ¨<code>TestObject_get_type()</code>å‡½æ•°ä¸­ï¼Œå°†ä¼šå…ˆé€šè¿‡<code>g_once_init_enter()</code>å‡½æ•°æ£€æŸ¥<code>TestObject_get_type()</code>ä¸­çš„é™æ€å˜é‡<code>g_define_type_id_volatile</code>æ˜¯å¦ä¸º0ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€šè¿‡<code>g_type_register_static_simple()</code>å‡½æ•°å‘<code>Gobject</code>ç³»ç»Ÿç™»è®°<code>TestObject</code>ç±»ï¼ŒåŒæ—¶è¿”å›<code>object ID</code>ï¼Œå¦‚æœ<code>g_define_type_id_volatile</code>ä¸ä¸º0ï¼Œåˆ™è¯´æ˜å·²ç»å‘<code>Gobject</code>ç³»ç»Ÿæ³¨å†Œ<code>TestObjec</code>tç±»ï¼Œç›´æ¥è¿”å›<code>object ID</code>ï¼Œè¿™æ ·ï¼Œå³å®Œæˆäº†<code>TestObject</code>çš„æ³¨å†Œç™»è®°ã€‚</p><h2 id="ç±»çš„æ„é€ å‡½æ•°"><a href="#ç±»çš„æ„é€ å‡½æ•°" class="headerlink" title="ç±»çš„æ„é€ å‡½æ•°"></a>ç±»çš„æ„é€ å‡½æ•°</h2><p>å­¦ä¹ <code>C++</code>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç±»æ˜¯æœ‰æ„é€ å‡½æ•°çš„ï¼Œåœ¨åˆ›å»ºç±»å®ä¾‹çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¯¥ç±»çš„æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆï¼Œåœ¨<code>Gobject</code>ä¸­ï¼Œåˆæ˜¯æ€ä¹ˆè°ƒç”¨ç±»çš„æ„é€ å‡½æ•°å‘¢ï¼Ÿ</p><p>ä»¥<code>TestObject</code>ä¸ºä¾‹ï¼Œåœ¨ä¸Šé¢è¯´åˆ°é€šè¿‡<code>g_type_register_static_simple()</code>å‡½æ•°å‘<code>Gobject</code>ç³»ç»Ÿæ³¨å†Œè‡ªå®šä¹‰ç±»çš„æ—¶å€™ï¼Œå°±ä¼ è¿›äº†ç›¸åº”çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç±»çš„åˆå§‹åŒ–å‡½æ•°<code>test_object_class_intern_init()</code>ä»¥åŠç±»å®ä¾‹çš„åˆå§‹åŒ–å‡½æ•°<code>test_object_init()</code>ï¼Œå®ƒä»¬ä¸¤ä¸ªå…±åŒçš„ç›¸å½“äº<code>TestObject</code>ç±»çš„æ„é€ å‡½æ•°ã€‚ä»å®å®šä¹‰<code>G_DEFINE_TYPE</code>çš„å±•å¼€ä»£ç ä¸­å‘ç°ä»¥ä¸‹å‡½æ•°å£°æ˜ä»¥åŠ<code>test_object_class_intern_init()</code>å‡½æ•°çš„å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>     <span class="title">test_object_init</span>              <span class="params">(TestObject      *self)</span></span>; </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>     <span class="title">test_object_class_init</span>        <span class="params">(TestObjectClass *klass)</span></span>; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>     <span class="title">test_object_class_intern_init</span> <span class="params">(gpointer klass)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  test_object_parent_class = g_type_class_peek_parent (klass);</span><br><span class="line">  <span class="keyword">if</span> (test_object_private_offset != <span class="number">0</span>)</span><br><span class="line">    g_type_class_adjust_private_offset (klass, &amp;TestObject_private_offset);</span><br><span class="line">  test_object_class_init ((TestObjectClass*) klass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåœ¨é€šè¿‡<code>G_DEFINE_TYPE</code>å‘<code>Gobject</code>ç³»ç»Ÿæ³¨å†Œç±»ï¼Œè¿˜éœ€è¦æˆ‘ä»¬å®ç°<code>test_object_class_init()</code>å’Œ<code>test_object_init()</code>å‡½æ•°çš„å®šä¹‰ã€‚<code>test_object_class_init()</code>å‡½æ•°æ˜¯åœ¨ç¬¬ä¸€æ¬¡åˆ›å»º<code>TestObject</code>ç±»å®ä¾‹å¯¹è±¡çš„æ—¶å€™è°ƒç”¨çš„ï¼Œè¯¥å‡½æ•°åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œè€Œ<code>test_object_init()</code>å‡½æ•°åˆ™æ˜¯æ¯æ¬¡åˆ›å»º<code>TestObject</code>ç±»å®ä¾‹å¯¹è±¡éƒ½ä¼šè°ƒç”¨ã€‚</p><h2 id="ç±»çš„ç»§æ‰¿å…³ç³»"><a href="#ç±»çš„ç»§æ‰¿å…³ç³»" class="headerlink" title="ç±»çš„ç»§æ‰¿å…³ç³»"></a>ç±»çš„ç»§æ‰¿å…³ç³»</h2><p>åœ¨<code>G_DEFINE_TYPE</code>çš„å±•å¼€ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> gpointer type_name##_parent_class = <span class="literal">NULL</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span>     type_name##_class_intern_init (gpointer klass)</span><br><span class="line">&#123;</span><br><span class="line">  type_name##_parent_class = g_type_class_peek_parent (klass);</span><br><span class="line">  <span class="keyword">if</span> (TypeName##_private_offset != <span class="number">0</span>)</span><br><span class="line">    g_type_class_adjust_private_offset (klass, &amp;TypeName##_private_offset);</span><br><span class="line">  type_name##_class_init ((TypeName##Class*) klass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªå®ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å®šä¹‰äº†ä¸€ä¸ªé™æ€çš„å…¨å±€æŒ‡é’ˆå˜é‡<code>type_name_parent_class</code>ï¼Œè€Œ<code>type_name_parent_class</code>å˜é‡æ˜¯é€šè¿‡<code>g_type_class_peek_parent()</code>å‡½æ•°èµ‹å€¼çš„ï¼Œ<code>type_name_parent_class</code>å˜é‡ä»£è¡¨ç€ä»€ä¹ˆå‘¢ï¼Œå®ƒå°±æ˜¯çˆ¶ç±»ã€‚ä¸€èˆ¬çš„ï¼Œä¼šåœ¨è¯¥æºæ–‡ä»¶æ–°å¢ä¸€ä¸ªå®ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> type_name##_parent_class parent_class</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡å®å®šä¹‰<code>parent_class</code>ç›´æ¥è°ƒç”¨çˆ¶ç±»å‡½æ•°ï¼Œè€Œè¯¥çˆ¶ç±»ï¼Œå°±æ˜¯åœ¨é€šè¿‡å®å®šä¹‰<code>G_DEFINE_TYPE</code>å‘<code>Gobject</code>ç³»ç»Ÿæ³¨å†Œç±»æ—¶ä¼ è¿›çš„ç¬¬ä¸‰ä¸ªå‚æ•°<code>T_P</code>ã€‚<code>g_type_class_peek_parent()</code>å‡½æ•°é€šè¿‡ä¼ è¿›çš„å­ç±»æŒ‡é’ˆï¼ŒæŸ¥æ‰¾åˆ°æ³¨å†Œæ—¶å€™çš„ç›¸åº”ä¿¡æ¯ï¼Œå¾—åˆ°çˆ¶ç±»çš„ç±»å‹ï¼Œè€Œåé€šè¿‡çˆ¶ç±»ç±»å‹å¾—åˆ°çˆ¶ç±»ä¿¡æ¯å¹¶è¿”å›ã€‚</p><h2 id="ç±»çš„ææ„å‡½æ•°"><a href="#ç±»çš„ææ„å‡½æ•°" class="headerlink" title="ç±»çš„ææ„å‡½æ•°"></a>ç±»çš„ææ„å‡½æ•°</h2><p>æœ‰äº†ç›¸åº”çš„æ„é€ å‡½æ•°ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­ç”³è¯·äº†å†…å­˜ã€ç¡¬ä»¶ç­‰èµ„æºï¼Œè‡ªç„¶çš„ï¼Œä¹Ÿä¼šç±»ä¼¼<code>C++</code>çš„ï¼Œæœ‰ç›¸åº”çš„ææ„å‡½æ•°è´Ÿè´£èµ„æºçš„é‡Šæ”¾æ“ä½œã€‚é‚£ä¹ˆï¼Œåœ¨<code>Gobject</code>ç³»ç»Ÿä¸­ï¼Œææ„å‡½æ•°åˆæ˜¯ä»€ä¹ˆå›äº‹å‘¢ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ„é€ å‡½æ•°æ˜¯ä»çˆ¶ç±»åˆ°å­ç±»ï¼Œè€Œææ„å‡½æ•°æ˜¯ä»å­ç±»åˆ°çˆ¶ç±»ã€‚åœ¨<code>Gobject</code>ç³»ç»Ÿä¸­çš„ææ„å‡½æ•°åˆæ˜¯å¦‚ä½•çš„å‘¢ï¼Ÿ</p><p>ä¹‹å‰è¯´åˆ°ï¼Œåœ¨é€šè¿‡<code>G_DEFINE_TYPE</code>å‘<code>Gobject</code>ç³»ç»Ÿï¼Œæ³¨å†Œ<code>TestObject</code>ç±»çš„æ—¶å€™ï¼Œéœ€è¦å®šä¹‰<code>test_object_class_init()</code>å’Œ<code>test_object_init()</code>å‡½æ•°ï¼Œè€Œåœ¨ç±»å®ä¾‹çš„åˆå§‹åŒ–å‡½æ•°<code>test_object_init()</code>ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ç”³è¯·äº†ä¸€äº›å†…å­˜ç­‰èµ„æºï¼Œæˆ‘ä»¬éœ€è¦åœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾è¿™äº›èµ„æºï¼Œè¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦æˆ‘ä»¬åœ¨<code>TestObject</code>ç±»åˆå§‹åŒ–å‡½æ•°<code>test_object_class_init()</code>è¦†ç›–ä»çˆ¶ç±»ç»§æ‰¿çš„ææ„å‡½æ•°ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">static void</span><br><span class="line">test_object_dispose (GObject * object)</span><br><span class="line">&#123;</span><br><span class="line">TestObject *testobject = TEST_OBJECT (object);</span><br><span class="line"> </span><br><span class="line">/*  èµ„æºé‡Šæ”¾*/</span><br><span class="line"> </span><br><span class="line">/*  è°ƒç”¨çˆ¶ç±»çš„dispose å‡½æ•° */</span><br><span class="line">G_OBJECT_CLASS (parent_class)-&gt;dispose (object);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">static void</span><br><span class="line">test_object_finalize (TestObject * testobject)</span><br><span class="line">&#123;</span><br><span class="line">g_free(testobject-&gt;mem);</span><br><span class="line"></span><br><span class="line">    /*  è°ƒç”¨çˆ¶ç±»çš„finalize å‡½æ•° */</span><br><span class="line">G_OBJECT_CLASS (parent_class)-&gt;finalize (object);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">static void test_object_init(TestObject * self)</span><br><span class="line">&#123;</span><br><span class="line">self-&gt;mem = g_malloc (1);</span><br><span class="line">&#125;</span><br><span class="line">static void test_object_class_init(TestObjectClass *klass)</span><br><span class="line">&#123;</span><br><span class="line">GObjectClass *object_class = G_OBJECT_CLASS (klass);</span><br><span class="line"> </span><br><span class="line">object_class-&gt;dispose = test_object_dispose;</span><br><span class="line">object_class-&gt;finalize = test_object_finalize;</span><br><span class="line"> </span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šè¿°ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåœ¨<code>TestObject</code>çš„åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°†ä¼šè¦†ç›–ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥çš„ææ„å‡½æ•°ï¼ŒåŒæ—¶åœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾ç±»å®ä¾‹åˆå§‹åŒ–æ—¶å ç”¨çš„èµ„æºï¼ŒåŒæ—¶è¿˜æœ‰é€’å½’è°ƒç”¨çˆ¶ç±»çš„ææ„å‡½æ•°ã€‚<code>dispose</code>å‡½æ•°ä¸»è¦æ˜¯å°†åœ¨ç±»ä¸­å ç”¨çš„èµ„æºé‡Šæ”¾ï¼Œè€Œ<code>finalize</code>å‡½æ•°åˆ™æ˜¯æœ‰ç‚¹ç±»ä¼¼çœŸæ­£çš„ææ„å‡½æ•°ï¼Œå°†æ„é€ å‡½æ•°ç”³è¯·çš„èµ„æºè¿›è¡Œé‡Šæ”¾å›æ”¶ã€‚</p><p>æ—¢ç„¶ææ„å‡½æ•°ä¹Ÿå·²ç»æœ‰äº†ï¼Œææ„å‡½æ•°åˆä¼šæ˜¯ä»€ä¹ˆæ—¶å€™è°ƒç”¨å‘¢ï¼Ÿ</p><p><code> JAVA</code>ä½¿ç”¨çš„æ˜¯åƒåœ¾å›æ”¶çš„æœºåˆ¶ï¼Œè€Œ<code>Gobjec</code>tåˆ™æ˜¯ä½¿ç”¨å¼•ç”¨è®¡æ•°çš„æ–¹å¼ã€‚å½“æ¯ä¸ªå¯¹è±¡åˆ›å»ºçš„æ—¶å€™ï¼Œå°†ä¼šå¯¹å…¶å¼•ç”¨è®¡æ•°åŠ ä¸€ï¼Œå¦‚æœæœŸé—´è¢«å…¶ä»–å¯¹è±¡è¿›è¡Œå¼•ç”¨ï¼Œä¹Ÿéƒ½ä¼šå°†å®ƒçš„å¼•ç”¨è®¡æ•°å¢åŠ ï¼›è€Œå½“å¯¹è±¡è¢«è§£é™¤å¼•ç”¨çš„æ—¶å€™ï¼Œå¼•ç”¨è®¡æ•°å°†ä¼šå‡ä¸€ï¼Œå½“å¼•ç”¨è®¡æ•°å‡ä¸º0çš„æ—¶å€™ï¼Œå°†ä¼šè°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œè¿›è¡Œèµ„æºçš„å›æ”¶ã€‚</p><p><code>Gobject</code>çš„å¼•ç”¨è®¡æ•°æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li>ä½¿ç”¨<code>g_object_new()</code>å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º1ï¼›</li><li>ä½¿ç”¨<code>g_object_ref()</code>å‡½æ•°è¿›è¡Œå¼•ç”¨å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡çš„å¼•ç”¨è®¡æ•°åŠ 1ï¼›</li><li>ä½¿ç”¨<code>g_object_unref()</code>å‡½æ•°è§£é™¤å¼•ç”¨çš„æ—¶å€™ï¼Œå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å‡1ï¼›</li><li>è°ƒç”¨<code>g_object_unref()</code>å‡½æ•°è¿›è¡Œè§£å¼•ç”¨çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0ï¼Œå°†ä¼šå…ˆåè°ƒç”¨è¯¥å¯¹è±¡çš„<code>dispose()</code>å‡½æ•°å’Œ<code>finalize()</code>å‡½æ•°ã€‚</li></ul><p>è€Œä¸ºä»€ä¹ˆåœ¨<code>test_object_class_init()</code>å‡½æ•°ä¸­è¦†ç›–ä»çˆ¶ç±»ç»§æ‰¿è¿‡æ¥çš„ææ„å‡½æ•°å‘¢ï¼Ÿ<br>å› ä¸ºåœ¨<code>g_object_unref()</code>å‡½æ•°ä¸­è°ƒç”¨<code>dispose()</code>å‡½æ•°å’Œ<code>finalize()</code>å‡½æ•°æ˜¯é€šè¿‡å®å®šä¹‰<code>G_OBJECT_GET_CLASSå–å¾—OBJECT_CLASS</code>ç±»ä¹‹åï¼Œå†è°ƒç”¨å®ƒçš„<code>dispose()</code>å‡½æ•°å’Œ<code>finalize()</code>å‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦åœ¨<code>TestObject</code>çš„ç±»åˆå§‹åŒ–å‡½æ•°å¯¹è¿™ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆè¿›è¡Œè¦†ç›–ï¼Œè€Œåœ¨<code>TestObject</code>ç±»çš„<code>dispose()</code>å‡½æ•°å’Œ<code>finalize()</code>å‡½æ•°å†é€šè¿‡<code>G_OBJECT_CLASS (parent_class)</code>å–å¾—çˆ¶ç±»æŒ‡é’ˆï¼Œè°ƒç”¨çˆ¶ç±»çš„ææ„å‡½æ•°ã€‚</p><h2 id="ç±»çš„å…¶ä»–è®¾ç½®"><a href="#ç±»çš„å…¶ä»–è®¾ç½®" class="headerlink" title="ç±»çš„å…¶ä»–è®¾ç½®"></a>ç±»çš„å…¶ä»–è®¾ç½®</h2><p>åœ¨<code>Gobject</code>ç³»ç»Ÿä¸­ï¼Œè®¾ç½®äº†å¾ˆå¤šæ–¹ä¾¿çš„å®ï¼Œä½¿åœ¨ä½¿ç”¨å¯¹è±¡çš„æ—¶å€™å¯ä»¥æ›´åŠ çš„æ–¹ä¾¿ï¼Œåœ¨ç›¸åº”çš„å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬ä¼šæœ‰å¦‚ä¸‹å®å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">GstTestObject</span> <span class="title">TestObject</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">GstTestObjectClass</span> <span class="title">GstTestObjectClass</span>;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* è·å–ç±»å‹ */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GST_TYPE_TEST_OBJECT      (test_object_get_type())</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* ç±»å®ä¾‹ç±»å‹åˆ¤æ–­ */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GST_IS_TEST_OBJECT(obj)   (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GST_TYPE_TEST_OBJECT))</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* ç±»ç»“æ„åˆ¤å®š */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GST_IS_TEST_OBJECT_CLASS(klass)      (G_TYPE_CHECK_CLASS_TYPE ((klass), GST_TYPE_TEST_OBJECT))</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* è·å–objçš„ç±»å‹ï¼ŒåŒæ—¶å°†å…¶è½¬æ¢ä¸ºGST_TYPE_TEST_OBJECTï¼Œå¹¶è¿”å›æŒ‡å‘GstTestObjectClassçš„æŒ‡é’ˆ */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GST_TEST_OBJECT_GET_CLASS(obj)       (G_TYPE_INSTANCE_GET_CLASS ((obj), GST_TYPE_TEST_OBJECT, GstTestObjectClass))</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* æ£€æŸ¥objæ˜¯å¦æ˜¯GST_TYPE_TEST_OBJECTç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†è¿”å›æŒ‡å‘objæˆå‘˜å˜é‡TestObjectçš„æŒ‡é’ˆ */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GST_TEST_OBJECT(obj)      (G_TYPE_CHECK_INSTANCE_CAST ((obj), GST_TYPE_TEST_OBJECT, TestObject))</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* æ£€æŸ¥klassæ˜¯ä¸æ˜¯GST_TYPE_TEST_OBJECTç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†è¿”å›æŒ‡å‘klassæˆå‘˜å˜é‡GstTestObjectClassçš„æŒ‡é’ˆ */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GST_TEST_OBJECT_CLASS(klass)         (G_TYPE_CHECK_CLASS_CAST ((klass), GST_TYPE_TEST_OBJECT, GstTestObjectClass))</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* å®ä¾‹ç»“æ„è½¬æ¢ */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GST_TEST_OBJECT_CAST(obj) ((TestObject*)(obj))</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">GstTestObject</span> &#123;</span></span><br><span class="line">  GstObject            object;</span><br><span class="line">  gchar *mem;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* ç±»å®šä¹‰ */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">GstTestObjectClass</span> &#123;</span></span><br><span class="line">  GstObjectClass    object_class;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯é€šè¿‡ä¸Šè¿°çš„å®å®šä¹‰ï¼Œå¯ä»¥æ–¹ä¾¿çš„å°†å„ç§ç±»ä»¥åŠå¯¹è±¡è¿›è¡Œè½¬æ¢ï¼Œåœ¨å­ç±»ä¸­å¯ä»¥è°ƒç”¨çˆ¶ç±»çš„å‡½æ•°ç­‰æ“ä½œï¼ŒåŒæ—¶ï¼Œåœ¨<code>gstreamer</code>ä¸­ï¼Œè¿˜æœ‰ä¸€äº›å±æ€§è®¾ç½®å‡½æ•°ç­‰ï¼Œè¿›è¡Œå¤šæ ·åŒ–çš„ç±»ç®¡ç†ã€‚</p><p>å¦å¤–çš„ï¼Œå®å®šä¹‰<code>G_DEFINE_TYPE_WITH_CODE</code>ä¹Ÿæ˜¯å®ç°ä¸<code>G_DEFINE_TYP</code>ç±»ä¼¼çš„åŠŸèƒ½ï¼Œåªä¸è¿‡æ˜¯å¯ä»¥å°†ä¸€äº›å‡½æ•°å†…ç½®åœ¨<code>type_name##_get_type()</code>å‡½æ•°ä¸­ã€‚</p>]]></content>
    
    
    <summary type="html">GObject è®¾è®¡ç”¨äºç›´æ¥åœ¨Cç¨‹åºä¸­ä½¿ç”¨ä»¥æä¾›é¢å‘å¯¹è±¡çš„åŸºäºCçš„APIï¼Œå¹¶é€šè¿‡ä¸å…¶ä»–è¯­è¨€çš„ç»‘å®šæ¥æä¾›é€æ˜çš„è·¨è¯­è¨€äº’æ“ä½œæ€§ï¼Œä¾‹å¦‚PyGObjectã€‚</summary>
    
    
    
    <category term="Internship" scheme="http://example.com/categories/Internship/"/>
    
    
    <category term="GStreamer" scheme="http://example.com/tags/GStreamer/"/>
    
    <category term="GObject" scheme="http://example.com/tags/GObject/"/>
    
  </entry>
  
  <entry>
    <title>Deepstream æ£€æµ‹å®‰å…¨å¸½ğŸ‘·</title>
    <link href="http://example.com/2021/07/10/week-2-2/"/>
    <id>http://example.com/2021/07/10/week-2-2/</id>
    <published>2021-07-10T05:32:29.000Z</published>
    <updated>2021-07-24T06:26:21.233Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Yolov3-æ£€æµ‹å®‰å…¨å¸½"><a href="#Yolov3-æ£€æµ‹å®‰å…¨å¸½" class="headerlink" title="Yolov3 æ£€æµ‹å®‰å…¨å¸½"></a>Yolov3 æ£€æµ‹å®‰å…¨å¸½</h1><h2 id="è¿è¡Œè‡ªå¸¦yolov3ç¤ºä¾‹"><a href="#è¿è¡Œè‡ªå¸¦yolov3ç¤ºä¾‹" class="headerlink" title="è¿è¡Œè‡ªå¸¦yolov3ç¤ºä¾‹"></a>è¿è¡Œè‡ªå¸¦yolov3ç¤ºä¾‹</h2><h3 id="ç¯å¢ƒå’Œç¤ºä¾‹è¯´æ˜"><a href="#ç¯å¢ƒå’Œç¤ºä¾‹è¯´æ˜" class="headerlink" title="ç¯å¢ƒå’Œç¤ºä¾‹è¯´æ˜"></a>ç¯å¢ƒå’Œç¤ºä¾‹è¯´æ˜</h3><p><strong>è¯¥ç¤ºä¾‹æ˜¯Deepstream-5.0åœ¨Jetson Xavier NXä¸Šè¿è¡Œï¼Œå…·ä½“ç¯å¢ƒéƒ¨ç½²å¯ä»¥å‚è§<a href="https://xuhuigeren.github.io/2021/07/02/week-1/">è¿™é‡Œ</a>.</strong></p><p>ç¤ºä¾‹æ–‡ä»¶åœ¨<code>deepstram-5.0\sources\objectDetector_Yolo</code>ç›®å½•ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">|-- objectDetector_Yolo</span><br><span class="line">|   |-- config_infer_primary_yoloV2.txt</span><br><span class="line">|   |-- config_infer_primary_yoloV2_tiny.txt</span><br><span class="line">|   |-- config_infer_primary_yoloV3.txt</span><br><span class="line">|   |-- config_infer_primary_yoloV3_tiny.txt</span><br><span class="line">|   |-- deepstream_app_config_yoloV2.txt</span><br><span class="line">|   |-- deepstream_app_config_yoloV2_tiny.txt</span><br><span class="line">|   |-- deepstream_app_config_yoloV3.txt</span><br><span class="line">|   |-- deepstream_app_config_yoloV3_tiny.txt</span><br><span class="line">|   |-- labels.txt</span><br><span class="line">|   |-- prebuild.sh</span><br><span class="line">|   |-- README</span><br><span class="line">|   |-- yolov3-calibration.table.trt7.0</span><br><span class="line">|   |-- nvdsinfer_custom_impl_Yolo             </span><br><span class="line">|       |-- Makefile</span><br><span class="line">|       |-- kernels.cu</span><br><span class="line">|       |-- nvdsinfer_yolo_engine.cpp</span><br><span class="line">|       |-- nvdsparsebbox_Yolo.cpp</span><br><span class="line">|       |-- trt_utils.cpp</span><br><span class="line">|       |-- trt_utils.h</span><br><span class="line">|       |-- yolo.cpp</span><br><span class="line">|       |-- yolo.h</span><br><span class="line">|       |-- yoloPlugins.cpp</span><br><span class="line">|       |-- yoloPlugins.h</span><br></pre></td></tr></table></figure><p><strong>å½“ç„¶æ˜¯å…ˆåº·åº·<code>README</code>ï¼Œæœç„¶å†™çš„éå¸¸ç»†è‡´è¯¦å°½ï¼Œä»‹ç»äº†æ–‡ä»¶ç›®å½•ä¸­æ¯ä¸ªæ–‡ä»¶çš„å«ä¹‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Sample contents:</span><br><span class="line">- deepstream_app_config_yolo[V3,V3_tiny,V2,V2_tiny,tlt].txt - DeepStream reference</span><br><span class="line">  app configuration file for using YoloV2/yoloV2-tiny/yolo/yolo-tiny/tlt model</span><br><span class="line">  as the primary detector.</span><br><span class="line">- config_infer_primary_yolo[V3,V3_tiny,V2,V2_tiny,tlt].txt - Configuration file for the GStreamer</span><br><span class="line">  nvinfer plugin for the Yolo detector model.</span><br><span class="line">- yolov3-calibration.table.trt7.0 - yoloV3 INT8 calibration binary on TensorRT 7.0+</span><br><span class="line">- nvdsinfer_custom_impl_Yolo/nvdsinfer_yolo_engine.cpp -</span><br><span class="line">  Implementation of &#x27;NvDsInferCreateModelParser&#x27;/IModelParser for nvdsinfer to</span><br><span class="line">  parse custom models. Alternatively, also contains implementation of</span><br><span class="line">  &#x27;NvDsInferYoloCudaEngineGet&#x27; for nvdsinfer to directly create cuda engine.</span><br><span class="line">  To use the &#x27;NvDsInferYoloCudaEngineGet&#x27; interface, enable the macro</span><br><span class="line">  USE_CUDA_ENGINE_GET_API in nvdsinfer_yolo_engine.cpp</span><br><span class="line">- nvdsinfer_custom_impl_Yolo/nvdsparsebbox_Yolo.cpp - Output layer</span><br><span class="line">  parsing function for detected objects for the Yolo model.</span><br><span class="line">- nvdsinfer_custom_impl_Yolo/yoloPlugins.h -</span><br><span class="line">  Declaration of YoloLayerV3 and YoloLayerV3PluginCreator.</span><br><span class="line">- nvdsinfer_custom_impl_Yolo/yoloPlugins.cpp -</span><br><span class="line">  Implementation of YoloLayerV3 and YoloLayerV3PluginCreator.</span><br><span class="line">- nvdsinfer_custom_impl_Yolo/kernels.cu - Implementation of cuda kernels for</span><br><span class="line">- nvdsinfer_custom_impl_Yolo/trt_utils.h - Utilities to setup tensorRT networks</span><br><span class="line">- nvdsinfer_custom_impl_Yolo/trt_utils.cpp - Implementation of Utilities to setup</span><br><span class="line">   tensorRT networks</span><br><span class="line">- nvdsinfer_custom_impl_Yolo/yolo.h - Interface to create Yolo Cuda-Engine</span><br><span class="line">- nvdsinfer_custom_impl_Yolo/yolo.cpp - Implementation to create Yolo Cuda-Engine</span><br></pre></td></tr></table></figure><p><strong>ä¸‹è½½æƒé‡å’Œé…ç½®æ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Pre-requisites:</span><br><span class="line">- Download yolo config and weights files</span><br><span class="line">  $ ./prebuild.sh         # å¯ä»¥æŠŠè„šæœ¬é‡Œçš„ä¸éœ€è¦çš„éƒ¨åˆ†æ³¨é‡Šæ‰ï¼Œæé«˜ä¸‹è½½é€Ÿåº¦ã€‚</span><br><span class="line">- Set correct yolo config/weights file in config_infer_primary_yolo[...].txt.</span><br><span class="line">    custom-network-config # path to yolo config</span><br><span class="line">    model-file # path to yolo weights</span><br><span class="line">- Enable INT8 precision detection if there is a calibration cache file, update</span><br><span class="line">  config_infer_primary_yolo[...].txt.</span><br><span class="line">    int8-calib-file=yolo[...]-calibration.table.trt5.1</span><br><span class="line">- Other INT8 precision calibration table need to be calibrated by user.</span><br><span class="line">- The yolo-tlt sample makes use of a few TensorRT OSS plugins. Download the</span><br><span class="line">  TensorRT OSS repo (https://github.com/NVIDIA/TensorRT/) and checkout the</span><br><span class="line">  &#x27;release/7.0&#x27; branch. Follow the instructions in the README to build the</span><br><span class="line">  plugin library &#x27;libnvinfer_plugin.so.7.0.0&#x27; corresponding to your dGPU/Jetson</span><br><span class="line">  platform. This library needs to be used with LD_PRELOAD to let nvinfer plugin</span><br><span class="line">  access the TRT OSS plugin layers.</span><br><span class="line">- Set the path of the etlt model (tlt-encoded-model) and the tlt model key</span><br><span class="line">  (tlt-model-key) in config_infer_primary_yolo_tlt.txt before running the sample.</span><br></pre></td></tr></table></figure><p><strong>ç¼–è¯‘å·¥ç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Compile the custom library:</span><br><span class="line">  # Based on the API to use &#x27;NvDsInferCreateModelParser&#x27; or &#x27;NvDsInferCudaEngineGet&#x27;</span><br><span class="line">  # set the macro USE_CUDA_ENGINE_GET_API to 0 or 1 in</span><br><span class="line">  # nvdsinfer_custom_impl_Yolo/nvdsinfer_yolo_engine.cpp</span><br><span class="line"></span><br><span class="line">  # Export correct CUDA version (e.g. 10.2, 10.1)</span><br><span class="line">  $ export CUDA_VER=10.2</span><br><span class="line">  $ make -C nvdsinfer_custom_impl_Yolo</span><br><span class="line">  è¿™æ—¶å€™ä¼šåœ¨nvdsinfer_custom_impl_Yoloæ–‡ä»¶å¤¹é‡Œç”Ÿæˆ.soæ–‡ä»¶</span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç¤ºä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Run the sample:</span><br><span class="line">The &quot;nvinfer&quot; config file config_infer_primary_yolo.txt specifies the path to</span><br><span class="line">the custom library and the custom output parsing function through the properties</span><br><span class="line">&quot;custom-lib-path&quot; and &quot;parse-bbox-func-name&quot; respectively.</span><br><span class="line">The first-time a &quot;model_b1_int8.engine&quot; would be generated as the engine-file</span><br><span class="line"></span><br><span class="line">- With deepstream-app</span><br><span class="line">  $ deepstream-app -c deepstream_app_config_yoloV3.txt</span><br><span class="line">  $ deepstream-app -c deepstream_app_config_yoloV3_tiny.txt</span><br><span class="line">  $ deepstream-app -c deepstream_app_config_yoloV2.txt</span><br><span class="line">  $ deepstream-app -c deepstream_app_config_yoloV2_tiny.txt</span><br><span class="line">  $ LD_PRELOAD=&lt;path-to-TRT-OSS-libnvinfer_plugin.so.7.0.0&gt; deepstream-app -c deepstream_app_config_yolo_tlt.txt</span><br></pre></td></tr></table></figure><p><strong>æ£€æµ‹ç»“æœ</strong></p><p><img src="/2021/07/10/week-2-2/2-1.png" alt="1"></p><h3 id="ç¨‹åºæ³¨é‡Šå’Œç†è§£"><a href="#ç¨‹åºæ³¨é‡Šå’Œç†è§£" class="headerlink" title="ç¨‹åºæ³¨é‡Šå’Œç†è§£"></a>ç¨‹åºæ³¨é‡Šå’Œç†è§£</h3><p>è¯¥ç¨‹åºåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>ä¸€éƒ¨åˆ†æ˜¯<code>tensorRT</code>éƒ¨åˆ† å°±æ˜¯<code>sources\objectDetector_Yolo</code>æ–‡ä»¶å¤¹é‡Œçš„ï¼Œç¼–è¯‘åä¼šç”Ÿäº§åŠ¨æ€åº“æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯<code>libnvdsinfer_custom_impl_Yolo.so</code></p></li><li><p>å¦ä¸€éƒ¨åˆ†æ˜¯<code>deepstream</code>çš„æ–‡ä»¶ï¼Œåœ¨<code>sources\apps\sample_apps\deepstream-app</code>æ–‡ä»¶å¤¹é‡Œã€‚</p></li></ul><p>é¦–å…ˆè¯´æ˜ä¸‹<code>tensorRT</code>å‡ ä¸ªæ–‡ä»¶çš„å…³ç³»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|-- kernels.cucudaæ ¸æœ€åº•å±‚çš„å®ç°</span><br><span class="line">|-- nvdsinfer_yolo_engine.cppæ ¹æ®ç½‘ç»œç±»å‹åˆ›å»ºå¼•æ“,ç”Ÿæˆtensorrt engine</span><br><span class="line">|-- nvdsparsebbox_Yolo.cppyoloç›®æ ‡æ£€æµ‹ç»“æœçš„è¾“å‡º,æ¨ç†åçš„åå¤„ç†éƒ¨åˆ†</span><br><span class="line">|-- trt_utils.cppå»ºç«‹tensorRTç½‘ç»œçš„éƒ¨åˆ†</span><br><span class="line">|-- trt_utils.h</span><br><span class="line">|-- yolo.cppåˆ›å»ºå¼•æ“ã€åˆ›å»ºç½‘ç»œç­‰çš„å…·ä½“å®ç°</span><br><span class="line">|-- yolo.h</span><br><span class="line">|-- yoloPlugins.cppæ¨¡å‹æ­å»ºçš„ä¸€äº›ç»„ä»¶ä»¥åŠç›¸åº”çš„å®ç°</span><br><span class="line">|-- yoloPlugins.h</span><br></pre></td></tr></table></figure><p><img src="/2021/07/10/week-2-2/2-2.png" alt="1"></p><p>å…¶ä¸­yolo.cppå®ç°äº†ç½‘ç»œå±‚çš„æ­å»ºï¼Œæ˜¯æ ¸å¿ƒä»£ç éƒ¨åˆ†,ä¸‹é¢ä»£ç å®ç°äº†å·ç§¯å±‚çš„æ­å»ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœæ˜¯å·ç§¯å±‚</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (m_ConfigBlocks.at(i).at(<span class="string">&quot;type&quot;</span>) == <span class="string">&quot;convolutional&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">//è·å–tensorçš„å¤§å°</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> inputVol = dimsToString(previous-&gt;getDimensions());</span><br><span class="line">    nvinfer1::ILayer* out;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> layerType;<span class="comment">//ä¿å­˜ç½‘ç»œç±»å‹</span></span><br><span class="line">    <span class="comment">// check if batch_norm enabled</span></span><br><span class="line">    <span class="keyword">if</span> (m_ConfigBlocks.at(i).find(<span class="string">&quot;batch_normalize&quot;</span>) !=</span><br><span class="line">    m_ConfigBlocks.at(i).end()) &#123;</span><br><span class="line">    <span class="comment">//æœ‰BNçš„å·ç§¯å±‚</span></span><br><span class="line">    out = netAddConvBNLeaky(i, m_ConfigBlocks.at(i), weights,</span><br><span class="line">    m_TrtWeights, weightPtr, channels, previous, &amp;network);</span><br><span class="line">    layerType = <span class="string">&quot;conv-bn-leaky&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    out = netAddConvLinear(i, m_ConfigBlocks.at(i), weights,</span><br><span class="line">    m_TrtWeights, weightPtr, channels, previous, &amp;network);</span><br><span class="line">    layerType = <span class="string">&quot;conv-linear&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    previous = out-&gt;getOutput(<span class="number">0</span>);<span class="comment">//è·å–è¯¥å±‚çš„è¾“å‡º</span></span><br><span class="line">    assert(previous != <span class="literal">nullptr</span>);</span><br><span class="line">    channels = getNumChannels(previous);</span><br><span class="line">    <span class="comment">//è·å–tensorçš„å¤§å°</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> outputVol = dimsToString(previous-&gt;getDimensions());</span><br><span class="line">    <span class="comment">//ä¿å­˜ç›¸åº”çš„å±‚è¾“å‡º</span></span><br><span class="line">    tensorOutputs.push_back(out-&gt;getOutput(<span class="number">0</span>));</span><br><span class="line">    <span class="comment">//æ‰“å°å‚æ•°</span></span><br><span class="line">    printLayerInfo(layerIndex, layerType, inputVol, outputVol, <span class="built_in">std</span>::to_string(weightPtr));</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¯´æ˜ä¸€ä¸‹deepstreaméƒ¨åˆ†ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|-- deepstream-app</span><br><span class="line">|   |-- Makefile</span><br><span class="line">|   |-- README</span><br><span class="line">|   |-- deepstream_app.cpipelineçš„ä¸€äº›æ“ä½œåœ¨è¿™é‡Œ</span><br><span class="line">|   |-- deepstream_app.h</span><br><span class="line">|   |-- deepstream_app_config_parser.c é…ç½®æ–‡ä»¶çš„è§£æ</span><br><span class="line">|   |-- deepstream_app_main.c deepstreamä¸»å‡½æ•°</span><br><span class="line"></span><br><span class="line">deepstreamä¼šè°ƒç”¨åŠ¨æ€åº“æ–‡ä»¶libnvdsinfer_custom_impl_Yolo.soå®ç°ç½‘ç»œå±‚çš„æ­å»ºç­‰åŠŸèƒ½</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ä¸‹deepstream_app_main.cä¸»å‡½æ•°éƒ¨åˆ†çš„ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span></span></span><br><span class="line"><span class="function"><span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  GOptionContext *ctx = <span class="literal">NULL</span>;</span><br><span class="line">  GOptionGroup *group = <span class="literal">NULL</span>;</span><br><span class="line">  GError *error = <span class="literal">NULL</span>;</span><br><span class="line">  guint i;</span><br><span class="line">  ctx = g_option_context_new (<span class="string">&quot;Nvidia DeepStream Demo&quot;</span>);</span><br><span class="line">  group = g_option_group_new (<span class="string">&quot;abc&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">  g_option_group_add_entries (group, entries);  <span class="comment">//æŠŠentriesæ·»åŠ åˆ°group</span></span><br><span class="line">  g_option_context_set_main_group (ctx, group); <span class="comment">//groupæ·»åŠ åˆ°ctx</span></span><br><span class="line">  g_option_context_add_group (ctx, gst_init_get_option_group ());</span><br><span class="line">  GST_DEBUG_CATEGORY_INIT (NVDS_APP, <span class="string">&quot;NVDS_APP&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>);   </span><br><span class="line">  <span class="comment">// è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œè¯†åˆ«å·²æ·»åŠ åˆ°ä¸Šä¸‹æ–‡çš„é€‰é¡¹</span></span><br><span class="line">  <span class="keyword">if</span> (!g_option_context_parse (ctx, &amp;argc, &amp;argv, &amp;error)) &#123;</span><br><span class="line">    NVGSTDS_ERR_MSG_V (<span class="string">&quot;%s&quot;</span>, error-&gt;message);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (print_version) &#123;</span><br><span class="line">    g_print (<span class="string">&quot;deepstream-app version %d.%d.%d\n&quot;</span>,</span><br><span class="line">        NVDS_APP_VERSION_MAJOR, NVDS_APP_VERSION_MINOR, NVDS_APP_VERSION_MICRO);</span><br><span class="line">    nvds_version_print ();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (print_dependencies_version) &#123;</span><br><span class="line">    g_print (<span class="string">&quot;deepstream-app version %d.%d.%d\n&quot;</span>,</span><br><span class="line">        NVDS_APP_VERSION_MAJOR, NVDS_APP_VERSION_MINOR, NVDS_APP_VERSION_MICRO);</span><br><span class="line">    nvds_version_print ();</span><br><span class="line">    nvds_dependencies_version_print ();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (cfg_files) &#123;<span class="comment">//ä¸€èˆ¬æ‰§è¡Œè¿™é¡¹</span></span><br><span class="line">    num_instances = g_strv_length (cfg_files);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (input_files) &#123;</span><br><span class="line">    num_input_files = g_strv_length (input_files);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!cfg_files || num_instances == <span class="number">0</span>) &#123;</span><br><span class="line">    NVGSTDS_ERR_MSG_V (<span class="string">&quot;Specify config file with -c option&quot;</span>);</span><br><span class="line">    return_value = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">goto</span> done;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_instances; i++) &#123;</span><br><span class="line">    appCtx[i] = g_malloc0 (<span class="keyword">sizeof</span> (AppCtx));</span><br><span class="line">    appCtx[i]-&gt;person_class_id = <span class="number">-1</span>;</span><br><span class="line">    appCtx[i]-&gt;car_class_id = <span class="number">-1</span>;</span><br><span class="line">    appCtx[i]-&gt;index = i;</span><br><span class="line">    appCtx[i]-&gt;active_source_index = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (show_bbox_text) &#123;</span><br><span class="line">      appCtx[i]-&gt;show_bbox_text = TRUE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (input_files &amp;&amp; input_files[i]) &#123;</span><br><span class="line">      appCtx[i]-&gt;config.multi_source_config[<span class="number">0</span>].uri =</span><br><span class="line">          g_strdup_printf (<span class="string">&quot;file://%s&quot;</span>, input_files[i]);</span><br><span class="line">      g_free (input_files[i]);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è§£æé…ç½®æ–‡ä»¶å†…å®¹ï¼Œè¿™æ˜¯ä¸ªé‡ç‚¹å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (!parse_config_file (&amp;appCtx[i]-&gt;config, cfg_files[i])) &#123;</span><br><span class="line">      NVGSTDS_ERR_MSG_V (<span class="string">&quot;Failed to parse config file &#x27;%s&#x27;&quot;</span>, cfg_files[i]);</span><br><span class="line">      appCtx[i]-&gt;return_value = <span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é’ˆå¯¹é…ç½®è¿›è¡Œåˆ›å»ºpipelineï¼Œè¿™é‡Œæ˜¯å…³é”®éƒ¨åˆ†deepstreaméƒ¨åˆ†</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_instances; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!create_pipeline (appCtx[i], <span class="literal">NULL</span>,</span><br><span class="line">            all_bbox_generated, perf_cb, overlay_graphics)) &#123;</span><br><span class="line">      NVGSTDS_ERR_MSG_V (<span class="string">&quot;Failed to create pipeline&quot;</span>);</span><br><span class="line">      return_value = <span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  main_loop = g_main_loop_new (<span class="literal">NULL</span>, FALSE);</span><br><span class="line">  _intr_setup ();</span><br><span class="line">  g_timeout_add (<span class="number">400</span>, check_for_interrupt, <span class="literal">NULL</span>);</span><br><span class="line">  g_mutex_init (&amp;disp_lock);</span><br><span class="line">  <span class="comment">// è¿™éƒ¨åˆ†æ˜¯æ˜¾ç¤ºç›¸å…³çš„å†…å®¹</span></span><br><span class="line">  display = XOpenDisplay (<span class="literal">NULL</span>);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_instances; i++) &#123;</span><br><span class="line">    guint j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (gst_element_set_state (appCtx[i]-&gt;pipeline.pipeline,</span><br><span class="line">            GST_STATE_PAUSED) == GST_STATE_CHANGE_FAILURE) &#123;</span><br><span class="line">      NVGSTDS_ERR_MSG_V (<span class="string">&quot;Failed to set pipeline to PAUSED&quot;</span>);</span><br><span class="line">      return_value = <span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!appCtx[i]-&gt;config.tiled_display_config.enable)</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; appCtx[i]-&gt;config.num_sink_sub_bins; j++) &#123;</span><br><span class="line">      XTextProperty xproperty;</span><br><span class="line">      gchar *title;</span><br><span class="line">      guint width, height;</span><br><span class="line">      XSizeHints hints = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">      <span class="keyword">if</span> (!GST_IS_VIDEO_OVERLAY (appCtx[i]-&gt;pipeline.instance_bins[<span class="number">0</span>].</span><br><span class="line">              sink_bin.sub_bins[j].sink)) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!display) &#123;</span><br><span class="line">        NVGSTDS_ERR_MSG_V (<span class="string">&quot;Could not open X Display&quot;</span>);</span><br><span class="line">        return_value = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">      &#125;</span><br><span class="line">  <span class="comment">// æ˜¾ç¤ºè®¾ç½®</span></span><br><span class="line">      <span class="keyword">if</span> (appCtx[i]-&gt;config.sink_bin_sub_bin_config[j].render_config.width)</span><br><span class="line">        width =</span><br><span class="line">            appCtx[i]-&gt;config.sink_bin_sub_bin_config[j].render_config.width;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        width = appCtx[i]-&gt;config.tiled_display_config.width;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (appCtx[i]-&gt;config.sink_bin_sub_bin_config[j].render_config.height)</span><br><span class="line">        height =</span><br><span class="line">            appCtx[i]-&gt;config.sink_bin_sub_bin_config[j].render_config.height;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        height = appCtx[i]-&gt;config.tiled_display_config.height;</span><br><span class="line">      width = (width) ? width : DEFAULT_X_WINDOW_WIDTH;</span><br><span class="line">      height = (height) ? height : DEFAULT_X_WINDOW_HEIGHT;</span><br><span class="line">      hints.flags = PPosition | PSize;</span><br><span class="line">      hints.x = appCtx[i]-&gt;config.sink_bin_sub_bin_config[j].render_config.offset_x;</span><br><span class="line">      hints.y = appCtx[i]-&gt;config.sink_bin_sub_bin_config[j].render_config.offset_y;</span><br><span class="line">      hints.width = width;</span><br><span class="line">      hints.height = height;</span><br><span class="line">      windows[i] =</span><br><span class="line">          XCreateSimpleWindow (display, RootWindow (display,</span><br><span class="line">              DefaultScreen (display)), hints.x, hints.y, width, height, <span class="number">2</span>,</span><br><span class="line">              <span class="number">0x00000000</span>, <span class="number">0x00000000</span>);</span><br><span class="line">      XSetNormalHints(display, windows[i], &amp;hints);</span><br><span class="line">      <span class="keyword">if</span> (num_instances &gt; <span class="number">1</span>)</span><br><span class="line">        title = g_strdup_printf (APP_TITLE <span class="string">&quot;-%d&quot;</span>, i);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        title = g_strdup (APP_TITLE);</span><br><span class="line">      <span class="keyword">if</span> (XStringListToTextProperty ((<span class="keyword">char</span> **) &amp;title, <span class="number">1</span>, &amp;xproperty) != <span class="number">0</span>) &#123;</span><br><span class="line">        XSetWMName (display, windows[i], &amp;xproperty);</span><br><span class="line">        XFree (xproperty.value);</span><br><span class="line">      &#125;</span><br><span class="line">      XSetWindowAttributes attr = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">      <span class="keyword">if</span> ((appCtx[i]-&gt;config.tiled_display_config.enable &amp;&amp;</span><br><span class="line">              appCtx[i]-&gt;config.tiled_display_config.rows *</span><br><span class="line">              appCtx[i]-&gt;config.tiled_display_config.columns == <span class="number">1</span>) ||</span><br><span class="line">          (appCtx[i]-&gt;config.tiled_display_config.enable == <span class="number">0</span> &amp;&amp;</span><br><span class="line">              appCtx[i]-&gt;config.num_source_sub_bins == <span class="number">1</span>)) &#123;</span><br><span class="line">        attr.event_mask = KeyPress;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        attr.event_mask = ButtonPress | KeyRelease;</span><br><span class="line">      &#125;</span><br><span class="line">      XChangeWindowAttributes (display, windows[i], CWEventMask, &amp;attr);</span><br><span class="line"></span><br><span class="line">      Atom wmDeleteMessage = XInternAtom (display, <span class="string">&quot;WM_DELETE_WINDOW&quot;</span>, False);</span><br><span class="line">      <span class="keyword">if</span> (wmDeleteMessage != None) &#123;</span><br><span class="line">        XSetWMProtocols (display, windows[i], &amp;wmDeleteMessage, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      XMapRaised (display, windows[i]);</span><br><span class="line">      XSync (display, <span class="number">1</span>);       <span class="comment">//discard the events for now</span></span><br><span class="line">      gst_video_overlay_set_window_handle (GST_VIDEO_OVERLAY (appCtx</span><br><span class="line">              [i]-&gt;pipeline.instance_bins[<span class="number">0</span>].sink_bin.sub_bins[j].sink),</span><br><span class="line">          (gulong) windows[i]);</span><br><span class="line">      gst_video_overlay_expose (GST_VIDEO_OVERLAY (appCtx[i]-&gt;</span><br><span class="line">              pipeline.instance_bins[<span class="number">0</span>].sink_bin.sub_bins[j].sink));</span><br><span class="line">      <span class="keyword">if</span> (!x_event_thread)</span><br><span class="line">        x_event_thread = g_thread_new (<span class="string">&quot;nvds-window-event-thread&quot;</span>,</span><br><span class="line">            nvds_x_event_thread, <span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* Dont try to set playing state if error is observed */</span> </span><br><span class="line">  <span class="comment">// å‘ç”Ÿé”™è¯¯çš„å¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (return_value != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_instances; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (gst_element_set_state (appCtx[i]-&gt;pipeline.pipeline,</span><br><span class="line">              GST_STATE_PLAYING) == GST_STATE_CHANGE_FAILURE) &#123;</span><br><span class="line"></span><br><span class="line">        g_print (<span class="string">&quot;\ncan&#x27;t set pipeline to playing state.\n&quot;</span>);</span><br><span class="line">        return_value = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  print_runtime_commands ();</span><br><span class="line">  changemode (<span class="number">1</span>);</span><br><span class="line">  g_timeout_add (<span class="number">40</span>, event_thread_func, <span class="literal">NULL</span>);</span><br><span class="line">  g_main_loop_run (main_loop);</span><br><span class="line">  changemode (<span class="number">0</span>);</span><br><span class="line">done:</span><br><span class="line">  g_print (<span class="string">&quot;Quitting\n&quot;</span>);</span><br><span class="line">  <span class="comment">// ä¸‹é¢æ˜¯é‡Šæ”¾èµ„æº</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_instances; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (appCtx[i]-&gt;return_value == <span class="number">-1</span>)</span><br><span class="line">      return_value = <span class="number">-1</span>;</span><br><span class="line">    destroy_pipeline (appCtx[i]);</span><br><span class="line"></span><br><span class="line">    g_mutex_lock (&amp;disp_lock);</span><br><span class="line">    <span class="keyword">if</span> (windows[i])</span><br><span class="line">      XDestroyWindow (display, windows[i]);</span><br><span class="line">    windows[i] = <span class="number">0</span>;</span><br><span class="line">    g_mutex_unlock (&amp;disp_lock);</span><br><span class="line">    g_free (appCtx[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  g_mutex_lock (&amp;disp_lock);</span><br><span class="line">  <span class="keyword">if</span> (display)</span><br><span class="line">    XCloseDisplay (display);</span><br><span class="line">  display = <span class="literal">NULL</span>;</span><br><span class="line">  g_mutex_unlock (&amp;disp_lock);</span><br><span class="line">  g_mutex_clear (&amp;disp_lock);</span><br><span class="line">  <span class="keyword">if</span> (main_loop) &#123;</span><br><span class="line">    g_main_loop_unref (main_loop);<span class="comment">//æ‰§è¡Œå¾ªç¯æ¨ç†</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (ctx) &#123;</span><br><span class="line">    g_option_context_free (ctx);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (return_value == <span class="number">0</span>) &#123;</span><br><span class="line">    g_print (<span class="string">&quot;App run successful\n&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    g_print (<span class="string">&quot;App run failed\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  gst_deinit ();</span><br><span class="line">  <span class="keyword">return</span> return_value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯<code>deepstream_app_config_parser.c</code>è§£æé…ç½®æ–‡ä»¶çš„ä»£ç ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">gboolean</span></span><br><span class="line"><span class="function"><span class="title">parse_config_file</span> <span class="params">(NvDsConfig *config, gchar *cfg_file_path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  GKeyFile *cfg_file = g_key_file_new ();</span><br><span class="line">  GError *error = <span class="literal">NULL</span>;</span><br><span class="line">  gboolean ret = FALSE;</span><br><span class="line">  gchar **groups = <span class="literal">NULL</span>;</span><br><span class="line">  gchar **group;</span><br><span class="line">  guint i, j;</span><br><span class="line"></span><br><span class="line">  config-&gt;source_list_enabled = FALSE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!APP_CFG_PARSER_CAT) &#123;</span><br><span class="line">    GST_DEBUG_CATEGORY_INIT (APP_CFG_PARSER_CAT, <span class="string">&quot;NVDS_CFG_PARSER&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!g_key_file_load_from_file (cfg_file, cfg_file_path, G_KEY_FILE_NONE,</span><br><span class="line">          &amp;error)) &#123;</span><br><span class="line">    GST_CAT_ERROR (APP_CFG_PARSER_CAT, <span class="string">&quot;Failed to load uri file: %s&quot;</span>,</span><br><span class="line">        error-&gt;message);</span><br><span class="line">    <span class="keyword">goto</span> done;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (g_key_file_has_group (cfg_file, CONFIG_GROUP_SOURCE_LIST)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!parse_source_list (config, cfg_file, cfg_file_path)) &#123;</span><br><span class="line">      GST_CAT_ERROR (APP_CFG_PARSER_CAT, <span class="string">&quot;Failed to parse &#x27;%s&#x27; group&quot;</span>,</span><br><span class="line">          CONFIG_GROUP_SOURCE_LIST);</span><br><span class="line">      <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line">    config-&gt;num_source_sub_bins = config-&gt;total_num_sources;</span><br><span class="line">    config-&gt;source_list_enabled = TRUE;</span><br><span class="line">    <span class="keyword">if</span> (!g_key_file_has_group (cfg_file, CONFIG_GROUP_SOURCE_ALL)) &#123;</span><br><span class="line">      NVGSTDS_ERR_MSG_V (<span class="string">&quot;[source-attr-all] group not present.&quot;</span>);</span><br><span class="line">      ret = FALSE;</span><br><span class="line">      <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line">    g_key_file_remove_group (cfg_file, CONFIG_GROUP_SOURCE_LIST, &amp;error);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (g_key_file_has_group (cfg_file, CONFIG_GROUP_SOURCE_ALL)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!parse_source (&amp;global_source_config,</span><br><span class="line">            cfg_file, CONFIG_GROUP_SOURCE_ALL, cfg_file_path)) &#123;</span><br><span class="line">      GST_CAT_ERROR (APP_CFG_PARSER_CAT, <span class="string">&quot;Failed to parse &#x27;%s&#x27; group&quot;</span>,</span><br><span class="line">          CONFIG_GROUP_SOURCE_LIST);</span><br><span class="line">      <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!set_source_all_configs (config, cfg_file_path)) &#123;</span><br><span class="line">      ret = FALSE;</span><br><span class="line">      <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line">    g_key_file_remove_group (cfg_file, CONFIG_GROUP_SOURCE_ALL, &amp;error);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¿¡æ¯å­˜å‚¨åœ¨é‡Œcfg_fileé‡Œé¢</span></span><br><span class="line">  groups = g_key_file_get_groups (cfg_file, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="comment">//è¿™é‡Œå¯¹åº”çš„æ˜¯8é¡¹  </span></span><br><span class="line">  <span class="comment">//group[0]=application</span></span><br><span class="line">  <span class="comment">//group[1]=tiled-display</span></span><br><span class="line">  <span class="comment">//group[2]=source0</span></span><br><span class="line">  <span class="comment">//group[3]=sink0</span></span><br><span class="line">  <span class="comment">//group[4]=osd</span></span><br><span class="line">  <span class="comment">//group[5]=streammux</span></span><br><span class="line">  <span class="comment">//group[6]=primary-gie</span></span><br><span class="line">  <span class="comment">//group[7]=tracker</span></span><br><span class="line">  <span class="comment">//group[8]=tests</span></span><br><span class="line">  <span class="keyword">for</span> (group = groups; *group; group++) &#123;</span><br><span class="line">    gboolean parse_err = FALSE;</span><br><span class="line">    GST_CAT_DEBUG (APP_CFG_PARSER_CAT, <span class="string">&quot;Parsing group: %s&quot;</span>, *group);</span><br><span class="line">    <span class="comment">// application </span></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_APP)) &#123;</span><br><span class="line">      parse_err = !parse_app (config, cfg_file, cfg_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// source0  </span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">strncmp</span> (*group, CONFIG_GROUP_SOURCE,</span><br><span class="line">            <span class="keyword">sizeof</span> (CONFIG_GROUP_SOURCE) - <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;num_source_sub_bins == MAX_SOURCE_BINS) &#123;</span><br><span class="line">        NVGSTDS_ERR_MSG_V (<span class="string">&quot;App supports max %d sources&quot;</span>, MAX_SOURCE_BINS);</span><br><span class="line">        ret = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">      &#125;</span><br><span class="line">      gchar *source_id_start_ptr = *group + <span class="built_in">strlen</span> (CONFIG_GROUP_SOURCE);</span><br><span class="line">      gchar *source_id_end_ptr = <span class="literal">NULL</span>;</span><br><span class="line">      guint index =</span><br><span class="line">          g_ascii_strtoull (source_id_start_ptr, &amp;source_id_end_ptr, <span class="number">10</span>);</span><br><span class="line">      <span class="keyword">if</span> (source_id_start_ptr == source_id_end_ptr</span><br><span class="line">          || *source_id_end_ptr != <span class="string">&#x27;\0&#x27;</span>) &#123;</span><br><span class="line">        NVGSTDS_ERR_MSG_V</span><br><span class="line">            (<span class="string">&quot;Source group \&quot;[%s]\&quot; is not in the form \&quot;[source&lt;%%d&gt;]\&quot;&quot;</span>,</span><br><span class="line">            *group);</span><br><span class="line">        ret = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">      &#125;</span><br><span class="line">      guint source_id = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;source_list_enabled) &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= config-&gt;total_num_sources) &#123;</span><br><span class="line">          NVGSTDS_ERR_MSG_V</span><br><span class="line">              (<span class="string">&quot;Invalid source group index %d, index cannot exceed %d&quot;</span>, index,</span><br><span class="line">              config-&gt;total_num_sources);</span><br><span class="line">          ret = FALSE;</span><br><span class="line">          <span class="keyword">goto</span> done;</span><br><span class="line">        &#125;</span><br><span class="line">        source_id = index;</span><br><span class="line">        NVGSTDS_INFO_MSG_V (<span class="string">&quot;Some parameters to be overwritten for group [%s]&quot;</span>,</span><br><span class="line">            *group);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        source_id = config-&gt;num_source_sub_bins;</span><br><span class="line">      &#125;</span><br><span class="line">      parse_err = !parse_source (&amp;config-&gt;multi_source_config[source_id],</span><br><span class="line">          cfg_file, *group, cfg_file_path);</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;source_list_enabled</span><br><span class="line">          &amp;&amp; config-&gt;multi_source_config[source_id].type ==</span><br><span class="line">          NV_DS_SOURCE_URI_MULTIPLE) &#123;</span><br><span class="line">        NVGSTDS_ERR_MSG_V</span><br><span class="line">            (<span class="string">&quot;MultiURI support not available if [source-list] is provided&quot;</span>);</span><br><span class="line">        ret = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;multi_source_config[source_id].enable</span><br><span class="line">          &amp;&amp; !config-&gt;source_list_enabled) &#123;</span><br><span class="line">        config-&gt;num_source_sub_bins++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// streammux</span></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_STREAMMUX)) &#123;</span><br><span class="line">      <span class="comment">// å­˜å‚¨åˆ°config-&gt;streammux_configä¸­</span></span><br><span class="line">      parse_err = !parse_streammux (&amp;config-&gt;streammux_config, cfg_file, cfg_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// osd</span></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_OSD)) &#123;</span><br><span class="line">      parse_err = !parse_osd (&amp;config-&gt;osd_config, cfg_file);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// primary_gie</span></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_PRIMARY_GIE)) &#123;</span><br><span class="line">      parse_err =</span><br><span class="line">          !parse_gie (&amp;config-&gt;primary_gie_config, cfg_file,</span><br><span class="line">          CONFIG_GROUP_PRIMARY_GIE, cfg_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_TRACKER)) &#123;</span><br><span class="line">      parse_err = !parse_tracker (&amp;config-&gt;tracker_config, cfg_file, cfg_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">strncmp</span> (*group, CONFIG_GROUP_SECONDARY_GIE,</span><br><span class="line">                  <span class="keyword">sizeof</span> (CONFIG_GROUP_SECONDARY_GIE) - <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;num_secondary_gie_sub_bins == MAX_SECONDARY_GIE_BINS) &#123;</span><br><span class="line">        NVGSTDS_ERR_MSG_V (<span class="string">&quot;App supports max %d secondary GIEs&quot;</span>, MAX_SECONDARY_GIE_BINS);</span><br><span class="line">        ret = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">      &#125;</span><br><span class="line">      parse_err =</span><br><span class="line">          !parse_gie (&amp;config-&gt;secondary_gie_sub_bin_config[config-&gt;</span><br><span class="line">                                  num_secondary_gie_sub_bins],</span><br><span class="line">                                  cfg_file, *group, cfg_file_path);</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;secondary_gie_sub_bin_config[config-&gt;num_secondary_gie_sub_bins].enable)&#123;</span><br><span class="line">        config-&gt;num_secondary_gie_sub_bins++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">strncmp</span> (*group, CONFIG_GROUP_SINK, <span class="keyword">sizeof</span> (CONFIG_GROUP_SINK) - <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;num_sink_sub_bins == MAX_SINK_BINS) &#123;</span><br><span class="line">        NVGSTDS_ERR_MSG_V (<span class="string">&quot;App supports max %d sinks&quot;</span>, MAX_SINK_BINS);</span><br><span class="line">        ret = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">      &#125;</span><br><span class="line">      parse_err =</span><br><span class="line">          !parse_sink (&amp;config-&gt;</span><br><span class="line">          sink_bin_sub_bin_config[config-&gt;num_sink_sub_bins], cfg_file, *group,</span><br><span class="line">          cfg_file_path);</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;</span><br><span class="line">          sink_bin_sub_bin_config[config-&gt;num_sink_sub_bins].enable)&#123;</span><br><span class="line">        config-&gt;num_sink_sub_bins++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">strncmp</span> (*group, CONFIG_GROUP_MSG_CONSUMER,</span><br><span class="line">        <span class="keyword">sizeof</span> (CONFIG_GROUP_MSG_CONSUMER) - <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;num_message_consumers == MAX_MESSAGE_CONSUMERS) &#123;</span><br><span class="line">        NVGSTDS_ERR_MSG_V (<span class="string">&quot;App supports max %d consumers&quot;</span>, MAX_MESSAGE_CONSUMERS);</span><br><span class="line">        ret = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">      &#125;</span><br><span class="line">      parse_err = !parse_msgconsumer (</span><br><span class="line">                    &amp;config-&gt;message_consumer_config[config-&gt;num_message_consumers],</span><br><span class="line">                    cfg_file, *group, cfg_file_path);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (config-&gt;message_consumer_config[config-&gt;num_message_consumers].enable) &#123;</span><br><span class="line">        config-&gt;num_message_consumers++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// tiled-display</span></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_TILED_DISPLAY)) &#123;</span><br><span class="line">      parse_err = !parse_tiled_display (&amp;config-&gt;tiled_display_config, cfg_file);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_IMG_SAVE)) &#123;</span><br><span class="line">      parse_err = !parse_image_save (&amp;config-&gt;image_save_config , cfg_file, *group, cfg_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_DSANALYTICS)) &#123;</span><br><span class="line">      parse_err = !parse_dsanalytics (&amp;config-&gt;dsanalytics_config, cfg_file, cfg_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_DSEXAMPLE)) &#123;</span><br><span class="line">      parse_err = !parse_dsexample (&amp;config-&gt;dsexample_config, cfg_file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_MSG_CONVERTER)) &#123;</span><br><span class="line">      parse_err = !parse_msgconv (&amp;config-&gt;msg_conv_config, cfg_file, *group, cfg_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// tests</span></span><br><span class="line">    <span class="keyword">if</span> (!g_strcmp0 (*group, CONFIG_GROUP_TESTS)) &#123;</span><br><span class="line">      parse_err = !parse_tests (config, cfg_file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parse_err) &#123;</span><br><span class="line">      GST_CAT_ERROR (APP_CFG_PARSER_CAT, <span class="string">&quot;Failed to parse &#x27;%s&#x27; group&quot;</span>, *group);</span><br><span class="line">      <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// äºŒçº§ç½‘ç»œå¤„ç†</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; config-&gt;num_secondary_gie_sub_bins; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (config-&gt;secondary_gie_sub_bin_config[i].unique_id ==</span><br><span class="line">        config-&gt;primary_gie_config.unique_id) &#123;</span><br><span class="line">      NVGSTDS_ERR_MSG_V (<span class="string">&quot;Non unique gie ids found&quot;</span>);</span><br><span class="line">      ret = FALSE;</span><br><span class="line">      <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; config-&gt;num_secondary_gie_sub_bins; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = i + <span class="number">1</span>; j &lt; config-&gt;num_secondary_gie_sub_bins; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;secondary_gie_sub_bin_config[i].unique_id ==</span><br><span class="line">          config-&gt;secondary_gie_sub_bin_config[j].unique_id) &#123;</span><br><span class="line">        NVGSTDS_ERR_MSG_V (<span class="string">&quot;Non unique gie id %d found&quot;</span>,</span><br><span class="line">                            config-&gt;secondary_gie_sub_bin_config[i].unique_id);</span><br><span class="line">        ret = FALSE;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¤šè¾“å…¥æºå¤„ç†</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; config-&gt;num_source_sub_bins; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (config-&gt;multi_source_config[i].type == NV_DS_SOURCE_URI_MULTIPLE) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config-&gt;multi_source_config[i].num_sources &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        config-&gt;multi_source_config[i].num_sources = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; config-&gt;multi_source_config[i].num_sources; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (config-&gt;num_source_sub_bins == MAX_SOURCE_BINS) &#123;</span><br><span class="line">          NVGSTDS_ERR_MSG_V (<span class="string">&quot;App supports max %d sources&quot;</span>, MAX_SOURCE_BINS);</span><br><span class="line">          ret = FALSE;</span><br><span class="line">          <span class="keyword">goto</span> done;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memcpy</span> (&amp;config-&gt;multi_source_config[config-&gt;num_source_sub_bins],</span><br><span class="line">            &amp;config-&gt;multi_source_config[i],</span><br><span class="line">            <span class="keyword">sizeof</span> (config-&gt;multi_source_config[i]));</span><br><span class="line">        config-&gt;multi_source_config[config-&gt;num_source_sub_bins].type =</span><br><span class="line">            NV_DS_SOURCE_URI;</span><br><span class="line">        config-&gt;multi_source_config[config-&gt;num_source_sub_bins].uri =</span><br><span class="line">            g_strdup_printf (config-&gt;multi_source_config[config-&gt;</span><br><span class="line">                num_source_sub_bins].uri, j);</span><br><span class="line">        config-&gt;num_source_sub_bins++;</span><br><span class="line">      &#125;</span><br><span class="line">      config-&gt;multi_source_config[i].type = NV_DS_SOURCE_URI;</span><br><span class="line">      config-&gt;multi_source_config[i].uri =</span><br><span class="line">          g_strdup_printf (config-&gt;multi_source_config[i].uri, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ret = TRUE;</span><br><span class="line"></span><br><span class="line">done:</span><br><span class="line">  <span class="keyword">if</span> (cfg_file) &#123;</span><br><span class="line">    g_key_file_free (cfg_file);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (groups) &#123;</span><br><span class="line">    g_strfreev (groups);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    g_error_free (error);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!ret) &#123;</span><br><span class="line">    NVGSTDS_ERR_MSG_V (<span class="string">&quot;%s failed&quot;</span>, __func__);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæ˜¯å»ºç«‹<code>pipeline</code>çš„ä»£ç ï¼Œå»ºç«‹<code>pipeline</code>æ˜¯å±äº<code>deepstream</code>çš„éƒ¨åˆ†ï¼Œé‡Œé¢åŒ…å«äº†<code>tensorRT</code>çš„è°ƒç”¨ã€‚é…ç½®æ–‡ä»¶å½“ä¸­çš„<code>[primary-gie]</code>æ˜¯å¯¹æ¨ç†å¼•æ“çš„ç›¸å…³é…ç½®ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶å¯ä»¥å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œè®¾ç½®ã€‚</p><h2 id="ä½¿ç”¨yolov3æ£€æµ‹å®‰å…¨å¸½ğŸ‘·"><a href="#ä½¿ç”¨yolov3æ£€æµ‹å®‰å…¨å¸½ğŸ‘·" class="headerlink" title="ä½¿ç”¨yolov3æ£€æµ‹å®‰å…¨å¸½ğŸ‘·"></a>ä½¿ç”¨yolov3æ£€æµ‹å®‰å…¨å¸½ğŸ‘·</h2><h3 id="æ•°æ®å‡†å¤‡"><a href="#æ•°æ®å‡†å¤‡" class="headerlink" title="æ•°æ®å‡†å¤‡"></a>æ•°æ®å‡†å¤‡</h3><p>æ¨¡å‹é…ç½®æ–‡ä»¶ï¼š<code>yolov3_half_helmet.cfg</code><br>æ¨¡å‹æƒé‡æ–‡ä»¶ï¼š<code>yolov3_half_helmet.weights</code><br>æ¨¡å‹ç±»åˆ«ï¼š3  ï¼Œ 0-æ­£å¸¸å¤´è‚©ï¼Œ1-ä¿å®‰å¤´è‚©ï¼Œ2-å®‰å…¨å¸½å¤´è‚© è§<code>helmet.names</code><br>æµ‹è¯•è§†é¢‘æ–‡ä»¶ï¼š<code>test_helmet_1.mp4</code>    <code> test_personcount.mp4</code></p><h3 id="æ£€æµ‹ä»»åŠ¡"><a href="#æ£€æµ‹ä»»åŠ¡" class="headerlink" title="æ£€æµ‹ä»»åŠ¡"></a>æ£€æµ‹ä»»åŠ¡</h3><p>â‘ ä½¿ç”¨<code>deepstream</code>æ„å»ºä¸€ä¸ª<code>pipeline</code>ï¼Œæ£€æµ‹<code>test_helmet_1.mp4</code>ï¼Œè¾“å‡ºç”»é¢ä¸­æ­£å¸¸å¤´è‚©ç”»çº¢æ¡†ï¼Œä¿å®‰å¤´è‚©ç”»è“æ¡†ï¼Œå®‰å…¨å¸½å¤´è‚©ç”»ç»¿æ¡†<br>â‘¡æµ‹è¯•å®‰å…¨å¸½æ£€æµ‹ å‰å¤„ç†ï¼Œæ¨ç†ï¼Œåå¤„ç†æ‰€ç”¨çš„æ—¶é—´<br>â‘¢ä½¿ç”¨<code>deepstream</code>æ„å»ºå¤šçº¿ç¨‹<code>pipeline</code>ï¼Œä½¿ç”¨å®‰å…¨å¸½æ£€æµ‹æ¨¡å‹åŒæ—¶æ£€æµ‹2ä¸ªè§†é¢‘æ–‡ä»¶</p><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>å¯¹äºè‡ªå®šä¹‰æ•°æ®çš„æ£€æµ‹ï¼Œéœ€æ ¹æ®è‡ªå·±æ£€æµ‹çš„ç±»åˆ«ä¿®æ”¹å¦‚ä¸‹æ–‡ä»¶</p><p>ä¿®æ”¹<code>nvdsinfer_custom_impl_Yolo/nvdsparsebbox_Yolo.cpp</code>æ–‡ä»¶ä¸­æ£€æµ‹ç±»åˆ«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># é»˜è®¤æ£€æµ‹cocoæ•°æ®é›†80ä¸ªç±»åˆ«ï¼Œä¿®æ”¹ä¸ºä½ è‡ªå·±æ£€æµ‹çš„ç±»åˆ«</span><br><span class="line">static const int NUM_CLASSES_YOLO = 3;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¿®æ”¹å®Œéœ€è¦é‡æ–°ç¼–è¯‘å’Œè¿è¡Œç”Ÿæˆé“¾æ¥çš„<code>.so</code>æ–‡ä»¶</p><p>ä¿®æ”¹<code>config_infer_primary_yoloV3.txt</code>æ–‡ä»¶ï¼Œä¿®æ”¹<code>cfg</code>å’Œ<code>weights</code>ç­‰æ–‡ä»¶ï¼Œæ ¹æ®è‡ªå·±æ£€æµ‹çš„ç±»åˆ«è®¾ç½®<code>num-detected-classes</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[property]</span><br><span class="line">gpu-id=0</span><br><span class="line">net-scale-factor=0.0039215697906911373</span><br><span class="line">#0=RGB, 1=BGR</span><br><span class="line">model-color-format=0</span><br><span class="line">#ä¿®æ”¹cfgæ–‡ä»¶</span><br><span class="line">custom-network-config=yolov3_half_helmet_20200607.cfg</span><br><span class="line">#ä¿®æ”¹weightsæ–‡ä»¶</span><br><span class="line">model-file=yolov3_half_helmet_20200607.weights</span><br><span class="line">#model-engine-file=yolov3_b1_gpu0_int8.engine</span><br><span class="line">#ä¿®æ”¹labelæ–‡ä»¶</span><br><span class="line">labelfile-path=helmet_names.txt</span><br><span class="line">int8-calib-file=yolov3-calibration.table.trt7.0</span><br><span class="line">## 0=FP32, 1=INT8, 2=FP16 mode</span><br><span class="line">network-mode=1</span><br><span class="line">#æ¨¡å‹ç±»åˆ«:3 0-æ­£å¸¸å¤´è‚©ï¼Œ1-ä¿å®‰å¤´è‚©ï¼Œ2-å®‰å…¨å¸½å¤´è‚©</span><br><span class="line">num-detected-classes=3</span><br><span class="line">gie-unique-id=1</span><br><span class="line">network-type=0</span><br><span class="line">is-classifier=0</span><br><span class="line">## 0=Group Rectangles, 1=DBSCAN, 2=NMS, 3= DBSCAN+NMS Hybrid, 4 = None(No clustering)</span><br><span class="line">cluster-mode=2</span><br><span class="line">maintain-aspect-ratio=1</span><br><span class="line">parse-bbox-func-name=NvDsInferParseCustomYoloV3</span><br><span class="line"># ç¼–è¯‘çš„åŠ¨æ€åº“è·¯å¾„</span><br><span class="line">custom-lib-path=nvdsinfer_custom_impl_Yolo/libnvdsinfer_custom_impl_Yolo.so</span><br><span class="line">engine-create-func-name=NvDsInferYoloCudaEngineGet</span><br><span class="line">#scaling-filter=0</span><br><span class="line">#scaling-compute-hw=0</span><br><span class="line"></span><br><span class="line">[class-attrs-all]</span><br><span class="line">nms-iou-threshold=0.3# NMSçš„é˜ˆå€¼</span><br><span class="line">#threshold=0.7</span><br><span class="line">pre-cluster-threshold=0.7   # æ£€æµ‹æ¡†çš„è¿‡æ»¤é˜ˆå€¼</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>deepstream_app_config_yoloV3.txt</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">[application]</span><br><span class="line">enable-perf-measurement=1</span><br><span class="line">perf-measurement-interval-sec=5</span><br><span class="line">#gie-kitti-output-dir=streamscl</span><br><span class="line"></span><br><span class="line">[tiled-display]</span><br><span class="line">enable=1</span><br><span class="line">rows=1</span><br><span class="line">columns=1</span><br><span class="line">width=1280</span><br><span class="line">height=720</span><br><span class="line">gpu-id=0</span><br><span class="line">#(0): nvbuf-mem-default - Default memory allocated, specific to particular platform</span><br><span class="line">#(1): nvbuf-mem-cuda-pinned - Allocate Pinned/Host cuda memory, applicable for Tesla</span><br><span class="line">#(2): nvbuf-mem-cuda-device - Allocate Device cuda memory, applicable for Tesla</span><br><span class="line">#(3): nvbuf-mem-cuda-unified - Allocate Unified cuda memory, applicable for Tesla</span><br><span class="line">#(4): nvbuf-mem-surface-array - Allocate Surface Array memory, applicable for Jetson</span><br><span class="line">nvbuf-memory-type=0</span><br><span class="line"></span><br><span class="line">[source0]</span><br><span class="line">enable=1</span><br><span class="line">#Type - 1=CameraV4L2 2=URI 3=MultiURI</span><br><span class="line">type=3</span><br><span class="line"># ä¿®æ”¹æ–‡ä»¶ä½ç½®</span><br><span class="line">uri=file://../../samples/streams/test_helmet_1.mp4</span><br><span class="line">num-sources=1</span><br><span class="line">gpu-id=0</span><br><span class="line"># (0): memtype_device   - Memory type Device</span><br><span class="line"># (1): memtype_pinned   - Memory type Host Pinned</span><br><span class="line"># (2): memtype_unified  - Memory type Unified</span><br><span class="line">cudadec-memtype=0</span><br><span class="line"></span><br><span class="line">[sink0]</span><br><span class="line">enable=1</span><br><span class="line">#Type - 1=FakeSink 2=EglSink 3=File</span><br><span class="line">type=2</span><br><span class="line">sync=0</span><br><span class="line">source-id=0</span><br><span class="line">gpu-id=0</span><br><span class="line">nvbuf-memory-type=0</span><br><span class="line"></span><br><span class="line">[osd]</span><br><span class="line">enable=1</span><br><span class="line">gpu-id=0</span><br><span class="line">border-width=1</span><br><span class="line">text-size=15</span><br><span class="line">text-color=1;1;1;1;</span><br><span class="line">text-bg-color=0.3;0.3;0.3;1</span><br><span class="line">font=Serif</span><br><span class="line">show-clock=0</span><br><span class="line">clock-x-offset=800</span><br><span class="line">clock-y-offset=820</span><br><span class="line">clock-text-size=12</span><br><span class="line">clock-color=1;0;0;0</span><br><span class="line">nvbuf-memory-type=0</span><br><span class="line"></span><br><span class="line">[streammux]</span><br><span class="line">gpu-id=0</span><br><span class="line">##Boolean property to inform muxer that sources are live</span><br><span class="line">live-source=0</span><br><span class="line">batch-size=1</span><br><span class="line">##time out in usec, to wait after the first buffer is available</span><br><span class="line">##to push the batch even if the complete batch is not formed</span><br><span class="line">batched-push-timeout=40000</span><br><span class="line">## Set muxer output width and height</span><br><span class="line">width=1920</span><br><span class="line">height=1080</span><br><span class="line">##Enable to maintain aspect ratio wrt source, and allow black borders, works</span><br><span class="line">##along with width, height properties</span><br><span class="line">enable-padding=0</span><br><span class="line">nvbuf-memory-type=0</span><br><span class="line"></span><br><span class="line"># config-file property is mandatory for any gie section.</span><br><span class="line"># Other properties are optional and if set will override the properties set in</span><br><span class="line"># the infer config file.</span><br><span class="line">[primary-gie]</span><br><span class="line">enable=1</span><br><span class="line">gpu-id=0</span><br><span class="line">#model-engine-file=model_b1_gpu0_int8.engine</span><br><span class="line"># ä¿®æ”¹æ ‡ç­¾æ–‡ä»¶</span><br><span class="line">labelfile-path=helmet_names.txt</span><br><span class="line">batch-size=1</span><br><span class="line">#Required by the app for OSD, not a plugin property</span><br><span class="line">bbox-border-color0=1;0;0;1</span><br><span class="line">bbox-border-color1=0;1;1;1</span><br><span class="line">bbox-border-color2=0;0;1;1</span><br><span class="line">bbox-border-color3=0;1;0;1</span><br><span class="line">interval=2</span><br><span class="line">gie-unique-id=1</span><br><span class="line">nvbuf-memory-type=0</span><br><span class="line"># ä¿®æ”¹configæ–‡ä»¶</span><br><span class="line">config-file=config_infer_helmet_yoloV3.txt</span><br><span class="line"></span><br><span class="line">[tracker]</span><br><span class="line">enable=1</span><br><span class="line">tracker-width=640</span><br><span class="line">tracker-height=384</span><br><span class="line">ll-lib-file=/opt/nvidia/deepstream/deepstream-5.0/lib/libnvds_mot_klt.so</span><br><span class="line"></span><br><span class="line">[tests]</span><br><span class="line">file-loop=0</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦æ£€æµ‹å¤šä¸ªè§†é¢‘ï¼Œåªè¦åœ¨<code>deepstream_app_config_yoloV3.txt</code>æ–‡ä»¶ä¸­æ·»åŠ <code>source</code>å’Œ<code>sink</code>å¹¶ä¸”ä¸€ä¸€å¯¹åº”å³å¯ã€‚</p><h3 id="æ£€æµ‹ç»“æœ"><a href="#æ£€æµ‹ç»“æœ" class="headerlink" title="æ£€æµ‹ç»“æœ"></a>æ£€æµ‹ç»“æœ</h3><p>å®‰å…¨å¸½æ£€æµ‹</p><p><img src="/2021/07/10/week-2-2/2-3.png" alt="18"></p><p>ä½¿ç”¨å®‰å…¨å¸½æ£€æµ‹æ¨¡å‹åŒæ—¶æ£€æµ‹2ä¸ªè§†é¢‘æ–‡ä»¶</p><p><img src="/2021/07/10/week-2-2/2-4.png" alt="18"></p><p>ç¬¬ä¸€æ¬¡è¿è¡Œç”Ÿæˆ<code>engine</code>ï¼Œè¿™æ˜¯æœ€è€—æ—¶çš„åœ°æ–¹ï¼Œ<code>engine</code>åªåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œç”Ÿæˆï¼Œç„¶åå¯ä»¥æŠŠ<code>config_infer_primary_yoloV3.txt</code>æ–‡ä»¶ä¸­é…ç½®æ‰“å¼€ï¼Œå¤šæ¬¡è¿è¡Œæ—¶ä¸å¿…å†ç”Ÿæˆ<code>engine</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å½“è¿™é¡¹é…ç½®æ‰“å¼€æ—¶ï¼Œè¿™æ ·åªä¼šåœ¨ç¬¬ä¸€æ¬¡ç”Ÿæˆå¼•æ“ï¼Œåç»­å¯åŠ¨ä¼šå¾ˆå¿«ã€‚</span><br><span class="line">model-engine-file=yolov3_b1_gpu0_int8.engine</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•æ—¶é—´"><a href="#æµ‹è¯•æ—¶é—´" class="headerlink" title="æµ‹è¯•æ—¶é—´"></a>æµ‹è¯•æ—¶é—´</h2><p>æµ‹è¯•å®‰å…¨å¸½æ£€æµ‹ å‰å¤„ç†ï¼Œæ¨ç†ï¼Œåå¤„ç†æ‰€ç”¨çš„æ—¶é—´è¿™éƒ¨åˆ†è¿˜æ²¡æœ‰å®Œæˆã€‚ã€‚ã€‚</p><p>å°½é‡å°½å¿«è¡¥å……å®Œæˆï¼</p>]]></content>
    
    
    <summary type="html">Deepstream YoloV3æ£€æµ‹å®‰å…¨å¸½</summary>
    
    
    
    <category term="Internship" scheme="http://example.com/categories/Internship/"/>
    
    
    <category term="Jetson" scheme="http://example.com/tags/Jetson/"/>
    
    <category term="Deepstreeam" scheme="http://example.com/tags/Deepstreeam/"/>
    
  </entry>
  
  <entry>
    <title>Installing  GStreamer</title>
    <link href="http://example.com/2021/07/09/week-2-1/"/>
    <id>http://example.com/2021/07/09/week-2-1/</id>
    <published>2021-07-09T13:01:50.000Z</published>
    <updated>2021-07-24T06:26:12.464Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Installing-GStreamer"><a href="#Installing-GStreamer" class="headerlink" title="Installing  GStreamer"></a>Installing  GStreamer</h1><h2 id="Installing-on-Linux"><a href="#Installing-on-Linux" class="headerlink" title="Installing on Linux"></a>Installing on Linux</h2><p><strong>ç³»ç»Ÿï¼šUbuntu 16.04</strong></p><p>å‚ç…§<a href="https://gstreamer.freedesktop.org/documentation/installing/on-linux.html?gi-language=c">å®˜æ–¹æ–‡æ¡£</a>ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½†æ˜¯åœ¨æˆ‘çš„ç¬”è®°æœ¬å’Œå…¬å¸çš„å°å¼æœºä¸Šä¼¼ä¹ä¸å¤ªokâ€¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libgstreamer-plugins-bad1.0-dev gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-doc gstreamer1.0-tools gstreamer1.0-x gstreamer1.0-alsa gstreamer1.0-gl gstreamer1.0-gtk3 gstreamer1.0-qt5 gstreamer1.0-pulseaudio</span><br></pre></td></tr></table></figure><p><a href="https://samwhelp.github.io/note-ubuntu-18.04/read/howto/install-tool/gstreamer/">å‚è€ƒ</a>äº†ä¸€ä½æ¹¾æ¹¾ç½‘å‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æˆåŠŸå®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libgstreamer1.0-0 gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-doc gstreamer1.0-tools</span><br></pre></td></tr></table></figure><p><strong>Package</strong></p><ul><li><a href="https://packages.ubuntu.com/bionic/libgstreamer1.0-0">libgstreamer1.0-0</a></li><li><a href="https://packages.ubuntu.com/bionic/gstreamer1.0-plugins-base">gstreamer1.0-plugins-base</a></li><li><a href="https://packages.ubuntu.com/bionic/gstreamer1.0-plugins-good">gstreamer1.0-plugins-good</a></li><li><a href="https://packages.ubuntu.com/bionic/gstreamer1.0-plugins-bad">gstreamer1.0-plugins-bad</a></li><li><a href="https://packages.ubuntu.com/bionic/gstreamer1.0-plugins-ugly">gstreamer1.0-plugins-ugly</a></li><li><a href="https://packages.ubuntu.com/bionic/gstreamer1.0-libav">gstreamer1.0-libav</a></li><li><a href="https://packages.ubuntu.com/bionic/gstreamer1.0-doc">gstreamer1.0-doc</a></li><li><a href="https://packages.ubuntu.com/bionic/gstreamer1.0-tools">gstreamer1.0-tools</a></li></ul><p><strong>éªŒè¯å®‰è£…</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep gstreamer</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ GStreamer æ„å»ºåº”ç”¨ç¨‹åº</strong></p><p>ä¸ºäº†ç¼–è¯‘ GStreamer å¹¶ä½¿ç”¨ GStreamer æ ¸å¿ƒåº“çš„ä»£ç ï¼Œéœ€åœ¨<code>gcc</code>åæ·»åŠ ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg-config --cflags --libs gstreamer-1.0</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨å…¶ä»– GStreamer åº“ï¼Œä¾‹å¦‚è§†é¢‘åº“ï¼Œåˆ™å¿…é¡»åœ¨ä¸Šè¿° gstreamer-1.0 ä¹‹åæ·»åŠ å…¶ä»–åŒ…ï¼ˆä¾‹å¦‚ï¼Œè§†é¢‘åº“çš„ gstreamer-video-1.0ï¼‰</p><p><strong>è·å–tutorialâ€™s source code</strong></p><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤gitåˆ°æœ¬åœ°ï¼Œå¯ä»¥åœ¨æ–‡ä»¶ç›®å½•<code>gst/examples/tutorials</code>ä¸­æ‰¾åˆ°ä¾‹ç¨‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitlab.freedesktop.org/gstreamer/gst-docs</span><br></pre></td></tr></table></figure><p><strong>Building the tutorials</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc basic-tutorial-1.c -o basic-tutorial-1 `pkg-config --cflags --libs gstreamer-1.0`</span><br></pre></td></tr></table></figure><p><strong>Running the tutorials</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./basic-tutorial-1</span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœ</strong></p><p><img src="/2021/07/09/week-2-1/2_1.png" alt="1"></p><p><strong>nice</strong>ï¼</p><h2 id="Installing-on-Windows"><a href="#Installing-on-Windows" class="headerlink" title="Installing on Windows"></a>Installing on Windows</h2><p>é¦–å…ˆå‚ç…§<a href="https://gstreamer.freedesktop.org/documentation/installing/on-windows.html?gi-language=c">å®˜æ–¹æ–‡æ¡£</a>å®‰è£…ï¼ŒçœŸçš„è›®å¿ƒç´¯çš„ï¼Œè‹±æ–‡æˆ‘éƒ½èƒ½çœ‹æ‡‚ï¼Œä½†å°±æ˜¯æä¸å®šã€‚è®°å½•ä¸€ä¸‹GStreamer on Windowsçš„å´å²–ä¹‹è·¯ã€‚</p><p><strong>ç¯å¢ƒï¼šWin 10 + VS2017</strong></p><p><strong>1. ä¸‹è½½GStreamer</strong></p><p>é€‰æ‹©MSVC 64-bit(æœ‰mingwå¯é€‰)</p><p><a href="https://gstreamer.freedesktop.org/data/pkg/windows/1.18.4/msvc/gstreamer-1.0-msvc-x86_64-1.18.4.msi">gstreamer-1.0-msvc-x86_64-1.18.4.msi</a>               å…ˆè£…</p><p><a href="https://gstreamer.freedesktop.org/data/pkg/windows/1.18.4/msvc/gstreamer-1.0-devel-msvc-x86_64-1.18.4.msi">gstreamer-1.0-devel-msvc-x86_64-1.18.4.msi</a>    åè£…</p><p>å®‰è£…çš„æ—¶å€™éƒ½é€‰æ‹©<code>Complete</code>å®Œæ•´å®‰è£…ï¼Œé»˜è®¤ä¼šå®‰è£…åœ¨å‰©ä½™ç©ºé—´æœ€å¤§çš„ç›˜ç¬¦</p><p><strong>2. é…ç½®ç³»ç»Ÿå˜é‡</strong></p><p>é¦–å…ˆå°†<code>glibconfig.h</code>æ–‡ä»¶æ‹·è´åˆ°<code>include/glib-2.0</code>ä»¥åŠ<code>include/glib-2.0/glib</code>ç›®å½•ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|-- lib</span><br><span class="line">|   |-- glib-2.0</span><br><span class="line">|   |    -- include</span><br><span class="line">|   |        -- glibconfig.h æ­¤æ–‡ä»¶æ‹·è´åˆ°</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|-- include</span><br><span class="line">|     --glib-2.0 æ­¤ç›®å½•ä¸‹</span><br><span class="line">|        -- glib ä»¥åŠæ­¤ç›®å½•ä¸‹</span><br></pre></td></tr></table></figure><p>æ·»åŠ ç”¨æˆ·å˜é‡</p><p><img src="/2021/07/09/week-2-1/2_3.png" alt="3"></p><p>æ·»åŠ ç³»ç»Ÿå˜é‡</p><p><img src="/2021/07/09/week-2-1/2_4.png" alt="4"></p><p>Pathä¸­æ·»åŠ è·¯å¾„</p><p><img src="/2021/07/09/week-2-1/2_5.png" alt="5"></p><p><strong>3. ç¯å¢ƒæµ‹è¯•</strong></p><ul><li><p>å½±åƒæµ‹è¯•ï¼Œæ‰“å¼€cmdè¿è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gst-launch-1.0 videotestsrc ! videoconvert ! autovideosink</span><br></pre></td></tr></table></figure></li></ul><p><img src="/2021/07/09/week-2-1/2_6.png" alt="6"></p><ul><li><p>æ’çƒæµ‹è¯•ï¼Œæ‰“å¼€cmdè¿è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gst-launch-1.0 -v videotestsrc pattern=ball ! video/x-raw,width=320,height=240 ! videoconvert ! tee ! autovideosink device=0</span><br></pre></td></tr></table></figure><p><img src="/2021/07/09/week-2-1/2_7.png" alt="7"></p></li></ul><p>è‡³æ­¤ï¼ŒGStreamerçš„MSCVç¯å¢ƒokï¼Œæ¥ä¸‹æ¥åœ¨VS2017é…ç½®GStreamer</p><p><strong>4. VS2017é…ç½®GStreamer</strong></p><p>è¿˜æ˜¯ä¹‹å‰ä¸‹è½½çš„<a href="https://medium.com/r/?url=https://gitlab.freedesktop.org/gstreamer/gst-docs/">gst-docs</a>ï¼Œç”¨VSæ‰“å¼€ï¼ŒåŒå‡»<code>tutorials.sln</code></p><p><img src="/2021/07/09/week-2-1/2_8.png" alt="8"></p><p><code>tutorials</code>ç»™çš„æ˜¯<code>VS2010</code>çš„ä¾‹ç¨‹ï¼Œå½“ç„¶è¦å‡çº§ä¸€ä¸‹å•¦</p><p><img src="/2021/07/09/week-2-1/2_9.png" alt="9"></p><p>æ‰“å¼€åæ˜¯è¿™æ ·æ»´</p><p><img src="/2021/07/09/week-2-1/2_9_1.png" alt="9_1"></p><p>ç«™èµ·æ¥æ´»åŠ¨ä¸€ä¸‹ï¼Œç›´ç›´è…°å¯ä»¥å¼€å§‹å•¦ï¼Œä¸€ä¸Šæ¥å…¨æ˜¯<code>Errors</code>ï¼Œèƒ½è¿è¡Œæ‰å¥‡æ€ªæã€‚ã€‚ã€‚</p><p><img src="/2021/07/09/week-2-1/2_10.png" alt="10"></p><p>é‡ç‚¹æ¥äº†ï¼Œç¬¬ä¸€æ¬¡ç»™<code>VS2017</code>é…ç½®ç¬¬ä¸‰æ–¹åº“</p><p>â‘  è§£å†³æ–¹æ¡ˆèµ„æºç®¡ç†å™¨é‡Œé€‰æ‹©é¡¹ç›®åï¼Œå³é”®é¡¹ç›®ï¼Œé€‰æ‹©å±æ€§</p><p>åœ¨é…ç½®å±æ€§â€”â€”è°ƒè¯•â€”â€”å·¥ä½œç›®å½• å¢åŠ å¦‚ä¸‹ç›®å½•(é€‰æ‹©æ´»åŠ¨(x64)å¹³å°å“¦ï¼Œæ¥ä¸‹æ¥éƒ½æ˜¯)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\gstreamer\1.0\msvc_x86_64\bin</span><br></pre></td></tr></table></figure><p><img src="/2021/07/09/week-2-1/2_11.png" alt="11"></p><p>â‘¡åœ¨C/C++ â€”â€” å¸¸è§„â€”â€”é™„åŠ åŒ…å«ç›®å½• å¢åŠ å¦‚ä¸‹ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D:\gstreamer\1.0\msvc_x86_64\include\gstreamer-1.0</span><br><span class="line">D:\gstreamer\1.0\msvc_x86_64\include\glib-2.0</span><br><span class="line">D:\gstreamer\1.0\msvc_x86_64\include\libxml2</span><br><span class="line">D:\gstreamer\1.0\msvc_x86_64\include</span><br><span class="line">D:\gstreamer\1.0\msvc_x86_64\lib\glib-2.0\include</span><br></pre></td></tr></table></figure><p><img src="/2021/07/09/week-2-1/2_12.png" alt="12"></p><p>â‘¢åœ¨é“¾æ¥å™¨â€”-å¸¸è§„â€”-é™„åŠ åº“ç›®å½•ï¼Œå¢åŠ  å¦‚ä¸‹ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\gstreamer\1.0\msvc_x86_64\lib</span><br></pre></td></tr></table></figure><p><img src="/2021/07/09/week-2-1/2_13.png" alt="13"></p><p>â‘£åœ¨é“¾æ¥å™¨â€”-è¾“å…¥â€”â€“é™„åŠ ä¾èµ–æ€§ å¢åŠ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gobject-2.0.lib</span><br><span class="line">glib-2.0.lib</span><br><span class="line">gstreamer-1.0.lib</span><br></pre></td></tr></table></figure><p><img src="/2021/07/09/week-2-1/2_14.png" alt="14"></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œè¿è¡Œä¸€ä¸‹<code>basic-tutorial-1.c</code>ï¼Œæ²¡æœ‰æŠ¥é”™äº†ï¼Œæ’’èŠ±<em>â˜…,Â°</em>:.â˜†(ï¿£â–½ï¿£)/$:<em>.Â°â˜…</em> </p><p><img src="/2021/07/09/week-2-1/2_15.png" alt="15"></p><p>è¿è¡Œç»“æœ</p><p><img src="/2021/07/09/week-2-1/2_17.png" alt="17"></p><p><code>basic-tutorial-1.c</code>çš„ä»£ç å°±å…ˆä¸è§£è¯»å•¦ï¼Œé‡Œé¢æ³¨é‡Šå¾ˆæ¸…æ™°äº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gst/gst.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span></span></span><br><span class="line"><span class="function"><span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">GstElement *pipeline;</span><br><span class="line">GstBus *bus;</span><br><span class="line">GstMessage *msg;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Initialize GStreamer */</span></span><br><span class="line">gst_init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Build the pipeline */</span></span><br><span class="line">pipeline =</span><br><span class="line">gst_parse_launch</span><br><span class="line">(<span class="string">&quot;playbin uri=https://www.freedesktop.org/software/gstreamer-sdk/data/media/sintel_trailer-480p.webm&quot;</span>,</span><br><span class="line"><span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Start playing */</span></span><br><span class="line">gst_element_set_state(pipeline, GST_STATE_PLAYING);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wait until error or EOS */</span></span><br><span class="line">bus = gst_element_get_bus(pipeline);</span><br><span class="line">msg =</span><br><span class="line">gst_bus_timed_pop_filtered(bus, GST_CLOCK_TIME_NONE,</span><br><span class="line">GST_MESSAGE_ERROR | GST_MESSAGE_EOS);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Free resources */</span></span><br><span class="line"><span class="keyword">if</span> (msg != <span class="literal">NULL</span>)</span><br><span class="line">gst_message_unref(msg);</span><br><span class="line">gst_object_unref(bus);</span><br><span class="line">gst_element_set_state(pipeline, GST_STATE_NULL);</span><br><span class="line">gst_object_unref(pipeline);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>GStreamer on Windowsçš„å®‰è£…è‡³æ­¤ç®—æ˜¯æå®šäº†ï¼Œè¿˜æ˜¯æœ‰èŠ±è›®å¤šç²¾åŠ›çš„ï¼No pains, no gains. æ¥ä¸‹æ¥è¿˜è¦å­¦å†™GStreameræ’ä»¶ï¼Œèƒ½å†™å¥½çš„å†è®°å½•ä¸€ä¸‹ï¼</p><p><strong>å‚è€ƒ</strong></p><p><a href="https://gstreamer.freedesktop.org/data/pkg/windows/1.18.4/msvc/">https://gstreamer.freedesktop.org/data/pkg/windows/1.18.4/msvc/</a></p><p><a href="https://gstreamer.freedesktop.org/documentation/installing/index.html?gi-language=c">https://gstreamer.freedesktop.org/documentation/installing/index.html?gi-language=c</a></p><p><a href="https://www.cnblogs.com/0-lingdu/p/12718613.html">https://www.cnblogs.com/0-lingdu/p/12718613.html</a></p><p><a href="https://blog.csdn.net/kongxingxing/article/details/104270463">https://blog.csdn.net/kongxingxing/article/details/104270463</a></p><p><a href="https://blog.csdn.net/fly_bear_unknown/article/details/113917633">https://blog.csdn.net/fly_bear_unknown/article/details/113917633</a></p>]]></content>
    
    
    <summary type="html">GStreameråœ¨Ubuntuå’ŒWindowsä¸Šå®‰è£…</summary>
    
    
    
    <category term="Internship" scheme="http://example.com/categories/Internship/"/>
    
    
    <category term="GStreamer" scheme="http://example.com/tags/GStreamer/"/>
    
  </entry>
  
  <entry>
    <title>Jetson éƒ¨ç½² Deepstream</title>
    <link href="http://example.com/2021/07/02/week-1/"/>
    <id>http://example.com/2021/07/02/week-1/</id>
    <published>2021-07-02T12:13:16.000Z</published>
    <updated>2021-07-24T06:25:56.273Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Jetson-éƒ¨ç½²-Deep-stream"><a href="#Jetson-éƒ¨ç½²-Deep-stream" class="headerlink" title="Jetson éƒ¨ç½² Deep stream"></a>Jetson éƒ¨ç½² Deep stream</h1><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><h3 id="æŸ¥çœ‹Jetsonä¿¡æ¯"><a href="#æŸ¥çœ‹Jetsonä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹Jetsonä¿¡æ¯"></a><strong>æŸ¥çœ‹Jetsonä¿¡æ¯</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sudo pip3 install jetson-stats</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> jtop</span></span><br></pre></td></tr></table></figure><p><img src="/2021/07/02/week-1/01.png" alt="01"></p><h3 id="Jetson-Setup"><a href="#Jetson-Setup" class="headerlink" title="Jetson Setup"></a><strong>Jetson Setup</strong></h3><p>å¦‚æœæ˜¯ Jetson Nano æˆ–è€… Jetson Xavier NX developer kit, ä»<a href="https://developer.nvidia.com/embedded/jetpack">JetPack SDK</a>ä¸‹è½½ SD card imageï¼Œè¿™å…¶ä¸­åŒ…å«äº† CUDA, TensorRT and cuDNN.</p><h3 id="å‘½ä»¤è¡Œå·¥å…·nvpmodel"><a href="#å‘½ä»¤è¡Œå·¥å…·nvpmodel" class="headerlink" title="å‘½ä»¤è¡Œå·¥å…·nvpmodel"></a><strong>å‘½ä»¤è¡Œå·¥å…·nvpmodel</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo nvpmodel --query</span></span><br><span class="line">NV Fan Mode:cool</span><br><span class="line">NV Power Mode: MODE_15W_2CORE</span><br><span class="line">0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢åˆ°æ¨¡å¼2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo nvpmodel -m 2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ€å¤§åŒ–Xavieræ€§èƒ½</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo jetson_clocks</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¾ç¤ºå½“å‰è®¾ç½®ï¼š</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo jetson_clocks --show</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¢å¤ä»¥å‰çš„è®¾ç½®</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo jetson_clocks --restore</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¿¡æ¯"><a href="#æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¿¡æ¯"></a><strong>æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¿¡æ¯</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> LinuxæŸ¥çœ‹ç‰ˆæœ¬å½“å‰æ“ä½œç³»ç»Ÿ å†…æ ¸ä¿¡æ¯</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> uname --a</span></span><br><span class="line">Linux name-desktop 4.9.140-tegra #1 SMP PREEMPT Thu Jun 25 21:22:12 PDT 2020 aarch64 aarch64 aarch64 GNU/Linux</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LinuxæŸ¥çœ‹å½“å‰æ“ä½œç³»ç»Ÿ ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/version</span></span><br><span class="line">Linux version 4.9.140-tegra (buildbrain@mobile-u64-3357) (gcc version 7.3.1 20180425 [linaro-7.3-2018.05 revision d29120a424ecfbc167ef90065c0eeb7f91977701] (Linaro GCC 7.3-2018.05) ) #1 SMP PREEMPT Thu Jun 25 21:22:12 PDT 2020</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LinuxæŸ¥çœ‹ç‰ˆæœ¬å½“å‰æ“ä½œç³»ç»Ÿ å‘è¡Œç‰ˆä¿¡æ¯</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /etc/issue</span></span><br><span class="line">Ubuntu 18.04.5 LTS \n \l</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹cpuçš„ä¿¡æ¯</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/cpuinfo</span></span><br><span class="line">processor: 0</span><br><span class="line">model name: ARMv8 Processor rev 0 (v8l)</span><br><span class="line">BogoMIPS: 62.50</span><br><span class="line">Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp</span><br><span class="line">CPU implementer: 0x4e</span><br><span class="line">CPU architecture: 8</span><br><span class="line">CPU variant: 0x0</span><br><span class="line">CPU part: 0x004</span><br><span class="line">CPU revision: 0</span><br><span class="line">MTS version: 50168445</span><br><span class="line">â€¦</span><br><span class="line">â€¦</span><br><span class="line">â€¦</span><br><span class="line">processor: 5</span><br><span class="line">model name: ARMv8 Processor rev 0 (v8l)</span><br><span class="line">BogoMIPS: 62.50</span><br><span class="line">Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp</span><br><span class="line">CPU implementer: 0x4e</span><br><span class="line">CPU architecture: 8</span><br><span class="line">CPU variant: 0x0</span><br><span class="line">CPU part: 0x004</span><br><span class="line">CPU revision: 0</span><br><span class="line">MTS version: 50168445</span><br></pre></td></tr></table></figure><h3 id="DeepStream-Setup"><a href="#DeepStream-Setup" class="headerlink" title="DeepStream Setup"></a>DeepStream Setup</h3><ol><li><p><a href="https://developer.nvidia.com/deepstream-sdk">NVIDIA DeepStream SDK</a>å®˜ç½‘ä¸‹è½½ <code>deepstream_sdk_v5.0.1_jetson.tbz2</code></p></li><li><p>å‘½ä»¤è¡Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo tar -xvf deepstream_sdk_v5.0.1_jetson.tbz2 -C /</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /opt/nvidia/deepstream/deepstream-5.0</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ./install.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ldconfig</span></span><br></pre></td></tr></table></figure></li></ol><p><img src="/2021/07/02/week-1/02.png" alt="02"></p><h3 id="Run-deepstream-app"><a href="#Run-deepstream-app" class="headerlink" title="Run deepstream-app"></a>Run deepstream-app</h3><ol><li><p>å¯¼èˆªåˆ°ç¤ºä¾‹ç›®å½•(samples)ã€‚</p></li><li><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥è¿è¡Œå‚è€ƒåº”ç”¨ç¨‹åºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> deepstream-app -c &lt;path_to_config_file&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;path_to_config_file&gt;</code>å¯ä»¥åœ¨<code>configs/deepstream-app/</code>ä¸­æ‰¾åˆ°</p></li><li><p>åœ¨æºæ–‡ä»¶ç›®å½•ä¸­æ‰¾åˆ°æºç ï¼Œç¼–è¯‘å¹¶è¿è¡Œdemo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æºæ–‡ä»¶ç›®å½•ï¼ˆdeepstream-test1ï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> éƒ½éœ€è¦makeç¼–è¯‘ï¼Œå…·ä½“è¯·å‚é˜…å…¶ä¸­çš„READMEæ–‡æ¡£</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /opt/nvidia/deepstream/deepstream-5.0/sources/apps/sample_apps/deepstream-test1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">deepstream_test1_app.c  dstest1_pgie_config.txt  Makefile  README</span><br><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">deepstream-test1-app    deepstream_test1_app.o   Makefile</span><br><span class="line">deepstream_test1_app.c  dstest1_pgie_config.txt  README</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œdeepstream-test1-app</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./deepstream-test1-app /opt/nvidia/deepstream/deepstream-5.0/samples/streams/sample_720p.h264</span></span><br></pre></td></tr></table></figure><table><thead><tr><th align="center">Reference test application</th><th align="center">Path inside sources directory</th><th>Description</th></tr></thead><tbody><tr><td align="center">Sample test application 1</td><td align="center">apps/sample_apps/deepstream-test1</td><td>Sample of how to use DeepStream elements for a single H.264 stream: filesrc â†’ decode â†’ nvstreammuH264 containerized streamx â†’ nvinfer (primary detector) â†’ nvdsosd â†’ renderer.</td></tr><tr><td align="center">Sample test application 2</td><td align="center">apps/sample_apps/deepstream-test2</td><td>Sample of how to use DeepStream elements for a single H.264 stream: filesrc â†’ decode â†’ nvstreammux â†’ nvinfer (primary detector) â†’ nvtracker â†’ nvinfer (secondary classifier) â†’ nvdsosd â†’ renderer.</td></tr><tr><td align="center">Sample test application 3</td><td align="center">apps/sample_apps/deepstream-test3</td><td>Builds on deepstream-test1 (simple test application 1) to demonstrate how to:Use multiple sources in the pipelineUse a uridecodebin to accept any type of input (e.g. RTSP/File), any GStreamer supported container format, and any codecConfigure Gst-nvstreammux to generate a batch of frames and infer on it for better resource utilizationExtract the stream metadata, which contains useful information about the frames in the batched buffer</td></tr><tr><td align="center">Sample test application 4</td><td align="center">apps/sample_apps/deepstream-test4</td><td>Builds on deepstream-test1 for a single H.264 stream: filesrc, decode, nvstreammux, nvinfer, nvdsosd, renderer to demonstrate how to:Use the Gst-nvmsgconv and Gst-nvmsgbroker plugins in the pipelineCreate NVDS_META_EVENT_MSG type metadata and attach it to the bufferUse NVDS_META_EVENT_MSG for different types of objects, e.g. vehicle and personImplement â€œcopyâ€ and â€œfreeâ€ functions for use if metadata is extended through the extMsg field</td></tr><tr><td align="center">Sample test application 5</td><td align="center">apps/sample_apps/deepstream-test5</td><td>Builds on top of deepstream-app. Demonstrates:Use of Gst-nvmsgconv and Gst-nvmsgbroker plugins in the pipeline for multistreamHow to configure Gst-nvmsgbroker plugin from the config file as a sink plugin (for KAFKA, Azure, etc.)How to handle the RTCP sender reports from RTSP servers or cameras and translate the Gst Buffer PTS to a UTC timestamp.For more details refer the RTCP Sender Report callback function <code>test5_rtcp_sender_report_callback()</code> registration and usage in <code>deepstream_test5_app_main.c</code>. GStreamer callback registration with rtpmanager elementâ€™s â€œhandle-syncâ€ signal is documented in <code>apps-common/src/deepstream_source_bin.c</code>.</td></tr></tbody></table></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">|-- opt</span><br><span class="line">    |-- nvidia</span><br><span class="line">        |-- deepstream</span><br><span class="line">            |-- deepstream</span><br><span class="line">            |-- deepstream-5.0</span><br><span class="line">                |-- bin</span><br><span class="line">                |-- doc</span><br><span class="line">                |-- lib</span><br><span class="line">                |-- samples</span><br><span class="line">                |   |-- configs</span><br><span class="line">                |   |   |-- deepstream-app</span><br><span class="line">                |   |   |   |-- config_infer_primary.txt#å°†nvinferé…ç½®ä¸ºä¸»è¦æ£€æµ‹å™¨</span><br><span class="line">                |   |   |   |-- config_infer_primary_nano.txt</span><br><span class="line">                |   |   |   |-- config_infer_secondary_carcolor.txt#å°†nvinferé…ç½®ä¸ºè¾…åŠ©åˆ†ç±»å™¨</span><br><span class="line">                |   |   |   |-- config_infer_secondary_carmake.txt</span><br><span class="line">                |   |   |   |-- config_infer_secondary_vehicletypes.txt</span><br><span class="line">                |   |   |   |-- iou_config.txt#é…ç½®ä¸€ä¸ªä½çº§çš„IOUè·Ÿè¸ªå™¨ã€‚</span><br><span class="line">                |   |   |   |-- source12_1080p_dec_infer-resnet_tracker_tiled_display_fp16_tx2.txt</span><br><span class="line">                |   |   |   |-- source1_csi_dec_infer_resnet_int8.txt   #æ¼”ç¤ºä¸€ä¸ªCSIæ‘„åƒæœºä½œä¸ºè¾“å…¥ï¼›ä»…é€‚ç”¨äºJetson</span><br><span class="line">                |   |   |   |-- source1_usb_dec_infer_resnet_int8.txt#æ¼”ç¤ºä¸€ä¸ªUSBæ‘„åƒæœºä½œä¸ºè¾“å…¥</span><br><span class="line">                |   |   |   |-- source2_csi_usb_dec_infer_resnet_int8.txt</span><br><span class="line">                                #æ¼”ç¤º30ä¸ªå…·æœ‰ä¸»è¦æ¨ç†åŠŸèƒ½çš„æµè§£ç ï¼ˆä»…é€‚ç”¨äºdGPUå’ŒJetson AGX Xavierå¹³å°ï¼‰</span><br><span class="line">                |   |   |   |-- source30_1080p_dec_infer-resnet_tiled_display_int8.txt </span><br><span class="line">                #æ¼”ç¤ºå…·æœ‰ä¸»è¦æ¨ç†ï¼Œå¯¹è±¡è·Ÿè¸ªå’Œä¸‰ä¸ªä¸åŒè¾…åŠ©åˆ†ç±»å™¨çš„å››ä¸ªæµè§£ç ï¼ˆä»…é€‚ç”¨äºdGPUå’ŒJetson AGX Xavierå¹³å°ï¼‰</span><br><span class="line">                |   |   |   |-- source4_1080p_dec_infer-resnet_tracker_sgie_tiled_display_int8.txt</span><br><span class="line">                |   |   |   |-- source6_csi_dec_infer_resnet_int8.txt</span><br><span class="line">                |   |   |   |-- source8_1080p_dec_infer-resnet_tracker_tiled_display_fp16_nano.txt</span><br><span class="line">                |   |   |   |-- source8_1080p_dec_infer-resnet_tracker_tiled_display_fp16_tx1.txt</span><br><span class="line">                |   |   |   |-- tracker_config.yml#é…ç½®NvDCFè·Ÿè¸ªå™¨</span><br><span class="line">                |   |   |-- deepstream-app-trtis</span><br><span class="line">                |   |   |-- tlt_pretrained_models</span><br><span class="line">                |   |-- models</span><br><span class="line">                |   |-- streams</span><br><span class="line">                |   |   |-- sample_1080p_h264.mp4#H264 containerized stream</span><br><span class="line">                |   |   |-- sample_1080p_h265.mp4#H265 containerized stream</span><br><span class="line">                |   |   |-- sample_720p.h264#H264 elementary stream</span><br><span class="line">                |   |   |-- sample_720p.jpg#JPEG image</span><br><span class="line">                |   |   |-- sample_720p.mjpeg#MJPEG stream</span><br><span class="line">                |   |   |-- sample_720p.mp4</span><br><span class="line">                |   |   |-- sample_cam6.mp4#H264 containerized stream(360D camera stream)</span><br><span class="line">                |   |   |-- sample_industrial.jpg</span><br><span class="line">                |   |   |-- sample_qHD.h264</span><br><span class="line">                |   |   |-- sample_qHD.mp4</span><br><span class="line">                |   |   |-- yoga.jpg</span><br><span class="line">                |   |   |-- yoga.mp4</span><br><span class="line">                |   |-- trtis_model_repo</span><br><span class="line">                |-- sources</span><br><span class="line">                    |-- apps</span><br><span class="line">                    |   |-- apps-common</span><br><span class="line">                    |   |   |-- includes</span><br><span class="line">                    |   |-- sample_apps</span><br><span class="line">                    |       |-- deepstream-app#ç«¯åˆ°ç«¯ç¤ºä¾‹æ¼”ç¤ºäº†4çº§è”ç¥ç»ç½‘ç»œ(1ä¸ªä¸€çº§æ£€æµ‹å™¨å’Œ3ä¸ªäºŒçº§åˆ†ç±»å™¨)çš„å¤šç›¸æœºæµï¼Œå¹¶æ˜¾ç¤ºå¹³é“ºè¾“å‡ºã€‚</span><br><span class="line">                    |       |   |-- Makefile</span><br><span class="line">                    |       |   |-- README</span><br><span class="line">                    |       |   |-- deepstream_app.c</span><br><span class="line">                    |       |   |-- deepstream_app.h</span><br><span class="line">                    |       |   |-- deepstream_app_config_parser.c</span><br><span class="line">                    |       |   |-- deepstream_app_main.c</span><br><span class="line">                    |       |-- deepstream-test1#å¯¹å•ä¸€H264è§†é¢‘æµï¼Œåº”ç”¨filesrcâ†’decodeâ†’nvstreammuH264 containerized streamxâ†’nvinfer(ä¸»æ£€æµ‹å™¨)â†’nvdsosdâ†’renderer</span><br><span class="line">                    |       |   |-- Makefile</span><br><span class="line">                    |       |   |-- README</span><br><span class="line">                 Builds on deepstream-test1 (simple test application 1) to demonstrate how to:Use multiple sources in the pipelineUse a uridecodebin to accept any type of input (e.g. RTSP/File), any GStreamer supported container format, and any codecConfigure Gst-nvstreammux to generate a batch of frames and infer on it for better resource utilizationExtract the stream metadata, which contains useful information about the frames in the batched buffer   |       |   |-- deepstream-test1-app</span><br><span class="line">                    |       |   |-- deepstream_test1_app.c</span><br><span class="line">                    |       |   |-- deepstream_test1_app.o</span><br><span class="line">                    |       |   |-- dstest1_pgie_config.txt</span><br><span class="line">                    |       |-- deepstream-test2#å»ºç«‹åœ¨test1ä¹‹ä¸Šï¼Œæ˜¾ç¤ºé¢å¤–çš„å±æ€§ï¼Œå¦‚è·Ÿè¸ªå’ŒäºŒçº§åˆ†ç±»å±æ€§ã€‚</span><br><span class="line">                    |       |   |-- Makefile</span><br><span class="line">                    |       |   |-- README</span><br><span class="line">                    |       |   |-- deepstream_test2_app.c</span><br><span class="line">                    |       |   |-- dstest2_pgie_config.txt</span><br><span class="line">                    |       |   |-- dstest2_sgie1_config.txt</span><br><span class="line">                    |       |   |-- dstest2_sgie2_config.txt</span><br><span class="line">                    |       |   |-- dstest2_sgie3_config.txt</span><br><span class="line">                    |       |   |-- dstest2_tracker_config.txt</span><br><span class="line">                    |       |   |-- tracker_config.yml</span><br><span class="line">                    |       |-- deepstream-test3#å»ºç«‹åœ¨test1çš„åŸºç¡€ä¸Šï¼Œæ˜¾ç¤ºå¤šä¸ªè¾“å…¥æºå’Œæ‰¹å¤„ç†ä½¿ç”¨nvstreammuxerã€‚</span><br><span class="line">                    |       |   |-- Makefile</span><br><span class="line">                    |       |   |-- README</span><br><span class="line">                    |       |   |-- deepstream_test3_app.c</span><br><span class="line">                    |       |   |-- dstest3_pgie_config.txt</span><br><span class="line">                    |       |-nfer_primary.txt</span><br><span class="line">                |   |   |   |-- config_infer_primary_nano.txt</span><br><span class="line">                |   |   |   |-- config_infer_secondary_carcolor.txt</span><br><span class="line">                |   |   |   |-- config_infer_secondary_carmake.txt</span><br><span class="line">                |   |   |   |-- config_infer_secondary_vehicletypes.txt</span><br><span class="line">                |   |   |   |-- iou_config.txt</span><br><span class="line">                |   |   |   |-- source12_1080p_dec_infer-resnet_tracker_tiled_display_fp16_tx2.txt</span><br><span class="line">                |   |   |   |-- source1_csi_dec_infer_resnet_int8.txt</span><br><span class="line">                |   |   |   |-- source1_usb_dec_infer_resnet_int8.txt</span><br><span class="line">                |   |   |   |-- source2_cs- deepstream-test4</span><br><span class="line">                    |       |   |-- Makefile</span><br><span class="line">                    |       |   |-- README</span><br><span class="line">                    |       |   |-- cfg_amqp.txt</span><br><span class="line">                    |       |   |-- cfg_azure.txt</span><br><span class="line">                    |       |   |-- cfg_kafka.txt</span><br><span class="line">                    |       |   |-- deepstream_test4_app.c</span><br><span class="line">                    |       |   |-- dstest4_msgconv_config.txt</span><br><span class="line">                    |       |   |-- dstest4_pgie_config.txt</span><br><span class="line">                    |       |-- deepstream-test5</span><br><span class="line">                    |       |   |-- Makefile</span><br><span class="line">                    |       |   |-- README</span><br><span class="line">                    |       |   |-- deepstream_test5_app.h</span><br><span class="line">                    |       |   |-- deepstream_test5_app_main.c</span><br><span class="line">                    |       |   |-- deepstream_utc.c</span><br><span class="line">                    |       |   |-- configs</span><br><span class="line">                    |       |       |-- dstest5_msgconv_sample_config.txt</span><br><span class="line">                    |       |       |-- test5_config_file_src_infer.txt</span><br><span class="line">                    |       |       |-- test5_config_file_src_infer_azure_iotedge.txt</span><br><span class="line">                    |       |       |-- test5_config_file_src_infer_tiler_demux.txt</span><br><span class="line">                    |       |       |-- test5_config_file_src_infer_tracker_sgie.txt</span><br><span class="line">                    |       |       |-- test5_dec_infer-resnet_tracker_sgie_tiled_display_int8.txt</span><br><span class="line">                    |       |       |-- test5_ota_override_config.txt</span><br><span class="line">                    |-- gst-plugins</span><br><span class="line">                    |-- includes</span><br><span class="line">                    |-- libs</span><br><span class="line">                    |-- objectDetector_FasterRCNN</span><br><span class="line">                    |-- objectDetector_SSD</span><br><span class="line">                    |-- objectDetector_Yolo</span><br><span class="line">                    |-- tools</span><br></pre></td></tr></table></figure><p>æ—¥å¿—ä¿¡æ¯ï¼š</p><p><img src="/2021/07/02/week-1/04.png" alt="04"><br>ç»“æœæ˜¾ç¤ºï¼š</p><p><img src="/2021/07/02/week-1/05.png" alt="05"></p><p><img src="/2021/07/02/week-1/08.png" alt="08"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://docs.nvidia.com/metropolis/deepstream/dev-guide/index.html">NVIDIA DeepStream SDKå¼€å‘æŒ‡å—</a></p><p><a href="https://docs.nvidia.com/metropolis/deepstream/plugin-manual/index.html">NVIDIA DeepStreamæ’ä»¶æ‰‹å†Œ</a></p><p><a href="https://docs.nvidia.com/metropolis/deepstream/dev-guide/">NVIDIA DeepStream SDK APIå‚è€ƒæ–‡æ¡£</a></p>]]></content>
    
    
    <summary type="html">Jetson Xavier NXéƒ¨ç½² Deepstream</summary>
    
    
    
    <category term="Internship" scheme="http://example.com/categories/Internship/"/>
    
    
    <category term="Jetson" scheme="http://example.com/tags/Jetson/"/>
    
    <category term="Deepstreeam" scheme="http://example.com/tags/Deepstreeam/"/>
    
  </entry>
  
  <entry>
    <title>webserver</title>
    <link href="http://example.com/2021/04/11/webserver/"/>
    <id>http://example.com/2021/04/11/webserver/</id>
    <published>2021-04-11T13:32:24.000Z</published>
    <updated>2021-08-11T13:46:40.269Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="TinyWebserver"><a href="#TinyWebserver" class="headerlink" title="TinyWebserver"></a>TinyWebserver</h1><h2 id="ä»€ä¹ˆæ˜¯Web-Serverï¼ˆç½‘ç»œæœåŠ¡å™¨ï¼‰"><a href="#ä»€ä¹ˆæ˜¯Web-Serverï¼ˆç½‘ç»œæœåŠ¡å™¨ï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯Web Serverï¼ˆç½‘ç»œæœåŠ¡å™¨ï¼‰"></a>ä»€ä¹ˆæ˜¯Web Serverï¼ˆç½‘ç»œæœåŠ¡å™¨ï¼‰</h2>]]></content>
    
    
    <summary type="html">Linuxç½‘ç»œç¼–ç¨‹é¡¹ç›®å®è·µã€‚å‚è€ƒæ¸¸åŒã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹å’Œhttps://github.com/qinguoyi/TinyWebServer/tree/masterã€‚</summary>
    
    
    
    <category term="æœåŠ¡å™¨" scheme="http://example.com/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
    <category term="HTTP" scheme="http://example.com/tags/HTTP/"/>
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>CMake&amp;Meson è¾¹å­¦è¾¹è®°</title>
    <link href="http://example.com/2021/04/10/cmake-notes/"/>
    <id>http://example.com/2021/04/10/cmake-notes/</id>
    <published>2021-04-10T12:32:42.000Z</published>
    <updated>2021-07-24T06:24:58.207Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="CMakeç¬”è®°"><a href="#CMakeç¬”è®°" class="headerlink" title="CMakeç¬”è®°"></a>CMakeç¬”è®°</h1><p><strong>ä¸€å¼€å§‹æ˜¯è®°å½•CMakeçš„å­¦ä¹ ï¼Œ7æœˆä»½å®ä¹ ç”¨åˆ°äº†Mesonï¼Œæ•…ä¹Ÿè®°å½•åœ¨äº†è¿™ç¯‡æ–‡ç« ä¸­ã€‚</strong></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="Windowså®‰è£…"><a href="#Windowså®‰è£…" class="headerlink" title="Windowså®‰è£…"></a>Windowså®‰è£…</h3><ul><li>ç½‘å€ï¼š<a href="https://cmake.org/download/">https://cmake.org/download/</a></li></ul><h3 id="Linuxå®‰è£…"><a href="#Linuxå®‰è£…" class="headerlink" title="Linuxå®‰è£…"></a>Linuxå®‰è£…</h3><ul><li><p>ç›´æ¥å®‰è£… <code>apt install cmake</code></p></li><li><p>ç½‘å€ï¼š<a href="https://cmake.org/download/">https://cmake.org/download/</a>     ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„CMakeï¼ˆ32ä½æˆ–è€…64ä½ï¼‰</p></li><li><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè§£å‹</p><p><code>    tar -zxvf cmake-3.10.0-rc4-Linux-x86_64.tar.gz</code></p></li><li><p>æŠŠè§£å‹åçš„ç›®å½•æ”¹åä¸ºï¼šcmake</p><p><code>mv cmake-3.10.0-rc4-Linux-x86_64 cmake</code></p></li><li><p>å®‰è£…å®Œæ¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥ï¼š<code>cmake --version</code>æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p></li></ul><h2 id="CMakeåˆæ¢"><a href="#CMakeåˆæ¢" class="headerlink" title="CMakeåˆæ¢"></a>CMakeåˆæ¢</h2><p><strong>åŸºæœ¬éƒ½åœ¨æˆ‘çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šå€’è…¾ï¼Œç¯å¢ƒä¸ºUbuntu 16.04</strong></p><h3 id="CMakeåŸºç¡€çŸ¥è¯†"><a href="#CMakeåŸºç¡€çŸ¥è¯†" class="headerlink" title="CMakeåŸºç¡€çŸ¥è¯†"></a>CMakeåŸºç¡€çŸ¥è¯†</h3><ul><li><p>æœ€ä½ç‰ˆæœ¬</p><ul><li><p><code>CMakeLists.txt</code>çš„ç¬¬ä¸€è¡Œéƒ½ä¼šå†™ï¼š<code>cmake_minimum_required(VERSION 3.1)</code>ï¼Œè¯¥å‘½ä»¤æŒ‡å®šäº†CMakeçš„æœ€ä½ç‰ˆæœ¬æ˜¯3.1</p></li><li><p>å‘½ä»¤åç§°<code>cmake_minimum_required</code>ä¸åŒºåˆ†å¤§å°å†™</p></li><li><p>è®¾ç½®ç‰ˆæœ¬èŒƒå›´ï¼š<code>cmake_minimum_required(VERSION 3.1...3.12)</code></p></li><li><p>åˆ¤æ–­CMakeç‰ˆæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#è¯¥å‘½ä»¤è¡¨ç¤ºï¼šå¦‚æœCMakeç‰ˆæœ¬å°äº3.12ï¼Œåˆ™ifå—å°†ä¸ºtrueï¼Œç„¶åå°†è®¾ç½®ä¸ºå½“å‰CMakeç‰ˆæœ¬</span><br><span class="line">#å¦‚æœCMakeç‰ˆæœ¬é«˜äº3.12ï¼Œifå—ä¸ºå‡ï¼Œcmake_minimum_requiredå°†è¢«æ­£ç¡®æ‰§è¡Œ</span><br><span class="line">if($&#123;CMAKE_VERSION&#125; VERSION_LESS 3.12)     </span><br><span class="line">    cmake_policy(VERSION $&#123;CMAKE_MAJOR_VERSION&#125;.$&#123;CMAKE_MINOR_VERSION&#125;) </span><br><span class="line">endif() </span><br></pre></td></tr></table></figure></li><li><p>æ³¨æ„ï¼šå¦‚æœéœ€è¦æ”¯æŒéå‘½ä»¤è¡ŒWindowsç‰ˆæœ¬åˆ™éœ€åœ¨ä¸Šé¢çš„ifåˆ¤æ–­åŠ ä¸Šelseåˆ†æ”¯ï¼Œå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.1)</span><br><span class="line">if($&#123;CMAKE_VERSION&#125; VERSION_LESS 3.12)</span><br><span class="line">    cmake_policy(VERSION $&#123;CMAKE_MAJOR_VERSION&#125;.$&#123;CMAKE_MINOR_VERSION&#125;)</span><br><span class="line">else()</span><br><span class="line">    cmake_policy(VERSION 3.12)</span><br><span class="line">endif()</span><br></pre></td></tr></table></figure></li></ul></li><li><p>è®¾ç½®ç”Ÿæˆé¡¹ç›®åç§°</p><ul><li><p>å‘½ä»¤ï¼š<code>projectï¼ˆMyProjectï¼‰</code>,è¡¨ç¤ºç”Ÿæˆçš„å·¥ç¨‹åå­—å«åšï¼š<code>MyProject</code></p></li><li><p>å‘½ä»¤è¿˜å¯ä»¥æ ‡è¯†é¡¹ç›®æ”¯æŒçš„è¯­è¨€ï¼Œå†™æ³•ï¼š<code>projectï¼ˆMyProject[C] [C++]ï¼‰</code>,ä¸è¿‡é€šå¸¸å°†åé¢çš„å‚æ•°çœæ‰ï¼Œå› ä¸ºé»˜è®¤æ”¯æŒæ‰€æœ‰è¯­è¨€</p></li><li><p>ä½¿ç”¨è¯¥æŒ‡ä»¤ä¹‹åç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªå˜é‡ï¼š<code>&lt;projectname&gt;_BINARY_DIR</code>  äºŒè¿›åˆ¶æ–‡ä»¶ä¿å­˜è·¯å¾„ã€<code>&lt;projectname&gt;_SOURCE_DIR</code>  æºä»£ç è·¯å¾„</p></li><li><p>æ‰§è¡Œ<code>project(MyProject)</code>ï¼Œå°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªé¡¹ç›®çš„åç§°ä¸º<code>MyProject</code>ï¼Œå¯¹åº”çš„å°±ä¼šç”Ÿæˆä¸¤ä¸ªå˜é‡ï¼š<code>_BINARY_DIR</code>å’Œ<code>_SOURCE_DIR</code>ï¼Œä½†æ˜¯<code>cmake</code>ä¸­å…¶å®å·²ç»æœ‰ä¸¤ä¸ªé¢„å®šä¹‰çš„å˜é‡ï¼š<code>PROJECT_BINARY_DIR</code> å’Œ <code>PROJECT_SOURCR_DIR</code></p></li><li><p>å…³äºä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸åŒï¼Œæ¶‰åŠåˆ°æ˜¯å†…éƒ¨æ„å»ºè¿˜æ˜¯å¤–éƒ¨æ„å»º</p><ul><li><p>å†…éƒ¨æ„å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake ./</span><br><span class="line">make</span><br></pre></td></tr></table></figure></li><li><p>å¤–éƒ¨æ„å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd ./build</span><br><span class="line">cmake ../</span><br><span class="line">make</span><br></pre></td></tr></table></figure></li><li><p>å†…éƒ¨æ„å»ºå’Œå¤–éƒ¨æ„å»ºçš„ä¸åŒåœ¨äºï¼š<code>cmake </code>çš„å·¥ä½œç›®å½•ä¸åŒã€‚å†…éƒ¨æ„å»ºä¼šå°†<code>cmake</code>ç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨å’Œé¡¹ç›®åŒä¸€ç›®å½•ï¼›å¤–éƒ¨æ„å»ºçš„è¯ï¼Œä¸­é—´æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¼šæ”¾åœ¨<code>build</code>ç›®å½•</p></li><li><p><code>PROJECT_SOURCE_DIR</code>å’Œ<code>_SOURCE_DIR</code>æ— è®ºå†…éƒ¨æ„å»ºè¿˜æ˜¯å¤–éƒ¨æ„å»ºï¼ŒæŒ‡å‘çš„å†…å®¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æŒ‡å‘å·¥ç¨‹çš„æ ¹ç›®å½•</p></li><li><p><code>PROJECT_BINARY_DIR</code>å’Œ<code>_BINARY_DIR</code>æŒ‡å‘çš„ç›¸åŒå†…å®¹ï¼Œå†…éƒ¨æ„å»ºçš„æ—¶å€™æŒ‡å‘<code>CMakeLists.txt</code>æ–‡ä»¶çš„ç›®å½•ï¼Œå¤–éƒ¨æ„å»ºæŒ‡å‘<code>target</code>ç¼–è¯‘çš„ç›®å½•</p></li></ul></li></ul></li><li><p>ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</p><ul><li><p>è¯­æ³•ï¼š<code>add_executable(exename srcname)</code></p><blockquote><ul><li>exename:ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„åå­—</li><li>srcname:åŸæ¥çš„æºæ–‡ä»¶</li></ul></blockquote></li><li><p>è¯¥å‘½ä»¤æŒ‡å®šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„åå­—ä»¥åŠæŒ‡å‡ºéœ€è¦ä¾èµ–çš„æºæ–‡ä»¶çš„æ–‡ä»¶å</p></li><li><p>è·å–æ–‡ä»¶è·¯å¾„ä¸­çš„æ‰€æœ‰æºæ–‡ä»¶</p><ul><li>å‘½ä»¤ï¼š<code>aux_sourcr_directory(&lt;dir&gt; &lt;variable&gt;)</code></li><li>ä¾‹å­ï¼š<code>aux_sourcr_directory(. DIR_SRCS)</code>ï¼Œå°†å½“å‰ç›®å½•ä¸‹çš„æºæ–‡ä»¶åå­—å­˜æ”¾åˆ°å˜é‡<code>DIR_SRCS</code>é‡Œé¢ ï¼Œå¦‚æœæºæ–‡ä»¶æ¯”è¾ƒå¤šï¼Œç›´æ¥ç”¨<code>DIR_SRCS</code>å˜é‡å³å¯</li></ul></li><li><p>ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼š<code>add_executable(Demo $&#123;DIR_SRCS&#125;)</code>ï¼Œå°†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å‘½åä¸ºï¼š<code>Demo</code></p></li></ul></li><li><p>ç”Ÿæˆ<code>lib</code>åº“</p><ul><li><p>å‘½ä»¤ï¼š<code>add_library(libname [SHARED|STATIC|MODULE] [EXCLUDE_FROM_ALL] source1 source2 ... sourceN)</code></p><blockquote><ul><li><code>libname</code>:ç”Ÿæˆçš„åº“æ–‡ä»¶çš„åå­—</li><li><code>[SHARED|STATIC|MODULE]</code>ï¼šç”Ÿæˆåº“æ–‡ä»¶çš„ç±»å‹ï¼ˆåŠ¨æ€åº“|é™æ€åº“|æ¨¡å—ï¼‰</li><li><code>[EXCLUDE_FROM_ALL]</code>ï¼šæœ‰è¿™ä¸ªå‚æ•°è¡¨ç¤ºè¯¥åº“ä¸ä¼šè¢«é»˜è®¤æ„å»º</li><li><code>source2 ... sourceN</code>ï¼šç”Ÿæˆåº“ä¾èµ–çš„æºæ–‡ä»¶ï¼Œå¦‚æœæºæ–‡ä»¶æ¯”è¾ƒå¤šï¼Œå¯ä»¥ä½¿ç”¨</li><li><code>aux_sourcr_directory</code>å‘½ä»¤è·å–è·¯å¾„ä¸‹æ‰€æœ‰æºæ–‡ä»¶ï¼Œå…·ä½“ç« èŠ‚å‚è§ï¼š<code>CMake</code>åˆæ¢-&gt;ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶-&gt;è·å–è·¯å¾„ä¸­æ‰€æœ‰æºæ–‡ä»¶</li></ul></blockquote></li><li><p>ä¾‹å­ï¼š<code>add_library(ALib SHARE alib.cpp)</code></p></li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add_executable(demo demo.cpp) # ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">add_library(common STATIC util.cpp) # ç”Ÿæˆé™æ€åº“</span><br><span class="line">add_library(common SHARED util.cpp) # ç”ŸæˆåŠ¨æ€åº“æˆ–å…±äº«åº“</span><br></pre></td></tr></table></figure><blockquote><p><code>add_library</code> é»˜è®¤ç”Ÿæˆæ˜¯é™æ€åº“ï¼Œé€šè¿‡ä»¥ä¸Šå‘½ä»¤ç”Ÿæˆæ–‡ä»¶åå­—ï¼Œ</p><ul><li>åœ¨ Linux ä¸‹æ˜¯ï¼š<br>demo<br>libcommon.a<br>libcommon.so</li><li>åœ¨ Windows ä¸‹æ˜¯ï¼š<br>demo.exe<br>common.lib<br>common.dll</li></ul></blockquote><ul><li><p>æ·»åŠ å¤´æ–‡ä»¶ç›®å½•</p><ul><li><p>å‘½ä»¤1ï¼š<code>target_include_directories(&lt;target&gt; [SYSTEM] [BEFORE]   &lt;INTERFACE|PUBLIC|PRIVATE&gt; [items1...]   [&lt;INTERFACE|PUBLIC|PRIVATE&gt; [items2...] ...])</code></p><blockquote><p>å½“æˆ‘ä»¬æ·»åŠ å­é¡¹ç›®ä¹‹åè¿˜éœ€è¦è®¾ç½®ä¸€ä¸ª<code>include</code>è·¯å¾„ï¼Œä¾‹å­ï¼š<br>eg:<code>target_include_directories(RigelEditor PUBLIC ./include/rgeditor)</code>ï¼Œè¡¨ç¤ºç»™<code>RigelEditor</code> è¿™ä¸ªå­é¡¹ç›®æ·»åŠ ä¸€ä¸ªåº“æ–‡ä»¶çš„è·¯å¾„</p></blockquote></li><li><p>å‘½ä»¤2ï¼š<code>include_directories([AFTER|BEFORE] [SYSTEM] dir1 [dir2 â€¦])</code></p><blockquote><p>å‚æ•°è§£æï¼š</p><ul><li>[AFTER|BEFORE]ï¼šæŒ‡å®šäº†è¦æ·»åŠ è·¯å¾„æ˜¯æ·»åŠ åˆ°åŸæœ‰åˆ—è¡¨ä¹‹å‰è¿˜æ˜¯ä¹‹å</li><li>[SYSTEM]ï¼šè‹¥æŒ‡å®šäº†<code>system</code>å‚æ•°ï¼Œåˆ™æŠŠè¢«åŒ…å«çš„è·¯å¾„å½“åšç³»ç»ŸåŒ…å«è·¯å¾„æ¥å¤„ç†</li><li>dir1 [dir2 â€¦]æŠŠè¿™äº›è·¯å¾„æ·»åŠ åˆ°<code>CMakeLists</code>åŠå…¶å­ç›®å½•çš„<code>CMakeLists</code>çš„å¤´æ–‡ä»¶åŒ…å«é¡¹ç›®ä¸­<br>ç›¸å½“äº<code>g++</code>é€‰é¡¹ä¸­çš„-lçš„å‚æ•°çš„ä½œç”¨</li><li>ä¸¾ä¾‹ï¼š<code>include_directories(&quot;/opt/MATLAB/R2012a/extern/include&quot;)</code></li></ul></blockquote></li></ul><ul><li>ä¸¤æ¡æŒ‡ä»¤çš„ä½œç”¨éƒ½æ˜¯è®²å°†<code>include</code>çš„ç›®å½•æ·»åŠ åˆ°ç›®æ ‡åŒºåˆ«åœ¨äº<code>include_directorie</code>sæ˜¯<code>CMake</code>ç¼–è¯‘æ‰€æœ‰ç›®æ ‡çš„ç›®å½•è¿›è¡Œæ·»åŠ ï¼Œ<code>target_include_directories</code>æ˜¯å°†<code>CMake</code>ç¼–è¯‘çš„æŒ‡å®šçš„ç‰¹å®šç›®æ ‡çš„åŒ…å«ç›®å½•è¿›è¡Œæ·»åŠ </li></ul></li><li><p>æ·»åŠ éœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶è·¯å¾„</p><ul><li><p>å‘½ä»¤1:<code>target_link_libraries(&lt;target&gt; [item1 [item2 [...]]] [[debug|optimized|general] &lt;item&gt;] ...)</code></p><blockquote><ul><li>ä½œç”¨ï¼šä¸ºç»™å®šçš„ç›®æ ‡è®¾ç½®é“¾æ¥æ—¶ä½¿ç”¨çš„åº“ï¼ˆè®¾ç½®è¦é“¾æ¥çš„åº“æ–‡ä»¶çš„åç§°ï¼‰</li><li>eg:target_link_libraries(MyProject a b.a <a href="http://c.so/">c.so</a>)    //å°†è‹¥å¹²åº“æ–‡ä»¶é“¾æ¥åˆ°helloä¸­ï¼Œtarget_link_librariesé‡Œçš„åº“æ–‡ä»¶çš„é¡ºåºç¬¦åˆgcc/g++é“¾æ¥é¡ºåºè§„åˆ™ï¼Œå³ï¼šè¢«ä¾èµ–çš„åº“æ”¾åœ¨ä¾èµ–ä»–çš„åº“çš„åé¢ï¼Œå¦‚æœé¡ºåºæœ‰é”™ï¼Œé“¾æ¥å°†ä¼šæŠ¥é”™</li><li>å…³é”®å­—ï¼šdebugå¯¹åº”äºè°ƒè¯•é…ç½®</li><li>å…³é”®å­—ï¼šoptimizedå¯¹åº”äºæ‰€æœ‰å…¶ä»–çš„é…ç½®ç±»å‹</li><li>å…³é”®å­—ï¼šgeneralå¯¹åº”äºæ‰€æœ‰çš„é…ç½®ï¼ˆè¯¥å±æ€§æ˜¯é»˜è®¤å€¼ï¼‰</li></ul></blockquote></li><li><p>å‘½ä»¤2ï¼š<code>link_libraries</code></p><blockquote><ul><li>ä½œç”¨ï¼šç»™å½“å‰å·¥ç¨‹é“¾æ¥éœ€è¦çš„åº“æ–‡ä»¶ï¼ˆå…¨è·¯å¾„ï¼‰</li><li>eg:<code>link_libraries((&quot;/opt/MATLAB/R2012a/bin/glnxa64/libeng.so&quot;)</code>//å¿…é¡»æ·»åŠ å¸¦åå­—çš„å…¨è·¯å¾„</li></ul></blockquote></li><li><p>åŒºåˆ«ï¼š<code>target_link_libraries</code>å¯ä»¥ç»™å·¥ç¨‹æˆ–è€…åº“æ–‡ä»¶è®¾ç½®å…¶éœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶ï¼Œè€Œä¸”ä¸éœ€è¦å¡«å†™å…¨è·¯å¾„ï¼Œä½†æ˜¯<code>link_libraries</code>åªèƒ½ç»™å·¥ç¨‹æ·»åŠ ä¾èµ–çš„åº“ï¼Œè€Œä¸”å¿…é¡»æ·»åŠ å…¨è·¯å¾„</p></li><li><p>æ·»åŠ éœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶ç›®å½•</p><blockquote><ul><li><p>å‘½ä»¤ï¼šlink_directoriesï¼ˆæ·»åŠ éœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶ç›®å½•ï¼‰</p></li><li><p>è¯­æ³•ï¼šlink_directories(directory1 directory2 â€¦)</p></li><li><p>ä¾‹å­ï¼šlink_directories(â€œ/opt/MATLAB/R2012a/bin/glnxa64â€)</p></li></ul></blockquote></li><li><p>æŒ‡ä»¤çš„åŒºåˆ«ï¼šæŒ‡ä»¤çš„å‰ç¼€å¸¦<code>target</code>ï¼Œè¡¨ç¤ºé’ˆå¯¹æŸä¸€ä¸ªç›®æ ‡è¿›è¡Œè®¾ç½®ï¼Œå¿…é¡»æŒ‡æ˜è®¾ç½®çš„ç›®æ ‡ï¼›<code>include_directories</code>æ˜¯åœ¨ç¼–è¯‘æ—¶ç”¨ï¼ŒæŒ‡æ˜<code>.h</code>æ–‡ä»¶çš„è·¯å¾„ï¼›<code>link_directoeies</code>æ˜¯åœ¨é“¾æ¥æ—¶ç”¨çš„ï¼ŒæŒ‡æ˜é“¾æ¥åº“çš„è·¯å¾„ï¼›<code>target_link_libraries</code>æ˜¯æŒ‡æ˜é“¾æ¥åº“çš„åå­—ï¼Œä¹Ÿå°±æ˜¯å…·ä½“è°é“¾æ¥åˆ°å“ªä¸ªåº“ã€‚<code>link_libraries</code>ä¸å¸¸ç”¨ï¼Œå› ä¸ºå¿…é¡»æŒ‡æ˜å¸¦æ–‡ä»¶åå…¨è·¯å¾„</p></li></ul></li><li><p>æ§åˆ¶ç›®æ ‡å±æ€§</p><ul><li><p>ä»¥ä¸Šçš„å‡ æ¡å‘½ä»¤çš„åŒºåˆ†éƒ½æ˜¯ï¼šæ˜¯å¦å¸¦<code>target</code>å‰ç¼€ï¼Œåœ¨<code>CMake</code>é‡Œé¢ï¼Œä¸€ä¸ª<code>target</code>æœ‰è‡ªå·±çš„å±æ€§é›†ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ˜¾ç¤ºçš„è®¾ç½®è¿™äº›<code>target</code>çš„å±æ€§çš„è¯ï¼Œ<code>CMake</code>é»˜è®¤æ˜¯ç”±ç›¸å…³çš„å…¨å±€å±æ€§æ¥å¡«å……<code>target</code>çš„å±æ€§ï¼Œæˆ‘ä»¬å¦‚æœéœ€è¦å•ç‹¬çš„è®¾ç½®<code>target</code>çš„å±æ€§ï¼Œéœ€è¦ä½¿ç”¨å‘½ä»¤ï¼š<code>set_target_properties()</code></p></li><li><p>å‘½ä»¤æ ¼å¼:</p><blockquote><p>set_target_properties(target1 target2 â€¦<br>PROPERTIES<br>å±æ€§åç§°1  å€¼<br>å±æ€§åç§°2  å€¼<br>â€¦<br>)</p></blockquote></li><li><p>æ§åˆ¶ç¼–è¯‘é€‰é¡¹çš„å±æ€§æ˜¯ï¼š<code>COMPILE_FLAGS</code></p></li><li><p>æ§åˆ¶é“¾æ¥é€‰é¡¹çš„å±æ€§æ˜¯ï¼š<code>LINK_FLAGS</code></p></li><li><p>æ§åˆ¶è¾“å‡ºè·¯å¾„çš„å±æ€§ï¼š<code>EXECUTABLE_OUTPUT_PATH</code>ï¼ˆexeçš„è¾“å‡ºè·¯å¾„ï¼‰ã€<code>LIBRARY_OUTPUT_PATH</code>ï¼ˆåº“æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ï¼‰</p></li><li><p>ä¸¾ä¾‹ï¼š</p><blockquote><p>set_target_properties(exe<br>PROPERTIES<br>LINK_FLAGS          -static<br>LINK_FLAGS_RELEASE  -s<br>)</p></blockquote><p>è¿™æ¡æŒ‡ä»¤ä¼šä½¿å¾—<code>exe</code>è¿™ä¸ªç›®æ ‡åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹éƒ½é‡‡ç”¨<code>-static</code>é€‰é¡¹ï¼Œè€Œä¸”åœ¨<code>release build</code>çš„æ—¶å€™<code>-static -s</code>é€‰é¡¹ã€‚ä½†æ˜¯è¿™ä¸ªå±æ€§ä»…ä»…åœ¨<code>exe</code>è¿™ä¸ª<code>target</code>ä¸Šé¢æœ‰æ•ˆ</p></li></ul></li></ul><h3 id="Cmakeæ„å»ºç¤ºä¾‹"><a href="#Cmakeæ„å»ºç¤ºä¾‹" class="headerlink" title="Cmakeæ„å»ºç¤ºä¾‹"></a>Cmakeæ„å»ºç¤ºä¾‹</h3><p>ç»å…¸çš„<code>helloworld</code>å¿…é¡»å‡ºç°å•Šï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>main.cpp</code>åŒ…å«æºçš„æ–‡ä»¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> parameter_size, <span class="keyword">char</span> **parameter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span> + <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> b = a + <span class="number">3</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;hello word  &quot;</span> &lt;&lt; parameter_size &lt;&lt; <span class="string">&quot;   &quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>CMakeLists.txt</code>åŒä¸€ä¸ªç›®å½•ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.5)</span><br><span class="line">#é¡¹ç›®åç§°</span><br><span class="line">project(test_cmaka)</span><br><span class="line">#ä»£ç è·¯å¾„</span><br><span class="line">aux_source_directory(. DIR_TOOT_SRCS)</span><br><span class="line">#dubug æ¨¡å¼</span><br><span class="line">set (CMAKE_CXX_FLAGS  &quot;$&#123;CMAKE_CXX_FLAGS&#125; -g&quot;)</span><br><span class="line">#å°†å¯æ‰§è¡Œæ–‡ä»¶æ”¾å…¥binç›®å½•</span><br><span class="line">set( EXECUTABLE_OUTPUT_PATH $&#123;PROJECT_SOURCE_DIR&#125;/bin)</span><br><span class="line">#ç”Ÿæˆå¯æ‰§è¡Œçš„æ–‡ä»¶</span><br><span class="line">add_executable(main $&#123;DIR_TOOT_SRCS&#125;)</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ç›®å½• å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|-- test_cmake</span><br><span class="line">    |-- main.cpp</span><br><span class="line">    |-- CMakeLists.txt</span><br></pre></td></tr></table></figure><p>ç°åœ¨å‡†å¤‡æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå¯¼èˆªåˆ°æ–‡ä»¶ç›®å½•ä¸‹ï¼Œåˆ›å»º<code>build</code>æ–‡ä»¶å¤¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir build</span><br></pre></td></tr></table></figure><p>è¿›å…¥<code>build</code>ç›®å½•ï¼Œæ‰§è¡Œå¤–éƒ¨æ„å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd build</span><br><span class="line"># cmake ../</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- The C compiler identification is GNU 7.5.0</span><br><span class="line">-- The CXX compiler identification is GNU 7.5.0</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /root/share/C++/test_cmake/build</span><br></pre></td></tr></table></figure><p>å†çœ‹çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMakeCache.txt  CMakeFiles  cmake_install.cmake  Makefile</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆåŠŸç”Ÿæˆäº†Makefileï¼Œè¿˜æœ‰ä¸€äº›cmakeè¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶<br>ç„¶ååœ¨ç»ˆç«¯ä¸‹è¾“å…¥makeå¹¶å›è½¦,è¾“å‡ºä»¥ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Scanning dependencies of target main</span><br><span class="line">[ 50%] Building CXX object CMakeFiles/main.dir/main.cpp.o</span><br><span class="line">[100%] Linking CXX executable ../bin/main</span><br><span class="line">[100%] Built target main</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæ–‡ä»¶ç›®å½•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|-- test_cmake</span><br><span class="line">    |-- bin</span><br><span class="line">    |-- build</span><br><span class="line">    |-- main.cpp</span><br><span class="line">    |-- CMakeLists.txt</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨<code>bin</code>ç›®å½•ä¸‹ï¼Œå¯¼èˆªåˆ°è¯¥ç›®å½•ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ../bin</span><br><span class="line">./main</span><br></pre></td></tr></table></figure><p>äº§ç”Ÿé¢„æœŸçš„è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello word  1 </span><br></pre></td></tr></table></figure><p><code>github</code>ä¸Šæœ‰ä¸é”™çš„<code>CMakeâ€”â€”examples</code>  é“¾æ¥ï¼š<a href="https://github.com/ttroy50/cmake-examples">https://github.com/ttroy50/cmake-examples</a></p><h1 id="Mesonç¬”è®°"><a href="#Mesonç¬”è®°" class="headerlink" title="Mesonç¬”è®°"></a>Mesonç¬”è®°</h1><h2 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="Linuxå®‰è£…-1"><a href="#Linuxå®‰è£…-1" class="headerlink" title="Linuxå®‰è£…"></a>Linuxå®‰è£…</h3><ul><li><p>MesonåŸºäºPython3è¿è¡Œï¼Œè¦æ±‚Pythonç‰ˆæœ¬3.5ä»¥ä¸Š</p></li><li><p>å®‰è£…ä¾èµ– <code>ninja-build</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ninja-build</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…<code>Meson</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip3 install meson #root      </span><br><span class="line"></span><br><span class="line">pip3 install --user meson #user å®˜æ–¹æ¨è</span><br></pre></td></tr></table></figure></li><li><p>ä¹Ÿä»<code>git</code>ä¸‹è½½å®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mesonbuild/meson.git /path/to/sourcedir</span><br></pre></td></tr></table></figure></li></ul><h3 id="Mesonæ„å»ºç¤ºä¾‹"><a href="#Mesonæ„å»ºç¤ºä¾‹" class="headerlink" title="Mesonæ„å»ºç¤ºä¾‹"></a>Mesonæ„å»ºç¤ºä¾‹</h3><p>ä¾ç„¶ç»å…¸çš„<code>helloworld</code>ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>main.c</code>åŒ…å«æºçš„æ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># main.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello there.\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>meson.build</code>åŒä¸€ä¸ªç›®å½•ä¸­è°ƒç”¨çš„æ–‡ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">project(&#x27;tutorial&#x27;, &#x27;c&#x27;)</span><br><span class="line">executable(&#x27;main&#x27;, &#x27;main.c&#x27;)</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ç›®å½•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|-- test_meson</span><br><span class="line">    |-- main.c</span><br><span class="line">    |-- meson.build</span><br></pre></td></tr></table></figure><p>ç°åœ¨å‡†å¤‡æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå¯¼èˆªåˆ°æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#æ„å»ºç¨‹åº</span><br><span class="line">$ meson build</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ„å»ºç›®å½•<code>build</code>æ¥ä¿å­˜æ‰€æœ‰ç¼–è¯‘å™¨è¾“å‡ºã€‚<code>Meson</code> ä¸å…¶ä»–ä¸€äº›æ„å»ºç³»ç»Ÿçš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒä¸å…è®¸æºä»£ç æ„å»ºã€‚æ‚¨å¿…é¡»å§‹ç»ˆåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ„å»ºç›®å½•ã€‚å¸¸è§çš„çº¦å®šæ˜¯å°†é»˜è®¤æ„å»ºç›®å½•æ”¾åœ¨é¡¶çº§æºç›®å½•çš„å­ç›®å½•ä¸­</p><p>å½“ <code>Meson</code> è¿è¡Œæ—¶ï¼Œå®ƒä¼šæ‰“å°ä»¥ä¸‹è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">The Meson build system</span><br><span class="line">Version: 0.58.1</span><br><span class="line">Source dir: /root/share/C++/test_meson</span><br><span class="line">Build dir: /root/share/C++/test_meson/build</span><br><span class="line">Build type: native build</span><br><span class="line">Project name: tutorial</span><br><span class="line">Project version: undefined</span><br><span class="line">C compiler for the host machine: cc (gcc 7.5.0 &quot;cc (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0&quot;)</span><br><span class="line">C linker for the host machine: cc ld.bfd 2.30</span><br><span class="line">Host machine cpu family: x86_64</span><br><span class="line">Host machine cpu: x86_64</span><br><span class="line">Build targets in project: 1</span><br></pre></td></tr></table></figure><p>ç°åœ¨å·²ç»å‡†å¤‡å¥½æ„å»ºæˆ‘ä»¬çš„ä»£ç äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd buildd</span><br><span class="line">$ ninja</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨çš„ <code>Meson</code> ç‰ˆæœ¬é«˜äº <code>0.55.0</code>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ–°çš„åç«¯ä¸å¯çŸ¥æ„å»ºå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd build</span><br><span class="line">$ meson compile</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦æ„å»ºäº†å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œå®ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./main</span><br></pre></td></tr></table></figure><p>è¿™ä¼šäº§ç”Ÿé¢„æœŸçš„è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello there.</span><br></pre></td></tr></table></figure><p>â€‹    </p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://mubu.com/doc/t1VDCEn4O0#o-17f166a665726b18d">https://mubu.com/doc/t1VDCEn4O0#o-17f166a665726b18d</a></p><p><a href="https://cmake.org/documentation">https://cmake.org/documentation</a></p><p><a href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">https://cmake.org/cmake/help/latest/guide/tutorial/index.html</a></p><p><a href="https://mesonbuild.com/">https://mesonbuild.com/</a></p>]]></content>
    
    
    <summary type="html">å­¦ä¹ ç”Ÿäº§åŠ›å·¥å…·CMakeã€Meson</summary>
    
    
    
    <category term="Tools" scheme="http://example.com/categories/Tools/"/>
    
    
    <category term="CMake" scheme="http://example.com/tags/CMake/"/>
    
    <category term="Meson" scheme="http://example.com/tags/Meson/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œIOæ¼”å˜å‘å±•è¿‡ç¨‹å’Œæ¨¡å‹ä»‹ç»</title>
    <link href="http://example.com/2021/03/24/%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8-%E7%BD%91%E7%BB%9CIO/"/>
    <id>http://example.com/2021/03/24/%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8-%E7%BD%91%E7%BB%9CIO/</id>
    <published>2021-03-24T06:04:11.000Z</published>
    <updated>2021-08-14T06:12:41.613Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç½‘ç»œ-IO-æ¼”å˜å‘å±•è¿‡ç¨‹å’Œæ¨¡å‹ä»‹ç»"><a href="#ç½‘ç»œ-IO-æ¼”å˜å‘å±•è¿‡ç¨‹å’Œæ¨¡å‹ä»‹ç»" class="headerlink" title="ç½‘ç»œ IO æ¼”å˜å‘å±•è¿‡ç¨‹å’Œæ¨¡å‹ä»‹ç»"></a>ç½‘ç»œ IO æ¼”å˜å‘å±•è¿‡ç¨‹å’Œæ¨¡å‹ä»‹ç»</h1><blockquote><p>è½¬è…¾è®¯æŠ€æœ¯å·¥ç¨‹â€”â€”<a href="https://mp.weixin.qq.com/s/EDzFOo3gcivOe_RgipkTkQ">ç½‘ç»œ IO æ¼”å˜å‘å±•è¿‡ç¨‹å’Œæ¨¡å‹ä»‹ç»</a></p></blockquote><p>åœ¨äº’è”ç½‘ä¸­æèµ·ç½‘ç»œï¼Œæˆ‘ä»¬éƒ½ä¼šé¿å…ä¸äº†è®¨è®ºé«˜å¹¶å‘ã€ç™¾ä¸‡è¿æ¥ã€‚è€Œæ­¤å¤„çš„ç™¾ä¸‡è¿æ¥çš„å®ç°ï¼Œè„±ç¦»ä¸äº†ç½‘ç»œ IO çš„é€‰æ‹©ï¼Œå› æ­¤æœ¬æ–‡ä½œä¸ºä¸€ç¯‡ä¸ªäººå­¦ä¹ çš„ç¬”è®°ï¼Œç‰¹æ­¤è¿›è¡Œè®°å½•ä¸€ä¸‹æ•´ä¸ªç½‘ç»œ IO çš„å‘å±•æ¼”å˜è¿‡ç¨‹ã€‚ä»¥åŠç›®å‰å¹¿æ³›ä½¿ç”¨çš„ç½‘ç»œæ¨¡å‹ã€‚</p><h2 id="1-ç½‘ç»œ-IO-çš„å‘å±•"><a href="#1-ç½‘ç»œ-IO-çš„å‘å±•" class="headerlink" title="1.ç½‘ç»œ IO çš„å‘å±•"></a>1.ç½‘ç»œ IO çš„å‘å±•</h2><p>åœ¨æœ¬èŠ‚å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥ä¸€æ­¥ä»‹ç»ç½‘ç»œ IO çš„æ¼”å˜å‘å±•è¿‡ç¨‹ã€‚ä»‹ç»å®Œå‘å±•è¿‡ç¨‹åï¼Œå†å¯¹ç½‘ç»œ IO ä¸­å‡ ç»„å®¹æ˜“æ··æ·†çš„æ¦‚å¿µè¿›è¡Œå¯¹æ¯”ã€åˆ†æã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415112127.webp"></p><h3 id="1-1-ç½‘ç»œ-IO-çš„å„ä¸ªå‘å±•é˜¶æ®µ"><a href="#1-1-ç½‘ç»œ-IO-çš„å„ä¸ªå‘å±•é˜¶æ®µ" class="headerlink" title="1.1 ç½‘ç»œ IO çš„å„ä¸ªå‘å±•é˜¶æ®µ"></a>1.1 ç½‘ç»œ IO çš„å„ä¸ªå‘å±•é˜¶æ®µ</h3><p>é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨æ­¤è®¨è®ºçš„ç½‘ç»œ IO ä¸€èˆ¬éƒ½æ˜¯é’ˆå¯¹ linux æ“ä½œç³»ç»Ÿè€Œè¨€ã€‚ç½‘ç»œ IO çš„å‘å±•è¿‡ç¨‹æ˜¯éšç€ linux çš„å†…æ ¸æ¼”å˜è€Œå˜åŒ–ï¼Œå› æ­¤ç½‘ç»œ IO å¤§è‡´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p><p><strong>1. é˜»å¡ IO(BIO)</strong><br><strong>2. éé˜»å¡ IO(NIO)</strong><br><strong>3. IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆ(select/poll)</strong><br><strong>4. IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆ(epoll)</strong><br><strong>5. å¼‚æ­¥ IO(AIO)</strong></p><p>è€Œæ¯ä¸€ä¸ªé˜¶æ®µï¼Œéƒ½æ˜¯å› ä¸ºå½“å‰çš„ç½‘ç»œæœ‰ä¸€äº›ç¼ºé™·ï¼Œå› æ­¤åˆåœ¨ä¸æ–­æ”¹è¿›è¯¥ç¼ºé™·ã€‚è¿™æ˜¯<strong>ç½‘ç»œ IO ä¸€ç›´æ¼”å˜è¿‡ç¨‹ä¸­çš„æœ¬è´¨</strong>ã€‚ä¸‹é¢å°†å¯¹ä¸Šè¿°å‡ ä¸ªé˜¶æ®µè¿›è¡Œä»‹ç»ï¼Œå¹¶å¯¹æ¯ä¸ªé˜¶æ®µçš„ç½‘ç»œ IO è§£å†³äº†å“ªäº›é—®é¢˜ã€ä¼˜ç‚¹ã€ç¼ºç‚¹è¿›è¡Œå‰–æã€‚</p><h3 id="1-2-ç½‘ç»œçš„ä¸¤ä¸ªé˜¶æ®µ"><a href="#1-2-ç½‘ç»œçš„ä¸¤ä¸ªé˜¶æ®µ" class="headerlink" title="1.2 ç½‘ç»œçš„ä¸¤ä¸ªé˜¶æ®µ"></a>1.2 ç½‘ç»œçš„ä¸¤ä¸ªé˜¶æ®µ</h3><p>åœ¨ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¯ä»¥å°†å…¶å¹¿ä¹‰ä¸Šåˆ’åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªé˜¶æ®µï¼š</p><p><strong>ç¬¬ä¸€é˜¶æ®µï¼šç¡¬ä»¶æ¥å£åˆ°å†…æ ¸æ€</strong><br><strong>ç¬¬äºŒé˜¶æ®µï¼šå†…æ ¸æ€åˆ°ç”¨æˆ·æ€</strong></p><p>æœ¬äººç†è§£ï¼šæˆ‘ä»¬é€šå¸¸ä¸Šç½‘ï¼Œå¤§éƒ¨åˆ†æ•°æ®éƒ½æ˜¯é€šè¿‡ç½‘çº¿ä¼ é€’çš„ã€‚å› æ­¤å¯¹äºä¸¤å°è®¡ç®—æœºè€Œè¨€ï¼Œè¦è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œå…¶æ•°æ®éƒ½æ˜¯å…ˆä»åº”ç”¨ç¨‹åºä¼ é€’åˆ°ä¼ è¾“å±‚(TCP/UDP)åˆ°è¾¾å†…æ ¸æ€ï¼Œç„¶åå†åˆ°ç½‘ç»œå±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç‰©ç†å±‚ï¼Œæ¥ç€æ•°æ®ä¼ é€’åˆ°ç¡¬ä»¶ç½‘å¡ï¼Œæœ€åé€šè¿‡ç½‘ç»œä¼ è¾“ä»‹è´¨ä¼ é€’åˆ°å¯¹ç«¯æœºå™¨çš„ç½‘å¡ï¼Œç„¶åå†ä¸€æ­¥ä¸€æ­¥æ•°æ®ä»ç½‘å¡ä¼ é€’åˆ°å†…æ ¸æ€ï¼Œæœ€åå†æ‹·è´åˆ°ç”¨æˆ·æ€ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415112223.webp" style="zoom:50%;"><h3 id="1-3-é˜»å¡-IO-å’Œéé˜»å¡-IO-çš„åŒºåˆ«"><a href="#1-3-é˜»å¡-IO-å’Œéé˜»å¡-IO-çš„åŒºåˆ«" class="headerlink" title="1.3 é˜»å¡ IO å’Œéé˜»å¡ IO çš„åŒºåˆ«"></a>1.3 é˜»å¡ IO å’Œéé˜»å¡ IO çš„åŒºåˆ«</h3><p>æ ¹æ® 1.2 èŠ‚çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œç½‘ç»œä¸­çš„æ•°æ®ä¼ è¾“ä»ç½‘ç»œä¼ è¾“ä»‹è´¨åˆ°è¾¾ç›®çš„æœºå™¨ï¼Œéœ€è¦å¦‚ä¸Šä¸¤ä¸ªé˜¶æ®µã€‚æ­¤å¤„æˆ‘ä»¬æŠŠä»<strong>ç¡¬ä»¶åˆ°å†…æ ¸æ€</strong>è¿™ä¸€é˜¶æ®µï¼Œæ˜¯å¦å‘ç”Ÿé˜»å¡ç­‰å¾…ï¼Œå¯ä»¥å°†ç½‘ç»œåˆ†ä¸º<strong>é˜»å¡ IO</strong>å’Œ<strong>éé˜»å¡ IO</strong>ã€‚å¦‚æœç”¨æˆ·å‘èµ·äº†è¯»å†™è¯·æ±‚ï¼Œä½†å†…æ ¸æ€æ•°æ®è¿˜æœªå‡†å¤‡å°±ç»ªï¼Œè¯¥é˜¶æ®µä¸ä¼šé˜»å¡ç”¨æˆ·æ“ä½œï¼Œå†…æ ¸ç«‹é©¬è¿”å›ï¼Œåˆ™ç§°ä¸ºéé˜»å¡ IOã€‚å¦‚æœè¯¥é˜¶æ®µä¸€ç›´é˜»å¡ç”¨æˆ·æ“ä½œã€‚ç›´åˆ°å†…æ ¸æ€æ•°æ®å‡†å¤‡å°±ç»ªï¼Œæ‰è¿”å›ã€‚è¿™ç§æ–¹å¼ç§°ä¸ºé˜»å¡ IOã€‚</p><p>å› æ­¤ï¼ŒåŒºåˆ†é˜»å¡ IO å’Œéé˜»å¡ IO ä¸»è¦çœ‹ç¬¬ä¸€é˜¶æ®µæ˜¯å¦é˜»å¡ç”¨æˆ·æ“ä½œã€‚</p><h3 id="1-4-åŒæ­¥-IO-å’Œå¼‚æ­¥-IO-çš„åŒºåˆ«"><a href="#1-4-åŒæ­¥-IO-å’Œå¼‚æ­¥-IO-çš„åŒºåˆ«" class="headerlink" title="1.4 åŒæ­¥ IO å’Œå¼‚æ­¥ IO çš„åŒºåˆ«"></a>1.4 åŒæ­¥ IO å’Œå¼‚æ­¥ IO çš„åŒºåˆ«</h3><p>ä»å‰é¢æˆ‘ä»¬çŸ¥é“äº†ï¼Œæ•°æ®çš„ä¼ é€’éœ€è¦ä¸¤ä¸ªé˜¶æ®µï¼Œåœ¨æ­¤å¤„åªè¦ä»»ä½•ä¸€ä¸ªé˜¶æ®µä¼šé˜»å¡ç”¨æˆ·è¯·æ±‚ï¼Œéƒ½å°†å…¶ç§°ä¸ºåŒæ­¥ IOï¼Œä¸¤ä¸ªé˜¶æ®µéƒ½ä¸é˜»å¡ï¼Œåˆ™ç§°ä¸ºå¼‚æ­¥ IOã€‚</p><p>åœ¨ç›®å‰æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œlinux ä¸­çš„ epollã€mac çš„ kqueue éƒ½å±äºåŒæ­¥ IOï¼Œå› ä¸ºå…¶åœ¨ç¬¬äºŒé˜¶æ®µ(æ•°æ®ä»å†…æ ¸æ€åˆ°ç”¨æˆ·æ€)éƒ½ä¼šå‘ç”Ÿæ‹·è´é˜»å¡ã€‚è€Œåªæœ‰ windows ä¸­çš„ IOCP æ‰çœŸæ­£å±äºå¼‚æ­¥ IOï¼Œå³ AIOã€‚</p><h2 id="2-é˜»å¡-IO"><a href="#2-é˜»å¡-IO" class="headerlink" title="2.é˜»å¡ IO"></a>2.é˜»å¡ IO</h2><p>åœ¨æœ¬èŠ‚ï¼Œæˆ‘ä»¬å°†ä»‹ç»æœ€åˆçš„é˜»å¡ IOï¼Œé˜»å¡ IO è‹±æ–‡ä¸º blocking IOï¼Œåˆç§°ä¸º BIOã€‚æ ¹æ®å‰é¢çš„ä»‹ç»ï¼Œé˜»å¡ IO ä¸»è¦æŒ‡çš„æ˜¯ç¬¬ä¸€é˜¶æ®µ(ç¡¬ä»¶ç½‘å¡åˆ°å†…æ ¸æ€)ã€‚</p><h3 id="2-1-é˜»å¡-IO-çš„æ¦‚å¿µ"><a href="#2-1-é˜»å¡-IO-çš„æ¦‚å¿µ" class="headerlink" title="2.1 é˜»å¡ IO çš„æ¦‚å¿µ"></a>2.1 é˜»å¡ IO çš„æ¦‚å¿µ</h3><p>é˜»å¡ IOï¼Œé¡¾åæ€ä¹‰å½“ç”¨æˆ·å‘ç”Ÿäº†ç³»ç»Ÿè°ƒç”¨åï¼Œå¦‚æœæ•°æ®æœªä»ç½‘å¡åˆ°è¾¾å†…æ ¸æ€ï¼Œå†…æ ¸æ€æ•°æ®æœªå‡†å¤‡å¥½ï¼Œæ­¤æ—¶ä¼šä¸€ç›´é˜»å¡ã€‚ç›´åˆ°æ•°æ®å°±ç»ªï¼Œç„¶åä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€å†è¿”å›ã€‚å…·ä½“è¿‡ç¨‹å¯ä»¥å‚è€ƒ 2.2 çš„å›¾ç¤ºã€‚</p><h3 id="2-2-é˜»å¡-IO-çš„è¿‡ç¨‹"><a href="#2-2-é˜»å¡-IO-çš„è¿‡ç¨‹" class="headerlink" title="2.2 é˜»å¡ IO çš„è¿‡ç¨‹"></a>2.2 é˜»å¡ IO çš„è¿‡ç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415112344.webp"></p><h3 id="2-3-é˜»å¡-IO-çš„ç¼ºç‚¹"><a href="#2-3-é˜»å¡-IO-çš„ç¼ºç‚¹" class="headerlink" title="2.3 é˜»å¡ IO çš„ç¼ºç‚¹"></a>2.3 é˜»å¡ IO çš„ç¼ºç‚¹</h3><p>åœ¨ä¸€èˆ¬ä½¿ç”¨é˜»å¡ IO æ—¶ï¼Œéƒ½éœ€è¦é…ç½®å¤šçº¿ç¨‹æ¥ä½¿ç”¨ï¼Œæœ€å¸¸è§çš„æ¨¡å‹æ˜¯<strong>é˜»å¡ IO+å¤šçº¿ç¨‹</strong>ï¼Œæ¯ä¸ªè¿æ¥ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚</p><p><strong>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬ä¸€ä¸ªç¨‹åºå¯ä»¥å¼€è¾Ÿçš„çº¿ç¨‹æ˜¯æœ‰é™çš„ï¼Œè€Œä¸”å¼€è¾Ÿçº¿ç¨‹çš„å¼€é”€ä¹Ÿæ˜¯æ¯”è¾ƒå¤§çš„ã€‚ä¹Ÿæ­£æ˜¯è¿™ç§æ–¹å¼ï¼Œä¼šå¯¼è‡´ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥å¤„ç†çš„å®¢æˆ·ç«¯è¯·æ±‚å—é™ã€‚é¢å¯¹ç™¾ä¸‡è¿æ¥çš„æƒ…å†µï¼Œæ˜¯æ— æ³•å¤„ç†ã€‚</strong></p><p>æ—¢ç„¶å‘ç°äº†é—®é¢˜ï¼Œåˆ†æäº†é—®é¢˜ï¼Œé‚£å°±å¾—è§£å†³é—®é¢˜ã€‚æ—¢ç„¶é˜»å¡ IO æœ‰é—®é¢˜ï¼Œæœ¬è´¨æ˜¯ç”±äºå…¶é˜»å¡å¯¼è‡´çš„ï¼Œå› æ­¤è‡ªç„¶è€Œç„¶å¼•å‡ºäº†ä¸‹é¢å³å°†ä»‹ç»çš„ä¸»è§’ï¼š<strong>éé˜»å¡ IO</strong></p><h2 id="3-éé˜»å¡-IO"><a href="#3-éé˜»å¡-IO" class="headerlink" title="3.éé˜»å¡ IO"></a>3.éé˜»å¡ IO</h2><p>éé˜»å¡ IO æ˜¯ä¸ºäº†è§£å†³å‰é¢æåˆ°çš„é˜»å¡ IO çš„ç¼ºé™·è€Œå¼•å‡ºçš„ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»éé˜»å¡ IO çš„è¿‡ç¨‹ã€‚</p><h3 id="3-1-éé˜»å¡-IO-çš„æ¦‚å¿µ"><a href="#3-1-éé˜»å¡-IO-çš„æ¦‚å¿µ" class="headerlink" title="3.1 éé˜»å¡ IO çš„æ¦‚å¿µ"></a>3.1 éé˜»å¡ IO çš„æ¦‚å¿µ</h3><p>éé˜»å¡ IOï¼šè§åçŸ¥æ„ï¼Œå°±æ˜¯åœ¨ç¬¬ä¸€é˜¶æ®µ(ç½‘å¡-å†…æ ¸æ€)æ•°æ®æœªåˆ°è¾¾æ—¶ä¸ç­‰å¾…ï¼Œç„¶åç›´æ¥è¿”å›ã€‚å› æ­¤éé˜»å¡ IO éœ€è¦ä¸æ–­çš„ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œè¯¢é—®å†…æ ¸æ•°æ®å¥½äº†æ²¡ï¼Œå¥½äº†æ²¡ã€‚</p><h3 id="3-2-éé˜»å¡-IO-çš„è¿‡ç¨‹"><a href="#3-2-éé˜»å¡-IO-çš„è¿‡ç¨‹" class="headerlink" title="3.2 éé˜»å¡ IO çš„è¿‡ç¨‹"></a>3.2 éé˜»å¡ IO çš„è¿‡ç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415112435.webp"></p><p>éé˜»å¡ IO æ˜¯éœ€è¦ç³»ç»Ÿå†…æ ¸æ”¯æŒçš„ï¼Œåœ¨åˆ›å»ºäº†è¿æ¥åï¼Œå¯ä»¥è°ƒç”¨ setsockop è®¾ç½® noblockingã€‚</p><h3 id="3-3-éé˜»å¡-IO-çš„ä¼˜ç‚¹"><a href="#3-3-éé˜»å¡-IO-çš„ä¼˜ç‚¹" class="headerlink" title="3.3 éé˜»å¡ IO çš„ä¼˜ç‚¹"></a>3.3 éé˜»å¡ IO çš„ä¼˜ç‚¹</h3><p>æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œéé˜»å¡ IO è§£å†³äº†é˜»å¡ IO<strong>æ¯ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹å¤„ç†çš„é—®é¢˜</strong>ï¼Œæ‰€ä»¥å…¶æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ <strong>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿æ¥</strong>ï¼Œè¿™ä¹Ÿæ˜¯å…¶éé˜»å¡å†³å®šçš„ã€‚</p><h3 id="3-4-éé˜»å¡-IO-çš„ç¼ºç‚¹"><a href="#3-4-éé˜»å¡-IO-çš„ç¼ºç‚¹" class="headerlink" title="3.4 éé˜»å¡ IO çš„ç¼ºç‚¹"></a>3.4 éé˜»å¡ IO çš„ç¼ºç‚¹</h3><p>ä½†è¿™ç§æ¨¡å¼ï¼Œä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯éœ€è¦ç”¨æˆ·å¤šæ¬¡å‘èµ·ç³»ç»Ÿè°ƒç”¨ã€‚<strong>é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨</strong>æ˜¯æ¯”è¾ƒæ¶ˆè€—ç³»ç»Ÿèµ„æºçš„ã€‚</p><p>å› æ­¤ï¼Œæ—¢ç„¶å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œé‚£ä¹ˆè‡ªç„¶è€Œç„¶æˆ‘ä»¬å°±éœ€è¦è§£å†³è¯¥é—®é¢˜ï¼š<strong>ä¿ç•™éé˜»å¡ IO çš„ä¼˜ç‚¹çš„å‰æä¸‹ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨</strong>ã€‚</p><h2 id="4-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆ"><a href="#4-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆ" class="headerlink" title="4.IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆ"></a>4.IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆ</h2><p>ä¸ºäº†è§£å†³éé˜»å¡ IO å­˜åœ¨çš„é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨è¿™ä¸ªé—®é¢˜ï¼Œéšç€å†…æ ¸çš„å‘å±•ï¼Œå‡ºç°äº† IO å¤šè·¯å¤ç”¨æ¨¡å‹ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ææ‡‚å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>IO å¤šè·¯å¤ç”¨åˆ°åº•å¤ç”¨ä»€ä¹ˆï¼Ÿ</li><li>IO å¤šè·¯å¤ç”¨å¦‚ä½•å¤ç”¨ï¼Ÿ</li></ol><p><strong>IO å¤šè·¯å¤ç”¨ï¼š</strong> å¾ˆå¤šäººéƒ½è¯´ï¼ŒIO å¤šè·¯å¤ç”¨æ˜¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œä½†æœ¬äººä¸å¤ªè®¤å¯ï¼Œå› ä¸ºåœ¨éé˜»å¡ IO æ—¶ï¼Œå°±å·²ç»å¯ä»¥å®ç°ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥äº†ï¼Œè¿™ä¸ªæ˜¯ç”±äºå…¶éé˜»å¡è€Œå†³å®šçš„ã€‚</p><p><strong>åœ¨æ­¤å¤„ï¼Œä¸ªäººè§‚ç‚¹ï¼Œå¤šè·¯å¤ç”¨ä¸»è¦å¤ç”¨çš„æ˜¯é€šè¿‡æœ‰é™æ¬¡çš„ç³»ç»Ÿè°ƒç”¨æ¥å®ç°ç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ã€‚æœ€ç®€å•æ¥è¯´ï¼Œæˆ‘ç›®å‰æœ‰ 10 ä¸ªè¿æ¥ï¼Œæˆ‘å¯ä»¥é€šè¿‡ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨å°†è¿™ 10 ä¸ªè¿æ¥éƒ½ä¸¢ç»™å†…æ ¸ï¼Œè®©å†…æ ¸å‘Šè¯‰æˆ‘ï¼Œå“ªäº›è¿æ¥ä¸Šé¢æ•°æ®å‡†å¤‡å¥½äº†ï¼Œç„¶åæˆ‘å†å»è¯»å–æ¯ä¸ªå°±ç»ªçš„è¿æ¥ä¸Šçš„æ•°æ®ã€‚å› æ­¤ï¼ŒIO å¤šè·¯å¤ç”¨ï¼Œå¤ç”¨çš„æ˜¯ç³»ç»Ÿè°ƒç”¨ã€‚é€šè¿‡æœ‰é™æ¬¡ç³»ç»Ÿè°ƒç”¨åˆ¤æ–­æµ·é‡è¿æ¥æ˜¯å¦æ•°æ®å‡†å¤‡å¥½äº†</strong>ã€‚</p><p><strong>æ— è®ºä¸‹é¢çš„ selectã€pollã€epollï¼Œå…¶éƒ½æ˜¯è¿™ç§æ€æƒ³å®ç°çš„ï¼Œä¸è¿‡åœ¨å®ç°ä¸Šï¼Œselect/poll å¯ä»¥çœ‹åšæ˜¯ç¬¬ä¸€ç‰ˆï¼Œè€Œ epoll æ˜¯ç¬¬äºŒç‰ˆ</strong>ã€‚</p><h3 id="4-1-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„æ¦‚å¿µ"><a href="#4-1-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„æ¦‚å¿µ" class="headerlink" title="4.1 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„æ¦‚å¿µ"></a>4.1 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„æ¦‚å¿µ</h3><p><strong>IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆï¼Œè¿™ä¸ªæ¦‚å¿µæ˜¯æœ¬äººæƒ³å‡ºæ¥çš„ï¼Œä¸»è¦æ˜¯æ–¹ä¾¿å°† select/poll å’Œ epoll è¿›è¡ŒåŒºåˆ†</strong>ã€‚</p><p>æ‰€ä»¥æ­¤å¤„ IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆï¼Œä¸»è¦ç‰¹æŒ‡ select å’Œ poll è¿™ä¸¤ä¸ªã€‚</p><h4 id="select-çš„-api"><a href="#select-çš„-api" class="headerlink" title="select çš„ api"></a>select çš„ api</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// readfds:å…³å¿ƒè¯»çš„fdé›†åˆï¼›writefdsï¼šå…³å¿ƒå†™çš„fdé›†åˆï¼›excepttfdsï¼šå¼‚å¸¸çš„fdé›†åˆ</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span> <span class="params">(<span class="keyword">int</span> n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout)</span></span>;</span><br></pre></td></tr></table></figure><p>select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ† 3 ç±»ï¼Œåˆ†åˆ«æ˜¯ writefdsã€readfdsã€å’Œ exceptfdsã€‚è°ƒç”¨å select å‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªï¼ˆæœ‰æ•°æ® å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰ exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeout æŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸º null å³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“ select å‡½æ•°è¿”å›åï¼Œå¯ä»¥ é€šè¿‡éå† fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚</p><p>select ç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„å¹³å°ä¸Šæ”¯æŒï¼Œå…¶è‰¯å¥½è·¨å¹³å°æ”¯æŒä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªä¼˜ç‚¹ã€‚select çš„ä¸€ ä¸ªç¼ºç‚¹åœ¨äºå•ä¸ªè¿›ç¨‹èƒ½å¤Ÿç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œåœ¨ Linux ä¸Šä¸€èˆ¬ä¸º 1024ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å®å®šä¹‰ç”šè‡³é‡æ–°ç¼–è¯‘å†…æ ¸çš„æ–¹å¼æå‡è¿™ä¸€é™åˆ¶ï¼Œä½† æ˜¯è¿™æ ·ä¹Ÿä¼šé€ æˆæ•ˆç‡çš„é™ä½ã€‚</p><h4 id="poll-çš„-api"><a href="#poll-çš„-api" class="headerlink" title="poll çš„ api"></a>poll çš„ api</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">poll</span> <span class="params">(struct pollfd *fds, <span class="keyword">unsigned</span> <span class="keyword">int</span> nfds, <span class="keyword">int</span> timeout)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> fd; <span class="comment">/* file descriptor */</span></span><br><span class="line">    <span class="keyword">short</span> events; <span class="comment">/* requested events to watch */</span></span><br><span class="line">    <span class="keyword">short</span> revents; <span class="comment">/* returned events witnessed */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>pollfd ç»“æ„åŒ…å«äº†è¦ç›‘è§†çš„ event å’Œå‘ç”Ÿçš„ eventï¼Œä¸å†ä½¿ç”¨ selectâ€œå‚æ•°-å€¼â€ä¼ é€’çš„æ–¹å¼ã€‚åŒæ—¶ï¼Œpollfd å¹¶æ²¡æœ‰æœ€å¤§æ•°é‡é™åˆ¶ï¼ˆä½†æ˜¯æ•°é‡è¿‡å¤§åæ€§èƒ½ä¹Ÿæ˜¯ä¼šä¸‹é™ï¼‰ã€‚å’Œ select å‡½æ•°ä¸€æ ·ï¼Œpoll è¿”å›åï¼Œéœ€è¦è½®è¯¢ pollfd æ¥è·å–å°±ç»ªçš„æè¿°ç¬¦ã€‚</p><p>ä»ä¸Šé¢çœ‹ï¼Œselect å’Œ poll éƒ½éœ€è¦åœ¨è¿”å›åï¼Œé€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦æ¥è·å–å·²ç»å°±ç»ªçš„ socketã€‚äº‹å®ä¸Šï¼ŒåŒæ—¶è¿æ¥çš„å¤§é‡å®¢æˆ·ç«¯åœ¨ä¸€æ—¶åˆ»å¯èƒ½åªæœ‰å¾ˆå°‘çš„å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå› æ­¤éšç€ç›‘è§†çš„æè¿°ç¬¦æ•°é‡çš„å¢é•¿ï¼Œå…¶æ•ˆç‡ä¹Ÿä¼šçº¿æ€§ä¸‹é™ã€‚</p><p><strong>ä»æœ¬è´¨æ¥è¯´ï¼šIO å¤šè·¯å¤ç”¨ä¸­ï¼Œselect()/poll()/epoll_wait()è¿™å‡ ä¸ªå‡½æ•°å¯¹åº”ç¬¬ä¸€é˜¶æ®µï¼›read()/recvfrom()å¯¹åº”ç¬¬äºŒé˜¶æ®µ</strong>ã€‚</p><h3 id="4-2-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„è¿‡ç¨‹"><a href="#4-2-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„è¿‡ç¨‹" class="headerlink" title="4.2 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„è¿‡ç¨‹"></a>4.2 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„è¿‡ç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415112735.webp"></p><h3 id="4-3-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„ä¼˜ç‚¹"><a href="#4-3-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„ä¼˜ç‚¹" class="headerlink" title="4.3 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„ä¼˜ç‚¹"></a>4.3 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„ä¼˜ç‚¹</h3><p><strong>IO å¤šè·¯å¤ç”¨ï¼Œä¸»è¦åœ¨äºå¤ç”¨ï¼Œé€šè¿‡ select()æˆ–è€… poll()å°†å¤šä¸ª socket fds æ‰¹é‡é€šè¿‡ç³»ç»Ÿè°ƒç”¨ä¼ é€’ç»™å†…æ ¸ï¼Œç”±å†…æ ¸è¿›è¡Œå¾ªç¯éå†åˆ¤æ–­å“ªäº› fd ä¸Šæ•°æ®å°±ç»ªäº†ï¼Œç„¶åå°†å°±ç»ªçš„ readyfds è¿”å›ç»™ç”¨æˆ·ã€‚å†ç”±ç”¨æˆ·è¿›è¡ŒæŒ¨ä¸ªéå†å°±ç»ªå¥½çš„ fdï¼Œè¯»å–æˆ–è€…å†™å…¥æ•°æ®ã€‚</strong></p><p><strong>æ‰€ä»¥é€šè¿‡ IO å¤šè·¯å¤ç”¨+éé˜»å¡ IOï¼Œä¸€æ–¹é¢é™ä½äº†ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥ç”¨æå°‘çš„çº¿ç¨‹æ¥å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥ã€‚</strong></p><h3 id="4-4-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„ç¼ºç‚¹"><a href="#4-4-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„ç¼ºç‚¹" class="headerlink" title="4.4 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„ç¼ºç‚¹"></a>4.4 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„ç¼ºç‚¹</h3><p>è™½ç„¶ç¬¬ä¸€ç‰ˆ IO å¤šè·¯å¤ç”¨è§£å†³äº†ä¹‹å‰æåˆ°çš„é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œä½†åŒæ—¶å¼•å…¥äº†æ–°çš„é—®é¢˜ï¼š<strong>ç”¨æˆ·éœ€è¦æ¯æ¬¡å°†æµ·é‡çš„ socket fds é›†åˆä»ç”¨æˆ·æ€ä¼ é€’åˆ°å†…æ ¸æ€ï¼Œè®©å†…æ ¸æ€å»æ£€æµ‹å“ªäº›ç½‘ç»œè¿æ¥æ•°æ®å°±ç»ªäº†</strong></p><p><strong>ä½†è¿™ä¸ªåœ°æ–¹ä¼šå‡ºç°é¢‘ç¹çš„å°†æµ·é‡ fd é›†åˆä»ç”¨æˆ·æ€ä¼ é€’åˆ°å†…æ ¸æ€ï¼Œå†ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªåœ°æ–¹å¼€é”€ä¹ŸæŒºå¤§ã€‚</strong></p><p>æ—¢ç„¶è¿˜æœ‰è¿™ä¸ªé—®é¢˜ï¼Œé‚£æˆ‘ä»¬ç»§ç»­å¼€å§‹è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› æ­¤å°±å¼•å‡ºäº†ç¬¬äºŒç‰ˆçš„ IO å¤šè·¯å¤ç”¨ã€‚</p><p><strong>å…¶å®æ€è·¯ä¹ŸæŒºç®€å•ï¼Œæ—¢ç„¶éœ€è¦æ‹·è´ï¼Œé‚£å°±æƒ³åŠæ³•ï¼Œä¸æ‹·è´ã€‚æ—¢ç„¶ä¸æ‹·è´ï¼Œé‚£å°±åœ¨å†…æ ¸å¼€è¾Ÿä¸€æ®µåŒºåŸŸå’¯</strong></p><h3 id="4-5-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„åŒºåˆ«"><a href="#4-5-IO-å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„åŒºåˆ«" class="headerlink" title="4.5 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„åŒºåˆ«"></a>4.5 IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„åŒºåˆ«</h3><p><strong>select å’Œ poll çš„åŒºåˆ«</strong></p><ol><li>select èƒ½å¤„ç†çš„æœ€å¤§è¿æ¥ï¼Œé»˜è®¤æ˜¯ 1024 ä¸ªï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ¥æ”¹å˜ï¼Œä½†ç»ˆç©¶æ˜¯æœ‰é™ä¸ªï¼›è€Œ poll ç†è®ºä¸Šå¯ä»¥æ”¯æŒæ— é™ä¸ª</li><li>select å’Œ poll åœ¨ç®¡ç†æµ·é‡çš„è¿æ¥æ—¶ï¼Œä¼šé¢‘ç¹çš„ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œæ¯”è¾ƒæ¶ˆè€—èµ„æºã€‚</li></ol><h2 id="5-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆ"><a href="#5-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆ" class="headerlink" title="5. IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆ"></a>5. IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆ</h2><p>IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆä¸»è¦æŒ‡ epollï¼Œepoll çš„å‡ºç°ä¹Ÿæ˜¯éšç€å†…æ ¸ç‰ˆæœ¬è¿­ä»£æ‰è¯ç”Ÿçš„ï¼Œåœ¨ç½‘ä¸Šåˆ°å¤„çœ‹åˆ°ï¼Œepoll æ˜¯å†…æ ¸ 2.6 ä»¥åå¼€å§‹æ”¯æŒçš„</p><p><strong>epoll çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³å‰é¢æåˆ°çš„ IO å¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆçš„é—®é¢˜</strong>ã€‚</p><h3 id="5-1-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„æ¦‚å¿µ"><a href="#5-1-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„æ¦‚å¿µ" class="headerlink" title="5.1 IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„æ¦‚å¿µ"></a>5.1 IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„æ¦‚å¿µ</h3><h4 id="epoll-æä¾›çš„-api"><a href="#epoll-æä¾›çš„-api" class="headerlink" title="epoll æä¾›çš„ api"></a>epoll æä¾›çš„ api</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºepollFdï¼Œåº•å±‚æ˜¯åœ¨å†…æ ¸æ€åˆ†é…ä¸€æ®µåŒºåŸŸï¼Œåº•å±‚æ•°æ®ç»“æ„çº¢é»‘æ ‘+åŒå‘é“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_create</span><span class="params">(<span class="keyword">int</span> size)</span>ï¼›<span class="comment">//åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//å¾€çº¢é»‘æ ‘ä¸­å¢åŠ ã€åˆ é™¤ã€æ›´æ–°ç®¡ç†çš„socket fd</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_ctl</span><span class="params">(<span class="keyword">int</span> epfd, <span class="keyword">int</span> op, <span class="keyword">int</span> fd, struct epoll_event *event)</span>ï¼›</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//è¿™ä¸ªapiæ˜¯ç”¨æ¥åœ¨ç¬¬ä¸€é˜¶æ®µé˜»å¡ï¼Œç­‰å¾…å°±ç»ªçš„fdã€‚</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="keyword">int</span> epfd, struct epoll_event * events, <span class="keyword">int</span> maxevents, <span class="keyword">int</span> timeout)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="function"><span class="keyword">int</span> <span class="title">epoll_create</span><span class="params">(<span class="keyword">int</span> size)</span></span>;</span><br><span class="line">åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§ï¼Œè¿™ä¸ªå‚æ•°ä¸åŒäºselect()ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç»™å‡ºæœ€å¤§ç›‘å¬çš„fd+<span class="number">1</span>çš„å€¼ï¼Œå‚æ•°sizeå¹¶ä¸æ˜¯é™åˆ¶äº†epollæ‰€èƒ½ç›‘å¬çš„æè¿°ç¬¦æœ€å¤§ä¸ªæ•°ï¼Œåªæ˜¯å¯¹å†…æ ¸åˆå§‹åˆ†é…å†…éƒ¨æ•°æ®ç»“æ„çš„ä¸€ä¸ªå»ºè®®ã€‚</span><br><span class="line">å½“åˆ›å»ºå¥½epollå¥æŸ„åï¼Œå®ƒå°±ä¼šå ç”¨ä¸€ä¸ªfdå€¼ï¼Œåœ¨linuxä¸‹å¦‚æœæŸ¥çœ‹/proc/è¿›ç¨‹id/fd/ï¼Œæ˜¯èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸ªfdçš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å®Œepollåï¼Œå¿…é¡»è°ƒç”¨close()å…³é—­ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´fdè¢«è€—å°½ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> <span class="function"><span class="keyword">int</span> <span class="title">epoll_ctl</span><span class="params">(<span class="keyword">int</span> epfd, <span class="keyword">int</span> op, <span class="keyword">int</span> fd, struct epoll_event *event)</span>ï¼›</span></span><br><span class="line"><span class="function">å‡½æ•°æ˜¯å¯¹æŒ‡å®šæè¿°ç¬¦fdæ‰§è¡Œopæ“ä½œã€‚</span></span><br><span class="line"><span class="function">- epfdï¼šæ˜¯<span class="title">epoll_create</span><span class="params">()</span>çš„è¿”å›å€¼ã€‚</span></span><br><span class="line"><span class="function">- opï¼šè¡¨ç¤ºopæ“ä½œï¼Œç”¨ä¸‰ä¸ªå®æ¥è¡¨ç¤ºï¼šæ·»åŠ EPOLL_CTL_ADDï¼Œåˆ é™¤EPOLL_CTL_DELï¼Œä¿®æ”¹EPOLL_CTL_MODã€‚åˆ†åˆ«æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹å¯¹fdçš„ç›‘å¬äº‹ä»¶ã€‚</span></span><br><span class="line"><span class="function">- fdï¼šæ˜¯éœ€è¦ç›‘å¬çš„fdï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰</span></span><br><span class="line"><span class="function">- epoll_eventï¼šæ˜¯å‘Šè¯‰å†…æ ¸éœ€è¦ç›‘å¬ä»€ä¹ˆäº‹ï¼Œstruct epoll_eventç»“æ„å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">struct epoll_event </span>&#123;</span><br><span class="line">  <span class="keyword">__uint32_t</span> events;  <span class="comment">/* Epoll events */</span></span><br><span class="line">  <span class="keyword">epoll_data_t</span> data;  <span class="comment">/* User data variable */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//eventså¯ä»¥æ˜¯ä»¥ä¸‹å‡ ä¸ªå®çš„é›†åˆï¼š</span></span><br><span class="line">EPOLLIN ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»ï¼ˆåŒ…æ‹¬å¯¹ç«¯SOCKETæ­£å¸¸å…³é—­ï¼‰ï¼›</span><br><span class="line">EPOLLOUTï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥å†™ï¼›</span><br><span class="line">EPOLLPRIï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ç´§æ€¥çš„æ•°æ®å¯è¯»ï¼ˆè¿™é‡Œåº”è¯¥è¡¨ç¤ºæœ‰å¸¦å¤–æ•°æ®åˆ°æ¥ï¼‰ï¼›</span><br><span class="line">EPOLLERRï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯ï¼›</span><br><span class="line">EPOLLHUPï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚æ–­ï¼›</span><br><span class="line">EPOLLETï¼š å°†EPOLLè®¾ä¸ºè¾¹ç¼˜è§¦å‘(Edge Triggered)æ¨¡å¼ï¼Œè¿™æ˜¯ç›¸å¯¹äºæ°´å¹³è§¦å‘(Level Triggered)æ¥è¯´çš„ã€‚</span><br><span class="line">EPOLLONESHOTï¼šåªç›‘å¬ä¸€æ¬¡äº‹ä»¶ï¼Œå½“ç›‘å¬å®Œè¿™æ¬¡äº‹ä»¶ä¹‹åï¼Œå¦‚æœè¿˜éœ€è¦ç»§ç»­ç›‘å¬è¿™ä¸ªsocketçš„è¯ï¼Œéœ€è¦å†æ¬¡æŠŠè¿™ä¸ªsocketåŠ å…¥åˆ°EPOLLé˜Ÿåˆ—é‡Œ</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> <span class="function"><span class="keyword">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="keyword">int</span> epfd, struct epoll_event * events, <span class="keyword">int</span> maxevents, <span class="keyword">int</span> timeout)</span></span>;</span><br><span class="line">ç­‰å¾…epfdä¸Šçš„ioäº‹ä»¶ï¼Œæœ€å¤šè¿”å›maxeventsä¸ªäº‹ä»¶ã€‚</span><br><span class="line">å‚æ•°eventsç”¨æ¥ä»å†…æ ¸å¾—åˆ°äº‹ä»¶çš„é›†åˆï¼Œmaxeventså‘Šä¹‹å†…æ ¸è¿™ä¸ªeventsæœ‰å¤šå¤§ï¼Œè¿™ä¸ªmaxeventsçš„å€¼ä¸èƒ½å¤§äºåˆ›å»ºepoll_create()æ—¶çš„sizeï¼Œå‚æ•°timeoutæ˜¯è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ<span class="number">0</span>ä¼šç«‹å³è¿”å›ï¼Œ<span class="number">-1</span>å°†ä¸ç¡®å®šï¼Œä¹Ÿæœ‰è¯´æ³•è¯´æ˜¯æ°¸ä¹…é˜»å¡ï¼‰ã€‚è¯¥å‡½æ•°è¿”å›éœ€è¦å¤„ç†çš„äº‹ä»¶æ•°ç›®ï¼Œå¦‚è¿”å›<span class="number">0</span>è¡¨ç¤ºå·²è¶…æ—¶ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å·¥ä½œæ¨¡å¼"><a href="#å·¥ä½œæ¨¡å¼" class="headerlink" title="å·¥ä½œæ¨¡å¼"></a>å·¥ä½œæ¨¡å¼</h4><p>epoll å¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ã€‚LT æ¨¡å¼æ˜¯é»˜è®¤æ¨¡å¼ï¼ŒLT æ¨¡å¼ä¸ ET æ¨¡å¼çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>LT æ¨¡å¼ï¼šå½“ epoll_wait æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚ä¸‹æ¬¡è°ƒç”¨ epoll_wait æ—¶ï¼Œä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚</li><li>ET æ¨¡å¼ï¼šå½“ epoll_wait æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait æ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚</li></ul><ol><li><p>LT æ¨¡å¼</p><p>LT(level triggered)æ˜¯ç¼ºçœçš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ block å’Œ no-block socket.åœ¨è¿™ç§åšæ³•ä¸­ï¼Œå†…æ ¸å‘Šè¯‰ä½ ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ªäº†ï¼Œç„¶åä½ å¯ä»¥å¯¹è¿™ä¸ªå°±ç»ªçš„ fd è¿›è¡Œ IO æ“ä½œã€‚å¦‚æœä½ ä¸ä½œä»»ä½•æ“ä½œï¼Œå†…æ ¸è¿˜æ˜¯ä¼šç»§ç»­é€šçŸ¥ä½ çš„ã€‚</p></li><li><p>ET æ¨¡å¼</p><p>ET(edge-triggered)æ˜¯é«˜é€Ÿå·¥ä½œæ–¹å¼ï¼Œåªæ”¯æŒ no-block socketã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå½“æè¿°ç¬¦ä»æœªå°±ç»ªå˜ä¸ºå°±ç»ªæ—¶ï¼Œå†…æ ¸é€šè¿‡ epoll å‘Šè¯‰ä½ ã€‚ç„¶åå®ƒä¼šå‡è®¾ä½ çŸ¥é“æ–‡ä»¶æè¿°ç¬¦å·²ç»å°±ç»ªï¼Œå¹¶ä¸”ä¸ä¼šå†ä¸ºé‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦å‘é€æ›´å¤šçš„å°±ç»ªé€šçŸ¥ï¼Œç›´åˆ°ä½ åšäº†æŸäº›æ“ä½œå¯¼è‡´é‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸å†ä¸ºå°±ç»ªçŠ¶æ€äº†(æ¯”å¦‚ï¼Œä½ åœ¨å‘é€ï¼Œæ¥æ”¶æˆ–è€…æ¥æ”¶è¯·æ±‚ï¼Œæˆ–è€…å‘é€æ¥æ”¶çš„æ•°æ®å°‘äºä¸€å®šé‡æ—¶å¯¼è‡´äº†ä¸€ä¸ª EWOULDBLOCK é”™è¯¯ï¼‰ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œå¦‚æœä¸€ç›´ä¸å¯¹è¿™ä¸ª fd ä½œ IO æ“ä½œ(ä»è€Œå¯¼è‡´å®ƒå†æ¬¡å˜æˆæœªå°±ç»ª)ï¼Œå†…æ ¸ä¸ä¼šå‘é€æ›´å¤šçš„é€šçŸ¥(only once)</p><p>ET æ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚epoll å·¥ä½œåœ¨ ET æ¨¡å¼çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨éé˜»å¡å¥—æ¥å£ï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚</p></li></ol><h3 id="5-2-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„è¿‡ç¨‹"><a href="#5-2-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„è¿‡ç¨‹" class="headerlink" title="5.2 IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„è¿‡ç¨‹"></a>5.2 IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„è¿‡ç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415113121.webp"></p><p>å½“ epoll_wait()è°ƒç”¨åä¼šé˜»å¡ï¼Œç„¶åå®Œäº†å½“è¿”å›æ—¶ï¼Œä¼šè¿”å›äº†å“ªäº› fd çš„æ•°æ®å°±ç»ªäº†ï¼Œç”¨æˆ·åªéœ€è¦éå†å°±ç»ªçš„ fd è¿›è¡Œè¯»å†™å³å¯ã€‚</p><h3 id="5-3-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„ä¼˜ç‚¹"><a href="#5-3-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„ä¼˜ç‚¹" class="headerlink" title="5.3 IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„ä¼˜ç‚¹"></a>5.3 IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„ä¼˜ç‚¹</h3><p><strong>IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆ epoll çš„ä¼˜ç‚¹åœ¨äºï¼š</strong></p><p>ä¸€å¼€å§‹å°±åœ¨å†…æ ¸æ€åˆ†é…äº†ä¸€æ®µç©ºé—´ï¼Œæ¥å­˜æ”¾ç®¡ç†çš„ fd,æ‰€ä»¥åœ¨æ¯æ¬¡è¿æ¥å»ºç«‹åï¼Œäº¤ç»™ epoll ç®¡ç†æ—¶ï¼Œéœ€è¦å°†å…¶æ·»åŠ åˆ°åŸå…ˆåˆ†é…çš„ç©ºé—´ä¸­ï¼Œåé¢å†ç®¡ç†æ—¶å°±ä¸éœ€è¦é¢‘ç¹çš„ä»ç”¨æˆ·æ€æ‹·è´ç®¡ç†çš„ fd é›†åˆã€‚é€šé€šè¿‡è¿™ç§æ–¹å¼å¤§å¤§çš„æå‡äº†æ€§èƒ½ã€‚</p><p>æ‰€ä»¥ç°åœ¨çš„ IO å¤šè·¯å¤ç”¨ä¸»è¦æŒ‡ epollã€‚</p><h3 id="5-4-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„ç¼ºç‚¹"><a href="#5-4-IO-å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„ç¼ºç‚¹" class="headerlink" title="5.4 IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„ç¼ºç‚¹"></a>5.4 IO å¤šè·¯å¤ç”¨ç¬¬äºŒç‰ˆçš„ç¼ºç‚¹</h3><p><strong>ä¸ªäººçŒœæƒ³ï¼š</strong> å¦‚ä½•é™ä½å ç”¨çš„ç©ºé—´ã€‚</p><h2 id="6-å¼‚æ­¥-IO"><a href="#6-å¼‚æ­¥-IO" class="headerlink" title="6.å¼‚æ­¥ IO"></a>6.å¼‚æ­¥ IO</h2><h3 id="6-1-å¼‚æ­¥-IO-çš„è¿‡ç¨‹"><a href="#6-1-å¼‚æ­¥-IO-çš„è¿‡ç¨‹" class="headerlink" title="6.1 å¼‚æ­¥ IO çš„è¿‡ç¨‹"></a>6.1 å¼‚æ­¥ IO çš„è¿‡ç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415113223.webp"></p><p>å‰é¢ä»‹ç»çš„æ‰€æœ‰ç½‘ç»œ IO éƒ½æ˜¯åŒæ­¥ IOï¼Œå› ä¸ºå½“æ•°æ®åœ¨å†…æ ¸æ€<strong>å°±ç»ª</strong>æ—¶ï¼Œåœ¨å†…æ ¸æ€æ‹·è´ç”¨ç”¨æˆ·æ€çš„è¿‡ç¨‹ä¸­ï¼Œä»ç„¶ä¼šæœ‰çŸ­æš‚æ—¶é—´çš„é˜»å¡ç­‰å¾…ã€‚è€Œå¼‚æ­¥ IO æŒ‡ï¼š<strong>å†…æ ¸æ€æ‹·è´æ•°æ®åˆ°ç”¨æˆ·æ€è¿™ç§æ–¹å¼ä¹Ÿæ˜¯äº¤ç»™ç³»ç»Ÿçº¿ç¨‹æ¥å®ç°ï¼Œä¸ç”±ç”¨æˆ·çº¿ç¨‹å®Œæˆ</strong>ï¼Œç›®å‰åªæœ‰ windows ç³»ç»Ÿçš„ IOCP æ˜¯å±äºå¼‚æ­¥ IOã€‚</p><p><strong>åŒºåˆ†åŒæ­¥å¼‚æ­¥IOçš„å‡†åˆ™å°±æ˜¯åˆ¤æ–­æ˜¯å°±ç»ªè¿˜æ˜¯å®Œæˆï¼Œå°±ç»ªå°±æ˜¯åŒæ­¥ï¼Œå®Œæˆå°±æ˜¯å¼‚æ­¥</strong></p><h2 id="7-ç½‘ç»œ-IO-å„ç§æ¨¡å‹"><a href="#7-ç½‘ç»œ-IO-å„ç§æ¨¡å‹" class="headerlink" title="7.ç½‘ç»œ IO å„ç§æ¨¡å‹"></a>7.ç½‘ç»œ IO å„ç§æ¨¡å‹</h2><h3 id="7-1-reactor-æ¨¡å‹"><a href="#7-1-reactor-æ¨¡å‹" class="headerlink" title="7.1 reactor æ¨¡å‹"></a>7.1 reactor æ¨¡å‹</h3><p>ç›®å‰ reactor æ¨¡å‹æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹æ¡ˆï¼š</p><p><strong>1. å• reactor å•çº¿ç¨‹æ¨¡å‹</strong><br><strong>2. å• reactor å¤šçº¿ç¨‹æ¨¡å‹</strong><br><strong>3. multi-reactor å¤šçº¿ç¨‹æ¨¡å‹</strong><br><strong>4. multi-reactor å¤šè¿›ç¨‹æ¨¡å‹</strong></p><h4 id="å•-reactor-å•çº¿ç¨‹æ¨¡å‹"><a href="#å•-reactor-å•çº¿ç¨‹æ¨¡å‹" class="headerlink" title="å• reactor å•çº¿ç¨‹æ¨¡å‹"></a>å• reactor å•çº¿ç¨‹æ¨¡å‹</h4><p>æ­¤ç§æ¨¡å‹ï¼Œé€šå¸¸æ˜¯åªæœ‰ä¸€ä¸ª epoll å¯¹è±¡ï¼Œæ‰€æœ‰çš„<strong>æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥</strong>ã€<strong>å®¢æˆ·ç«¯è¯»å–</strong>ã€<strong>å®¢æˆ·ç«¯å†™å…¥</strong>æ“ä½œéƒ½åŒ…å«åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ã€‚è¯¥ç§æ¨¡å‹ä¹Ÿæœ‰ä¸€äº›ä¸­é—´ä»¶åœ¨ç”¨ï¼Œæ¯”å¦‚ redisã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415113326.webp"></p><p>ä½†åœ¨ç›®å‰çš„å•çº¿ç¨‹ Reactor æ¨¡å¼ä¸­ï¼Œä¸ä»… I/O æ“ä½œåœ¨è¯¥ Reactor çº¿ç¨‹ä¸Šï¼Œè¿é I/O çš„ä¸šåŠ¡æ“ä½œä¹Ÿåœ¨è¯¥çº¿ç¨‹ä¸Šè¿›è¡Œå¤„ç†äº†ï¼Œè¿™å¯èƒ½ä¼šå¤§å¤§å»¶è¿Ÿ I/O è¯·æ±‚çš„å“åº”ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°†é I/O çš„ä¸šåŠ¡é€»è¾‘æ“ä½œä» Reactor çº¿ç¨‹ä¸Šå¸è½½ï¼Œä»¥æ­¤æ¥åŠ é€Ÿ Reactor çº¿ç¨‹å¯¹ I/O è¯·æ±‚çš„å“åº”ã€‚</p><h4 id="å•-reactor-å¤šçº¿ç¨‹æ¨¡å‹"><a href="#å•-reactor-å¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="å• reactor å¤šçº¿ç¨‹æ¨¡å‹"></a>å• reactor å¤šçº¿ç¨‹æ¨¡å‹</h4><p>è¯¥æ¨¡å‹ä¸»è¦æ˜¯é€šè¿‡å°†ï¼Œå‰é¢çš„æ¨¡å‹è¿›è¡Œæ”¹é€ ï¼Œå°†è¯»å†™çš„ä¸šåŠ¡é€»è¾‘äº¤ç»™å…·ä½“çš„çº¿ç¨‹æ± æ¥å®ç°ï¼Œè¿™æ ·å¯ä»¥æ˜¾ç¤º reactor çº¿ç¨‹å¯¹ IO çš„å“åº”ï¼Œä»¥æ­¤æå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415113406.webp"></p><p>åœ¨å·¥ä½œè€…çº¿ç¨‹æ± æ¨¡å¼ä¸­ï¼Œè™½ç„¶é I/O æ“ä½œäº¤ç»™äº†çº¿ç¨‹æ± æ¥å¤„ç†ï¼Œä½†æ˜¯æ‰€æœ‰çš„ I/O æ“ä½œä¾ç„¶ç”± Reactor å•çº¿ç¨‹æ‰§è¡Œï¼Œåœ¨é«˜è´Ÿè½½ã€é«˜å¹¶å‘æˆ–å¤§æ•°æ®é‡çš„åº”ç”¨åœºæ™¯ï¼Œä¾ç„¶è¾ƒå®¹æ˜“æˆä¸ºç“¶é¢ˆã€‚æ‰€ä»¥ï¼Œå¯¹äº Reactor çš„ä¼˜åŒ–ï¼Œåˆäº§ç”Ÿå‡ºä¸‹é¢çš„å¤šçº¿ç¨‹æ¨¡å¼ã€‚</p><h4 id="multi-reactor-å¤šçº¿ç¨‹æ¨¡å‹"><a href="#multi-reactor-å¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="multi-reactor å¤šçº¿ç¨‹æ¨¡å‹"></a>multi-reactor å¤šçº¿ç¨‹æ¨¡å‹</h4><p>åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šmainReactorã€subReactorsã€‚mainReactor ä¸»è¦è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œç„¶åå°†å»ºç«‹çš„å®¢æˆ·ç«¯è¿æ¥é€šè¿‡è´Ÿè½½å‡è¡¡çš„æ–¹å¼åˆ†å‘ç»™ subReactorsï¼ŒsubReactors æ¥è´Ÿè´£å…·ä½“çš„æ¯ä¸ªè¿æ¥çš„è¯»å†™ã€‚å¯¹äºé IO çš„æ“ä½œï¼Œä¾ç„¶äº¤ç»™å·¥ä½œçº¿ç¨‹æ± å»åšï¼Œå¯¹é€»è¾‘è¿›è¡Œè§£è€¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415113459.webp"></p><p>mainReactor å¯¹åº” Netty ä¸­é…ç½®çš„ BossGroup çº¿ç¨‹ç»„ï¼Œä¸»è¦è´Ÿè´£æ¥å—å®¢æˆ·ç«¯è¿æ¥çš„å»ºç«‹ã€‚ä¸€èˆ¬åªæš´éœ²ä¸€ä¸ªæœåŠ¡ç«¯å£ï¼ŒBossGroup çº¿ç¨‹ç»„ä¸€èˆ¬ä¸€ä¸ªçº¿ç¨‹å·¥ä½œå³å¯ subReactor å¯¹åº” Netty ä¸­é…ç½®çš„ WorkerGroup çº¿ç¨‹ç»„ï¼ŒBossGroup çº¿ç¨‹ç»„æ¥å—å¹¶å»ºç«‹å®Œå®¢æˆ·ç«¯çš„è¿æ¥åï¼Œå°†ç½‘ç»œ socket è½¬äº¤ç»™ WorkerGroup çº¿ç¨‹ç»„ï¼Œç„¶ååœ¨ WorkerGroup çº¿ç¨‹ç»„å†…é€‰æ‹©ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œ I/O çš„å¤„ç†ã€‚WorkerGroup çº¿ç¨‹ç»„ä¸»è¦å¤„ç† I/Oï¼Œä¸€èˆ¬è®¾ç½® 2*CPU æ ¸æ•°ä¸ªçº¿ç¨‹ã€‚</p><h3 id="7-2-proactor-æ¨¡å‹"><a href="#7-2-proactor-æ¨¡å‹" class="headerlink" title="7.2 proactor æ¨¡å‹"></a>7.2 proactor æ¨¡å‹</h3><p>proactor ä¸»è¦æ˜¯é€šè¿‡å¯¹å¼‚æ­¥ IO çš„å°è£…çš„ä¸€ç§æ¨¡å‹ï¼Œå®ƒéœ€è¦åº•å±‚æ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œç›®å‰åªæœ‰ windows çš„ IOCP æ”¯æŒçš„æ¯”è¾ƒå¥½ã€‚è¯¦ç»†çš„ä»‹ç»å¯ä»¥å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/95662364">é«˜æ€§èƒ½IOæ¨¡å‹åˆ†æ-Reactoræ¨¡å¼å’ŒProactoræ¨¡å¼ï¼ˆäºŒï¼‰</a>ã€‚</p><h3 id="7-3-ä¸»æµçš„ä¸­é—´ä»¶æ‰€é‡‡ç”¨çš„ç½‘ç»œæ¨¡å‹"><a href="#7-3-ä¸»æµçš„ä¸­é—´ä»¶æ‰€é‡‡ç”¨çš„ç½‘ç»œæ¨¡å‹" class="headerlink" title="7.3 ä¸»æµçš„ä¸­é—´ä»¶æ‰€é‡‡ç”¨çš„ç½‘ç»œæ¨¡å‹"></a>7.3 ä¸»æµçš„ä¸­é—´ä»¶æ‰€é‡‡ç”¨çš„ç½‘ç»œæ¨¡å‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Simpleforever/imgbed/pic2/20210415113546.webp"></p><h3 id="7-4-ä¸»æµç½‘ç»œæ¡†æ¶"><a href="#7-4-ä¸»æµç½‘ç»œæ¡†æ¶" class="headerlink" title="7.4 ä¸»æµç½‘ç»œæ¡†æ¶"></a>7.4 ä¸»æµç½‘ç»œæ¡†æ¶</h3><ul><li>netty</li><li>gnet</li><li>libevent</li><li>evio(golang)</li><li>ACE(c++)</li><li>boost::asio(c++)</li><li>muduo ï¼ˆlinux only)</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol><li><a href="https://juejin.im/post/5bf7b89e518825369c564059">IO æ¨¡å¼å’Œ IO å¤šè·¯å¤ç”¨</a></li><li><a href="https://segmentfault.com/a/1190000003063859">Linux IO æ¨¡å¼åŠ selectã€pollã€epoll è¯¦è§£</a></li><li><a href="http://www.masterraghu.com/subjects/np/introduction/unix_network_programming_v1.3/ch06.html">Chapter 6. I/O Multiplexing: The select and poll Functions</a></li><li><a href="https://zhuanlan.zhihu.com/p/95662364">é«˜æ€§èƒ½ IO æ¨¡å‹åˆ†æ-Reactor æ¨¡å¼å’Œ Proactor æ¨¡å¼ï¼ˆäºŒï¼‰</a></li></ol>]]></content>
    
    
    <summary type="html">å¤šè·¯å¤ç”¨â€”â€”ç½‘ç»œ IO æ¼”å˜å‘å±•è¿‡ç¨‹å’Œæ¨¡å‹ä»‹ç»</summary>
    
    
    
    <category term="å¤šè·¯å¤ç”¨" scheme="http://example.com/categories/%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/"/>
    
    
    <category term="I/O" scheme="http://example.com/tags/I-O/"/>
    
  </entry>
  
  <entry>
    <title>ç¨‹åºã€è¿›ç¨‹å’Œçº¿ç¨‹</title>
    <link href="http://example.com/2021/03/03/%E7%A8%8B%E5%BA%8F%E3%80%81%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/"/>
    <id>http://example.com/2021/03/03/%E7%A8%8B%E5%BA%8F%E3%80%81%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/</id>
    <published>2021-03-03T14:12:17.000Z</published>
    <updated>2021-08-11T13:40:57.590Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h2 id="sleep-å’Œusleep"><a href="#sleep-å’Œusleep" class="headerlink" title="sleep()å’Œusleep()"></a>sleep()å’Œusleep()</h2><p>å‡½æ•°å:<strong>sleep()</strong></p><p>å¤´æ–‡ä»¶:<code>#include &lt;unistd.h&gt; </code>  // åœ¨<code>gcc</code>ç¼–è¯‘å™¨ä¸­ï¼Œä½¿ç”¨çš„å¤´æ–‡ä»¶å› <code>gcc</code>ç‰ˆæœ¬çš„ä¸åŒè€Œä¸åŒ</p><p>åŠŸ èƒ½: æ‰§è¡ŒæŒ‚èµ·æŒ‡å®šçš„ç§’æ•°<br>è¯­ æ³•: <code>unsigned sleep(unsigned seconds);</code></p><p>å‡½æ•°å:<strong>usleep()</strong><br>å¤´æ–‡ä»¶:<code> #include &lt;unistd.h&gt;</code><br>åŠŸ  èƒ½:<code> usleep</code>åŠŸèƒ½æŠŠè¿›ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ï¼Œ å•ä½æ˜¯å¾®ç§’ï¼ˆç™¾ä¸‡åˆ†ä¹‹ä¸€ç§’ï¼‰<br>è¯­  æ³•:<code> void usleep(int micro_seconds);</code><br>å†…å®¹è¯´æ˜ï¼šæœ¬å‡½æ•°å¯æš‚æ—¶ä½¿ç¨‹åºåœæ­¢æ‰§è¡Œã€‚å‚æ•° <code>micro_seconds </code>ä¸ºè¦æš‚åœçš„å¾®ç§’æ•°(us)ã€‚</p><h2 id="çº¿ç¨‹é—´çš„äº’æ–¥"><a href="#çº¿ç¨‹é—´çš„äº’æ–¥" class="headerlink" title="çº¿ç¨‹é—´çš„äº’æ–¥"></a>çº¿ç¨‹é—´çš„äº’æ–¥</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªçº¿ç¨‹äº’æ–¥çš„ä¾‹å­ã€‚ä»£ç ç”¨çº¿ç¨‹äº’æ–¥çš„æ–¹æ³•æ„å»ºäº†ä»¥å“¦ä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä¾‹å­ã€‚ä»£ç ä¸­å»ºç«‹äº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œå‡½æ•°<code>producter_f()</code>ç”¨äºç”Ÿæˆï¼Œå‡½æ•°<code>consumer_f()</code>ç”¨äºæ¶ˆè´¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* mutex.c</span></span><br><span class="line"><span class="comment">* çº¿ç¨‹å®ä¾‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sched.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">producter_f</span> <span class="params">(<span class="keyword">void</span> *arg)</span></span>;<span class="comment">/*ç”Ÿäº§è€…*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">consumer_f</span> <span class="params">(<span class="keyword">void</span> *arg)</span></span>;<span class="comment">/*æ¶ˆè´¹è€…*/</span></span><br><span class="line"><span class="keyword">int</span> buffer_has_item=<span class="number">0</span>;<span class="comment">/*ç¼“å†²åŒºè®¡æ•°å€¼*/</span></span><br><span class="line"><span class="keyword">pthread_mutex_t</span> mutex;<span class="comment">/*äº’æ–¥åŒº*/</span></span><br><span class="line"><span class="keyword">int</span> running =<span class="number">1</span> ;<span class="comment">/*çº¿ç¨‹è¿è¡Œæ§åˆ¶*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">pthread_t</span> <span class="keyword">consumer_t</span>;<span class="comment">/*æ¶ˆè´¹è€…çº¿ç¨‹å‚æ•°*/</span></span><br><span class="line"><span class="keyword">pthread_t</span> <span class="keyword">producter_t</span>;<span class="comment">/*ç”Ÿäº§è€…çº¿ç¨‹å‚æ•°*/</span></span><br><span class="line"></span><br><span class="line">pthread_mutex_init (&amp;mutex,<span class="literal">NULL</span>);<span class="comment">/*åˆå§‹åŒ–äº’æ–¥*/</span></span><br><span class="line"></span><br><span class="line">pthread_create(&amp;<span class="keyword">producter_t</span>, <span class="literal">NULL</span>,(<span class="keyword">void</span>*)producter_f, <span class="literal">NULL</span> );            <span class="comment">/*å»ºç«‹ç”Ÿäº§è€…çº¿ç¨‹*/</span></span><br><span class="line">pthread_create(&amp;<span class="keyword">consumer_t</span>, <span class="literal">NULL</span>, (<span class="keyword">void</span> *)consumer_f, <span class="literal">NULL</span>);            <span class="comment">/*å»ºç«‹æ¶ˆè´¹è€…çº¿ç¨‹*/</span></span><br><span class="line">usleep(<span class="number">1</span>);<span class="comment">/*ç­‰å¾…ï¼Œçº¿ç¨‹åˆ›å»ºå®Œæ¯•*/</span></span><br><span class="line">running =<span class="number">0</span>;<span class="comment">/*è®¾ç½®çº¿ç¨‹é€€å‡ºå€¼*/</span></span><br><span class="line">pthread_join(<span class="keyword">consumer_t</span>,<span class="literal">NULL</span>);<span class="comment">/*ç­‰å¾…æ¶ˆè´¹è€…çº¿ç¨‹é€€å‡º*/</span></span><br><span class="line">pthread_join(<span class="keyword">producter_t</span>,<span class="literal">NULL</span>);    <span class="comment">/*ç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹é€€å‡º*/</span></span><br><span class="line">pthread_mutex_destroy(&amp;mutex);<span class="comment">/*é”€æ¯äº’æ–¥*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">producter_f</span> <span class="params">(<span class="keyword">void</span> *arg)</span><span class="comment">/*ç”Ÿäº§è€…çº¿ç¨‹ç¨‹åº*/</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(running)<span class="comment">/*æ²¡æœ‰è®¾ç½®é€€å‡ºå€¼*/</span></span><br><span class="line">&#123;</span><br><span class="line">pthread_mutex_lock (&amp;mutex);<span class="comment">/*è¿›å…¥äº’æ–¥åŒº*/</span></span><br><span class="line">buffer_has_item++;<span class="comment">/*å¢åŠ è®¡æ•°å€¼*/</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ç”Ÿäº§ï¼Œæ€»æ•°é‡:%d\n&quot;</span>,buffer_has_item); <span class="comment">/*æ‰“å°ä¿¡æ¯*/</span></span><br><span class="line">pthread_mutex_unlock(&amp;mutex);<span class="comment">/*ç¦»å¼€äº’æ–¥åŒº*/</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">consumer_f</span><span class="params">(<span class="keyword">void</span> *arg)</span><span class="comment">/*æ¶ˆè´¹è€…çº¿ç¨‹ç¨‹åº*/</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(running)<span class="comment">/*æ²¡æœ‰è®¾ç½®é€€å‡ºå€¼*/</span></span><br><span class="line">&#123;</span><br><span class="line">pthread_mutex_lock(&amp;mutex);<span class="comment">/*è¿›å…¥äº’æ–¥åŒº*/</span></span><br><span class="line">buffer_has_item--;<span class="comment">/*å‡å°è®¡æ•°å€¼*/</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;æ¶ˆè´¹ï¼Œæ€»æ•°é‡:%d\n&quot;</span>,buffer_has_item);<span class="comment">/*æ‰“å°ä¿¡æ¯*/</span></span><br><span class="line">pthread_mutex_unlock(&amp;mutex);<span class="comment">/*ç¦»å¼€äº’æ–¥åŒº*/</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç”Ÿäº§ï¼Œæ€»æ•°é‡:1</span><br><span class="line">æ¶ˆè´¹ï¼Œæ€»æ•°é‡:0</span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸­å£°æ˜äº†ä¸€ä¸ªçº¿ç¨‹äº’æ–¥å˜é‡<code>mutex</code>,åœ¨çº¿ç¨‹å‡½æ•°<code>consumer_f()</code>å’Œ<code>producter_f()</code>ä¸­ï¼Œç”¨çº¿ç¨‹äº’æ–¥é”å‡½æ•°<code>pthread_mutex_lock()</code>å’Œ<code>pthread_mutex_ublock()</code>æ¥ä¿æŠ¤å¯¹å…¬å…±å˜é‡<code>buffer_has_item</code>çš„è®¿é—®ã€‚</p><h2 id="çº¿ç¨‹ä¸­ä½¿ç”¨ä¿¡å·é‡"><a href="#çº¿ç¨‹ä¸­ä½¿ç”¨ä¿¡å·é‡" class="headerlink" title="çº¿ç¨‹ä¸­ä½¿ç”¨ä¿¡å·é‡"></a>çº¿ç¨‹ä¸­ä½¿ç”¨ä¿¡å·é‡</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ä¿¡å·é‡çš„ä¾‹å­ã€‚åœ¨<code>mutex</code>çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªå…¨å±€å˜é‡æ¥è®¡æ•°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ä¿¡å·é‡æ¥åšåŒæ ·çš„å·¥ä½œï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å¢åŠ ä¿¡å·é‡æ¥æ¨¡ä»¿ç”Ÿäº§è€…ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è·å¾—ä¿¡å·é‡æ¥æ¨¡ä»¿æ¶ˆè´¹è€…ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* sem.c</span></span><br><span class="line"><span class="comment">* çº¿ç¨‹å®ä¾‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">producter_f</span> <span class="params">(<span class="keyword">void</span> *arg)</span></span>;<span class="comment">/*ç”Ÿäº§è€…çº¿ç¨‹å‡½æ•°*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">consumer_f</span> <span class="params">(<span class="keyword">void</span> *arg)</span></span>;<span class="comment">/*æ¶ˆè´¹è€…çº¿ç¨‹å‡½æ•°*/</span></span><br><span class="line"><span class="keyword">sem_t</span> sem;</span><br><span class="line"><span class="keyword">int</span> running =<span class="number">1</span> ;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">pthread_t</span> <span class="keyword">consumer_t</span>;<span class="comment">/*æ¶ˆè´¹è€…çº¿ç¨‹å‚æ•°*/</span></span><br><span class="line"><span class="keyword">pthread_t</span> <span class="keyword">producter_t</span>;<span class="comment">/*ç”Ÿäº§è€…çº¿ç¨‹å‚æ•°*/</span></span><br><span class="line"></span><br><span class="line">sem_init (&amp;sem, <span class="number">0</span>, <span class="number">16</span>);<span class="comment">/*ä¿¡å·é‡åˆå§‹åŒ–*/</span></span><br><span class="line"></span><br><span class="line">pthread_create(&amp;<span class="keyword">producter_t</span>, <span class="literal">NULL</span>,(<span class="keyword">void</span>*)producter_f, <span class="literal">NULL</span> );             <span class="comment">/*å»ºç«‹ç”Ÿäº§è€…çº¿ç¨‹*/</span></span><br><span class="line">pthread_create(&amp;<span class="keyword">consumer_t</span>, <span class="literal">NULL</span>, (<span class="keyword">void</span> *)consumer_f, <span class="literal">NULL</span>);             <span class="comment">/*å»ºç«‹æ¶ˆè´¹è€…çº¿ç¨‹*/</span></span><br><span class="line">sleep(<span class="number">1</span>);<span class="comment">/*ç­‰å¾…*/</span></span><br><span class="line">running =<span class="number">0</span>;<span class="comment">/*è®¾ç½®çº¿ç¨‹é€€å‡º*/</span></span><br><span class="line">pthread_join(<span class="keyword">consumer_t</span>,<span class="literal">NULL</span>);<span class="comment">/*ç­‰å¾…æ¶ˆè´¹è€…çº¿ç¨‹é€€å‡º*/</span></span><br><span class="line">pthread_join(<span class="keyword">producter_t</span>,<span class="literal">NULL</span>);    <span class="comment">/*ç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹é€€å‡º*/</span></span><br><span class="line">sem_destroy(&amp;sem);<span class="comment">/*é”€æ¯ä¿¡å·é‡*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">producter_f</span> <span class="params">(<span class="keyword">void</span> *arg)</span><span class="comment">/*ç”Ÿäº§è€…å¤„ç†ç¨‹åºä»£ç */</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> semval=<span class="number">0</span>;<span class="comment">/*ä¿¡å·é‡çš„åˆå§‹å€¼ä¸º0*/</span></span><br><span class="line"><span class="keyword">while</span>(running)<span class="comment">/*è¿è¡ŒçŠ¶æ€ä¸ºå¯è¿è¡Œ*/</span></span><br><span class="line">&#123;</span><br><span class="line">usleep(<span class="number">1</span>);<span class="comment">/*ç­‰å¾…*/</span></span><br><span class="line">sem_post (&amp;sem);<span class="comment">/*ä¿¡å·é‡å¢åŠ */</span></span><br><span class="line">sem_getvalue(&amp;sem,&amp;semval);<span class="comment">/*è·å¾—ä¿¡å·é‡çš„å€¼*/</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ç”Ÿäº§ï¼Œæ€»æ•°é‡:%d\n&quot;</span>,semval);<span class="comment">/*æ‰“å°ä¿¡æ¯*/</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">consumer_f</span><span class="params">(<span class="keyword">void</span> *arg)</span><span class="comment">/*æ¶ˆè´¹è€…å¤„ç†ç¨‹åºä»£ç */</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> semval=<span class="number">0</span>;<span class="comment">/*ä¿¡å·é‡çš„åˆå§‹å€¼ä¸º0*/</span></span><br><span class="line"><span class="keyword">while</span>(running)<span class="comment">/*è¿è¡ŒçŠ¶æ€ä¸ºå¯è¿è¡Œ*/</span></span><br><span class="line">&#123;</span><br><span class="line">usleep(<span class="number">1</span>);<span class="comment">/*ç­‰å¾…*/</span></span><br><span class="line">sem_wait(&amp;sem);<span class="comment">/*ç­‰å¾…ä¿¡å·é‡*/</span></span><br><span class="line">sem_getvalue(&amp;sem,&amp;semval);<span class="comment">/*è·å¾—ä¿¡å·é‡çš„å€¼*/</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;æ¶ˆè´¹ï¼Œæ€»æ•°é‡:%d\n&quot;</span>,semval);<span class="comment">/*æ‰“å°ä¿¡æ¯*/</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">ç”Ÿäº§ï¼Œæ€»æ•°é‡:56</span><br><span class="line">ç”Ÿäº§ï¼Œæ€»æ•°é‡:57</span><br><span class="line">æ¶ˆè´¹ï¼Œæ€»æ•°é‡:56</span><br><span class="line">æ¶ˆè´¹ï¼Œæ€»æ•°é‡:55</span><br><span class="line">ç”Ÿäº§ï¼Œæ€»æ•°é‡:56</span><br><span class="line">æ¶ˆè´¹ï¼Œæ€»æ•°é‡:55</span><br><span class="line">ç”Ÿäº§ï¼Œæ€»æ•°é‡:56</span><br><span class="line">ç”Ÿäº§ï¼Œæ€»æ•°é‡:57</span><br><span class="line">æ¶ˆè´¹ï¼Œæ€»æ•°é‡:56</span><br><span class="line">æ¶ˆè´¹ï¼Œæ€»æ•°é‡:55</span><br><span class="line">ç”Ÿäº§ï¼Œæ€»æ•°é‡:56</span><br><span class="line">ç”Ÿäº§ï¼Œæ€»æ•°é‡:57</span><br><span class="line">æ¶ˆè´¹ï¼Œæ€»æ•°é‡:56</span><br><span class="line">æ¶ˆè´¹ï¼Œæ€»æ•°é‡:55</span><br><span class="line">ç”Ÿäº§ï¼Œæ€»æ•°é‡:56</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œä»¥ä¸Šç¨‹åºå»ºç«‹çš„å„ä¸ªçº¿ç¨‹é—´å­˜åœ¨ç«äº‰å…³ç³»ã€‚è€Œæ•°å€¼å¹¶æœªæŒ‰äº§ç”Ÿä¸€ä¸ªæ¶ˆè€—ä¸€ä¸ªçš„é¡ºåºæ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œæ˜¯ä»¥äº¤å‰çš„æ–¹å¼è¿›è¡Œï¼Œæœ‰çš„æ—¶å€™äº§ç”Ÿå¤šä¸ªå†æ¶ˆè€—å¤šä¸ªã€‚é€ æˆè¿™ç§ç°è±¡çš„åŸå› æ˜¯ä¿¡å·é‡çš„äº§ç”Ÿå’Œæ¶ˆè€—æ˜¯å¯¹<code>CPU</code>ç«äº‰çš„ç»“æœã€‚</p>]]></content>
    
    
    <summary type="html">å­¦ä¹ æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ¦‚å¿µâ€”â€”è¿›ç¨‹å’Œçº¿ç¨‹</summary>
    
    
    
    <category term="æ“ä½œç³»ç»Ÿ" scheme="http://example.com/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="pthread" scheme="http://example.com/tags/pthread/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œç¼–ç¨‹</title>
    <link href="http://example.com/2021/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    <id>http://example.com/2021/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</id>
    <published>2021-02-24T12:16:44.000Z</published>
    <updated>2021-08-11T13:41:09.645Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Socket-ç½‘ç»œé€šä¿¡"><a href="#Socket-ç½‘ç»œé€šä¿¡" class="headerlink" title="Socket ç½‘ç»œé€šä¿¡"></a>Socket ç½‘ç»œé€šä¿¡</h1><h2 id="å®ç°ç‚¹å¯¹ç‚¹é€šä¿¡"><a href="#å®ç°ç‚¹å¯¹ç‚¹é€šä¿¡" class="headerlink" title="å®ç°ç‚¹å¯¹ç‚¹é€šä¿¡"></a>å®ç°ç‚¹å¯¹ç‚¹é€šä¿¡</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * tcp_server.c</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PORT 8888    <span class="comment">/*ä¾¦å¬ç«¯å£åœ°å€*/</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BACKLOG 2    <span class="comment">/*ä¾¦å¬é˜Ÿåˆ—é•¿åº¦*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERR_EXIT(m) do&#123;perror(m);exit(EXIT_FAILURE);&#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">handler</span><span class="params">(<span class="keyword">int</span> sign)</span></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;recv a sign: %d&quot;</span>, sign);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_SUCCESS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ss,sc;    <span class="comment">/*ssä¸ºæœåŠ¡å™¨çš„socketæè¿°ç¬¦ï¼Œscä¸ºå®¢æˆ·ç«¯çš„socketæè¿°ç¬¦*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">server_addr</span>;</span>    <span class="comment">/*æœåŠ¡å™¨åœ°å€ç»“æ„*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">client_addr</span>;</span>    <span class="comment">/*å®¢æˆ·ç«¯åœ°å€ç»“æ„*/</span></span><br><span class="line"><span class="keyword">int</span> err;      <span class="comment">/*è¿”å›å€¼*/</span></span><br><span class="line"><span class="keyword">pid_t</span> pid;    <span class="comment">/*åˆ†å‰çš„è¿›è¡ŒID*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*å»ºç«‹ä¸€ä¸ªæµå¼å¥—æ¥å­—*/</span></span><br><span class="line">ss = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(ss &lt; <span class="number">0</span>)&#123;    <span class="comment">/*å‡ºé”™*/</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;socket error\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è®¾ç½®æœåŠ¡å™¨åœ°å€*/</span></span><br><span class="line"><span class="built_in">bzero</span>(&amp;server_addr, <span class="built_in"><span class="keyword">sizeof</span></span>(server_addr));        <span class="comment">/*æ¸…é›¶*/</span></span><br><span class="line"><span class="built_in">memset</span>(&amp;server_addr,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(server_addr));</span><br><span class="line">server_addr.sin_family = AF_INET;                <span class="comment">/*åè®®æ—*/</span></span><br><span class="line">server_addr.sin_addr.s_addr = <span class="built_in">htonl</span>(INADDR_ANY); <span class="comment">/*æœ¬åœ°åœ°å€*/</span></span><br><span class="line">server_addr.sin_port = <span class="built_in">htons</span>(PORT);              <span class="comment">/*æœåŠ¡å™¨ç«¯å£*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç»‘å®šåœ°å€ç»“æ„åˆ°å¥—æ¥å­—æè¿°ç¬¦*/</span></span><br><span class="line">err = <span class="built_in">bind</span>(ss, (struct sockaddr*)&amp;server_addr, <span class="built_in"><span class="keyword">sizeof</span></span>(server_addr));</span><br><span class="line"><span class="keyword">if</span>(err &lt; <span class="number">0</span>)&#123;    <span class="comment">/*å‡ºé”™*/</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;bind error\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è®¾ç½®ä¾¦å¬*/</span></span><br><span class="line">err = <span class="built_in">listen</span>(ss, BACKLOG);</span><br><span class="line"><span class="keyword">if</span>(err &lt; <span class="number">0</span>)&#123;    <span class="comment">/*å‡ºé”™*/</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;listen error\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ä¸»å¾ªç¯è¿‡ç¨‹*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">socklen_t</span> addrlen = <span class="built_in"><span class="keyword">sizeof</span></span>(struct sockaddr);</span><br><span class="line"></span><br><span class="line">sc = <span class="built_in">accept</span>(ss, (struct sockaddr*)&amp;client_addr, &amp;addrlen); </span><br><span class="line"><span class="comment">/*æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥*/</span></span><br><span class="line"><span class="keyword">if</span>(sc &lt; <span class="number">0</span>)&#123;    <span class="comment">/*å‡ºé”™*/</span></span><br><span class="line"><span class="built_in">ERR_EXIT</span>(<span class="string">&quot;accept error&quot;</span>);    <span class="comment">/*ç»“æŸæœ¬æ¬¡å¾ªç¯*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*å»ºç«‹ä¸€ä¸ªæ–°çš„è¿›ç¨‹å¤„ç†åˆ°æ¥çš„è¿æ¥*/</span></span><br><span class="line">pid = fork();    <span class="comment">/*åˆ†å‰è¿›ç¨‹*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å­è¿›ç¨‹åªç®¡å‘æ•°æ®</span></span><br><span class="line"><span class="keyword">if</span>( pid == <span class="number">0</span> )&#123;    <span class="comment">/*å­è¿›ç¨‹ä¸­*/</span></span><br><span class="line"><span class="built_in">signal</span>(SIGUSR1, handler);    <span class="comment">/*é€šçŸ¥å­è¿›ç¨‹å…³é—­*/</span></span><br><span class="line"><span class="keyword">char</span> sendbuffer[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">fgets</span>(sendbuffer, <span class="built_in"><span class="keyword">sizeof</span></span>(sendbuffer),stdin)!=<span class="literal">NULL</span>)&#123;</span><br><span class="line"><span class="built_in">write</span>(sc,sendbuffer,<span class="built_in">strlen</span>(sendbuffer));</span><br><span class="line"><span class="built_in">bzero</span>(sendbuffer,<span class="built_in"><span class="keyword">sizeof</span></span>(sendbuffer));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exit</span>(EXIT_SUCCESS);    <span class="comment">/*åœ¨å­è¿›ç¨‹ä¸­å…³é—­æœåŠ¡å™¨çš„ä¾¦å¬*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//çˆ¶è¿›ç¨‹åªç®¡è¯»æ•°æ®</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">char</span> recvbuffer[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">bzero</span>(recvbuffer,<span class="built_in"><span class="keyword">sizeof</span></span>(recvbuffer));</span><br><span class="line"><span class="keyword">int</span> size = <span class="built_in">read</span>(sc, recvbuffer, <span class="built_in"><span class="keyword">sizeof</span></span>(recvbuffer));</span><br><span class="line"><span class="keyword">if</span>(size &gt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">fputs</span>(recvbuffer, stdout);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(sc);</span><br><span class="line"><span class="built_in">close</span>(ss);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * tcp_client.c</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PORT 8888    <span class="comment">/*ä¾¦å¬ç«¯å£åœ°å€*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERR_EXIT(m) do&#123;perror(m);exit(EXIT_FAILURE);&#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">handler</span><span class="params">(<span class="keyword">int</span> sign)</span></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;recv a sign: %d&quot;</span>, sign);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_SUCCESS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> s;       <span class="comment">/*sä¸ºsocketæè¿°ç¬¦*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">server_addr</span>;</span>    <span class="comment">/*æœåŠ¡å™¨åœ°å€ç»“æ„*/</span></span><br><span class="line"></span><br><span class="line">s = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);    <span class="comment">/*å»ºç«‹ä¸€ä¸ªæµå¼å¥—æ¥å­— */</span></span><br><span class="line"><span class="keyword">if</span>(s &lt; <span class="number">0</span>)&#123;   <span class="comment">/*å‡ºé”™*/</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;socket error\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è®¾ç½®æœåŠ¡å™¨åœ°å€*/</span></span><br><span class="line"><span class="built_in">bzero</span>(&amp;server_addr, <span class="built_in"><span class="keyword">sizeof</span></span>(server_addr));        <span class="comment">/*æ¸…é›¶*/</span></span><br><span class="line">server_addr.sin_family = AF_INET;                <span class="comment">/*åè®®æ—*/</span></span><br><span class="line">server_addr.sin_addr.s_addr = <span class="built_in">htonl</span>(INADDR_ANY); <span class="comment">/*æœ¬åœ°åœ°å€*/</span></span><br><span class="line">server_addr.sin_port = <span class="built_in">htons</span>(PORT);              <span class="comment">/*æœåŠ¡å™¨ç«¯å£*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*å°†ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ç±»å‹çš„IPåœ°å€è½¬ä¸ºæ•´å‹*/</span></span><br><span class="line"><span class="built_in">inet_pton</span>(AF_INET, argv[<span class="number">1</span>], &amp;server_addr.sin_addr);</span><br><span class="line"><span class="comment">/*è¿æ¥æœåŠ¡å™¨*/</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">connect</span>(s, (struct sockaddr*)&amp;server_addr, <span class="built_in"><span class="keyword">sizeof</span></span>(struct sockaddr))&lt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">ERR_EXIT</span>(<span class="string">&quot;connect error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pid_t</span> pid;</span><br><span class="line">pid = fork();</span><br><span class="line"><span class="keyword">if</span>(<span class="number">-1</span> == pid)&#123;</span><br><span class="line"><span class="built_in">ERR_EXIT</span>(<span class="string">&quot;fork errorr&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">char</span> recvBuf[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memset</span>(recvBuf, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(recvBuf));</span><br><span class="line"><span class="keyword">int</span> ret = <span class="built_in">read</span>(s, recvBuf, <span class="built_in"><span class="keyword">sizeof</span></span>(recvBuf));</span><br><span class="line"><span class="keyword">if</span>(<span class="number">-1</span> == ret)&#123;</span><br><span class="line"><span class="built_in">ERR_EXIT</span>(<span class="string">&quot;read error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == ret)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;peer close\n&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">fputs</span>(recvBuf, stdout);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(s);</span><br><span class="line"><span class="built_in">kill</span>(<span class="built_in">getppid</span>(), SIGUSR1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">signal</span>(SIGUSR1, handler);</span><br><span class="line"><span class="keyword">char</span> sendBuf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">fgets</span>(sendBuf, <span class="built_in"><span class="keyword">sizeof</span></span>(sendBuf), stdin) != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">write</span>(s, sendBuf, <span class="built_in">strlen</span>(sendBuf));</span><br><span class="line"><span class="built_in">memset</span>(sendBuf, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(sendBuf));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2021/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/01.png" alt="01"></p><h2 id="å­˜åœ¨é—®é¢˜"><a href="#å­˜åœ¨é—®é¢˜" class="headerlink" title="å­˜åœ¨é—®é¢˜"></a>å­˜åœ¨é—®é¢˜</h2><p>é—®é¢˜ï¼šä¸èƒ½å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨</p><p>æ”¹è¿›ï¼šselectå¤šè·¯å¤ç”¨</p><h1 id="bind-å‡½æ•°é‡éš¾ç‚¹è§£æ"><a href="#bind-å‡½æ•°é‡éš¾ç‚¹è§£æ" class="headerlink" title="bind å‡½æ•°é‡éš¾ç‚¹è§£æ"></a>bind å‡½æ•°é‡éš¾ç‚¹è§£æ</h1><h2 id="bind-å‡½æ•°å¦‚ä½•é€‰æ‹©ç»‘å®šåœ°å€"><a href="#bind-å‡½æ•°å¦‚ä½•é€‰æ‹©ç»‘å®šåœ°å€" class="headerlink" title="bind å‡½æ•°å¦‚ä½•é€‰æ‹©ç»‘å®šåœ°å€"></a>bind å‡½æ•°å¦‚ä½•é€‰æ‹©ç»‘å®šåœ°å€</h2><p>bind å‡½æ•°çš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">bindaddr</span>;</span></span><br><span class="line">bindaddr.sin_family = AF_INET;</span><br><span class="line">bindaddr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class="line">bindaddr.sin_port = htons(<span class="number">3000</span>);</span><br><span class="line"><span class="keyword">if</span> (bind(listenfd, (struct sockaddr *)&amp;bindaddr, <span class="keyword">sizeof</span>(bindaddr)) == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;bind listen socket error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ bind çš„åœ°å€æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå®å« <strong>INADDR_ANY</strong> ï¼Œå…³äºè¿™ä¸ªå®çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">If an application does <span class="keyword">not</span> care what local address is assigned, </span><br><span class="line">specify the constant value INADDR_ANY <span class="keyword">for</span> an IPv4 local address</span><br><span class="line"><span class="keyword">or</span> the constant value in6addr_any <span class="keyword">for</span> an IPv6 local address </span><br><span class="line">in the sa_data member of the name parameter. This allows the </span><br><span class="line">underlying service provider to use any appropriate network address,</span><br><span class="line"><span class="function">potentially simplifying application programming in the presence of </span></span><br><span class="line"><span class="function">multihomed <span class="title">hosts</span> <span class="params">(that is, hosts that have more than one network </span></span></span><br><span class="line"><span class="params"><span class="function">interface <span class="keyword">and</span> address)</span>.</span></span><br></pre></td></tr></table></figure><p>æ„è¯‘ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœåº”ç”¨ç¨‹åºä¸å…³å¿ƒbindç»‘å®šçš„ipåœ°å€ï¼Œå¯ä»¥ä½¿ç”¨INADDR_ANY(å¦‚æœæ˜¯IPv6ï¼Œ</span><br><span class="line">åˆ™å¯¹åº”in6addr_any)ï¼Œè¿™æ ·åº•å±‚çš„ï¼ˆåè®®æ ˆï¼‰æœåŠ¡ä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ipåœ°å€ï¼Œ</span><br><span class="line">è¿™æ ·ä½¿åœ¨ä¸€ä¸ªæœ‰å¤šä¸ªç½‘å¡æœºå™¨ä¸Šé€‰æ‹©ipåœ°å€é—®é¢˜å˜å¾—ç®€å•ã€‚</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ <strong>INADDR_ANY</strong> ç›¸å½“äºåœ°å€ <strong>0.0.0.0</strong>ã€‚å¯èƒ½è¯»è€…è¿˜æ˜¯ä¸å¤ªæ˜ç™½æˆ‘æƒ³è¡¨è¾¾ä»€ä¹ˆã€‚è¿™é‡Œæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬åœ¨ä¸€å°æœºå™¨ä¸Šå¼€å‘ä¸€ä¸ªæœåŠ¡å™¨ç¨‹åºï¼Œä½¿ç”¨ bind å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬æœ‰å¤šä¸ªip åœ°å€å¯ä»¥é€‰æ‹©ã€‚é¦–å…ˆï¼Œè¿™å°æœºå™¨å¯¹å¤–è®¿é—®çš„ipåœ°å€æ˜¯<strong>120.55.94.78</strong>ï¼Œè¿™å°æœºå™¨åœ¨å½“å‰å±€åŸŸç½‘çš„åœ°å€æ˜¯<strong>192.168.1.104</strong>ï¼›åŒæ—¶è¿™å°æœºå™¨æœ‰æœ¬åœ°å›ç¯åœ°å€<strong>127.0.0.1</strong>ã€‚</p><p>å¦‚æœä½ æŒ‡å‘æœ¬æœºä¸Šå¯ä»¥è®¿é—®ï¼Œé‚£ä¹ˆä½  bind å‡½æ•°ä¸­çš„åœ°å€å°±å¯ä»¥ä½¿ç”¨<strong>127.0.0.1</strong>; å¦‚æœä½ çš„æœåŠ¡åªæƒ³è¢«å±€åŸŸç½‘å†…éƒ¨æœºå™¨è®¿é—®ï¼Œbind å‡½æ•°çš„åœ°å€å¯ä»¥ä½¿ç”¨<strong>192.168.1.104</strong>ï¼›å¦‚æœ å¸Œæœ›è¿™ä¸ªæœåŠ¡å¯ä»¥è¢«å…¬ç½‘è®¿é—®ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨åœ°å€<strong>0.0.0.0</strong>æˆ– <strong>INADDR_ANY</strong>ã€‚</p><h2 id="bind-å‡½æ•°ç«¯å£å·é—®é¢˜"><a href="#bind-å‡½æ•°ç«¯å£å·é—®é¢˜" class="headerlink" title="bind å‡½æ•°ç«¯å£å·é—®é¢˜"></a>bind å‡½æ•°ç«¯å£å·é—®é¢˜</h2><p>ç½‘ç»œé€šä¿¡ç¨‹åºçš„åŸºæœ¬é€»è¾‘æ˜¯å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œå³ä»å®¢æˆ·ç«¯çš„<strong>åœ°å€:ç«¯å£</strong>è¿æ¥åˆ°æœåŠ¡å™¨<strong>åœ°å€:ç«¯å£</strong>ä¸Šï¼Œä»¥ 4.2 å°èŠ‚ä¸­çš„ç¤ºä¾‹ç¨‹åºä¸ºä¾‹ï¼ŒæœåŠ¡å™¨ç«¯çš„ç«¯å£å·ä½¿ç”¨ 3000ï¼Œé‚£å®¢æˆ·ç«¯è¿æ¥æ—¶çš„ç«¯å£å·æ˜¯å¤šå°‘å‘¢ï¼ŸTCP é€šä¿¡åŒæ–¹ä¸­ä¸€èˆ¬æœåŠ¡å™¨ç«¯ç«¯å£å·æ˜¯å›ºå®šçš„ï¼Œè€Œå®¢æˆ·ç«¯ç«¯å£å·æ˜¯è¿æ¥å‘èµ·æ—¶ç”±æ“ä½œç³»ç»Ÿéšæœºåˆ†é…çš„ï¼ˆä¸ä¼šåˆ†é…å·²ç»è¢«å ç”¨çš„ç«¯å£ï¼‰ã€‚ç«¯å£å·æ˜¯ä¸€ä¸ª C short ç±»å‹çš„å€¼ï¼Œå…¶èŒƒå›´æ˜¯0ï½65535ï¼ŒçŸ¥é“è¿™ç‚¹å¾ˆé‡è¦ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¼–å†™å‹åŠ›æµ‹è¯•ç¨‹åºæ—¶ï¼Œç”±äºç«¯å£æ•°é‡çš„é™åˆ¶ï¼Œåœ¨æŸå°æœºå™¨ä¸Šç½‘å¡åœ°å€ä¸å˜çš„æƒ…å†µä¸‹å‹åŠ›æµ‹è¯•ç¨‹åºç†è®ºä¸Šæœ€å¤šåªèƒ½å‘èµ·å…­ä¸‡äº”åƒå¤šä¸ªè¿æ¥ã€‚æ³¨æ„æˆ‘è¯´çš„æ˜¯ç†è®ºä¸Šï¼Œåœ¨å®é™…æƒ…å†µä¸‹ï¼Œç”±äºå½“æ—¶çš„æ“ä½œç³»ç»Ÿå¾ˆå¤šç«¯å£å¯èƒ½å·²ç»è¢«å ç”¨ï¼Œå®é™…å¯ä»¥ä½¿ç”¨çš„ç«¯å£æ¯”è¿™ä¸ªæ›´å°‘ï¼Œä¾‹å¦‚ï¼Œä¸€èˆ¬è§„å®šç«¯å£å·åœ¨1024ä»¥ä¸‹çš„ç«¯å£æ˜¯ä¿ç•™ç«¯å£ï¼Œä¸å»ºè®®ç”¨æˆ·ç¨‹åºä½¿ç”¨ã€‚è€Œå¯¹äº Windows ç³»ç»Ÿï¼ŒMSDN ç”šè‡³æ˜ç¡®åœ°è¯´ï¼š</p><blockquote><p>On Windows Vista and later, the dynamic client port range is a value between 49152 and 65535. This is a change from Windows Server 2003 and earlier where the dynamic client port range was a value between 1025 and 5000. Vista åŠä»¥åçš„Windowsï¼Œå¯ç”¨çš„åŠ¨æ€ç«¯å£èŒƒå›´æ˜¯49152ï½65535ï¼Œè€Œ Windows ServeråŠæ›´æ—©çš„ç³»ç»Ÿï¼Œå¯ä»¥çš„åŠ¨æ€ç«¯å£èŒƒå›´æ˜¯1025~5000ã€‚ï¼ˆä½ å¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥æ”¹å˜è¿™ä¸€è®¾ç½®ï¼Œå‚è€ƒç½‘å€ï¼š<a href="https://docs.microsoft.com/en-us/windows/desktop/api/winsock/nf-winsock-bind%EF%BC%89">https://docs.microsoft.com/en-us/windows/desktop/api/winsock/nf-winsock-bindï¼‰</a></p></blockquote><p>å¦‚æœå°† bind å‡½æ•°ä¸­çš„ç«¯å£å·è®¾ç½®æˆ0ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¼šéšæœºç»™ç¨‹åºåˆ†é…ä¸€ä¸ªå¯ç”¨çš„ä¾¦å¬ç«¯å£ï¼Œå½“ç„¶æœåŠ¡å™¨ç¨‹åºä¸€èˆ¬ä¸ä¼šè¿™ä¹ˆåšï¼Œå› ä¸ºæœåŠ¡å™¨ç¨‹åºæ˜¯è¦å¯¹å¤–æœåŠ¡çš„ï¼Œå¿…é¡»è®©å®¢æˆ·ç«¯çŸ¥é“ç¡®åˆ‡çš„ipåœ°å€å’Œç«¯å£å·ã€‚</p><p>å¾ˆå¤šäººè§‰å¾—åªæœ‰æœåŠ¡å™¨ç¨‹åºå¯ä»¥è°ƒç”¨ bind å‡½æ•°ç»‘å®šä¸€ä¸ªç«¯å£å·ï¼Œå…¶å®ä¸ç„¶ï¼Œåœ¨ä¸€äº›ç‰¹æ®Šçš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®¢æˆ·ç«¯ç¨‹åºä»¥æŒ‡å®šçš„ç«¯å£å·å»è¿æ¥æœåŠ¡å™¨ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥åœ¨å®¢æˆ·ç«¯ç¨‹åºä¸­è°ƒç”¨ bind å‡½æ•°ç»‘å®šä¸€ä¸ªå…·ä½“çš„ç«¯å£ã€‚</p><p>æˆ‘ä»¬ç”¨ä»£ç æ¥å®é™…éªŒè¯ä¸€ä¸‹ä¸Šè·¯æ‰€è¯´çš„ï¼Œä¸ºäº†èƒ½çœ‹åˆ°è¿æ¥çŠ¶æ€ï¼Œæˆ‘ä»¬å°†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…³é—­socketçš„ä»£ç æ³¨é‡Šæ‰ï¼Œè¿™æ ·è¿æ¥ä¼šä¿æŒä¸€æ®µæ—¶é—´ã€‚</p><ul><li><strong>æƒ…å½¢ä¸€ï¼šå®¢æˆ·ç«¯ä»£ç ä¸ç»‘å®šç«¯å£</strong></li></ul><p>ä¿®æ”¹åçš„æœåŠ¡å™¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TCPæœåŠ¡å™¨é€šä¿¡åŸºæœ¬æµç¨‹</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.åˆ›å»ºä¸€ä¸ªä¾¦å¬socket</span></span><br><span class="line">    <span class="keyword">int</span> listenfd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (listenfd == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;create listen socket error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.åˆå§‹åŒ–æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">bindaddr</span>;</span></span><br><span class="line">    bindaddr.sin_family = AF_INET;</span><br><span class="line">    bindaddr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class="line">    bindaddr.sin_port = htons(<span class="number">3000</span>);</span><br><span class="line">    <span class="keyword">if</span> (bind(listenfd, (struct sockaddr *)&amp;bindaddr, <span class="keyword">sizeof</span>(bindaddr)) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;bind listen socket error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.å¯åŠ¨ä¾¦å¬</span></span><br><span class="line">    <span class="keyword">if</span> (listen(listenfd, SOMAXCONN) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;listen error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®°å½•æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥çš„å®¹å™¨</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; clientfds;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">clientaddr</span>;</span></span><br><span class="line">        <span class="keyword">socklen_t</span> clientaddrlen = <span class="keyword">sizeof</span>(clientaddr);</span><br><span class="line">        <span class="comment">//4. æ¥å—å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">        <span class="keyword">int</span> clientfd = accept(listenfd, (struct sockaddr *)&amp;clientaddr, &amp;clientaddrlen);</span><br><span class="line">        <span class="keyword">if</span> (clientfd != <span class="number">-1</span>)</span><br><span class="line">        &#123;             </span><br><span class="line">            <span class="keyword">char</span> recvBuf[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            <span class="comment">//5. ä»å®¢æˆ·ç«¯æ¥å—æ•°æ®</span></span><br><span class="line">            <span class="keyword">int</span> ret = recv(clientfd, recvBuf, <span class="number">32</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (ret &gt; <span class="number">0</span>) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;recv data from client, data: &quot;</span> &lt;&lt; recvBuf &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                <span class="comment">//6. å°†æ”¶åˆ°çš„æ•°æ®åŸå°ä¸åŠ¨åœ°å‘ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">                ret = send(clientfd, recvBuf, <span class="built_in">strlen</span>(recvBuf), <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (ret != <span class="built_in">strlen</span>(recvBuf))</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;send data error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;send data to client successfully, data: &quot;</span> &lt;&lt; recvBuf &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;recv data error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//close(clientfd);</span></span><br><span class="line">            clientfds.push_back(clientfd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.å…³é—­ä¾¦å¬socket</span></span><br><span class="line">    close(listenfd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„å®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TCPå®¢æˆ·ç«¯é€šä¿¡åŸºæœ¬æµç¨‹</span></span><br><span class="line"><span class="comment"> * zhangyl 2018.12.13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SERVER_ADDRESS <span class="meta-string">&quot;127.0.0.1&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SERVER_PORT     3000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SEND_DATA       <span class="meta-string">&quot;helloworld&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.åˆ›å»ºä¸€ä¸ªsocket</span></span><br><span class="line">    <span class="keyword">int</span> clientfd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (clientfd == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;create client socket error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">serveraddr</span>;</span></span><br><span class="line">    serveraddr.sin_family = AF_INET;</span><br><span class="line">    serveraddr.sin_addr.s_addr = inet_addr(SERVER_ADDRESS);</span><br><span class="line">    serveraddr.sin_port = htons(SERVER_PORT);</span><br><span class="line">    <span class="keyword">if</span> (connect(clientfd, (struct sockaddr *)&amp;serveraddr, <span class="keyword">sizeof</span>(serveraddr)) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;connect socket error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span><br><span class="line">    <span class="keyword">int</span> ret = send(clientfd, SEND_DATA, <span class="built_in">strlen</span>(SEND_DATA), <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="built_in">strlen</span>(SEND_DATA))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;send data error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;send data successfully, data: &quot;</span> &lt;&lt; SEND_DATA &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. ä»å®¢æˆ·ç«¯æ”¶å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">char</span> recvBuf[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    ret = recv(clientfd, recvBuf, <span class="number">32</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret &gt; <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;recv data successfully, data: &quot;</span> &lt;&lt; recvBuf &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;recv data error, data: &quot;</span> &lt;&lt; recvBuf &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5. å…³é—­socket</span></span><br><span class="line">    <span class="comment">//close(clientfd);</span></span><br><span class="line">    <span class="comment">//è¿™é‡Œä»…ä»…æ˜¯ä¸ºäº†è®©å®¢æˆ·ç«¯ç¨‹åºä¸é€€å‡º</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†ç¨‹åºç¼–è¯‘å¥½åï¼ˆç¼–è¯‘æ–¹æ³•å’Œä¸Šæ–‡ä¸€æ ·ï¼‰ï¼Œæˆ‘ä»¬å…ˆå¯åŠ¨serverï¼Œå†å¯åŠ¨ä¸‰ä¸ªå®¢æˆ·ç«¯ã€‚ç„¶åé€šè¿‡ <strong>lsof</strong> å‘½ä»¤æŸ¥çœ‹å½“å‰æœºå™¨ä¸Šçš„ TCP è¿æ¥ä¿¡æ¯ï¼Œä¸ºäº†æ›´æ¸…æ¥šåœ°æ˜¾ç¤ºç»“æœï¼Œå·²ç»å°†ä¸ç›¸å…³çš„è¿æ¥ä¿¡æ¯å»æ‰äº†ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lsof -i -Pn</span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">server   1445 root    3u  IPv4  21568      0t0  TCP *:3000 (LISTEN)</span><br><span class="line">server   1445 root    4u  IPv4  21569      0t0  TCP 127.0.0.1:3000-&gt;127.0.0.1:40818 (ESTABLISHED)</span><br><span class="line">server   1445 root    5u  IPv4  21570      0t0  TCP 127.0.0.1:3000-&gt;127.0.0.1:40820 (ESTABLISHED)</span><br><span class="line">server   1445 root    6u  IPv4  21038      0t0  TCP 127.0.0.1:3000-&gt;127.0.0.1:40822 (ESTABLISHED)</span><br><span class="line">client   1447 root    3u  IPv4  21037      0t0  TCP 127.0.0.1:40818-&gt;127.0.0.1:3000 (ESTABLISHED)</span><br><span class="line">client   1448 root    3u  IPv4  21571      0t0  TCP 127.0.0.1:40820-&gt;127.0.0.1:3000 (ESTABLISHED)</span><br><span class="line">client   1449 root    3u  IPv4  21572      0t0  TCP 127.0.0.1:40822-&gt;127.0.0.1:3000 (ESTABLISHED)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç»“æœæ˜¾ç¤ºï¼Œ<strong>server</strong> è¿›ç¨‹ï¼ˆè¿›ç¨‹ ID æ˜¯ <strong>1445</strong>ï¼‰åœ¨ <strong>3000</strong> ç«¯å£å¼€å¯ä¾¦å¬ï¼Œæœ‰ä¸‰ä¸ª <strong>client</strong> è¿›ç¨‹ï¼ˆè¿›ç¨‹ ID åˆ†åˆ«æ˜¯<strong>1447</strong>ã€<strong>1448</strong>ã€<strong>1449</strong>ï¼‰åˆ†åˆ«é€šè¿‡ç«¯å£å· <strong>40818</strong>ã€<strong>40820</strong>ã€<strong>40822</strong> è¿åˆ° <strong>server</strong> è¿›ç¨‹ä¸Šçš„ï¼Œä½œä¸ºå®¢æˆ·ç«¯çš„ä¸€æ–¹ï¼Œç«¯å£å·æ˜¯ç³»ç»Ÿéšæœºåˆ†é…çš„ã€‚</p><ul><li><p><strong>æƒ…å½¢äºŒï¼šå®¢æˆ·ç«¯ç»‘å®šç«¯å£å· 0</strong></p><p>æœåŠ¡å™¨ç«¯ä»£ç ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸‹å®¢æˆ·ç«¯ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TCPæœåŠ¡å™¨é€šä¿¡åŸºæœ¬æµç¨‹</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SERVER_ADDRESS <span class="meta-string">&quot;127.0.0.1&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SERVER_PORT     3000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SEND_DATA       <span class="meta-string">&quot;helloworld&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">//1.åˆ›å»ºä¸€ä¸ªsocket</span></span><br><span class="line">  <span class="keyword">int</span> clientfd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (clientfd == <span class="number">-1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;create client socket error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">bindaddr</span>;</span></span><br><span class="line">  bindaddr.sin_family = AF_INET;</span><br><span class="line">  bindaddr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class="line">  <span class="comment">//å°†socketç»‘å®šåˆ°0å·ç«¯å£ä¸Šå»</span></span><br><span class="line">  bindaddr.sin_port = htons(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (bind(clientfd, (struct sockaddr *)&amp;bindaddr, <span class="keyword">sizeof</span>(bindaddr)) == <span class="number">-1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;bind socket error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//2.è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">serveraddr</span>;</span></span><br><span class="line">  serveraddr.sin_family = AF_INET;</span><br><span class="line">  serveraddr.sin_addr.s_addr = inet_addr(SERVER_ADDRESS);</span><br><span class="line">  serveraddr.sin_port = htons(SERVER_PORT);</span><br><span class="line">  <span class="keyword">if</span> (connect(clientfd, (struct sockaddr *)&amp;serveraddr, <span class="keyword">sizeof</span>(serveraddr)) == <span class="number">-1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;connect socket error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//3. å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span><br><span class="line">  <span class="keyword">int</span> ret = send(clientfd, SEND_DATA, <span class="built_in">strlen</span>(SEND_DATA), <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (ret != <span class="built_in">strlen</span>(SEND_DATA))</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;send data error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;send data successfully, data: &quot;</span> &lt;&lt; SEND_DATA &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//4. ä»å®¢æˆ·ç«¯æ”¶å–æ•°æ®</span></span><br><span class="line">  <span class="keyword">char</span> recvBuf[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  ret = recv(clientfd, recvBuf, <span class="number">32</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (ret &gt; <span class="number">0</span>) </span><br><span class="line">  &#123;</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;recv data successfully, data: &quot;</span> &lt;&lt; recvBuf &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">else</span> </span><br><span class="line">  &#123;</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;recv data error, data: &quot;</span> &lt;&lt; recvBuf &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//5. å…³é—­socket</span></span><br><span class="line">  <span class="comment">//close(clientfd);</span></span><br><span class="line">  <span class="comment">//è¿™é‡Œä»…ä»…æ˜¯ä¸ºäº†è®©å®¢æˆ·ç«¯ç¨‹åºä¸é€€å‡º</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) </span><br><span class="line">  &#123;</span><br><span class="line">      sleep(<span class="number">3</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æˆ‘ä»¬å†æ¬¡ç¼–è¯‘å®¢æˆ·ç«¯ç¨‹åºï¼Œå¹¶å¯åŠ¨ä¸‰ä¸ª <strong>client</strong> è¿›ç¨‹ï¼Œç„¶åç”¨ <strong>lsof</strong> å‘½ä»¤æŸ¥çœ‹æœºå™¨ä¸Šçš„ TCP è¿æ¥æƒ…å†µï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># lsof -i -Pn</span></span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">server   1593 root    3u  IPv4  21807      0t0  TCP *:3000 (LISTEN)</span><br><span class="line">server   1593 root    4u  IPv4  21808      0t0  TCP 127.0.0.1:3000-&gt;127.0.0.1:44220 (ESTABLISHED)</span><br><span class="line">server   1593 root    5u  IPv4  19311      0t0  TCP 127.0.0.1:3000-&gt;127.0.0.1:38990 (ESTABLISHED)</span><br><span class="line">server   1593 root    6u  IPv4  21234      0t0  TCP 127.0.0.1:3000-&gt;127.0.0.1:42365 (ESTABLISHED)</span><br><span class="line">client   1595 root    3u  IPv4  22626      0t0  TCP 127.0.0.1:44220-&gt;127.0.0.1:3000 (ESTABLISHED)</span><br><span class="line">client   1611 root    3u  IPv4  21835      0t0  TCP 127.0.0.1:38990-&gt;127.0.0.1:3000 (ESTABLISHED)</span><br><span class="line">client   1627 root    3u  IPv4  21239      0t0  TCP 127.0.0.1:42365-&gt;127.0.0.1:3000 (ESTABLISHED)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ç»“æœï¼Œæˆ‘ä»¬å‘ç°ä¸‰ä¸ª <strong>client</strong> è¿›ç¨‹ä½¿ç”¨çš„ç«¯å£å·ä»ç„¶æ˜¯ç³»ç»Ÿéšæœºåˆ†é…çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç»‘å®š <strong>0</strong> å·ç«¯å£å’Œæ²¡æœ‰ç»‘å®šæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p><ul><li><p><strong>æƒ…å½¢ä¸‰ï¼šå®¢æˆ·ç«¯ç»‘å®šä¸€ä¸ªå›ºå®šç«¯å£</strong></p><p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ <strong>20000</strong> ç«¯å£ï¼Œå½“ç„¶è¯»è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½é€‰æ‹©ï¼Œåªè¦ä¿è¯æ‰€é€‰æ‹©çš„ç«¯å£å·å½“å‰æ²¡æœ‰è¢«å…¶ä»–ç¨‹åºå ç”¨å³å¯ï¼ŒæœåŠ¡å™¨ä»£ç ä¿æŒä¸å˜ï¼Œå®¢æˆ·ç«¯ç»‘å®šä»£ç ä¸­çš„ç«¯å£å·ä» <strong>0</strong> æ”¹æˆ <strong>20000</strong>ã€‚è¿™é‡Œä¸ºäº†èŠ‚çœç¯‡å¹…ï¼Œåªè´´å‡ºä¿®æ”¹å¤„çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">bindaddr</span>;</span></span><br><span class="line">bindaddr.sin_family = AF_INET;</span><br><span class="line">bindaddr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class="line"><span class="comment">//å°†socketç»‘å®šåˆ°20000å·ç«¯å£ä¸Šå»</span></span><br><span class="line">bindaddr.sin_port = htons(<span class="number">20000</span>);</span><br><span class="line"><span class="keyword">if</span> (bind(clientfd, (struct sockaddr *)&amp;bindaddr, <span class="keyword">sizeof</span>(bindaddr)) == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;bind socket error.&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡é‡æ–°ç¼–è¯‘ç¨‹åºï¼Œå…ˆå¯åŠ¨ä¸€ä¸ªå®¢æˆ·ç«¯åï¼Œæˆ‘ä»¬çœ‹åˆ°æ­¤æ—¶çš„ TCP è¿æ¥çŠ¶æ€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost testsocket]# lsof -i -Pn</span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">server   1676 root    3u  IPv4  21933      0t0  TCP *:3000 (LISTEN)</span><br><span class="line">server   1676 root    4u  IPv4  21934      0t0  TCP 127.0.0.1:3000-&gt;127.0.0.1:20000 (ESTABLISHED)</span><br><span class="line">client   1678 root    3u  IPv4  21336      0t0  TCP 127.0.0.1:20000-&gt;127.0.0.1:3000 (ESTABLISHED)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ç»“æœï¼Œæˆ‘ä»¬å‘ç° <strong>client</strong> è¿›ç¨‹ç¡®å®ä½¿ç”¨ <strong>20000</strong> å·ç«¯å£è¿æ¥åˆ° <strong>server</strong> è¿›ç¨‹ä¸Šå»äº†ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬å†å¼€å¯ä¸€ä¸ª <strong>client</strong> è¿›ç¨‹ï¼Œæˆ‘ä»¬çŒœæƒ³ç”±äºç«¯å£å· <strong>20000</strong> å·²ç»è¢«å ç”¨ï¼Œæ–°å¯åŠ¨çš„ <strong>client</strong> ä¼šç”±äºè°ƒç”¨ <strong>bind</strong> å‡½æ•°å‡ºé”™è€Œé€€å‡ºï¼Œæˆ‘ä»¬å®é™…éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost testsocket]# ./client </span><br><span class="line">bind socket error.</span><br><span class="line">[root@localhost testsocket]#</span><br></pre></td></tr></table></figure><p>ç»“æœç¡®å®å’Œæˆ‘ä»¬é¢„æƒ³çš„ä¸€æ ·ã€‚</p></li></ul><p>åœ¨æŠ€æœ¯é¢è¯•çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™é¢è¯•å®˜ä¼šé—® TCP ç½‘ç»œé€šä¿¡çš„å®¢æˆ·ç«¯ç¨‹åºä¸­çš„ socket æ˜¯å¦å¯ä»¥è°ƒç”¨ bind å‡½æ•°ï¼Œç›¸ä¿¡è¯»åˆ°è¿™é‡Œï¼Œèªæ˜çš„è¯»è€…å·²ç»æœ‰ç­”æ¡ˆäº†ã€‚</p><p>å¦å¤–ï¼ŒLinux çš„ <strong>nc</strong> å‘½ä»¤æœ‰ä¸ª <strong>-p</strong> é€‰é¡¹ï¼ˆå­—æ¯ <strong>p</strong> æ˜¯å°å†™ï¼‰ï¼Œè¿™ä¸ªé€‰é¡¹çš„ä½œç”¨å°±æ˜¯ <strong>nc</strong> åœ¨æ¨¡æ‹Ÿå®¢æˆ·ç«¯ç¨‹åºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡å®šç«¯å£å·è¿æ¥åˆ°æœåŠ¡å™¨ç¨‹åºä¸Šå»ï¼Œå®ç°åŸç†ç›¸ä¿¡è¯»è€…ä¹Ÿæ˜ç™½äº†ã€‚æˆ‘ä»¬è¿˜æ˜¯ä»¥ä¸Šé¢çš„æœåŠ¡å™¨ç¨‹åºä¸ºä¾‹ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸ç”¨æˆ‘ä»¬çš„ <strong>client</strong> ç¨‹åºï¼Œæ”¹ç”¨ <strong>nc</strong> å‘½ä»¤æ¥æ¨¡æ‹Ÿå®¢æˆ·ç«¯ã€‚åœ¨ <strong>shell</strong> ç»ˆç«¯è¾“å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost testsocket]# nc -v -p 9999 127.0.0.1 3000</span><br><span class="line">Ncat: Version 6.40 ( http://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 127.0.0.1:3000.</span><br><span class="line">My name is zhangxf</span><br><span class="line">My name is zhangxf</span><br></pre></td></tr></table></figure><p><strong>-v</strong> é€‰é¡¹è¡¨ç¤ºè¾“å‡º <strong>nc</strong> å‘½ä»¤è¿æ¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿™é‡Œè¿æ¥æˆåŠŸä»¥åï¼Œä¼šè¾“å‡ºâ€œ**Ncat: Connected to 127.0.0.1:3000.**â€ æç¤ºå·²ç»è¿æ¥åˆ°æœåŠ¡å™¨çš„ <strong>3000</strong> ç«¯å£ä¸Šå»äº†ã€‚</p><p><strong>-p</strong> é€‰é¡¹çš„å‚æ•°å€¼æ˜¯ <strong>9999</strong> è¡¨ç¤ºï¼Œæˆ‘ä»¬è¦æ±‚ <strong>nc</strong> å‘½ä»¤æœ¬åœ°ä»¥ç«¯å£å· <strong>9999</strong> è¿æ¥æœåŠ¡å™¨ï¼Œæ³¨æ„ä¸è¦ä¸ç«¯å£å· <strong>3000</strong> æ··æ·†ï¼Œ<strong>3000</strong> æ˜¯æœåŠ¡å™¨çš„ä¾¦å¬ç«¯å£å·ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„è¿æ¥çš„ç›®æ ‡ç«¯å£å·ï¼Œ<strong>9999</strong> æ˜¯æˆ‘ä»¬å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£å·ã€‚æˆ‘ä»¬ç”¨ <strong>lsof</strong> å‘½ä»¤æ¥éªŒè¯ä¸€ä¸‹æˆ‘ä»¬çš„ <strong>nc</strong> å‘½ä»¤æ˜¯å¦ç¡®å®ä»¥ <strong>9999</strong> ç«¯å£å·è¿æ¥åˆ° <strong>server</strong> è¿›ç¨‹ä¸Šå»äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost testsocket]# lsof -i -Pn</span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">server   1676 root    3u  IPv4  21933      0t0  TCP *:3000 (LISTEN)</span><br><span class="line">server   1676 root    7u  IPv4  22405      0t0  TCP 127.0.0.1:3000-&gt;127.0.0.1:9999 (ESTABLISHED)</span><br><span class="line">nc       2005 root    3u  IPv4  22408      0t0  TCP 127.0.0.1:9999-&gt;127.0.0.1:3000 (ESTABLISHED)</span><br></pre></td></tr></table></figure><p>ç»“æœç¡®å®å¦‚æˆ‘ä»¬æœŸæœ›çš„ä¸€è‡´ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ç”¨ <strong>nc</strong> å‘½ä»¤è¿æ¥ä¸Š <strong>server</strong> è¿›ç¨‹ä»¥åï¼Œæˆ‘ä»¬è¿˜ç»™æœåŠ¡å™¨å‘äº†ä¸€æ¡æ¶ˆæ¯â€<strong>My name is zhangxf</strong>â€œï¼Œ<strong>server</strong> ç¨‹åºæ”¶åˆ°æ¶ˆæ¯åæŠŠè¿™æ¡æ¶ˆæ¯åŸå°ä¸åŠ¨åœ°è¿”è¿˜ç»™æˆ‘ä»¬ï¼Œä»¥ä¸‹æ˜¯ <strong>server</strong> ç«¯è¿è¡Œç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost testsocket]# ./server   </span><br><span class="line">recv data from client, data: My name is zhangxf</span><br><span class="line"></span><br><span class="line">send data to client successfully, data: My name is zhangxf</span><br></pre></td></tr></table></figure><p>å…³äº <strong>lsof</strong> å’Œ <strong>nc</strong> å‘½ä»¤æˆ‘ä»¬ä¼šåœ¨åé¢çš„ç³»åˆ—æ–‡ç« ä¸­è¯¦ç»†è®²è§£ã€‚</p><p>å‚è€ƒï¼š<a href="https://balloonwj.github.io/cpp-guide-web/articles/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/bind%E5%87%BD%E6%95%B0%E9%87%8D%E9%9A%BE%E7%82%B9%E8%A7%A3%E6%9E%90.html">https://balloonwj.github.io/cpp-guide-web/articles/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/bind%E5%87%BD%E6%95%B0%E9%87%8D%E9%9A%BE%E7%82%B9%E8%A7%A3%E6%9E%90.html</a></p>]]></content>
    
    
    <summary type="html">å­¦ä¹ Socketç½‘ç»œç¼–ç¨‹</summary>
    
    
    
    <category term="ç½‘ç»œç¼–ç¨‹" scheme="http://example.com/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="Linux" scheme="http://example.com/tags/Linux/"/>
    
    <category term="Socket" scheme="http://example.com/tags/Socket/"/>
    
  </entry>
  
  <entry>
    <title>Algorithm</title>
    <link href="http://example.com/2021/02/21/Algorithm/"/>
    <id>http://example.com/2021/02/21/Algorithm/</id>
    <published>2021-02-21T13:32:33.000Z</published>
    <updated>2021-08-19T08:59:24.305Z</updated>
    
    <content type="html"><![CDATA[<p>æ•´ç†åˆ†ç±»åšè¿‡çš„ <code>leetcode</code>ï¼Œå¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´å•Š~</p><p>[TOC]</p><h1 id="æ»‘åŠ¨çª—å£-åŒæŒ‡é’ˆ"><a href="#æ»‘åŠ¨çª—å£-åŒæŒ‡é’ˆ" class="headerlink" title="æ»‘åŠ¨çª—å£/åŒæŒ‡é’ˆ"></a>æ»‘åŠ¨çª—å£/åŒæŒ‡é’ˆ</h1><p><strong>æœ€çŸ­æˆ–æœ€é•¿çš„å­ä¸²  æœ€å¤šå¯å˜kæ¬¡</strong></p><h2 id="LC-3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"><a href="#LC-3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²" class="headerlink" title="LC-3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"></a><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">LC-3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ <strong>æœ€é•¿å­ä¸²</strong> çš„é•¿åº¦ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: s = &quot;abcabcbb&quot;</span><br><span class="line">è¾“å‡º: 3 </span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;abc&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: s = &quot;bbbbb&quot;</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;b&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: s = &quot;pwwkew&quot;</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;wke&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</span><br><span class="line">     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ&quot;pwke&quot; æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: s = &quot;&quot;</span><br><span class="line">è¾“å‡º: 0</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>0 &lt;= s.length &lt;= 5 * 104</code></li><li><code>s</code> ç”±è‹±æ–‡å­—æ¯ã€æ•°å­—ã€ç¬¦å·å’Œç©ºæ ¼ç»„æˆ</li><li></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ï¼ˆä¸€ï¼‰</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œå¯ä»¥å»ºç«‹ä¸€ä¸ª HashMapï¼Œå»ºç«‹æ¯ä¸ªå­—ç¬¦å’Œå…¶æœ€åå‡ºç°ä½ç½®ä¹‹é—´çš„æ˜ å°„</span></span><br><span class="line"><span class="comment"> * ç„¶åå®šä¹‰ä¸¤ä¸ªå˜é‡ res å’Œ leftï¼Œå…¶ä¸­ res ç”¨æ¥è®°å½•æœ€é•¿æ— é‡å¤å­ä¸²çš„é•¿åº¦</span></span><br><span class="line"><span class="comment"> * left æŒ‡å‘è¯¥æ— é‡å¤å­ä¸²å·¦è¾¹çš„èµ·å§‹ä½ç½®çš„å‰ä¸€ä¸ªï¼Œæ‰€ä»¥åˆå§‹åŒ–å°±æ˜¯ -1</span></span><br><span class="line"><span class="comment"> * ç„¶åéå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œå¯¹äºæ¯ä¸€ä¸ªéå†åˆ°çš„å­—ç¬¦ï¼Œå¦‚æœè¯¥å­—ç¬¦å·²ç»åœ¨ HashMap ä¸­å­˜åœ¨äº†ï¼Œ</span></span><br><span class="line"><span class="comment"> * å¹¶ä¸”å¦‚æœå…¶æ˜ å°„å€¼å¤§äº left çš„è¯ï¼Œé‚£ä¹ˆæ›´æ–° left ä¸ºå½“å‰æ˜ å°„å€¼ã€‚ç„¶åæ˜ å°„å€¼æ›´æ–°ä¸ºå½“å‰åæ ‡iï¼Œ</span></span><br><span class="line"><span class="comment"> * è¿™æ ·ä¿è¯äº† left å§‹ç»ˆä¸ºå½“å‰è¾¹ç•Œçš„å‰ä¸€ä¸ªä½ç½®ï¼Œç„¶åè®¡ç®—çª—å£é•¿åº¦çš„æ—¶å€™ï¼Œç›´æ¥ç”¨ i-left å³å¯ï¼Œ</span></span><br><span class="line"><span class="comment"> * ç”¨æ¥æ›´æ–°ç»“æœ resã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>, left = <span class="number">-1</span>, n = s.<span class="built_in">size</span>();</span><br><span class="line">        unordered_map&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; m;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (m.<span class="built_in">count</span>(s[i]) &amp;&amp; m[s[i]] &gt; left) &#123;</span><br><span class="line">                left = m[s[i]];  </span><br><span class="line">            &#125;</span><br><span class="line">            m[s[i]] = i;</span><br><span class="line">            res = <span class="built_in">max</span>(res, i - left);            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™ç§è§£æ³•ä½¿ç”¨äº† <code>HashSet</code>ï¼Œæ ¸å¿ƒç®—æ³•å’Œä¸Šé¢çš„å¾ˆç±»ä¼¼ï¼ŒæŠŠå‡ºç°è¿‡çš„å­—ç¬¦éƒ½æ”¾å…¥<code>HashSet</code>ä¸­ï¼Œé‡åˆ° <code>HashSet </code>ä¸­æ²¡æœ‰çš„å­—ç¬¦å°±åŠ å…¥<code> HashSet</code> ä¸­å¹¶æ›´æ–°ç»“æœ <code>res</code>ï¼Œå¦‚æœé‡åˆ°é‡å¤çš„ï¼Œåˆ™ä»å·¦è¾¹å¼€å§‹åˆ å­—ç¬¦ï¼Œç›´åˆ°åˆ åˆ°é‡å¤çš„å­—ç¬¦åœæ­¢ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ï¼ˆäºŒï¼‰</span></span><br><span class="line"><span class="comment"> * ä¸‹é¢è¿™ç§è§£æ³•ä½¿ç”¨äº† HashSetï¼Œæ ¸å¿ƒç®—æ³•å’Œä¸Šé¢çš„å¾ˆç±»ä¼¼ï¼Œ</span></span><br><span class="line"><span class="comment"> * æŠŠå‡ºç°è¿‡çš„å­—ç¬¦éƒ½æ”¾å…¥ HashSet ä¸­ï¼Œé‡åˆ° HashSet ä¸­æ²¡æœ‰çš„å­—ç¬¦å°±åŠ å…¥ HashSet</span></span><br><span class="line"><span class="comment"> * å¹¶æ›´æ–°ç»“æœ resï¼Œå¦‚æœé‡åˆ°é‡å¤çš„ï¼Œåˆ™ä»å·¦è¾¹å¼€å§‹åˆ å­—ç¬¦ï¼Œç›´åˆ°åˆ åˆ°é‡å¤çš„å­—ç¬¦åœæ­¢ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> n=s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> left=<span class="number">0</span>, res=<span class="number">0</span>;</span><br><span class="line">        unordered_set&lt;<span class="keyword">char</span>&gt; st;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">            <span class="keyword">while</span>(st.<span class="built_in">find</span>(s[i])!=st.<span class="built_in">end</span>())&#123;</span><br><span class="line">                st.<span class="built_in">erase</span>(s[left]);</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            st.<span class="built_in">insert</span>(s[i]);</span><br><span class="line">            res=<span class="built_in">max</span>(res,i-left+<span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="LC-76-æœ€å°è¦†ç›–å­ä¸²"><a href="#LC-76-æœ€å°è¦†ç›–å­ä¸²" class="headerlink" title="LC-76. æœ€å°è¦†ç›–å­ä¸²"></a><a href="https://leetcode-cn.com/problems/minimum-window-substring/">LC-76. æœ€å°è¦†ç›–å­ä¸²</a></h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ã€ä¸€ä¸ªå­—ç¬¦ä¸² <code>t</code> ã€‚è¿”å› <code>s</code> ä¸­æ¶µç›– <code>t</code> æ‰€æœ‰å­—ç¬¦çš„æœ€å°å­ä¸²ã€‚å¦‚æœ <code>s</code> ä¸­ä¸å­˜åœ¨æ¶µç›– <code>t</code> æ‰€æœ‰å­—ç¬¦çš„å­ä¸²ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸² <code>&quot;&quot;</code> ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>å¯¹äº <code>t</code> ä¸­é‡å¤å­—ç¬¦ï¼Œæˆ‘ä»¬å¯»æ‰¾çš„å­å­—ç¬¦ä¸²ä¸­è¯¥å­—ç¬¦æ•°é‡å¿…é¡»ä¸å°‘äº <code>t</code> ä¸­è¯¥å­—ç¬¦æ•°é‡ã€‚</li><li>å¦‚æœ <code>s</code> ä¸­å­˜åœ¨è¿™æ ·çš„å­ä¸²ï¼Œæˆ‘ä»¬ä¿è¯å®ƒæ˜¯å”¯ä¸€çš„ç­”æ¡ˆã€‚</li></ul><p> <strong>è¿›é˜¶ï¼š</strong>ä½ èƒ½è®¾è®¡ä¸€ä¸ªåœ¨ <code>o(n)</code> æ—¶é—´å†…è§£å†³æ­¤é—®é¢˜çš„ç®—æ³•å—ï¼Ÿ</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;ADOBECODEBANC&quot;, t = &quot;ABC&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;BANC&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;a&quot;, t = &quot;a&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;a&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: s = &quot;a&quot;, t = &quot;aa&quot;</span><br><span class="line">è¾“å‡º: &quot;&quot;</span><br><span class="line">è§£é‡Š: t ä¸­ä¸¤ä¸ªå­—ç¬¦ &#x27;a&#x27; å‡åº”åŒ…å«åœ¨ s çš„å­ä¸²ä¸­ï¼Œ</span><br><span class="line">å› æ­¤æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å­å­—ç¬¦ä¸²ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= s.length, t.length &lt;= 105</code></li><li><code>s</code> å’Œ <code>t</code> ç”±è‹±æ–‡å­—æ¯ç»„æˆ</li></ul><p>è¿™é“é¢˜ç»™äº†æˆ‘ä»¬ä¸€ä¸ªåŸå­—ç¬¦ä¸²<code>s</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªç›®æ ‡å­—ç¬¦ä¸²<code>t</code>ï¼Œè®©åœ¨<code>s</code>ä¸­æ‰¾åˆ°ä¸€ä¸ªæœ€çŸ­çš„å­ä¸²ï¼Œä½¿å¾—å…¶åŒ…å«äº†<code>t</code>ä¸­çš„æ‰€æœ‰çš„å­—æ¯ï¼Œå¹¶ä¸”é™åˆ¶äº†æ—¶é—´å¤æ‚åº¦ä¸º<code> O(n)</code>ã€‚è¿™é“é¢˜çš„è¦æ±‚æ˜¯è¦åœ¨<code>O(n) </code>çš„æ—¶é—´åº¦é‡Œå®ç°æ‰¾åˆ°è¿™ä¸ªæœ€å°çª—å£å­—ä¸²ï¼Œæš´åŠ›æœç´¢ <code>Brute Force </code>è‚¯å®šæ˜¯ä¸èƒ½ç”¨çš„ï¼Œå› ä¸ºéå†æ‰€æœ‰çš„å­ä¸²çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¹³æ–¹çº§çš„ã€‚é‚£ä¹ˆæ¥æƒ³ä¸€ä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦å¡çš„è¿™ä¹ˆä¸¥ï¼Œè¯´æ˜å¿…é¡»åœ¨ä¸€æ¬¡éå†ä¸­å®Œæˆä»»åŠ¡ï¼Œå½“ç„¶éå†è‹¥å¹²æ¬¡ä¹Ÿæ˜¯<code> O(n)</code>ï¼Œä½†ä¸ä¸€å®šæœ‰è¿™ä¸ªå¿…è¦ï¼Œå°è¯•å°±ä¸€æ¬¡éå†æ‹¿ä¸‹ï¼é‚£ä¹ˆå†æ¥æƒ³ï¼Œæ—¢ç„¶è¦åŒ…å«Tä¸­æ‰€æœ‰çš„å­—æ¯ï¼Œé‚£ä¹ˆå¯¹äºTä¸­çš„æ¯ä¸ªå­—æ¯ï¼Œè‚¯å®šè¦å¿«é€ŸæŸ¥æ‰¾æ˜¯å¦åœ¨å­ä¸²ä¸­ï¼Œæ—¢ç„¶æ€»æ—¶é—´éƒ½å¡åœ¨äº†<code> O(n)</code>ï¼Œè‚¯å®šä¸æƒ³åœ¨è¿™é‡Œè¿˜æµªè´¹æ—¶é—´ï¼Œå°±ç”¨ç©ºé—´æ¢æ—¶é—´ï¼ˆä¹Ÿå°±ç®—æ³•é¢˜ä¸­å¯ä»¥è¿™ä¹ˆå¹²äº†ï¼Œä¸ƒè€å…«åçš„å¯Œç¿å°±ç®—ç”¨å¤§åˆ«é‡ä¹Ÿæ¢ä¸æ¥æ—¶é—´å•Šã€‚ä¾ä¾ä¸œæœ›ï¼Œæœ›çš„å°±æ˜¯æ—¶é—´å‘ï¼‰ï¼Œä½¿ç”¨<code> HashMap</code>ï¼Œå»ºç«‹Tä¸­æ¯ä¸ªå­—æ¯ä¸å…¶å‡ºç°æ¬¡æ•°ä¹‹é—´çš„æ˜ å°„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * step1: ç¡®å®šå³è¾¹ç•Œ</span></span><br><span class="line"><span class="comment"> * å…ˆç”¨ HashMap ç»Ÿè®¡å¥½ t ä¸²ä¸­å­—æ¯çš„ï¼Œå†éå† s ä¸²ï¼Œå¯¹äº s ä¸­çš„æ¯ä¸ªå­—æ¯</span></span><br><span class="line"><span class="comment"> * éƒ½å°† HashMap ä¸­çš„æ˜ å°„å€¼å‡1ï¼Œå¦‚æœå‡1åçš„æ˜ å°„å€¼ä»å¤§äºç­‰äº0ï¼Œè¯´æ˜å½“å‰éå†åˆ°çš„å­—æ¯æ˜¯ t ä¸²ä¸­çš„å­—æ¯</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ cnt++ è®°å½•ã€‚å½“cnt å’Œ t ä¸²å­—æ¯ä¸ªæ•°ç›¸ç­‰æ—¶ï¼Œè¯´æ˜æ­¤æ—¶çš„çª—å£å·²ç»åŒ…å«äº† t ä¸²ä¸­çš„æ‰€æœ‰å­—æ¯</span></span><br><span class="line"><span class="comment"> * step2: æ”¶ç¼©å·¦è¾¹ç•Œ</span></span><br><span class="line"><span class="comment"> * ç”±äºéå†çš„æ—¶å€™ï¼Œæ˜ å°„å€¼å‡äº†1ï¼Œæ‰€ä»¥æ­¤æ—¶å»é™¤å­—æ¯çš„æ—¶å€™ï¼Œå°±è¦æŠŠå‡å»çš„1åŠ å›æ¥ï¼Œ</span></span><br><span class="line"><span class="comment"> * æ­¤æ—¶å¦‚æœåŠ 1åçš„å€¼å¤§äº0äº†ï¼Œè¯´æ˜å½“å‰éå†åˆ°çš„å­—æ¯æ˜¯ t ä¸²ä¸­çš„å­—æ¯ï¼Œ</span></span><br><span class="line"><span class="comment"> * é‚£ä¹ˆ cnt å€¼å°±è¦å‡1äº†ï¼Œç„¶åç§»åŠ¨å·¦è¾¹ç•Œleft</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">minWindow</span><span class="params">(string s, string t)</span> </span>&#123;</span><br><span class="line">        string res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        unordered_map&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; letterCnt;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, cnt = <span class="number">0</span>, minLen = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> c : t) ++letterCnt[c];         <span class="comment">//éå†t</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (--letterCnt[s[i]] &gt;= <span class="number">0</span>) ++cnt;   <span class="comment">//--letterCnt[s[i]] &gt;= 0ï¼Œs[i]åœ¨tä¸­</span></span><br><span class="line">            <span class="keyword">while</span> (cnt == t.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (minLen &gt; i - left + <span class="number">1</span>) &#123;</span><br><span class="line">                    minLen = i - left + <span class="number">1</span>;</span><br><span class="line">                    res = s.<span class="built_in">substr</span>(left, minLen); <span class="comment">//ä»leftå¼€å§‹ï¼Œé•¿åº¦ä¸ºminLençš„å­—ç¬¦ä¸²</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//æ”¶ç¼©å·¦è¾¹ç•Œ ++letterCnt[s[left]] &gt; 0ï¼Œ 0-&gt;1 è¯¥å…ƒç´ åœ¨tä¸­ï¼Œ</span></span><br><span class="line">                <span class="keyword">if</span> (++letterCnt[s[left]] &gt; <span class="number">0</span>) --cnt;   </span><br><span class="line">                <span class="comment">//å› ä¸ºä¸åœ¨tä¸­çš„æœ¬æ¥ä¸º0ï¼Œå…ˆå‡å»ï¼Œç°åœ¨å†å¢åŠ ï¼Œæœ€ç»ˆè¿˜æ˜¯0.</span></span><br><span class="line">                ++left;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="pa-3-å¯»æ‰¾æœ€é å·¦çš„åŒ¹é…å­ä¸²"><a href="#pa-3-å¯»æ‰¾æœ€é å·¦çš„åŒ¹é…å­ä¸²" class="headerlink" title="pa-3.å¯»æ‰¾æœ€é å·¦çš„åŒ¹é…å­ä¸²"></a><a href="https://www.papamelon.com/problem/3">pa-3.å¯»æ‰¾æœ€é å·¦çš„åŒ¹é…å­ä¸²</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² A é•¿åº¦ä¸º Nï¼Œ1 &lt;= N &lt;= 2*10^5ï¼Œä¸‹æ ‡ä» 0 å¼€å§‹æ ‡å·ï¼Œä»…åŒ…å« 0 åˆ° 9 è¿™åç§å­—ç¬¦ã€‚</p><p>å†ç»™å®šå¦ä¸€ä¸ªå­—ç¬¦ä¸² Bï¼Œé•¿åº¦ä¸º Mï¼Œ1 &lt;= M &lt;= 2*10^5ï¼Œä¸‹æ ‡ä» 0 å¼€å§‹æ ‡å·ï¼Œä¹Ÿæ˜¯ä»…åŒ…å« 0 åˆ° 9 è¿™åç§å­—ç¬¦ã€‚</p><p>ä¾‹å¦‚ä»¥ä¸‹å­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªåˆæ³•çš„ Aæˆ– B</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">066465353473034515</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬è¦åœ¨ Aå¯»æ‰¾ä¸€ä¸ªè¿ç»­çš„å­ä¸² sï¼Œä½¿å¾— såŒ…å« Bä¸­å‡ºç°çš„æ‰€æœ‰å­—ç¬¦ï¼Œä¸”è¦ä¿è¯ sçš„<strong>é•¿åº¦å°½å¯èƒ½çŸ­</strong>ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªç¬¦åˆä¸Šè¿°æ¡ä»¶çš„ sï¼Œ<strong>è¿”å›æœ€é å·¦</strong>çš„é‚£ä¸ªã€‚</p><p>ä¾‹å¦‚:</p><ul><li>Bä¸²ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3314</span><br></pre></td></tr></table></figure><ul><li>Aä¸²ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">563145633</span><br></pre></td></tr></table></figure><p>å­ä¸² A[2:7]ä¸º <code>314563</code>ï¼ŒåŒ…å«äº† Bä¸²ä¸­å‡ºç°çš„ <code>3</code>, <code>3</code>, <code>1</code>, <code>4</code>ã€‚</p><p>å­ä¸² A[3:8]ä¸º <code>145633</code>ï¼Œä¹ŸåŒ…å«äº† Bä¸²ä¸­å‡ºç°çš„ <code>3</code>, <code>3</code>, <code>1</code>, <code>4</code>ã€‚</p><p>ä¸¤ä¸ªå­ä¸²é•¿åº¦ä¸€æ ·ï¼Œè€Œå‰è€…æ›´é å·¦ï¼Œå› æ­¤å‰è€…å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç­”æ¡ˆã€‚</p><p><strong>è¾“å…¥</strong></p><ul><li>æ¯ç»„æµ‹è¯•æ•°æ®çš„ç¬¬ä¸€è¡Œæ˜¯æ•´æ•° Tï¼Œ$1 \leq T \leq 1000$ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ Tå¯¹ A, Bä¸²</li><li>æ¥ä¸‹æ¥æœ‰ $2*T$è¡Œï¼Œæ¯ä¸¤è¡Œåˆ†åˆ«è¡¨ç¤ºä¸€å¯¹ Aä¸²å’Œ Bä¸²</li><li>A<em>A</em> ä¸²é•¿åº¦ä¸º Nï¼Œ1 &lt;= N &lt;= 2*10^5</li><li>B<em>B</em> ä¸²é•¿åº¦ä¸º Mï¼Œ1 &lt;= M &lt;= 2*10^5</li><li>ä¸€ç»„æµ‹è¯•æ•°æ®ä¸­å­—ç¬¦æ€»æ•°ä¸º Cï¼Œ  2 * T  &lt;= C &lt;= 2*10^6</li></ul><p><strong>è¾“å‡º</strong></p><ul><li>è¾“å‡º Tè¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œç”¨ç©ºæ ¼åˆ†å‰²ï¼Œè¡¨ç¤º Açš„å­ä¸²ä¸‹æ ‡</li><li>å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„åˆæ³•å­ä¸²ï¼Œè¾“å‡º <code>-1 -1</code></li></ul><p>æ ·ä¾‹ 1</p><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">563145633</span><br><span class="line">3314</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2 7</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ·ä¾‹ 2</p><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">678</span><br><span class="line">123</span><br><span class="line">12345</span><br><span class="line">1233</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-1 -1</span><br><span class="line">-1 -1</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ï¼ˆä¸€ï¼‰</span></span><br><span class="line"><span class="comment"> * æ ¸å¿ƒç®—æ³•ç»§æ‰¿LC-76ï¼Œå…ˆç¡®å®šå³è¾¹ç•Œå†æ”¶ç¼©å·¦è¾¹ç•Œ</span></span><br><span class="line"><span class="comment"> * éœ€è¦æ³¨æ„è¾“å…¥è¾“å‡ºçš„ç»ƒä¹ </span></span><br><span class="line"><span class="comment"> * if elseè§„èŒƒä¹¦å†™ï¼Œä¸€ä¸ªå°bugè°ƒå¼äº†å¥½ä¹…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    string s, t;</span><br><span class="line">    vector&lt;vector&lt;<span class="keyword">int</span>&gt;&gt; res;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">minWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cin &gt;&gt; s &gt;&gt; t;</span><br><span class="line">        unordered_map&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, cnt = <span class="number">0</span>, minLen = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> c : t) ++mp[c];        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (--mp[s[i]] &gt;= <span class="number">0</span>) ++cnt;   </span><br><span class="line">            <span class="keyword">while</span> (cnt == t.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (minLen &gt; i - left + <span class="number">1</span>) &#123;</span><br><span class="line">                    minLen = i - left + <span class="number">1</span>;</span><br><span class="line">                    res.<span class="built_in">clear</span>();</span><br><span class="line">                    res.<span class="built_in">push_back</span>(&#123;left,left+minLen<span class="number">-1</span>&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (++mp[s[left]] &gt; <span class="number">0</span>) --cnt;   </span><br><span class="line">                ++left;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// return res;</span></span><br><span class="line">        <span class="keyword">if</span>(res.<span class="built_in">size</span>()==<span class="number">0</span>)</span><br><span class="line">            cout&lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; <span class="number">-1</span> &lt;&lt;endl;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cout &lt;&lt; res[<span class="number">0</span>][<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &quot;</span>  &lt;&lt; res[<span class="number">0</span>][<span class="number">1</span>] &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--) <span class="built_in">Solution</span>().<span class="built_in">minWindow</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ï¼ˆäºŒï¼‰</span></span><br><span class="line"><span class="comment"> * æ ¸å¿ƒç®—æ³•ç»§æ‰¿LC-76ï¼Œ</span></span><br><span class="line"><span class="comment"> * ä»£ç ç¨å¾®ç®€æ´ï¼Œé€»è¾‘ä¸å˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">string s, t;</span><br><span class="line">unordered_map&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; s &gt;&gt; t;</span><br><span class="line">    vector&lt;vector&lt;<span class="keyword">int</span>&gt;&gt; res;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>, cnt = <span class="number">0</span>, minLen = INT_MAX;</span><br><span class="line">    mp.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> c : t) ++mp[c];         </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (--mp[s[i]] &gt;= <span class="number">0</span>) ++cnt;   </span><br><span class="line">        <span class="keyword">while</span> (cnt == t.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (minLen &gt; i - left + <span class="number">1</span>) &#123;</span><br><span class="line">                minLen = i - left + <span class="number">1</span>;</span><br><span class="line">                res.<span class="built_in">clear</span>();</span><br><span class="line">                res.<span class="built_in">push_back</span>(&#123;left,left+minLen<span class="number">-1</span>&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (++mp[s[left]] &gt; <span class="number">0</span>) --cnt;   </span><br><span class="line">            ++left;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// return res;</span></span><br><span class="line">    <span class="keyword">if</span>(res.<span class="built_in">size</span>()==<span class="number">0</span>)</span><br><span class="line">        cout&lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; <span class="number">-1</span> &lt;&lt;endl;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cout &lt;&lt; res[<span class="number">0</span>][<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &quot;</span>  &lt;&lt; res[<span class="number">0</span>][<span class="number">1</span>] &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--) <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="LC-1-ä¸¤æ•°ä¹‹å’Œ"><a href="#LC-1-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="LC-1. ä¸¤æ•°ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/two-sum/">LC-1. ä¸¤æ•°ä¹‹å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ <code>target</code>ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º <strong>å’Œä¸ºç›®æ ‡å€¼</strong> <em>target</em>  çš„é‚£ <strong>ä¸¤ä¸ª</strong> æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚</p><p>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [2,7,11,15], target = 9</span><br><span class="line">è¾“å‡ºï¼š[0,1]</span><br><span class="line">è§£é‡Šï¼šå› ä¸º nums[0] + nums[1] == 9 ï¼Œè¿”å› [0, 1] ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [3,2,4], target = 6</span><br><span class="line">è¾“å‡ºï¼š[1,2]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [3,3], target = 6</span><br><span class="line">è¾“å‡ºï¼š[0,1]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>2 &lt;= nums.length &lt;= 104</code></li><li><code>-109 &lt;= nums[i] &lt;= 109</code></li><li><code>-109 &lt;= target &lt;= 109</code></li><li><strong>åªä¼šå­˜åœ¨ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆ</strong></li></ul><p><strong>è¿›é˜¶ï¼š</strong>ä½ å¯ä»¥æƒ³å‡ºä¸€ä¸ªæ—¶é—´å¤æ‚åº¦å°äº <code>O(n2)</code> çš„ç®—æ³•å—ï¼Ÿ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ï¼ˆä¸€ï¼‰</span></span><br><span class="line"><span class="comment"> * ç¬¨æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•æ˜¯æšä¸¾æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªæ•° xï¼Œå¯»æ‰¾æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ target - xã€‚</span></span><br><span class="line"><span class="comment"> * å½“æˆ‘ä»¬ä½¿ç”¨éå†æ•´ä¸ªæ•°ç»„çš„æ–¹å¼å¯»æ‰¾ target - x æ—¶ï¼Œéœ€è¦æ³¨æ„åˆ°æ¯ä¸€ä¸ªä½äº x ä¹‹å‰çš„å…ƒç´ éƒ½å·²ç»å’Œ x åŒ¹é…è¿‡ï¼Œ</span></span><br><span class="line"><span class="comment"> * å› æ­¤ä¸éœ€è¦å†è¿›è¡ŒåŒ¹é…ã€‚è€Œæ¯ä¸€ä¸ªå…ƒç´ ä¸èƒ½è¢«ä½¿ç”¨ä¸¤æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨ x åé¢çš„å…ƒç´ ä¸­å¯»æ‰¾ target - x</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">twoSum</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        <span class="keyword">int</span> n=nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n<span class="number">-1</span>;++i)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;n;++j)&#123;</span><br><span class="line">                <span class="keyword">if</span>(target== nums[i]+nums[j])&#123;</span><br><span class="line">                    res.<span class="built_in">push_back</span>(i);</span><br><span class="line">                    res.<span class="built_in">push_back</span>(j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ï¼ˆäºŒï¼‰</span></span><br><span class="line"><span class="comment"> * æ³¨æ„åˆ°æ–¹æ³•ä¸€çš„æ—¶é—´å¤æ‚åº¦è¾ƒé«˜çš„åŸå› æ˜¯å¯»æ‰¾ target - x çš„æ—¶é—´å¤æ‚åº¦è¿‡é«˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´ä¼˜ç§€çš„æ–¹æ³•ï¼Œ</span></span><br><span class="line"><span class="comment"> * èƒ½å¤Ÿå¿«é€Ÿå¯»æ‰¾æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ç›®æ ‡å…ƒç´ ã€‚å¦‚æœå­˜åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡ºå®ƒçš„ç´¢å¼•ã€‚</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œå¯ä»¥å°†å¯»æ‰¾ target - x çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ°ä» O(N)O(N) é™ä½åˆ° O(1)ã€‚</span></span><br><span class="line"><span class="comment"> * è¿™æ ·æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå¯¹äºæ¯ä¸€ä¸ª xï¼Œæˆ‘ä»¬é¦–å…ˆæŸ¥è¯¢å“ˆå¸Œè¡¨ä¸­æ˜¯å¦å­˜åœ¨ target - xï¼Œç„¶åå°† x æ’å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œ</span></span><br><span class="line"><span class="comment"> * å³å¯ä¿è¯ä¸ä¼šè®© x å’Œè‡ªå·±åŒ¹é…ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">twoSum</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        unordered_map&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;nums.<span class="built_in">size</span>();++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(mp.<span class="built_in">find</span>(target-nums[i])!=mp.<span class="built_in">end</span>())&#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(i);</span><br><span class="line">                res.<span class="built_in">push_back</span>(mp.<span class="built_in">find</span>(target-nums[i])-&gt;second);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// mp.insert(pair&lt;int, int&gt;(nums[i], i));</span></span><br><span class="line">            mp[nums[i]]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ï¼ˆä¸‰ï¼‰å†ç²¾ç®€ä¸€ä¸‹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">twoSum</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; m;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (m.<span class="built_in">count</span>(target - nums[i])) &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;i, m[target - nums[i]]&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            m[nums[i]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="LC-15-ä¸‰æ•°ä¹‹å’Œ"><a href="#LC-15-ä¸‰æ•°ä¹‹å’Œ" class="headerlink" title="LC-15. ä¸‰æ•°ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/3sum/">LC-15. ä¸‰æ•°ä¹‹å’Œ</a></h2><p>éš¾åº¦ä¸­ç­‰3545æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡æ¥æ”¶åŠ¨æ€åé¦ˆ</p><p>ç»™ä½ ä¸€ä¸ªåŒ…å« <code>n</code> ä¸ªæ•´æ•°çš„æ•°ç»„ <code>nums</code>ï¼Œåˆ¤æ–­ <code>nums</code> ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  <em>aï¼Œbï¼Œc ï¼Œ</em>ä½¿å¾— <em>a + b + c =</em> 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰å’Œä¸º <code>0</code> ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [-1,0,1,2,-1,-4]</span><br><span class="line">è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [0]</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>0 &lt;= nums.length &lt;= 3000</code></li><li><code>-105 &lt;= nums[i] &lt;= 105</code></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’åº+åŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="comment"> * å›ºå®šç¬¬ä¸€ä¸ªæ•°ï¼Œè½¬åŒ–ä¸ºæ±‚ä¸¤æ•°ä¹‹å’Œ</span></span><br><span class="line"><span class="comment"> * ç‰¹åˆ«æ³¨æ„ç›¸é‚»å…ƒç´ å»é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="keyword">int</span>&gt;&gt; <span class="built_in">threeSum</span>(vector&lt;<span class="keyword">int</span>&gt;&amp; nums) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> size = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (size &lt; <span class="number">3</span>)   <span class="keyword">return</span> &#123;&#125;;          <span class="comment">// ç‰¹åˆ¤</span></span><br><span class="line">        vector&lt;vector&lt;<span class="keyword">int</span>&gt; &gt;res;            <span class="comment">// ä¿å­˜ç»“æœï¼ˆæ‰€æœ‰ä¸é‡å¤çš„ä¸‰å…ƒç»„ï¼‰</span></span><br><span class="line">        std::<span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());<span class="comment">// æ’åºï¼ˆé»˜è®¤é€’å¢ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)      <span class="comment">// å›ºå®šç¬¬ä¸€ä¸ªæ•°ï¼Œè½¬åŒ–ä¸ºæ±‚ä¸¤æ•°ä¹‹å’Œ</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; <span class="number">0</span>)  <span class="keyword">return</span> res; <span class="comment">// ç¬¬ä¸€ä¸ªæ•°å¤§äº 0ï¼Œåé¢éƒ½æ˜¯é€’å¢æ­£æ•°ï¼Œä¸å¯èƒ½ç›¸åŠ ä¸ºé›¶</span></span><br><span class="line">            <span class="comment">// å»é‡ï¼šå¦‚æœæ­¤æ•°å·²ç»é€‰å–è¿‡ï¼Œè·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i<span class="number">-1</span>])  <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// åŒæŒ‡é’ˆåœ¨nums[i]åé¢çš„åŒºé—´ä¸­å¯»æ‰¾å’Œä¸º0-nums[i]çš„å¦å¤–ä¸¤ä¸ªæ•°</span></span><br><span class="line">            <span class="keyword">int</span> left = i + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> right = size - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (left &lt; right)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[left] + nums[right] &gt; -nums[i])</span><br><span class="line">                    right--;    <span class="comment">// ä¸¤æ•°ä¹‹å’Œå¤ªå¤§ï¼Œå³æŒ‡é’ˆå·¦ç§»</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (nums[left] + nums[right] &lt; -nums[i])</span><br><span class="line">                    left++;     <span class="comment">// ä¸¤æ•°ä¹‹å’Œå¤ªå°ï¼Œå·¦æŒ‡é’ˆå³ç§»</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// æ‰¾åˆ°ä¸€ä¸ªå’Œä¸ºé›¶çš„ä¸‰å…ƒç»„ï¼Œæ·»åŠ åˆ°ç»“æœä¸­ï¼Œå·¦å³æŒ‡é’ˆå†…ç¼©ï¼Œç»§ç»­å¯»æ‰¾</span></span><br><span class="line">                    res.<span class="built_in">push_back</span>(vector&lt;<span class="keyword">int</span>&gt;&#123;nums[i], nums[left], nums[right]&#125;);</span><br><span class="line">                    left++;</span><br><span class="line">                    right--;</span><br><span class="line">                    <span class="comment">// å»é‡ï¼šç¬¬äºŒä¸ªæ•°å’Œç¬¬ä¸‰ä¸ªæ•°ä¹Ÿä¸é‡å¤é€‰å–</span></span><br><span class="line">                    <span class="comment">// ä¾‹å¦‚ï¼š[-4,1,1,1,2,3,3,3], i=0, left=1, right=5</span></span><br><span class="line">                    <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[left] == nums[left<span class="number">-1</span>])  left++;</span><br><span class="line">                    <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[right] == nums[right+<span class="number">1</span>])    right--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="LC-40-ç»„åˆæ€»å’Œ-II"><a href="#LC-40-ç»„åˆæ€»å’Œ-II" class="headerlink" title="LC-40. ç»„åˆæ€»å’Œ II"></a><a href="https://leetcode-cn.com/problems/combination-sum-ii/">LC-40. ç»„åˆæ€»å’Œ II</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>candidates</code> å’Œä¸€ä¸ªç›®æ ‡æ•° <code>target</code> ï¼Œæ‰¾å‡º <code>candidates</code> ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º <code>target</code> çš„ç»„åˆã€‚</p><p><code>candidates</code> ä¸­çš„æ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ </p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: candidates = [10,1,2,7,6,1,5], target = 8,</span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">[1,1,6],</span><br><span class="line">[1,2,5],</span><br><span class="line">[1,7],</span><br><span class="line">[2,6]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: candidates = [2,5,2,1,2], target = 5,</span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">[1,2,2],</span><br><span class="line">[5]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>æç¤º:</strong></p><ul><li><code>1 &lt;= candidates.length &lt;= 100</code></li><li><code>1 &lt;= candidates[i] &lt;= 50</code></li><li><code>1 &lt;= target &lt;= 30</code></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å›æº¯+å‰ªæ</span></span><br><span class="line"><span class="comment"> * ç‰¹åˆ«æ³¨æ„ç›¸é‚»å…ƒç´ å»é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">    vector&lt;vector&lt;<span class="keyword">int</span>&gt;&gt; res;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; temp;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">backtrack</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; candidates, <span class="keyword">int</span> target, <span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target == <span class="number">0</span>)&#123;</span><br><span class="line">            res.<span class="built_in">push_back</span>(temp);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = index; i &lt; candidates.<span class="built_in">size</span>() &amp;&amp; target-candidates[i] &gt;= <span class="number">0</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//å»é‡</span></span><br><span class="line">            <span class="keyword">if</span>(i &gt; index &amp;&amp; candidates[i] == candidates[i<span class="number">-1</span>])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">//å¤„ç†èŠ‚ç‚¹</span></span><br><span class="line">            temp.<span class="built_in">push_back</span>(candidates[i]);</span><br><span class="line">            <span class="comment">//é€’å½’</span></span><br><span class="line">            <span class="built_in">backtrack</span>(candidates, target-candidates[i], i+<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//å›æº¯ï¼Œæ’¤é”€å¤„ç†ç»“æœ</span></span><br><span class="line">            temp.<span class="built_in">pop_back</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="keyword">int</span>&gt;&gt; <span class="built_in">combinationSum2</span>(vector&lt;<span class="keyword">int</span>&gt;&amp; candidates, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        <span class="comment">//å¯¹candidateså…ˆæ’åº</span></span><br><span class="line">        <span class="built_in">sort</span>(candidates.<span class="built_in">begin</span>(), candidates.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">backtrack</span>(candidates, target, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="è´ªå¿ƒ"><a href="#è´ªå¿ƒ" class="headerlink" title="è´ªå¿ƒ"></a>è´ªå¿ƒ</h1><h2 id="LC-122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II"><a href="#LC-122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II" class="headerlink" title="LC-122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II"></a><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/">LC-122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</a></h2><p>éš¾åº¦ç®€å•1290æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡æ¥æ”¶åŠ¨æ€åé¦ˆ</p><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>prices</code> ï¼Œå…¶ä¸­ <code>prices[i]</code> æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ <code>i</code> å¤©çš„ä»·æ ¼ã€‚</p><p>è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: prices = [7,1,5,3,6,4]</span><br><span class="line">è¾“å‡º: 7</span><br><span class="line">è§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚</span><br><span class="line">     éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6-3 = 3 ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: prices = [1,2,3,4,5]</span><br><span class="line">è¾“å‡º: 4</span><br><span class="line">è§£é‡Š: åœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚</span><br><span class="line">     æ³¨æ„ä½ ä¸èƒ½åœ¨ç¬¬ 1 å¤©å’Œç¬¬ 2 å¤©æ¥è¿è´­ä¹°è‚¡ç¥¨ï¼Œä¹‹åå†å°†å®ƒä»¬å–å‡ºã€‚å› ä¸ºè¿™æ ·å±äºåŒæ—¶å‚ä¸äº†å¤šç¬”äº¤æ˜“ï¼Œä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: prices = [7,6,4,3,1]</span><br><span class="line">è¾“å‡º: 0</span><br><span class="line">è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= prices.length &lt;= 3 * 10^4</code></li><li><code>0 &lt;= prices[i] &lt;= 10^4</code></li></ul><h2 id="pa-9-å¥—å¨ƒ"><a href="#pa-9-å¥—å¨ƒ" class="headerlink" title="pa-9.å¥—å¨ƒ"></a><a href="https://www.papamelon.com/problem/9">pa-9.å¥—å¨ƒ</a></h2><p>å°æ£’ç“œç“œæœ‰ nä¸ªå¥—å¨ƒï¼Œè®¾ç¬¬ iä¸ªå¥—å¨ƒçš„ä½“ç§¯ä¸ºv_iï¼Œå¤§å¥—å¨ƒå¯ä»¥å¥—ä½å°å¥—å¨ƒï¼ŒåŒæ—¶è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>ä¸€ä¸ªå¤§å¥—å¨ƒæƒ³è¦å¥—ä½å¦ä¸€ä¸ªå°å¥—å¨ƒï¼Œä½“ç§¯è‡³å°‘æ˜¯å…¶ 3 å€ï¼›ä¾‹å¦‚å¤§å¥—å¨ƒä½“ç§¯ä¸º 10ï¼Œå°å¥—å¨ƒä½“ç§¯ä¸º 3ï¼Œå‰è€…æ˜¯åè€…çš„ 3.333â€¦ å€ï¼Œå¯ä»¥å¥—ä½</li><li>ä¸€ä¸ªå¤§å¥—å¨ƒåªèƒ½å¥—ä½ä¸€ä¸ªå°å¥—å¨ƒï¼Œä¸€æ—¦å¥—ä½åï¼Œå°å¥—å¨ƒä¸èƒ½å†å¥—å…¶ä»–æ›´å°çš„å¥—å¨ƒï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ç»§ç»­åµŒå¥—ä¸‹å»</li><li>å½“å¤§å¥—å¨ƒå¥—ä½å°å¥—å¨ƒåï¼Œå°å¥—å¨ƒä¸å†å¯è§</li></ul><p>ç°åœ¨æˆ‘ä»¬è¦å¸®å°æ£’ç“œç“œé€‰æ‹©ä¸€ç§æœ€ä¼˜çš„å¥—å¨ƒæ–¹æ¡ˆï¼Œä½¿å¾—æœ€ç»ˆå¯è§çš„å¥—å¨ƒæ•°é‡æœ€å°‘ã€‚</p><p>è¾“å…¥</p><ul><li>ç¬¬ä¸€è¡Œè¾“å…¥æ•´æ•° T,  1 &lt;= T &lt;=1000ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ Tç»„æ•°æ®</li><li>æ¥ä¸‹æ¥æœ‰ Tè¡Œï¼Œæ¯è¡Œè¡¨ç¤ºä¸€ç»„å¥—å¨ƒçš„ä¿¡æ¯</li><li>å¯¹äºæ¯ç»„å¥—å¨ƒï¼Œç¬¬ä¸€ä¸ªæ•´æ•°æ˜¯ nï¼Œè¡¨ç¤ºå¥—å¨ƒæ•°é‡ï¼Œ1 &lt;= n &lt;= 600ï¼›åé¢è·Ÿç€ nä¸ªæ­£æ•´æ•°ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œè¡¨ç¤ºæ¯ä¸ªå¥—å¨ƒçš„ä½“ç§¯ï¼Œç¬¬ iä¸ªæ•´æ•°ä¸º v_i, 1 &lt;= v_i &lt;= 10000â€‹</li></ul><p>è¾“å‡º</p><ul><li>è¾“å‡º Tè¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º Tç»„å¥—å¨ƒç»è¿‡æ“ä½œï¼Œå¯è§å¥—å¨ƒçš„æœ€å°æ•°é‡</li></ul><p>æ ·ä¾‹ 1</p><p><strong>è¾“å…¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">3 1 3 7</span><br><span class="line">3 1 2 3</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡º</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">2</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  |-----------------|------------------|</span></span><br><span class="line"><span class="comment"> * a[0]              a[n/2]             a[n-1]</span></span><br><span class="line"><span class="comment"> * æ ¹æ®æ¡ä»¶2ï¼Œä¸€ä¸ªå¤§å¨ƒåªèƒ½å¥—ä¸€ä¸ªå°å¨ƒï¼Œæ‰€ä»¥æœ€ç»ˆå¯è§å¥—å¨ƒæ•°é‡æœ€å°‘ä¸º n/2</span></span><br><span class="line"><span class="comment"> * æ‰€ä»¥å°å¨ƒåœ¨å‰åŠéƒ¨åˆ†ï¼Œå¤§å¨ƒåœ¨ååŠéƒ¨åˆ†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> T, n;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; a;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n ;</span><br><span class="line">    a.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="keyword">int</span> tmp;</span><br><span class="line">        cin&gt;&gt;tmp;</span><br><span class="line">        a.<span class="built_in">push_back</span>(tmp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(a.<span class="built_in">begin</span>(),a.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>, j=n/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> res = n;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(i&lt;n/<span class="number">2</span> &amp;&amp; j&lt;n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[j]/a[i] &gt;=<span class="number">3</span>)&#123;</span><br><span class="line">            res--;</span><br><span class="line">            i++;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;<span class="keyword">else</span> j++;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span>(T--) <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-18-å¥—å¨ƒII"><a href="#pa-18-å¥—å¨ƒII" class="headerlink" title="pa-18.å¥—å¨ƒII"></a><a href="https://www.papamelon.com/problem/18">pa-18.å¥—å¨ƒII</a></h2><p>å°æ£’ç“œç“œåœ¨ç¬¬ä¸€æ¬¡å¾—åˆ° <a href="https://www.papamelon.com/problem/9">å¥—å¨ƒ</a> ç©å…·åï¼Œå–œæ¬¢ä¸Šäº†è¿™ç§ç©å…·ï¼Œè¿™æ¬¡ä»–å‡†å¤‡ç”¨è¡Œæç®±ä¸Šå¸¦ç€å¥—å¨ƒå»æ—…æ¸¸ã€‚</p><p>ç°åœ¨æœ‰ nä¸ªå¥—å¨ƒï¼Œè®¾ç¬¬ i ä¸ªå¥—å¨ƒçš„ä½“ç§¯ä¸º v_iï¼Œå¤§å¥—å¨ƒå¯ä»¥å¥—ä½å°å¥—å¨ƒï¼ŒåŒæ—¶è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>ä¸€ä¸ªå¤§å¥—å¨ƒæƒ³è¦å¥—ä½å¦ä¸€ä¸ªå°å¥—å¨ƒï¼Œä½“ç§¯è‡³å°‘æ˜¯å…¶ 33 å€ï¼›ä¾‹å¦‚å¤§å¥—å¨ƒä½“ç§¯ä¸º 10ï¼Œå°å¥—å¨ƒä½“ç§¯ä¸º 3ï¼Œå‰è€…æ˜¯åè€…çš„ 3.333â€¦ å€ï¼Œå¯ä»¥å¥—ä½</li><li>ä¸€ä¸ªå¤§å¥—å¨ƒåªèƒ½å¥—ä½ä¸€ä¸ªå°å¥—å¨ƒï¼Œä¸€æ—¦å¥—ä½åï¼Œå°å¥—å¨ƒä¸èƒ½å†å¥—å…¶ä»–æ›´å°çš„å¥—å¨ƒï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ç»§ç»­åµŒå¥—ä¸‹å»</li><li>å½“å¤§å¥—å¨ƒå¥—ä½å°å¥—å¨ƒåï¼Œä¸¤è€…çš„ä½“ç§¯å°±æ˜¯å¤§å¥—å¨ƒçš„ä½“ç§¯</li></ul><p>å°æ£’ç“œç“œæœ‰ä¸€ä¸ªè¡Œæç®±ï¼Œå®ƒçš„å®¹ç§¯æ˜¯ Cï¼Œå¸Œæœ›èƒ½ç”¨è¡Œæç®±è£…ä¸‹ <strong>æœ€å¤šæ•°é‡</strong> çš„å¥—å¨ƒï¼Œåœ¨èƒ½è£…ä¸‹æœ€å¤šå¥—å¨ƒçš„æƒ…å†µä¸‹ï¼Œé€‰æ‹© <strong>å ç”¨ç©ºé—´æœ€å°</strong> çš„æ–¹æ¡ˆã€‚</p><p>æ¥çœ‹ä¸€ä¸‹å®é™…çš„ä¾‹å­ï¼š</p><p>æœ‰ 66 ä¸ªå¥—å¨ƒï¼Œå®ƒä»¬çš„ä½“ç§¯åˆ†åˆ«ä¸º[1,3,4,3,12,10]ï¼Œè¡Œæç®±çš„å®¹ç§¯ä¸º 16</p><p> <strong>ç¬¬ä¸€ç§æ–¹æ¡ˆ</strong></p><ul><li>ç¬¬ä¸‰ä¸ªå¥—å¨ƒèƒ½å¥—ä½ç¬¬ä¸€ä¸ªå¥—å¨ƒï¼Œå¥—ä½åä¸¤è€…ä½“ç§¯ä¸º 4</li><li>ç¬¬äº”ä¸ªå¥—å¨ƒèƒ½å¥—ä½ç¬¬äºŒä¸ªå¥—å¨ƒï¼Œå¥—ä½åä¸¤è€…ä½“ç§¯ä¸º 12</li><li>æœ€ç»ˆé€‰æ‹© 4 ä¸ªå¥—å¨ƒï¼Œæ€»ä½“ç§¯ä¸º 16</li></ul><p> <strong>ç¬¬äºŒç§æ–¹æ¡ˆ</strong></p><ul><li>ç¬¬äºŒä¸ªå¥—å¨ƒèƒ½å¥—ä½ç¬¬ä¸€ä¸ªå¥—å¨ƒï¼Œå¥—ä½åä¸¤è€…ä½“ç§¯ä¸º 3</li><li>ç¬¬å…­ä¸ªå¥—å¨ƒèƒ½å¥—ä½ç¬¬å››ä¸ªå¥—å¨ƒï¼Œå¥—ä½åä¸¤è€…ä½“ç§¯ä¸º 10</li><li>æœ€ç»ˆé€‰æ‹© 4 ä¸ªå¥—å¨ƒï¼Œæ€»ä½“ç§¯ä¸º 13</li></ul><p><strong>ç¬¬ä¸‰ç§æ–¹æ¡ˆ</strong></p><ul><li>ç¬¬äºŒä¸ªå¥—å¨ƒèƒ½å¥—ä½ç¬¬ä¸€ä¸ªå¥—å¨ƒï¼Œå¥—ä½åä¸¤è€…ä½“ç§¯ä¸º 3</li><li>å†é€‰æ‹©ç¬¬ä¸‰ï¼Œå››ä¸ªå¥—å¨ƒï¼Œå®ƒä»¬ä¸¤ä¸ªä¸å¥—ä½å…¶ä»–çš„ä»»ä½•å¥—å¨ƒï¼Œä¹Ÿä¸è¢«åˆ«äººå¥—ä½ï¼Œå…±å ç”¨ä½“ç§¯ 7</li><li>æœ€ç»ˆé€‰æ‹© 4 ä¸ªå¥—å¨ƒï¼Œæ€»ä½“ç§¯ä¸º 10</li></ul><p>ä¸Šè¿°æ–¹æ¡ˆèƒ½å¸¦èµ°çš„å¥—å¨ƒæ•°é‡æ˜¯æœ€å¤šçš„ï¼Œè€Œç¬¬ä¸‰ç§æ–¹æ¡ˆå ç”¨ç©ºé—´æ›´å°ï¼Œé€‰æ‹©ç¬¬ä¸‰ç§æ–¹æ¡ˆã€‚</p><p> <strong>è¾“å…¥</strong></p><ul><li><p>ç¬¬ä¸€è¡Œè¾“å…¥æ•´æ•° T, ,1â‰¤ T â‰¤100ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ T ç»„æ•°æ®</p></li><li><p>æ¥ä¸‹æ¥æœ‰ T è¡Œï¼Œæ¯è¡Œè¡¨ç¤ºå¥—å¨ƒå’Œè¡Œæç®±çš„ä¿¡æ¯</p><ul><li>ç¬¬ä¸€ä¸ªæ•´æ•°æ˜¯ n, 1â‰¤ n â‰¤12ï¼Œè¡¨ç¤ºå¥—å¨ƒæ•°é‡</li><li>ç¬¬äºŒä¸ªæ•´æ•°ä¸º C, 1â‰¤ C â‰¤105ï¼Œè¡¨ç¤ºè¡Œæç®±å®¹ç§¯</li><li>åé¢è·Ÿç€ nä¸ªæ­£æ•´æ•°ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œè¡¨ç¤ºæ¯ä¸ªå¥—å¨ƒçš„ä½“ç§¯ï¼Œç¬¬ i ä¸ªæ•´æ•°ä¸º v_i, 1â‰¤ vi â‰¤10000</li></ul></li></ul><p> <strong>è¾“å‡º</strong></p><ul><li>è¾“å‡º T è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤šèƒ½å¸¦èµ°å¤šå°‘ä¸ªå¥—å¨ƒï¼Œä»¥åŠä¿è¯å¥—å¨ƒæ•°é‡æœ€å¤šçš„æƒ…å†µä¸‹ï¼Œå ç”¨çš„æœ€å°ç©ºé—´</li></ul><p>æ ·ä¾‹ 1</p><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">6 16 1 3 4 3 12 10</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 10</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 1. äºŒè¿›åˆ¶æšä¸¾å¤–éƒ¨å¥—å¨ƒ</span></span><br><span class="line"><span class="comment"> * 2. æšä¸¾æœªé€‰ä¸­çš„å¥—å¨ƒ</span></span><br><span class="line"><span class="comment"> * 3. åŒæŒ‡é’ˆå¾—å‡ºæœ€å°ä½“ç§¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> T, n, C;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; C;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">a</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;++i)  cin &gt;&gt; a[i] ;</span><br><span class="line">    <span class="built_in">sort</span>(a.<span class="built_in">begin</span>(),a.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> maxcount=<span class="number">0</span>, mincap=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> maxstate = <span class="number">1</span>&lt;&lt;n;  <span class="comment">// 2^næ–¹ç§çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼€å§‹çŠ¶æ€å‹ç¼©æšä¸¾, æšä¸¾ 2^næ–¹ç§çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> s=<span class="number">0</span>; s&lt;maxstate; ++s)&#123;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; b;</span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">bool</span>&gt; <span class="title">visted</span><span class="params">(n, <span class="literal">false</span>)</span></span>;</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>, cap=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>( (s&gt;&gt;i) &amp; <span class="number">1</span> )&#123; <span class="comment">//ç¬¬ i ä¸ªå¤–å›´å¥—å¨ƒè¢«é€‰ä¸­</span></span><br><span class="line">                b.<span class="built_in">push_back</span>(i);</span><br><span class="line">                count++;</span><br><span class="line">                cap += a[i];</span><br><span class="line">                visted[i] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(cap &gt; C) <span class="keyword">continue</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>; i&lt;n &amp;&amp; j&lt;b.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!visted[i])&#123;</span><br><span class="line">                <span class="comment">//ä»æœªè¢«é€‰ä¸­çš„å¥—å¨ƒé‡Œé¢ä¾æ¬¡åˆ¤æ–­æ˜¯å¦å¯ä»¥æ”¾å…¥å¤–å›´å¥—å¨ƒä¸­</span></span><br><span class="line">                <span class="keyword">while</span>( j&lt;b.<span class="built_in">size</span>() &amp;&amp; a[i]*<span class="number">3</span> &gt; a[b[j]]) j++;</span><br><span class="line">                <span class="keyword">if</span>( j&lt;b.<span class="built_in">size</span>())  count++, j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ›´æ–°ç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span>(count &gt; maxcount || (count==maxcount &amp;&amp; cap &lt; mincap))&#123;</span><br><span class="line">                maxcount = count;</span><br><span class="line">                mincap = cap;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(maxcout==<span class="number">0</span>)  mincap=<span class="number">0</span>; <span class="comment">//ç‰¹ä¾‹è¾“å‡º</span></span><br><span class="line">    cout &lt;&lt; maxcount &lt;&lt; <span class="string">&quot;ã€€&quot;</span> &lt;&lt; mincap &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span>(T--) <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="DFS-BFS"><a href="#DFS-BFS" class="headerlink" title="DFS/BFS"></a>DFS/BFS</h1><h1 id="åŠ¨æ€è§„åˆ’DP"><a href="#åŠ¨æ€è§„åˆ’DP" class="headerlink" title="åŠ¨æ€è§„åˆ’DP"></a>åŠ¨æ€è§„åˆ’DP</h1><h2 id="LC-5-æœ€é•¿å›æ–‡å­ä¸²"><a href="#LC-5-æœ€é•¿å›æ–‡å­ä¸²" class="headerlink" title="LC-5. æœ€é•¿å›æ–‡å­ä¸²"></a><a href="https://leetcode-cn.com/problems/longest-palindromic-substring/">LC-5. æœ€é•¿å›æ–‡å­ä¸²</a></h2><p>éš¾åº¦ä¸­ç­‰3874æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡æ¥æ”¶åŠ¨æ€åé¦ˆ</p><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œæ‰¾åˆ° <code>s</code> ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;babad&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;bab&quot;</span><br><span class="line">è§£é‡Šï¼š&quot;aba&quot; åŒæ ·æ˜¯ç¬¦åˆé¢˜æ„çš„ç­”æ¡ˆã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;cbbd&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;bb&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;a&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;a&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;ac&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;a&quot;</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><p><code>1 &lt;= s.length &lt;= 1000</code></p></li><li><p><code>s</code> ä»…ç”±æ•°å­—å’Œè‹±æ–‡å­—æ¯ï¼ˆå¤§å†™å’Œ/æˆ–å°å†™ï¼‰ç»„æˆ</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ï¼ˆä¸€ï¼‰ä¸­å¿ƒæ‰©å±•æ³•</span></span><br><span class="line"><span class="comment"> * ç”±äºå›æ–‡ä¸²çš„é•¿åº¦å¯å¥‡å¯å¶ï¼Œæ¯”å¦‚ â€œbobâ€ æ˜¯å¥‡æ•°å½¢å¼çš„å›æ–‡ï¼Œâ€noonâ€ å°±æ˜¯å¶æ•°å½¢å¼çš„å›æ–‡ï¼Œ</span></span><br><span class="line"><span class="comment"> * ä¸¤ç§å½¢å¼çš„å›æ–‡éƒ½è¦æœç´¢ï¼Œå¯¹äºå¥‡æ•°å½¢å¼çš„ï¼Œæˆ‘ä»¬å°±ä»éå†åˆ°çš„ä½ç½®ä¸ºä¸­å¿ƒï¼Œå‘ä¸¤è¾¹è¿›è¡Œæ‰©æ•£ï¼Œ</span></span><br><span class="line"><span class="comment"> * å¯¹äºå¶æ•°æƒ…å†µï¼Œæˆ‘ä»¬å°±æŠŠå½“å‰ä½ç½®å’Œä¸‹ä¸€ä¸ªä½ç½®å½“ä½œå¶æ•°è¡Œå›æ–‡çš„æœ€ä¸­é—´ä¸¤ä¸ªå­—ç¬¦ï¼Œç„¶åå‘ä¸¤è¾¹è¿›è¡Œæœç´¢</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">longestPalindrome</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len=s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(len &lt; <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        <span class="keyword">int</span> start=<span class="number">0</span>;    <span class="comment">//è®°å½•å›æ–‡å­ä¸²èµ·å§‹ä½ç½®</span></span><br><span class="line">        <span class="keyword">int</span> end=<span class="number">0</span>;      <span class="comment">//è®°å½•å›æ–‡å­ä¸²ç»ˆæ­¢ä½ç½®</span></span><br><span class="line">        <span class="keyword">int</span> mlen=<span class="number">0</span>;     <span class="comment">//è®°å½•æœ€å¤§å›æ–‡å­ä¸²çš„é•¿åº¦</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> len1=<span class="built_in">expendaroundcenter</span>(s,i,i);     <span class="comment">//ä¸€ä¸ªå…ƒç´ ä¸ºä¸­å¿ƒ</span></span><br><span class="line">            <span class="keyword">int</span> len2=<span class="built_in">expendaroundcenter</span>(s,i,i+<span class="number">1</span>);   <span class="comment">//ä¸¤ä¸ªå…ƒç´ ä¸ºä¸­å¿ƒ</span></span><br><span class="line">            mlen=<span class="built_in">max</span>(<span class="built_in">max</span>(len1,len2),mlen);</span><br><span class="line">            <span class="keyword">if</span>(mlen&gt;end-start+<span class="number">1</span>)&#123;</span><br><span class="line">                start=i-(mlen<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">                end=i+mlen/<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">substr</span>(start,mlen);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">expendaroundcenter</span><span class="params">(string s,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">        <span class="comment">//è®¡ç®—ä»¥leftå’Œrightä¸ºä¸­å¿ƒçš„å›æ–‡ä¸²é•¿åº¦</span></span><br><span class="line">        <span class="keyword">int</span> L=left;</span><br><span class="line">        <span class="keyword">int</span> R=right;</span><br><span class="line">        <span class="keyword">while</span>(L&gt;=<span class="number">0</span> &amp;&amp; R&lt;s.<span class="built_in">length</span>() &amp;&amp; s[R]==s[L])&#123;</span><br><span class="line">            L--;</span><br><span class="line">            R++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R-L<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ï¼ˆä¸€ï¼‰ä¸­å¿ƒæ‰©å±•æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//ä»¥ s[left] s[right] ä¸ºä¸­å¿ƒå‘ä¸¤ç«¯æ‰©æ•£çš„å›æ–‡ä¸²</span></span><br><span class="line">    <span class="function">string <span class="title">expendaroundcenter</span><span class="params">(string &amp;s, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">        <span class="comment">//é˜²æ­¢ç´¢å¼•è¶Šç•Œ</span></span><br><span class="line">        <span class="keyword">while</span>(left&gt;=<span class="number">0</span>&amp;&amp;right&lt;s.<span class="built_in">size</span>()&amp;&amp;s[left]==s[right])&#123;</span><br><span class="line">            left--;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">substr</span>(left+<span class="number">1</span>,right-left<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">longestPalindrome</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        string res;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            string s1=<span class="built_in">expendaroundcenter</span>(s,i,i);</span><br><span class="line">            string s2=<span class="built_in">expendaroundcenter</span>(s,i,i+<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//res=longest(res,s1,s1)</span></span><br><span class="line">            res=res.<span class="built_in">size</span>()&gt;s1.<span class="built_in">size</span>()?res:s1;</span><br><span class="line">            res=res.<span class="built_in">size</span>()&gt;s2.<span class="built_in">size</span>()?res:s2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ï¼ˆäºŒï¼‰åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="comment"> * 1.ç¡®å®šdpæ•°ç»„ï¼ˆdp tableï¼‰ä»¥åŠä¸‹æ ‡çš„å«ä¹‰</span></span><br><span class="line"><span class="comment"> * 2.ç¡®å®šé€’æ¨å…¬å¼</span></span><br><span class="line"><span class="comment"> * 3.dpæ•°ç»„å¦‚ä½•åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * 4.ç¡®å®šéå†é¡ºåº</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * åœ¨ç¡®å®šé€’æ¨å…¬å¼æ—¶ï¼Œå°±è¦åˆ†æå¦‚ä¸‹å‡ ç§æƒ…å†µã€‚</span></span><br><span class="line"><span class="comment"> * æ•´ä½“ä¸Šæ˜¯ä¸¤ç§ï¼Œå°±æ˜¯s[i]ä¸s[j]ç›¸ç­‰ï¼Œs[i]ä¸s[j]ä¸ç›¸ç­‰è¿™ä¸¤ç§ã€‚</span></span><br><span class="line"><span class="comment"> * å½“s[i]ä¸s[j]ä¸ç›¸ç­‰ï¼Œé‚£æ²¡å•¥å¥½è¯´çš„äº†ï¼Œdp[i][j]ä¸€å®šæ˜¯falseã€‚</span></span><br><span class="line"><span class="comment"> * å½“s[i]ä¸s[j]ç›¸ç­‰æ—¶ï¼Œè¿™å°±å¤æ‚ä¸€äº›äº†ï¼Œåˆæœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µ</span></span><br><span class="line"><span class="comment"> *  æƒ…å†µä¸€ï¼šä¸‹æ ‡i ä¸ jç›¸åŒï¼ŒåŒä¸€ä¸ªå­—ç¬¦ä¾‹å¦‚aï¼Œå½“ç„¶æ˜¯å›æ–‡å­ä¸²</span></span><br><span class="line"><span class="comment"> *  æƒ…å†µäºŒï¼šä¸‹æ ‡i ä¸ jç›¸å·®ä¸º1ï¼Œä¾‹å¦‚aaï¼Œä¹Ÿæ˜¯å›æ–‡å­ä¸²</span></span><br><span class="line"><span class="comment"> *  æƒ…å†µä¸‰ï¼šä¸‹æ ‡ï¼ši ä¸ jç›¸å·®å¤§äº1çš„æ—¶å€™ï¼Œä¾‹å¦‚cabacï¼Œæ­¤æ—¶s[i]ä¸s[j]å·²ç»ç›¸åŒäº†ï¼Œ</span></span><br><span class="line"><span class="comment"> *  æˆ‘ä»¬çœ‹iåˆ°jåŒºé—´æ˜¯ä¸æ˜¯å›æ–‡å­ä¸²å°±çœ‹abaæ˜¯ä¸æ˜¯å›æ–‡å°±å¯ä»¥äº†ï¼Œé‚£ä¹ˆabaçš„åŒºé—´å°±æ˜¯ i+1 ä¸ j-1åŒºé—´ï¼Œ</span></span><br><span class="line"><span class="comment"> *  è¿™ä¸ªåŒºé—´æ˜¯ä¸æ˜¯å›æ–‡å°±çœ‹dp[i + 1][j - 1]æ˜¯å¦ä¸ºtrueã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *     â€”â€” â€”â€” â€”â€” â€”â€” â€”  â€”â€” â€”â€” â€”â€” â€”â€”</span></span><br><span class="line"><span class="comment"> *    |             |            |</span></span><br><span class="line"><span class="comment"> *    |             |  dp[i][j]  |</span></span><br><span class="line"><span class="comment"> *    |             |            |</span></span><br><span class="line"><span class="comment"> *    |             |            |</span></span><br><span class="line"><span class="comment"> *     â€”â€” â€”â€” â€”â€” â€”â€” â€”  â€”â€” â€”â€” â€”â€” â€”â€”</span></span><br><span class="line"><span class="comment"> *    |             |            |</span></span><br><span class="line"><span class="comment"> *    |dp[i+1][j-1] |            |</span></span><br><span class="line"><span class="comment"> *    |             |            |</span></span><br><span class="line"><span class="comment"> *    |             |            |</span></span><br><span class="line"><span class="comment"> *     â€”â€” â€”â€” â€”â€” â€”â€” â€”  â€”â€” â€”â€” â€”â€” â€”â€”</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æœ¬é¢˜ç›®æ˜¯å°‘æœ‰çš„åŠ¨æ€è§„åˆ’éæœ€ä¼˜è§£çš„é—®é¢˜ ï¼ˆæ—¶é—´ O(n^2) ï¼ç©ºé—´O(n^2)ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">longestPalindrome</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¸ƒå°”ç±»å‹çš„dp[i][j]ï¼šè¡¨ç¤ºåŒºé—´èŒƒå›´[i,j] ï¼ˆæ³¨æ„æ˜¯å·¦é—­å³é—­ï¼‰çš„å­ä¸²æ˜¯å¦æ˜¯å›æ–‡å­ä¸²ï¼Œ</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯dp[i][j]ä¸ºtrueï¼Œå¦åˆ™ä¸ºfalseã€‚</span></span><br><span class="line">        vector&lt;vector&lt;<span class="keyword">int</span>&gt;&gt; <span class="built_in">dp</span>(s.<span class="built_in">size</span>(), vector&lt;<span class="keyword">int</span>&gt;(s.<span class="built_in">size</span>(), <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">int</span> maxlenth = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// dp[i][j]ç”±dp[i+1][j-1]ç¡®å®šï¼Œå› æ­¤ä»å·¦ä¸‹å‘å³ä¸Šéå†</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = s.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; s.<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s[i] == s[j]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (j - i &lt;= <span class="number">1</span>) &#123;    <span class="comment">// æƒ…å†µä¸€ å’Œ æƒ…å†µäºŒ</span></span><br><span class="line">                        dp[i][j] = <span class="literal">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dp[i + <span class="number">1</span>][j - <span class="number">1</span>]) &#123; <span class="comment">// æƒ…å†µä¸‰</span></span><br><span class="line">                        dp[i][j] = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (dp[i][j] &amp;&amp; j - i + <span class="number">1</span> &gt; maxlenth) &#123;</span><br><span class="line">                    maxlenth = j - i + <span class="number">1</span>;</span><br><span class="line">                    left = i;</span><br><span class="line">                    right = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">substr</span>(left, right - left + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥ä¸Šä»£ç æ˜¯ä¸ºäº†å‡¸æ˜¾æƒ…å†µä¸€äºŒä¸‰ï¼Œå½“ç„¶æ˜¯å¯ä»¥ç®€æ´ä¸€ä¸‹çš„</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">longestPalindrome</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="keyword">int</span>&gt;&gt; <span class="built_in">dp</span>(s.<span class="built_in">size</span>(), vector&lt;<span class="keyword">int</span>&gt;(s.<span class="built_in">size</span>(), <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">int</span> maxlenth = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = s.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; s.<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s[i] == s[j] &amp;&amp; (j - i &lt;= <span class="number">1</span> || dp[i + <span class="number">1</span>][j - <span class="number">1</span>])) &#123;</span><br><span class="line">                    dp[i][j] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (dp[i][j] &amp;&amp; j - i + <span class="number">1</span> &gt; maxlenth) &#123;</span><br><span class="line">                    maxlenth = j - i + <span class="number">1</span>;</span><br><span class="line">                    left = i;</span><br><span class="line">                    right = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">substr</span>(left, maxlenth);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="é«˜é¢‘é¢è¯•ç³»åˆ—"><a href="#é«˜é¢‘é¢è¯•ç³»åˆ—" class="headerlink" title="é«˜é¢‘é¢è¯•ç³»åˆ—"></a>é«˜é¢‘é¢è¯•ç³»åˆ—</h1><h2 id="å¯»æ‰¾ç´ æ•°"><a href="#å¯»æ‰¾ç´ æ•°" class="headerlink" title="å¯»æ‰¾ç´ æ•°"></a>å¯»æ‰¾ç´ æ•°</h2><p> <a href="https://leetcode-cn.com/problems/count-primes/">LC-204. è®¡æ•°è´¨æ•°</a></p><p>ç»Ÿè®¡æ‰€æœ‰å°äºéè´Ÿæ•´æ•° <em>n</em> çš„è´¨æ•°çš„æ•°é‡ã€‚[å¦‚æœâ¼€ä¸ªæ•°å¦‚æœåªèƒ½è¢« 1 å’Œå®ƒæœ¬â¾æ•´é™¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯ç´ æ•°]</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 10</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼šå°äº 10 çš„è´¨æ•°ä¸€å…±æœ‰ 4 ä¸ª, å®ƒä»¬æ˜¯ 2, 3, 5, 7 ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 0</span><br><span class="line">è¾“å‡ºï¼š0</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 1</span><br><span class="line">è¾“å‡ºï¼š0</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>0 &lt;= n &lt;= 5 * 10^6</code></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Eratosthenesç­›é€‰æ³•</span></span><br><span class="line"><span class="comment"> * ä»2å¼€å§‹éå†åˆ°n</span></span><br><span class="line"><span class="comment"> * i=2,å¹¶æ’é™¤2çš„å€æ•°</span></span><br><span class="line"><span class="comment"> * i=3,å¹¶æ’é™¤3çš„å€æ•°</span></span><br><span class="line"><span class="comment"> * i=5,å¹¶æ’é™¤5çš„å€æ•°</span></span><br><span class="line"><span class="comment"> * ã€‚ã€‚ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countPrimes</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//åˆå§‹é»˜è®¤æ‰€æœ‰æ•°ä¸ºè´¨æ•°</span></span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">bool</span>&gt; <span class="title">res</span><span class="params">(n, <span class="literal">true</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res[i]) &#123;</span><br><span class="line">                count++;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span> * i; j &lt; n; j += i) &#123;</span><br><span class="line">                    <span class="comment">//æ’é™¤içš„å€æ•°</span></span><br><span class="line">                    res[j] = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å¹‚è¿ç®—"><a href="#æ¨¡å¹‚è¿ç®—" class="headerlink" title="æ¨¡å¹‚è¿ç®—"></a>æ¨¡å¹‚è¿ç®—</h2><p><a href="https://leetcode-cn.com/problems/super-pow/">LC-372. è¶…çº§æ¬¡æ–¹</a></p><p>ä½ çš„ä»»åŠ¡æ˜¯è®¡ç®— <code>ab</code> å¯¹ <code>1337</code> å–æ¨¡ï¼Œ<code>a</code> æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œ<code>b</code> æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ­£æ•´æ•°ä¸”ä¼šä»¥æ•°ç»„å½¢å¼ç»™å‡ºã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼ša = 2, b = [3]</span><br><span class="line">è¾“å‡ºï¼š8</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼ša = 2, b = [1,0]</span><br><span class="line">è¾“å‡ºï¼š1024</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼ša = 1, b = [4,3,3,8,5,2]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼ša = 2147483647, b = [2,0,0]</span><br><span class="line">è¾“å‡ºï¼š1198</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= a &lt;= 231 - 1</code></li><li><code>1 &lt;= b.length &lt;= 2000</code></li><li><code>0 &lt;= b[i] &lt;= 9</code></li><li><code>b</code> ä¸å«å‰å¯¼ 0</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€’å½’</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> mod = <span class="number">1337</span>;</span><br><span class="line">    <span class="comment">//æ±‚ a çš„ k æ¬¡æ–¹ï¼Œ å¯¹ mod å–ä½™</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">modPow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">        a %= mod;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; ++i)&#123;</span><br><span class="line">            res *= a;</span><br><span class="line">            res %= mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">superPow</span><span class="params">(<span class="keyword">int</span> a, vector&lt;<span class="keyword">int</span>&gt;&amp; b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (b.<span class="built_in">size</span>() == <span class="number">0</span>)  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> last = b.<span class="built_in">back</span>();</span><br><span class="line">        b.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="comment">// å°†åŸé—®é¢˜åŒ–ç®€ï¼Œç¼©å°è§„æ¨¡é€’å½’æ±‚è§£</span></span><br><span class="line">        <span class="keyword">int</span> part1 = <span class="built_in">modPow</span>(a, last);</span><br><span class="line">        <span class="keyword">int</span> part2 = <span class="built_in">modPow</span>(<span class="built_in">superPow</span>(a, b), <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// åˆå¹¶å‡ºç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> (part1 * part2)%mod;</span><br><span class="line">        <span class="comment">// return (modPow(a, last) * modPow(superPow(a, b), 10)) % mod;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¿«é€Ÿå¹‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> mod = <span class="number">1337</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">modPow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        a %= mod;</span><br><span class="line">        <span class="comment">// k æ˜¯å¥‡æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (k % <span class="number">2</span> == <span class="number">1</span>)  <span class="keyword">return</span> (a * <span class="built_in">modPow</span>(a, k - <span class="number">1</span>)) % mod;</span><br><span class="line">        <span class="keyword">else</span> &#123;<span class="comment">// k æ˜¯å¶æ•°</span></span><br><span class="line">            <span class="keyword">int</span> sub = <span class="built_in">modPow</span>(a, k / <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">return</span> (sub * sub) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">superPow</span><span class="params">(<span class="keyword">int</span> a, vector&lt;<span class="keyword">int</span>&gt;&amp; b)</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="pa-3-å¯»æ‰¾æœ€é å·¦çš„åŒ¹é…å­ä¸²-1"><a href="#pa-3-å¯»æ‰¾æœ€é å·¦çš„åŒ¹é…å­ä¸²-1" class="headerlink" title="pa-3.å¯»æ‰¾æœ€é å·¦çš„åŒ¹é…å­ä¸²"></a>pa-3.å¯»æ‰¾æœ€é å·¦çš„åŒ¹é…å­ä¸²</h2><p><a href="#%5Bpa-3.%E5%AF%BB%E6%89%BE%E6%9C%80%E9%9D%A0%E5%B7%A6%E7%9A%84%E5%8C%B9%E9%85%8D%E5%AD%90%E4%B8%B2%5D(https://www.papamelon.com/problem/3)">è·³è½¬</a></p><h2 id="pa-4-é•¿åº¦ä¸º-K-çš„å›æ–‡å­ä¸²"><a href="#pa-4-é•¿åº¦ä¸º-K-çš„å›æ–‡å­ä¸²" class="headerlink" title="pa-4.é•¿åº¦ä¸º K çš„å›æ–‡å­ä¸²"></a><a href="https://www.papamelon.com/problem/4">pa-4.é•¿åº¦ä¸º K çš„å›æ–‡å­ä¸²</a></h2><p><img src="/2021/02/21/Algorithm/pa-4.png" alt="pa-4"></p><p>æ ·ä¾‹ 1</p><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">6 3</span><br><span class="line">acdcxb</span><br><span class="line">6 5</span><br><span class="line">acdcxb</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">YES</span><br><span class="line">NO</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* æµ‹è¯•ç”¨ä¾‹ 20/22</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> n, k;</span><br><span class="line">string s;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(left&lt;right)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[left]!=s[right]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> left++,right--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i+k<span class="number">-1</span>&lt;n;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">check</span>(i,i+k<span class="number">-1</span>))&#123;</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;YES&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;NO&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--) &#123;</span><br><span class="line">        cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">        cin&gt;&gt;s;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;      </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å­—ç¬¦ä¸²å“ˆå¸Œ O(1)</span></span><br><span class="line"><span class="comment">* https://www.bilibili.com/video/BV1Tv41157YX?p=5</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> ull = <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100000</span>;</span><br><span class="line"><span class="keyword">char</span> s[N];</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">131</span>;</span><br><span class="line"></span><br><span class="line">ull p[N];           <span class="comment">//kçš„å¹‚æ¬¡</span></span><br><span class="line">ull h0[N], h1[N];   <span class="comment">// ä»å·¦åˆ°å³æ‰«æï¼Œç»´æŠ¤æ‰€æœ‰å‰ç¼€çš„æ˜ å°„å€¼ï¼ˆå“ˆå¸Œå€¼ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  p[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  h0[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    p[i] = p[i - <span class="number">1</span>] * P;</span><br><span class="line">    h0[i] = h0[i - <span class="number">1</span>] * P + s[i];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="comment">//idx å¯¹åº”çš„æ˜¯ s çš„ n - i + 1 ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">int</span> idx = n - i + <span class="number">1</span>;</span><br><span class="line">    h1[i] = h1[i - <span class="number">1</span>] * P + s[idx];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ull <span class="title">query0</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123; <span class="keyword">return</span> h0[r] - h0[l - <span class="number">1</span>] * p[r - l + <span class="number">1</span>]; &#125;</span><br><span class="line"><span class="function">ull <span class="title">query1</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123; <span class="keyword">return</span> h1[r] - h1[l - <span class="number">1</span>] * p[r - l + <span class="number">1</span>]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">  cin&gt;&gt;s;</span><br><span class="line">  <span class="keyword">if</span> (m == <span class="number">1</span>) &#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;YES&quot;</span>&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">init</span>();   <span class="comment">//é¢„å¤„ç†å“ˆå¸Œå€¼ï¼Œå¹‚æ¬¡</span></span><br><span class="line">  <span class="comment">//æšä¸¾å›æ–‡ä¸²çš„å·¦ç«¯ç‚¹</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i + m - <span class="number">1</span> &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">int</span> half = m &gt;&gt; <span class="number">1</span>;   <span class="comment">//int half = m/2;</span></span><br><span class="line">    ull ret1 = <span class="built_in">query0</span>(i, i + half - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> l = n - (i + m - <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> r = n - (i + m - half) + <span class="number">1</span>;</span><br><span class="line">    ull ret2 = <span class="built_in">query1</span>(l, r);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ret1 == ret2) &#123;</span><br><span class="line">      cout&lt;&lt;<span class="string">&quot;YES&quot;</span>&lt;&lt;endl;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  cout&lt;&lt;<span class="string">&quot;NO&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  cin&gt;&gt;T;</span><br><span class="line">  <span class="keyword">while</span> (T--) <span class="built_in">solve</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-29-å›æ–‡å¹³æ–¹æ•°"><a href="#pa-29-å›æ–‡å¹³æ–¹æ•°" class="headerlink" title="pa-29.å›æ–‡å¹³æ–¹æ•°"></a><a href="https://www.papamelon.com/problem/29">pa-29.å›æ–‡å¹³æ–¹æ•°</a></h2><p>Palindromic Squares</p><p>å›æ–‡æ•°æ˜¯æŒ‡ä»å·¦å‘å³å¿µå’Œä»å³å‘å·¦å¿µéƒ½ä¸€æ ·çš„æ•°ã€‚å¦‚ 1232112321 å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å›æ–‡æ•°ã€‚</p><p>ç»™å®šä¸€ä¸ªç”¨åè¿›åˆ¶æ­£æ•´æ•° B<em>B</em>ï¼Œåœ¨ [1, 300]ä¸­å¯»æ‰¾æ‰€æœ‰ç‰¹æ®Šçš„æ•´æ•° <em>X</em>ï¼Œæ»¡è¶³ X^2ç”¨ Bè¿›åˆ¶è¡¨ç¤ºæ—¶æ˜¯å›æ–‡æ•°ã€‚</p><p>å…¶ä¸­ï¼Œ2â‰¤Bâ‰¤20ã€‚å¤§äº 9 çš„æ•°ï¼Œç”¨å­—æ¯è¡¨ç¤ºã€‚ä¾‹å¦‚ç”¨ Aè¡¨ç¤º 10ï¼ŒBè¡¨ç¤º 11ï¼Œç”¨ç¬¬ nä¸ªå¤§å†™å­—æ¯è¡¨ç¤º n+9ã€‚</p><p> è¾“å…¥</p><ul><li>è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•° B, 2â‰¤Bâ‰¤20</li></ul><p> è¾“å‡º</p><ul><li>è¾“å‡ºå¤šè¡Œï¼Œæ¯è¡Œåˆ†å·¦å³ä¸¤éƒ¨åˆ†ï¼Œç”¨ç©ºæ ¼éš”å¼€<ul><li>å·¦è¾¹çš„éƒ¨åˆ†æ˜¯ [1,300] å†…çš„ä¸€ä¸ªæ­£æ•´æ•° Xçš„ Bè¿›åˆ¶è¡¨ç¤º</li><li>å³è¾¹çš„éƒ¨åˆ†æ˜¯ X^2 çš„ Bè¿›åˆ¶è¡¨ç¤º</li></ul></li><li>è¾“å‡ºçš„æ•°æ®æŒ‰å·¦éƒ¨åˆ†çš„åè¿›åˆ¶å€¼ä»å°åˆ°å¤§æ’åº</li></ul><p>æ ·ä¾‹ 1</p><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1 1</span><br><span class="line">2 4</span><br><span class="line">3 9</span><br><span class="line">11 121</span><br><span class="line">22 484</span><br><span class="line">26 676</span><br><span class="line">101 10201</span><br><span class="line">111 12321</span><br><span class="line">121 14641</span><br><span class="line">202 40804</span><br><span class="line">212 44944</span><br><span class="line">264 69696</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åè¿›åˆ¶è½¬ K è¿›åˆ¶ï¼šçŸ­é™¤æ³•</span></span><br><span class="line"><span class="comment"> * å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªä¸æ–­æ¨¡ K é™¤ K çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œå°† 345 è½¬æˆ 6 è¿›åˆ¶æ•°</span></span><br><span class="line"><span class="comment"> * 346Ã·6=57...4</span></span><br><span class="line"><span class="comment"> * 57Ã·6=9...3</span></span><br><span class="line"><span class="comment"> * 9Ã·6=1...3</span></span><br><span class="line"><span class="comment"> * 1Ã·6=0...1</span></span><br><span class="line"><span class="comment"> * å½“å•†ç­‰äº 0 æ—¶ç®—æ³•åœæ­¢ï¼Œç„¶åæˆ‘ä»¬å°†ä½™æ•°é€†åºä¿å­˜ï¼Œå¾—åˆ° 1334ï¼Œè¿™å°±æ˜¯å¯¹åº”çš„ 6 è¿›åˆ¶è¡¨è¾¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> b;</span><br><span class="line"><span class="comment">//å›æ–‡ä¸²åˆ¤æ–­</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(vector&lt;<span class="keyword">char</span>&gt; s, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(left&lt;right)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[left]!=s[right]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> left++,right--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿›åˆ¶è½¬æ¢</span></span><br><span class="line"><span class="function">vector&lt;<span class="keyword">char</span>&gt; <span class="title">tobint</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="keyword">char</span>&gt; res;</span><br><span class="line">    <span class="keyword">while</span>(a)&#123;</span><br><span class="line">        <span class="keyword">int</span> tmp=a%b;</span><br><span class="line">        <span class="keyword">if</span>(tmp&gt;<span class="number">9</span>)&#123;</span><br><span class="line">            res.<span class="built_in">push_back</span>(<span class="string">&#x27;A&#x27;</span>+tmp<span class="number">-10</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">//intå¼ºè½¬char--&gt; char(intval+48)</span></span><br><span class="line">            res.<span class="built_in">push_back</span>(<span class="built_in"><span class="keyword">char</span></span>(tmp+<span class="number">48</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        a=a/b; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">reverse</span>(res.<span class="built_in">begin</span>(),res.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; b;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">300</span>;++i)&#123;</span><br><span class="line">        vector&lt;<span class="keyword">char</span>&gt; vec1=<span class="built_in">tobint</span>(i*i,b);</span><br><span class="line">        <span class="keyword">bool</span> flag=<span class="built_in">check</span>(vec1,<span class="number">0</span>,vec1.<span class="built_in">size</span>()<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            vector&lt;<span class="keyword">char</span>&gt; vec0=<span class="built_in">tobint</span>(i,b);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> it0=vec0.<span class="built_in">begin</span>();it0!=vec0.<span class="built_in">end</span>();++it0)&#123;</span><br><span class="line">                cout&lt;&lt;*it0;</span><br><span class="line">            &#125;</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> it1=vec1.<span class="built_in">begin</span>();it1!=vec1.<span class="built_in">end</span>();++it1)&#123;</span><br><span class="line">                cout&lt;&lt;*it1;</span><br><span class="line">            &#125;</span><br><span class="line">            cout&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-30-åŒé‡å›æ–‡æ•°"><a href="#pa-30-åŒé‡å›æ–‡æ•°" class="headerlink" title="pa-30.åŒé‡å›æ–‡æ•°"></a><a href="https://www.papamelon.com/problem/30/submissions">pa-30.åŒé‡å›æ–‡æ•°</a></h2><p>Dual Palindromes</p><p>ä»å·¦å¾€å³è¯»å’Œä»å³å¾€å·¦è¯»éƒ½ä¸€æ ·çš„æ•°å­—å«åš <strong>å›æ–‡æ•°</strong>ã€‚ä¾‹å¦‚ï¼Œ12321å°±æ˜¯ä¸€ä¸ªå›æ–‡æ•°ï¼Œè€Œ 77778 å°±ä¸æ˜¯ã€‚</p><p>å½“ç„¶ï¼Œå›æ–‡æ•°çš„é¦–å’Œå°¾éƒ½åº”æ˜¯éé›¶çš„ï¼Œå› æ­¤ 0220ä¸æ˜¯å›æ–‡æ•°ã€‚</p><p>æœ‰ä¸€äº›æ•°ï¼Œä¾‹å¦‚ 21ï¼Œåœ¨åè¿›åˆ¶æ—¶ä¸æ˜¯å›æ–‡æ•°ï¼Œä½†åœ¨å…¶å®ƒè¿›åˆ¶ï¼Œå¦‚äºŒè¿›åˆ¶æ—¶ä¸º 10101æ—¶æ˜¯å›æ–‡æ•°ã€‚</p><p>ç»™å®šä¸¤ä¸ªåè¿›åˆ¶æ•° n,sï¼Œç„¶åæ‰¾å‡ºå‰ nä¸ªæ»¡è¶³å¤§äº sä¸”åœ¨ä¸å°‘äºä¸¤ç§è¿›åˆ¶ï¼ˆäºŒè¿›åˆ¶è‡³åè¿›åˆ¶ï¼‰ä¸Šæ˜¯å›æ–‡æ•°çš„åè¿›åˆ¶æ•°ã€‚</p><p>æœ¬é—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¸éœ€è¦ä½¿ç”¨å¤§äº 32 ä½çš„æ•´å‹æ•°</p><p> è¾“å…¥</p><ul><li>åªæœ‰ä¸€è¡Œï¼Œç”¨ç©ºæ ¼éš”å¼€çš„ä¸¤ä¸ªæ­£æ•´æ•° n,s, 1â‰¤<em>n</em>â‰¤15,1â‰¤<em>s</em>â‰¤9999ã€‚</li></ul><p> è¾“å‡º</p><ul><li>nè¡Œ, æ¯è¡Œä¸€ä¸ªæ»¡è¶³ä¸Šè¿°è¦æ±‚çš„æ•°ï¼Œå¹¶æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºè¾“å‡ºã€‚</li></ul><p>æ ·ä¾‹ 1</p><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3 25</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä» s+1 å¼€å§‹æšä¸¾</span></span><br><span class="line"><span class="comment"> * å¯¹äºæ¯ä¸ªæ•°å­—ï¼Œä»äºŒè¿›åˆ¶åˆ°åè¿›åˆ¶æšä¸¾ï¼Œå°†è¯¥æ•°è½¬æ¢ä¸ºå¯¹åº”è¿›åˆ¶ä¸‹çš„å€¼ï¼Œå†çœ‹çœ‹è¿™ä¸ªå€¼æ˜¯å¦ä¸ºå›æ–‡æ•°</span></span><br><span class="line"><span class="comment"> * å¦‚æœæœ‰è‡³å°‘ä¸¤ä¸ªè¿›åˆ¶ä¸‹çš„å€¼æ˜¯å›æ–‡æ•°ï¼Œè¯¥æ•°å°±æ˜¯åŒé‡å›æ–‡æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, s;</span><br><span class="line"><span class="comment">//å›æ–‡ä¸²åˆ¤æ–­</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; s, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(left&lt;right)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[left]!=s[right]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> left++,right--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿›åˆ¶è½¬æ¢</span></span><br><span class="line"><span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">tobint</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">    <span class="keyword">while</span>(a)&#123;</span><br><span class="line">        res.<span class="built_in">push_back</span>(a%b);</span><br><span class="line">        a=a/b; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">reverse</span>(res.<span class="built_in">begin</span>(),res.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æš´åŠ›æšä¸¾</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=s+<span class="number">1</span>,k=<span class="number">0</span>;k&lt;n;++i)&#123;</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">2</span>; j&lt;=<span class="number">10</span>&amp;&amp;count&lt;<span class="number">2</span>; ++j)&#123;</span><br><span class="line">            vector&lt;<span class="keyword">int</span>&gt; vec = <span class="built_in">tobint</span>(i,j);</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">check</span>(vec, <span class="number">0</span>, vec.<span class="built_in">size</span>()<span class="number">-1</span>))  count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count==<span class="number">2</span>)&#123;</span><br><span class="line">            cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">            k++;</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; s;</span><br><span class="line">    <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-27-æŒ¤ç‰›å¥¶"><a href="#pa-27-æŒ¤ç‰›å¥¶" class="headerlink" title="pa-27.æŒ¤ç‰›å¥¶"></a><a href="https://www.papamelon.com/problem/27/submissions">pa-27.æŒ¤ç‰›å¥¶</a></h2><p>è¿™æ˜¯ä¸€ä¸ªå…³äºå†œå¤«å’Œå¥¶ç‰›çš„é—®é¢˜ï¼Œç›´æ¥æ¥çœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå†œæ°‘åœ¨ [300, 1000) ç§’ç»™å¥¶ç‰›æŒ¤å¥¶</li><li>ç¬¬äºŒä¸ªå†œæ°‘åœ¨ [700, 1200) ç§’ç»™å¥¶ç‰›æŒ¤å¥¶</li><li>ç¬¬ä¸‰ä¸ªå†œæ°‘åœ¨ [1500, 2100) ç§’ç»™å¥¶ç‰›æŒ¤å¥¶</li></ul><p>æœŸé—´æœ€é•¿çš„è‡³å°‘æœ‰ä¸€ä¸ªå†œæ°‘åœ¨æŒ¤å¥¶çš„è¿ç»­æ—¶é—´ä¸º 900 ç§’ (ä¹Ÿå°±æ˜¯ [300, 1200) ç§’)ã€‚</p><p>è€Œæœ€é•¿çš„æ— äººæŒ¤å¥¶çš„è¿ç»­æ—¶é—´ä¸º 300 ç§’ (ä¹Ÿå°±æ˜¯ [1200, 1500) ç§’)ã€‚</p><p>ä½ çš„ä»»åŠ¡æ˜¯ç¼–ä¸€ä¸ªç¨‹åºï¼Œè¯»å…¥ nä¸ªå†œæ°‘çš„å·¥ä½œæ—¶é—´åˆ—è¡¨ï¼Œè®¡ç®—ä»¥ä¸‹ä¸¤ç‚¹(å‡ä»¥ç§’ä¸ºå•ä½):</p><ul><li>æœ€é•¿è‡³å°‘æœ‰ä¸€äººåœ¨æŒ¤å¥¶çš„æ—¶é—´æ®µã€‚</li><li>æœ€é•¿çš„æ— äººæŒ¤å¥¶çš„æ—¶é—´æ®µã€‚ï¼ˆä»æœ‰äººæŒ¤å¥¶å¼€å§‹ç®—èµ·ï¼‰</li></ul><p> è¾“å…¥</p><ul><li>ç¬¬ä¸€è¡Œä¸€ä¸ªæ­£æ•´æ•° n, 1 â‰¤<em>n</em>â‰¤5000</li><li>æ¥ä¸‹æ¥ nè¡Œï¼Œæ¯è¡Œä¸¤ä¸ªéè´Ÿæ•´æ•° l,rï¼Œè¡¨ç¤ºä¸€ä¸ªå†œæ°‘çš„å·¥ä½œæ—¶é—´ã€‚</li></ul><p> è¾“å‡º</p><ul><li>ä¸€è¡Œï¼Œä¸¤ä¸ªæ•´æ•°ï¼Œå³é¢˜ç›®æ‰€è¦æ±‚çš„ä¸¤ä¸ªç­”æ¡ˆã€‚</li></ul><p>æ ·ä¾‹ 1</p><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">300 1000</span><br><span class="line">700 1200</span><br><span class="line">1500 2100</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">900 300</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  ã€ç»å…¸çš„åŒºé—´åˆå¹¶é—®é¢˜ã€‘</span></span><br><span class="line"><span class="comment"> * æˆ‘ä»¬æŠŠå†œæ°‘å·¥ä½œçš„æ—¶å€™çœ‹ä½œåŒºé—´ï¼Œæ¯ä¸ªåŒºé—´ç”¨ [start_i, end_i) è¡¨ç¤º</span></span><br><span class="line"><span class="comment"> * å¯¹æ‰€æœ‰åŒºé—´æŒ‰å·¦ç«¯ç‚¹ä»å°åˆ°å¤§æ’åº</span></span><br><span class="line"><span class="comment"> * æŒ¨ä¸ªéå†è¿™äº›åŒºé—´ï¼Œå¹¶ä¸”ç»´æŠ¤ä¸€ä¸ª â€œå½“å‰åˆå¹¶åŒºé—´â€ Sï¼Œç”¨ [resa, reab) è¡¨ç¤º S çš„å·¦å³ç«¯ç‚¹</span></span><br><span class="line"><span class="comment"> * å½“éå†åˆ°ç¬¬ä¸€ä¸ªåŒºé—´çš„æ—¶å€™ï¼Œå®ƒå°±æ˜¯ Sï¼Œå³ resa=start_0, resb=end_0</span></span><br><span class="line"><span class="comment"> * å½“éå†åˆ°ä¸€ä¸ªæ–°åŒºé—´ï¼Œå¯èƒ½å‡ºç°ä¸¤ç§æƒ…å†µï¼š</span></span><br><span class="line"><span class="comment"> *    start_i &lt;= resb, åˆå¹¶åŒºé—´ Sï¼Œå¹¶æ›´æ–°å³ç«¯ç‚¹ï¼Œresb=max(end_i, resb)</span></span><br><span class="line"><span class="comment"> *    start_i &gt; resb,  å°† S ä¿å­˜ä¸‹æ¥,é‡ç½®åŒºé—´Sçš„å·¦å³ç«¯ç‚¹ï¼Œresa=start_i, resb=end_i</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">vector&lt;vector &lt;<span class="keyword">int</span>&gt;&gt; vec;</span><br><span class="line">vector &lt;<span class="keyword">int</span>&gt; ma, mi;</span><br><span class="line"><span class="keyword">int</span> resa, resb;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(vec.<span class="built_in">begin</span>(),vec.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    resa=vec[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    resb=vec[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">    ma.<span class="built_in">push_back</span>(resb-resa);</span><br><span class="line">    mi.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; ++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(vec[i][<span class="number">0</span>] &lt;= resb)&#123;</span><br><span class="line">            resb=<span class="built_in">max</span>(vec[i][<span class="number">1</span>],resb);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            ma.<span class="built_in">push_back</span>(resb-resa);</span><br><span class="line">            mi.<span class="built_in">push_back</span>(vec[i][<span class="number">0</span>]-resb);</span><br><span class="line">            resa=vec[i][<span class="number">0</span>];</span><br><span class="line">            resb=vec[i][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ma.<span class="built_in">push_back</span>(vec[n<span class="number">-1</span>][<span class="number">1</span>]-vec[n<span class="number">-1</span>][<span class="number">0</span>]);</span><br><span class="line">    cout&lt;&lt;*<span class="built_in">max_element</span>(ma.<span class="built_in">begin</span>(),ma.<span class="built_in">end</span>()) &lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt; *<span class="built_in">max_element</span>(mi.<span class="built_in">begin</span>(),mi.<span class="built_in">end</span>()) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N;</span><br><span class="line">    cin &gt;&gt; N ;</span><br><span class="line">    <span class="keyword">while</span>(N--)&#123;</span><br><span class="line">        <span class="keyword">int</span> start, end;</span><br><span class="line">        cin &gt;&gt; start &gt;&gt; end;</span><br><span class="line">        vec.<span class="built_in">push_back</span>(&#123;start, end&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-19-åç¼€0"><a href="#pa-19-åç¼€0" class="headerlink" title="pa-19.åç¼€0"></a><a href="https://www.papamelon.com/problem/19">pa-19.åç¼€0</a></h2><p>å°æ£’ç“œç“œå¾—åˆ°äº†ä¸€ä¸ªæ­£æ•´æ•° nï¼Œä»–éœ€è¦è®¡ç®— nï¼Œå³è¦è®¡ç®— 1 * 2 * 3 * 4 â€¦ * nã€‚æœ€åè®©æˆ‘ä»¬ç»Ÿè®¡ä¸€ä¸‹ï¼Œè¿™ä¸ªç»“æœæœ‰å¤šå°‘ä¸ªåç¼€ 0ï¼Œä¹Ÿå°±æ˜¯ä»ç»“æœçš„æœ«å°¾å¾€å‰æ•°æœ‰å¤šå°‘ä¸ªè¿ç»­çš„ 0ã€‚</p><p><strong>è¾“å…¥</strong></p><p>ç¬¬ä¸€è¡Œæ˜¯æ•´æ•° T, 1â‰¤Tâ‰¤1000ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ T ç»„æ•°æ®</p><p>æ¥ä¸‹æ¥æœ‰ TT è¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ•´æ•° n, 1â‰¤nâ‰¤1000ï¼Œè¡¨ç¤ºè¦æˆ‘ä»¬ç»Ÿè®¡ n! çš„åç¼€ 0 æ•°é‡</p><p><strong>è¾“å‡º</strong></p><p>è¾“å‡º T è¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º n! çš„åç¼€ 0 çš„æ•°é‡</p><p>æ ·ä¾‹ 1<br>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">4</span><br><span class="line">8</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br></pre></td></tr></table></figure><blockquote><p> æç¤º<br>4 çš„é˜¶ä¹˜æ˜¯ 24ï¼Œåç¼€ 0 æ•°é‡ä¸º 0<br>8 çš„é˜¶ä¹˜ä¸º 40320ï¼Œåç¼€ 0 çš„æ•°é‡ä¸º 1</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å®¹æ–¥åŸç†</span></span><br><span class="line"><span class="comment"> * æœ‰ä¸€å¯¹ã€2ï¼Œ5ã€‘æ‰èƒ½äº§ç”Ÿä¸€ä¸ª 0</span></span><br><span class="line"><span class="comment"> * åœ¨æ¯ 5 ä¸ªæ•°ä¸ºä¸€ç»„çš„åŒºé—´ï¼Œ 2^x  5^y  ====&gt; x &gt; y</span></span><br><span class="line"><span class="comment"> * æœ€åæ±‚[0,n]ä¸­ 5 çš„å¹‚æ¬¡æ–¹çš„ä¸ªæ•° 5^a, 25^b, 125^c 625^d</span></span><br><span class="line"><span class="comment"> * åç¼€0çš„ä¸ªæ•°å³ä¸º a+b+c+d</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span>&gt;</span></span><br><span class="line"><span class="keyword">using</span>  <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>, base=<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">while</span>(base &lt;= n)&#123;</span><br><span class="line">        res += n/base;</span><br><span class="line">        base = base*<span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--) <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-20-åˆé€‚ç¯®ç­çš„æ•°é‡"><a href="#pa-20-åˆé€‚ç¯®ç­çš„æ•°é‡" class="headerlink" title="pa-20.åˆé€‚ç¯®ç­çš„æ•°é‡"></a><a href="https://www.papamelon.com/problem/20">pa-20.åˆé€‚ç¯®ç­çš„æ•°é‡</a></h2><p>å°æ£’ç“œç“œç°åœ¨æœ‰ m ä¸ªç”œç¾çš„æ£’ç“œï¼Œæ¯ä¸ªæ£’ç“œéƒ½æœ‰ç›¸åº”çš„ä½“ç§¯ï¼Œè®¾ç¬¬ i ä¸ªæ£’ç“œçš„ä½“ç§¯ä¸º v_i</p><p>ç°åœ¨ä»–è¦å¯»æ‰¾ä¸€ä¸ª åˆé€‚çš„ç¯®ç­ï¼Œè¦æ±‚è¿™ä¸ª ç¯®ç­çš„å®¹é‡è‡³å°‘æ˜¯å…¶ä¸­ä¸€ä¸ªæ£’ç“œçš„ä½“ç§¯çš„æ•´æ•°å€ã€‚</p><p>å°æ£’ç“œç“œæ¥åˆ°é›†å¸‚ï¼Œå‘ç°æœ‰ n ä¸ªç¯®ç­ï¼Œè¿™äº›ç¯®ç­çš„å®¹é‡æ°å¥½æ˜¯è¿ç»­çš„æ­£æ•´æ•°ï¼Œæœ€å°çš„ç¯®ç­å®¹é‡ä¸º Cï¼Œæœ€å¤§çš„ç¯®ç­å®¹é‡ä¸º C + n - 1ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›ç¯®ç­çš„å®¹é‡åˆ†åˆ«ä¸º [C, C+1, C+2, C+3, â€¦ , C+n-1]</p><p>ç°åœ¨ä»–è¦åœ¨è¿™äº›ç¯®ç­ä¸­ï¼Œæ‰¾å‡ºæ‰€æœ‰åˆé€‚çš„ç¯®ç­ï¼Œè¯·ä½ å¸®å¿™ç»Ÿè®¡åˆé€‚çš„ç¯®ç­ä¸ªæ•°ã€‚</p><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªä¾‹å­</p><p>ä¸€å…±æœ‰ 3 ä¸ªæ£’ç“œï¼Œå®ƒä»¬çš„ä½“ç§¯åˆ†åˆ«ä¸º [2,3,4]</p><p>é›†å¸‚é‡Œæœ‰ 6 ä¸ªç¯®ç­ï¼Œæœ€å°ç¯®ç­å®¹é‡ä¸º 11ï¼Œæ‰€æœ‰çš„ç¯®ç­å®¹é‡ä¸º [1,2,3,4,5,6]</p><p>åˆé€‚çš„ç¯®ç­ä¸€å…±æœ‰ 4 ä¸ªï¼ŒåŒ…æ‹¬ [2,3,4,6]ï¼Œå®ƒä»¬çš„å®¹é‡è‡³å°‘æ˜¯ä¸€ä¸ªæ£’ç“œä½“ç§¯çš„æ•´æ•°å€</p><p><strong>è¾“å…¥</strong></p><ul><li><p>ç¬¬ä¸€è¡Œæ˜¯æ•´æ•° T, 1â‰¤Tâ‰¤1000ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ T ç»„æ•°æ®</p></li><li><p>æ¯ç»„æ•°æ®ä½äºä¸€è¡Œ:</p><ul><li><p>å‰ 3 ä¸ªæ˜¯æ­£æ•´æ•° m, n, Cï¼Œåˆ†åˆ«è¡¨ç¤ºæ£’ç“œçš„æ•°é‡å’Œé›†å¸‚ä¸­ç¯®ç­çš„æ•°é‡ï¼Œä»¥åŠæœ€å°çš„ç¯®ç­å®¹é‡ï¼Œå…¶ä¸­ 1â‰¤mâ‰¤10, 1â‰¤nâ‰¤10^6, 1â‰¤Câ‰¤10^8</p></li><li><p>æ¥ä¸‹æ¥æ˜¯ m ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤º m ä¸ªæ£’ç“œçš„ä½“ç§¯ï¼Œè®¾ç¬¬ i ä¸ªæ£’ç“œçš„ä½“ç§¯ä¸º 1&lt;=vi&lt;=500,<strong>åŒæ—¶ä¿è¯æ‰€æœ‰æ£’ç“œçš„ä½“ç§¯ç›¸ä¹˜ä¸ä¼šè¶…è¿‡</strong>10^18</p></li></ul></li></ul><blockquote><p>æ ·ä¾‹ 1<br>è¾“å…¥<br>1<br>3 6 1 2 3 4<br>è¾“å‡º<br>4</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1.æšä¸¾æ‰€æœ‰é›†åˆé‡å çš„æƒ…å†µ </span></span><br><span class="line"><span class="comment"> *  -æ‰€è°“çš„é›†åˆï¼ŒæŒ‡çš„æ˜¯ vi çš„å€æ•°</span></span><br><span class="line"><span class="comment"> *  -&#123;v0&#125;, &#123;v1&#125;, &#123;v2&#125; ... &#123;vm-1&#125;</span></span><br><span class="line"><span class="comment"> *  -&#123;v0,v1&#125;, &#123;v0,v2&#125;... &#123;vm-2,vm-1&#125;</span></span><br><span class="line"><span class="comment"> *  -&#123;v0,v1,v2&#125; ... &#123;vm-3,vm-2,vm-1&#125;</span></span><br><span class="line"><span class="comment"> *  - ...</span></span><br><span class="line"><span class="comment"> * 2.è®¡ç®—é‡å é›†åˆçš„æœ€å°å…¬å€æ•°ï¼Œ LCM = &#123;vi, vj ... vk&#125;,  n/LCM = é‡å é›†åˆçš„å¤§å°</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 3.æ ¹æ®å®¹æ–¥åŸç†ï¼Œ å¥‡åŠ  å¶å‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m, n ,c;</span><br><span class="line">    cin &gt;&gt; m &gt;&gt; n &gt;&gt; c;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">v</span><span class="params">(m)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m; ++i)  cin &gt;&gt; v[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> maxs = <span class="number">1</span> &lt;&lt; m; <span class="comment">//æ€»å…±çŠ¶æ€æ•°</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> s=<span class="number">1</span>; s&lt;maxs; ++s)&#123; <span class="comment">//ä¸€å…±maxs-1é‡çŠ¶æ€ï¼Œsä»1å¼€å§‹</span></span><br><span class="line">        ll lcm=<span class="number">1LL</span>;</span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m; ++i) <span class="keyword">if</span> ((s &gt;&gt; i) &amp; <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">// a*b=p*q æœ€å°å…¬å€æ•°äºæœ€å¤§å…¬çº¦æ•°çš„å…³ç³»</span></span><br><span class="line">            lcm = lcm * v[i] / __gcd(lcm, <span class="number">1LL</span> * v[i]) ; <span class="comment">// &#123;vi, vj ... vk&#125;çš„æœ€å°å…¬å€æ•°</span></span><br><span class="line">            cnt++;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">int</span> count = (c+n<span class="number">-1</span>)/lcm - (c<span class="number">-1</span>)/lcm;</span><br><span class="line">        <span class="keyword">if</span>(cnt &amp;<span class="number">1</span> )  res += count;</span><br><span class="line">        <span class="keyword">else</span> res -= count;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T--) <span class="built_in">solve</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="pa-9-å¥—å¨ƒ-1"><a href="#pa-9-å¥—å¨ƒ-1" class="headerlink" title="pa-9.å¥—å¨ƒ"></a>pa-9.å¥—å¨ƒ</h2><p><a href="#%5Bpa-9.%E5%A5%97%E5%A8%83%5D(https://www.papamelon.com/problem/9)">è·³è½¬</a></p><h2 id="pa-18-å¥—å¨ƒII-1"><a href="#pa-18-å¥—å¨ƒII-1" class="headerlink" title="pa-18.å¥—å¨ƒII"></a>pa-18.å¥—å¨ƒII</h2><p>[è·³è½¬](# <a href="https://www.papamelon.com/problem/18">pa-18.å¥—å¨ƒII</a>)</p><h2 id="pa-10-è®¡ç®—ç¬¬kä¸ªæ’åˆ—"><a href="#pa-10-è®¡ç®—ç¬¬kä¸ªæ’åˆ—" class="headerlink" title="pa-10.è®¡ç®—ç¬¬kä¸ªæ’åˆ—"></a><a href="https://www.papamelon.com/problem/10">pa-10.è®¡ç®—ç¬¬kä¸ªæ’åˆ—</a></h2><p>ç»™å®šæˆ‘ä»¬æ•´æ•° nï¼Œè¡¨ç¤ºæˆ‘ä»¬æœ‰ [1,2,3,4 â€¦ n-1, n] è¿™ n ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å‡º n! ä¸ªçš„å‡åºæ’åºçš„æ’åˆ—ã€‚</p><p>ä¾‹å¦‚ï¼Œn = 3ï¼Œæ‰€æœ‰çš„æ’åˆ—ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 2 3</span><br><span class="line">1 3 2</span><br><span class="line">2 1 3</span><br><span class="line">2 3 1</span><br><span class="line">3 1 2</span><br><span class="line">3 2 1</span><br></pre></td></tr></table></figure><p>ç°åœ¨å†ç»™å®šæˆ‘ä»¬ä¸€ä¸ªæ•´æ•° K, 1â‰¤Kâ‰¤n!ï¼Œè®©æˆ‘ä»¬æ‰¾åˆ°ç¬¬ K ä¸ªæ’åˆ—ã€‚</p><p>ä¾‹å¦‚ï¼Œn = 3, K = 1ï¼Œç›®æ ‡æ’åˆ—æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 3</span><br></pre></td></tr></table></figure><p> n= 3, K = 3ï¼Œç›®æ ‡æ’åˆ—æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 1 3</span><br></pre></td></tr></table></figure><p><strong>è¾“å…¥</strong></p><p>ç¬¬ä¸€è¡Œæ˜¯æ•´æ•° T è¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ T ç»„ n, Kï¼Œå…¶ä¸­ 1â‰¤Tâ‰¤1000</p><p>æ¥ä¸‹æ¥æœ‰ T è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•°å­—ç”¨ç©ºæ ¼åˆ†éš”ï¼Œåˆ†åˆ«ä¸º n, Kï¼Œ1â‰¤nâ‰¤20,1â‰¤Kâ‰¤n!</p><p><strong>è¾“å‡º</strong></p><p>è¾“å‡º T è¡Œï¼Œæ¯è¡Œæ˜¯ç›¸åº”çš„ç›®æ ‡æ’åˆ—ï¼Œæ¯ä¸ªæ•°å­—é—´ç”¨ç©ºæ ¼ç›¸éš”ï¼Œæ³¨æ„æ¯è¡Œæœ€åä¸è¦è¾“å‡ºå¤šä½™ç©ºæ ¼</p><p>æ ·ä¾‹ 1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">2</span><br><span class="line">3 1</span><br><span class="line">3 3</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å‡º:</span><br><span class="line">1 2 3</span><br><span class="line">2 1 3</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Author: Henry</span></span><br><span class="line"><span class="comment"> * @Date: 2021-08-11 21:53:14</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2021-08-12 10:49:45</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">ll f[N+<span class="number">5</span>];         <span class="comment">//è®¡ç®—é˜¶ä¹˜ f[i]=!i</span></span><br><span class="line"><span class="keyword">bool</span> visit[N+<span class="number">5</span>];   <span class="comment">//visit[i]=true è¡¨ç¤º i å·²ç»è¢«é€‰åˆ°æ’åˆ—ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    ll K;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; K;</span><br><span class="line">    <span class="built_in">memset</span>(visit, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(visit));</span><br><span class="line">    <span class="comment">// ä»å·¦åˆ°å³ï¼ŒæŒ‰ä½ç¡®è®¤è¢«é€‰ä¸­çš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> pos = n; pos&gt;<span class="number">0</span>; pos--) &#123;</span><br><span class="line">        ll sum=<span class="number">0</span>;     <span class="comment">//è·³è¿‡å¤šå°‘ä¸ªæ’åˆ—</span></span><br><span class="line">        <span class="keyword">int</span> cur=<span class="number">1</span>;    <span class="comment">//é€‰ä¸­çš„å…ƒç´ ï¼Œpos=næ—¶ï¼Œæ¯ä¸ªåˆ†ç»„æœ‰ f(n-1)ä¸ªæ’åˆ—</span></span><br><span class="line">        <span class="comment">//ç¡®è®¤åˆ†ç»„</span></span><br><span class="line">        <span class="keyword">for</span> (; cur &lt;= n; cur++) <span class="keyword">if</span> (!visit[cur]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sum + f[pos - <span class="number">1</span>] &gt;= K) <span class="keyword">break</span>;</span><br><span class="line">            sum += f[pos - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        visit[cur] = <span class="literal">true</span>;</span><br><span class="line">        cout &lt;&lt; cur &lt;&lt; (pos==<span class="number">1</span> ? <span class="string">&#x27;\n&#x27;</span>:<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        K -= sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) f[i] = f[i - <span class="number">1</span>] * i;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T--) <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="pa-10-è®¡ç®—æ’åˆ—çš„ç¼–å·"><a href="#pa-10-è®¡ç®—æ’åˆ—çš„ç¼–å·" class="headerlink" title="pa-10.è®¡ç®—æ’åˆ—çš„ç¼–å·"></a><a href="https://www.papamelon.com/problem/11">pa-10.è®¡ç®—æ’åˆ—çš„ç¼–å·</a></h2><p>ç»™å®šæ­£æ•´æ•° nï¼Œè¡¨ç¤ºæˆ‘ä»¬æœ‰ [1,2,3,4 â€¦ n-1, n] è¿™ n ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å‡º n! ä¸ªå‡åºæ’åºçš„æ’åˆ—ã€‚</p><p>ä¾‹å¦‚ï¼Œn = 3ï¼Œæ‰€æœ‰çš„æ’åˆ—ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 2 3</span><br><span class="line">1 3 2</span><br><span class="line">2 1 3</span><br><span class="line">2 3 1</span><br><span class="line">3 1 2</span><br><span class="line">3 2 1</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä»ä¸­é€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ’åˆ—ï¼Œè®¡ç®—å®ƒçš„ç¼–å·ï¼Œä¾‹å¦‚ï¼š</p><ul><li>ä»¥ä¸‹æ’åˆ—å±äºç¬¬ 1 ä¸ªï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 3</span><br></pre></td></tr></table></figure></li><li>ä»¥ä¸‹æ’åˆ—å±äºç¬¬ 3 ä¸ª:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 1 3</span><br></pre></td></tr></table></figure></li><li>ä»¥ä¸‹æ’åˆ—å±äºç¬¬ 5 ä¸ªï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3 1 2</span><br></pre></td></tr></table></figure></li><li><em>è¾“å…¥</em>*</li></ul><p>ç¬¬ä¸€è¡Œæ˜¯æ•´æ•° Tï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ T ç»„ æ’åˆ—ï¼Œå…¶ä¸­ 1â‰¤Tâ‰¤10000</p><p>æ¥ä¸‹æ¥æœ‰ T è¡Œï¼Œæ¯è¡Œçš„ç¬¬ä¸€ä¸ªæ•°å­—ä¸º n, 1â‰¤nâ‰¤20ï¼Œåé¢è·Ÿç€ n ä¸ªæ•´æ•°ï¼Œæ˜¯ä¸€ä¸ªå…³äº n çš„æ’åˆ—ï¼Œæ‰€æœ‰æ•°å­—ç”¨ç©ºæ ¼åˆ† éš”</p><p><strong>è¾“å‡º</strong></p><p>è¾“å‡º T è¡Œï¼Œæ¯è¡Œè¡¨ç¤ºæ’åˆ—çš„ç¼–å·</p><blockquote><p>æ ·ä¾‹ 1</p><p>è¾“å…¥</p><p>2</p><p>3 2 1 3</p><p>3 3 1 2</p><p>è¾“å‡º</p><p>3</p><p>5</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å¯¹äºç»™å®šçš„åºåˆ—ï¼ŒæŒ‰ä½ç¡®å®š</span></span><br><span class="line"><span class="comment"> * å¯¹äºå½“å‰ a[i]ï¼Œå…ˆè®¡ç®— a[i] åœ¨å¯ç”¨çš„å…ƒç´ é‡Œé¢æ’ç¬¬å‡ ä½(count)</span></span><br><span class="line"><span class="comment"> * å¯¹äºå½“å‰ç¬¬ i è½®ï¼Œç¡®è®¤äº† a[i] åï¼Œå…¶ä½™å…ƒç´ å¯ä»¥ä»»æ„æ’ï¼Œäº§ç”Ÿçš„æ’åˆ—æ•°é‡æ˜¯ (n-1-i)!</span></span><br><span class="line"><span class="comment"> * å®é™…è·³è¿‡çš„æ’åˆ—çš„æ•°é‡ = (n-1-i)! * count</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">ll f[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">a</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; ++i) cin &gt;&gt; a[i];</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">bool</span>&gt; <span class="title">vis</span><span class="params">(n, <span class="literal">false</span>)</span></span>; <span class="comment">//æ ‡è®°æ•°ç»„</span></span><br><span class="line">    </span><br><span class="line">    ll skip = <span class="number">0</span>; <span class="comment">//è·³è¿‡å¤šå°‘ä¸ªæ’åˆ—</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; ++i)&#123;  <span class="comment">// a[i] åœ¨å¯ç”¨çš„æ•°å­—é‡Œé¢ï¼Œæ˜¯ç¬¬å‡ ä¸ª</span></span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">1</span>; x&lt;=n &amp;&amp; x!=a[i]; x++)</span><br><span class="line">            <span class="keyword">if</span>(!vis[x]) count++;</span><br><span class="line">        skip += f[n<span class="number">-1</span>-i]*count;</span><br><span class="line">        vis[a[i]]=<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; skip+<span class="number">1</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    f[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=N; ++i)&#123;</span><br><span class="line">        f[i]=f[i<span class="number">-1</span>]*i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T--) <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-140-å…¬å¸å›¢å»º"><a href="#pa-140-å…¬å¸å›¢å»º" class="headerlink" title="pa-140.å…¬å¸å›¢å»º"></a><a href="https://www.papamelon.com/problem/140">pa-140.å…¬å¸å›¢å»º</a></h2><p>å…¬å¸ç»ˆäºå»å›¢å»ºå•¦ï¼è¿™æ¬¡å‚åŠ å›¢å»ºçš„ä¸€å…±æœ‰ n ä¸ªå°ä¼™ä¼´ï¼Œä¸ºäº†ä½¿å¾—å›¢å»ºå¯ä»¥æ„‰å¿«è¿›è¡Œï¼Œæˆ‘ä»¬ä¿è¯ n ä¸€å…±æ˜¯ å¶æ•°ï¼ŒåŒæ—¶æˆ‘ä»¬å¸Œæœ›å°ä¼™ä¼´ä»¬èƒ½ä¸¤ä¸¤ç»„é˜Ÿï¼Œè¿™æ ·æ—…é€”ä¸­ä¸ä¼šå¤ªæ— èŠã€‚</p><p>è¯·ä½ å¸®å¿™è®¡ç®—ä¸€ä¸‹ï¼Œä¸€å…±æœ‰å¤šå°‘ç§ç»„é˜Ÿæ–¹æ¡ˆï¼Ÿ</p><p>è¯·æ³¨æ„ä»¥ä¸‹ç»†èŠ‚</p><p>(A, B) å’Œ (B,A) è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé˜Ÿä¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ n=2ï¼Œåªæœ‰ä¸€ç§ç»„é˜Ÿæ–¹æ¡ˆ</p><p>åŒ¹é…åçš„é˜Ÿä¼ï¼Œå¹¶æ— å‰åé¡ºåºä¹‹åˆ†ï¼Œä¾‹å¦‚ n=4:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹ä¸¤ç§ç»„é˜Ÿæ–¹æ¡ˆè¢«è®¤ä¸ºæ˜¯åŒä¸€ç§</span><br><span class="line">1 2  // 1 2 ç»„é˜Ÿ</span><br><span class="line">3 4  // 3 4 ç»„é˜Ÿ</span><br><span class="line"></span><br><span class="line">3 4  // 3 4 ç»„é˜Ÿ</span><br><span class="line">1 2  // 1 2 ç»„é˜Ÿ</span><br></pre></td></tr></table></figure><p><strong>è¾“å…¥</strong></p><p>åªæœ‰ä¸€è¡Œï¼Œæ•´æ•° n (2â‰¤nâ‰¤16), ä¿è¯ n ä¸€å®šæ˜¯ <strong>å¶æ•°</strong></p><p><strong>è¾“å‡º</strong></p><p>åªæœ‰ä¸€è¡Œï¼Œè¡¨ç¤ºæœ‰å¤šå°‘ç§ç»„é˜Ÿæ–¹æ¡ˆ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * æ‰€æœ‰çš„ç»„åˆéƒ½å¯ä»¥å½’ç»“ä¸º a_0(1) &lt; b_i(n-1) a_1(1) &lt; b_i(n-3)...</span></span><br><span class="line"><span class="comment"> * æœ€åçš„ç»“æœä¸º(n-1)*(n-3)*(n-5)* ... * 1</span></span><br><span class="line"><span class="comment"> * é€’æ¨å…¬å¼ f[i]=f[i-2]*(i-1)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">16</span>;</span><br><span class="line"><span class="keyword">int</span> f[N+<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    f[<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">4</span>; i&lt;=N; i=i+<span class="number">2</span>)&#123;</span><br><span class="line">        f[i] = f[i<span class="number">-2</span>] * (i<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    cout &lt;&lt; f[n];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-141-å…¬å¸å›¢å»ºII"><a href="#pa-141-å…¬å¸å›¢å»ºII" class="headerlink" title="pa-141.å…¬å¸å›¢å»ºII"></a><a href="https://www.papamelon.com/problem/141">pa-141.å…¬å¸å›¢å»ºII</a></h2><p>é¢˜å¹²åŒ140.</p><p><strong>è¾“å…¥</strong></p><ul><li>ç¬¬ä¸€è¡Œä¸ºæ•´æ•° T (1â‰¤Tâ‰¤10000)ï¼Œè¡¨ç¤ºæœ‰ T ç»„æµ‹è¯•æ•°æ®</li><li>æ¥ä¸‹æ¥ Tè¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ•´æ•° n (2â‰¤nâ‰¤10^6), ä¿è¯ n ä¸€å®šæ˜¯ <strong>å¶æ•°</strong></li></ul><p><strong>è¾“å‡º</strong></p><ul><li>è¾“å‡º Tè¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘ç§ç»„é˜Ÿæ–¹æ¡ˆ</li><li>ç»“æœå¯¹ <code>998244353</code> å–æ¨¡</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤šäº†å–æ¨¡</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000000</span>;</span><br><span class="line">ll f[N+<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    f[<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">4</span>; i&lt;=N; i=i+<span class="number">2</span>)&#123;</span><br><span class="line">        f[i] = f[i<span class="number">-2</span>] * (i<span class="number">-1</span>) % <span class="number">998244353</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">   </span><br><span class="line">        cout &lt;&lt; f[n] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-15-åˆ·æˆ¿å­"><a href="#pa-15-åˆ·æˆ¿å­" class="headerlink" title="pa-15.åˆ·æˆ¿å­"></a><a href="https://www.papamelon.com/problem/15">pa-15.åˆ·æˆ¿å­</a></h2><p>å°æ£’ç“œç“œæœ‰ n ä¸ªæˆ¿å­æ’æˆä¸€æ’ï¼ŒåŒæ—¶ä»–æœ‰çº¢é»„è“ä¸‰ç§é¢œè‰²çš„æ²¹æ¼†ã€‚ç°åœ¨ä»–è¦ç»™æ¯ä¸ªæˆ¿å­åˆ·ä¸Šä¸€ç§é¢œè‰²çš„æ²¹æ¼†ï¼ŒåŒæ—¶è¦æ±‚ä»»æ„ä¸¤ä¸ªç›¸é‚»æˆ¿å­çš„æ²¹æ¼†é¢œè‰²ä¸å¾—ç›¸åŒã€‚</p><p>å¦å¤–ï¼Œå³ä¾¿æ˜¯åŒä¸€ç§é¢œè‰²çš„æ²¹æ¼†ï¼Œåˆ·ä¸åŒçš„æˆ¿å­ï¼Œæ‰€éœ€çš„èŠ±è´¹ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¾—åˆ°æ¯ä¸ªæˆ¿å­åˆ·ä¸Š 33 ç§æ²¹æ¼†çš„ä»£ä»·ï¼Œè¯·å¸®å°æ£’ç“œç“œè®¡ç®—ä¸€ä¸‹ï¼Œä¸ºæ‰€æœ‰æˆ¿å­éƒ½åˆ·ä¸Šæ²¹æ¼†ä¸”æ²¡æœ‰ä»»æ„ä¸¤ä¸ªç›¸é‚»æˆ¿å­çš„é¢œè‰²ç›¸åŒçš„æœ€å°æ€»èŠ±è´¹ã€‚</p><p><strong>è¾“å…¥</strong></p><ul><li><p>ç¬¬ä¸€è¡Œæ˜¯æ•´æ•° Tï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ TT ç»„æ•°æ®ï¼Œ1â‰¤Tâ‰¤1000</p></li><li><p>æ¯ç»„æ•°æ®ç”± n + 1 è¡Œç»„æˆï¼Œç¬¬ä¸€è¡Œæ˜¯æ•´æ•° nnï¼Œè¡¨ç¤ºæœ‰ n ä¸ªæˆ¿å­ï¼Œ1â‰¤nâ‰¤10^5</p></li><li><p>æ¥ä¸‹æ¥æ˜¯ n è¡Œï¼Œæ¯è¡Œ 3 ä¸ªæ­£æ•´æ•°ã€‚ç¬¬ i è¡Œçš„ 3 ä¸ªæ­£æ•´æ•°åˆ†åˆ«ä¸º cost[i][0], cost[i][1], cost[i][2]ï¼Œè¡¨ç¤ºç»™ç¬¬ i ä¸ªæˆ¿å­åˆ·ä¸Šçº¢é»„è“ä¸‰ç§æ²¹æ¼†çš„èŠ±è´¹ã€‚1â‰¤cost[i][j]â‰¤1000</p></li><li><p>T ç»„æ•°æ®ä¸­æ‰€æœ‰ n çš„æ€»å’Œä¸º S, Tâ‰¤Sâ‰¤10^6</p></li></ul><p><strong>è¾“å‡º</strong></p><ul><li>è¾“å‡º T è¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºä¸ºæ‰€æœ‰æˆ¿å­éƒ½åˆ·ä¸Šæ²¹æ¼†ä¸”æ²¡æœ‰ä»»æ„ä¸¤ä¸ªç›¸é‚»æˆ¿å­çš„é¢œè‰²ç›¸åŒçš„æœ€å°æ€»èŠ±è´¹</li></ul><blockquote><p>æ ·ä¾‹ 1<br>è¾“å…¥<br>3<br>1<br>1 2 3</p><p>2<br>1 2 1<br>2 1 2</p><p>3<br>100 200 300<br>200 300 400<br>1 2 3</p><p>è¾“å‡º<br>1<br>2<br>401</p><p>æç¤º<br>ç¬¬ 3 ç»„æµ‹è¯•ç”¨ä¾‹ä¸­ï¼š<br>ç¬¬ä¸€ä¸ªæˆ¿å­é€‰ç”¨çº¢è‰²æ²¹æ¼†ï¼ŒèŠ±è´¹ä¸º 100<br>ç¬¬äºŒä¸ªæˆ¿å­é€‰ç”¨é»„è‰²æ²¹æ¼†ï¼ŒèŠ±è´¹ä¸º 300<br>ç¬¬ä¸‰ä¸ªæˆ¿å­é€‰ç”¨çº¢è‰²æ²¹æ¼†ï¼ŒèŠ±è´¹ä¸º 1<br>æœ€å°æ€»èŠ±è´¹ä¸º 401</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  DP</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    vector &lt;<span class="keyword">int</span>&gt; <span class="built_in">x</span>(<span class="number">3</span>,<span class="number">0</span>), <span class="built_in">y</span>(<span class="number">3</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// åˆå§‹çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; ++i)  cin &gt;&gt; x[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; ++i)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">3</span>; ++j)&#123;<span class="comment">// å½“å‰æˆ¿å­é¢œè‰²çŠ¶æ€åªä¸å‰é¢æˆ¿å­é¢œè‰²ç›¸å…³</span></span><br><span class="line">            <span class="keyword">int</span> val;</span><br><span class="line">            cin &gt;&gt; val;</span><br><span class="line">            y[j]=INT_MAX;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">3</span>; ++k) <span class="keyword">if</span>(j!=k)&#123; <span class="comment">//å½“å‰æˆ¿å­å¤„æœ€å°èŠ±è´¹</span></span><br><span class="line">                y[j]=<span class="built_in">min</span>(y[j], x[k]+val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">swap</span>(x, y);  <span class="comment">// æ»šåŠ¨æ•°ç»„</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> res=INT_MAX;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; ++i)&#123;</span><br><span class="line">        res=<span class="built_in">min</span>(res, x[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span>(T--) <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pa-17-åˆ·æˆ¿å­II"><a href="#pa-17-åˆ·æˆ¿å­II" class="headerlink" title="pa-17.åˆ·æˆ¿å­II"></a><a href="https://www.papamelon.com/problem/17">pa-17.åˆ·æˆ¿å­II</a></h2><p>å°æ£’ç“œç“œåœ¨å®Œæˆäº†ç¬¬ä¸€æ¬¡ åˆ·æˆ¿å­ ä»»åŠ¡åï¼Œåˆè¿æ¥äº†ç¬¬äºŒä¸ªä»»åŠ¡ã€‚</p><p>ç°åœ¨æœ‰ n ä¸ªæˆ¿å­æ’æˆä¸€æ’ï¼ŒåŒæ—¶æœ‰çº¢é»„è“ä¸‰ç§é¢œè‰²çš„æ²¹æ¼†ï¼Œæ¯ç§æ²¹æ¼†åˆ†åˆ«æœ‰ na, nb, nc æ¡¶ã€‚</p><p>åˆ·ä¸€ä¸ªæˆ¿å­è¦è€—è´¹ä¸€æ¡¶æ²¹æ¼†ï¼ŒåŒæ—¶è¦æ±‚ä»»æ„ä¸¤ä¸ªç›¸é‚»æˆ¿å­çš„æ²¹æ¼†é¢œè‰²ä¸å¾—ç›¸åŒã€‚</p><p>å¦å¤–ï¼Œå³ä¾¿æ˜¯åŒä¸€ç§é¢œè‰²çš„æ²¹æ¼†ï¼Œåˆ·ä¸åŒçš„æˆ¿å­ï¼Œæ‰€éœ€çš„èŠ±è´¹ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¾—åˆ°æ¯ä¸ªæˆ¿å­åˆ·ä¸Š 3 ç§æ²¹æ¼†çš„ä»£ä»·ï¼Œè¯·å¸®å°æ£’ç“œç“œè®¡ç®—ä¸€ä¸‹ï¼Œä¸ºæ‰€æœ‰æˆ¿å­éƒ½åˆ·ä¸Šæ²¹æ¼†ä¸”æ²¡æœ‰ä»»æ„ä¸¤ä¸ªç›¸é‚»æˆ¿å­çš„é¢œè‰²ç›¸åŒçš„æ€»èŠ±è´¹æ˜¯å¤šå°‘ã€‚</p><p>å¦‚æœæ— æ³•ä¸ºæ¯ä¸ªæˆ¿å­éƒ½åˆ·ä¸Šæ²¹æ¼†ï¼ŒèŠ±è´¹ä¸º -1</p><p><strong>è¾“å…¥</strong></p><p>ç¬¬ä¸€è¡Œæ˜¯æ•´æ•° Tï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ T ç»„æ•°æ®ï¼Œ1â‰¤Tâ‰¤10</p><p>æ¯ç»„æ•°æ®ç”± n + 1 è¡Œç»„æˆ</p><p>ç¬¬ä¸€è¡Œæ˜¯æ•´æ•° n, na, nb, ncï¼Œè¡¨ç¤ºæœ‰ n ä¸ªæˆ¿å­ï¼Œçº¢é»„è“æ²¹æ¼†çš„æ¡¶æ•°åˆ†åˆ«ä¸º na, nb, nc, 1â‰¤n,na,nb,ncâ‰¤25ï¼Œ</p><p>æ¥ä¸‹æ¥æ˜¯ n è¡Œï¼Œæ¯è¡Œ 3 ä¸ªæ­£æ•´æ•°ã€‚ç¬¬ i è¡Œçš„ 3 ä¸ªæ­£æ•´æ•°åˆ†åˆ«ä¸º cost[i][0], cost[i][1], cost[i][2]ï¼Œè¡¨ç¤ºç»™ç¬¬ i ä¸ªæˆ¿å­åˆ·ä¸Šçº¢é»„è“ä¸‰ç§æ²¹æ¼†çš„èŠ±è´¹ã€‚1â‰¤cost[i][j]â‰¤1000</p><p><strong>è¾“å‡º</strong></p><p>è¾“å‡º T è¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºä¸ºæ‰€æœ‰æˆ¿å­éƒ½åˆ·ä¸Šæ²¹æ¼†ä¸”æ²¡æœ‰ä»»æ„ä¸¤ä¸ªç›¸é‚»æˆ¿å­çš„é¢œè‰²ç›¸åŒçš„æœ€å°èŠ±è´¹</p><p>å¦‚æœæ— æ³•ä¸ºæ‰€æœ‰æˆ¿å­éƒ½åˆ·ä¸Šæ²¹æ¼†ï¼Œè¾“å‡º -1</p><blockquote><p>æ ·ä¾‹ 1<br>è¾“å…¥<br>1<br>3 1 1 1<br>1 5 10<br>15 2 20<br>25 30 3</p><p>è¾“å‡º<br>6</p><p>æç¤º<br>ç¬¬ä¸€ä¸ªæˆ¿å­é€‰æ‹©çº¢è‰²æ²¹æ¼†ï¼ŒèŠ±è´¹ä¸º 1<br>ç¬¬äºŒä¸ªæˆ¿å­é€‰æ‹©é»„è‰²æ²¹æ¼†ï¼ŒèŠ±è´¹ä¸º 2<br>ç¬¬ä¸‰ä¸ªæˆ¿å­é€‰æ‹©è“è‰²æ²¹æ¼†ï¼ŒèŠ±è´¹ä¸º 3<br>æ€»èŠ±è´¹ä¸º 6</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  DP</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">30</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[N][<span class="number">4</span>][N][N][N], vis[N][<span class="number">4</span>][N][N][N];</span><br><span class="line"><span class="keyword">int</span> n, cnt[<span class="number">3</span>], cost[N][<span class="number">3</span>];<span class="comment">//æˆ¿å­æ•°é‡n æ¯ä¸ªé¢œæ–™æ•°é‡ cnt[i] èŠ±è´¹æ•°ç»„cost[n][i];</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> col)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(cur==n) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//å¦‚æœè®¡ç®—è¿‡ ç›´æ¥è¿”å›</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(vis[cur][col][cnt[<span class="number">0</span>]][cnt[<span class="number">1</span>]][cnt[<span class="number">2</span>]])</span><br><span class="line">        <span class="keyword">return</span> f[cur][col][cnt[<span class="number">0</span>]][cnt[<span class="number">1</span>]][cnt[<span class="number">2</span>]];</span><br><span class="line"></span><br><span class="line">     vis[cur][col][cnt[<span class="number">0</span>]][cnt[<span class="number">1</span>]][cnt[<span class="number">2</span>]] = <span class="number">1</span>;</span><br><span class="line">     <span class="keyword">int</span>&amp; res = f[cur][col][cnt[<span class="number">0</span>]][cnt[<span class="number">1</span>]][cnt[<span class="number">2</span>]];<span class="comment">//å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;<span class="number">3</span>; c++) <span class="keyword">if</span>(c !=col &amp;&amp; cnt[c] )&#123; <span class="comment">//é¢œæ–™ä½¿ç”¨é™åˆ¶æ¡ä»¶</span></span><br><span class="line">         cnt[c]--;</span><br><span class="line">         res = <span class="built_in">min</span>(res, <span class="built_in">dfs</span>(cur+<span class="number">1</span>, c) + cost[cur][c]);</span><br><span class="line">         cnt[c]++;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; ++i)   cin &gt;&gt; cnt[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; ++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">3</span>; ++j)</span><br><span class="line">            cin &gt;&gt; cost[i][j];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">0x3f3f3f3f</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(f));</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(vis));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> res = <span class="built_in">dfs</span>(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">if</span>(res == INF)  res=<span class="number">-1</span>;</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--) <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‰ç¼€å’Œ"><a href="#å‰ç¼€å’Œ" class="headerlink" title="å‰ç¼€å’Œ"></a>å‰ç¼€å’Œ</h1><h1 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h1><h1 id="å¹¶æŸ¥é›†"><a href="#å¹¶æŸ¥é›†" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h1><p><strong>å¯»æ‰¾è¿é€šåˆ†é‡å’Œæœ€å¤§é›†åˆæ•°é‡</strong></p><h1 id="å †-æ ˆ"><a href="#å †-æ ˆ" class="headerlink" title="å †/æ ˆ"></a>å †/æ ˆ</h1><h1 id="æ£‹ç›˜-æœ€çŸ­è·¯å¾„"><a href="#æ£‹ç›˜-æœ€çŸ­è·¯å¾„" class="headerlink" title="æ£‹ç›˜ æœ€çŸ­è·¯å¾„"></a>æ£‹ç›˜ æœ€çŸ­è·¯å¾„</h1>]]></content>
    
    
    <summary type="html">æ•´ç†è®°å½•åˆ·çš„ç®—æ³•é¢˜ï¼Œå¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´å•Šï¼é¢˜è§£å‚è€ƒäº†Grand Yang(https://github.com/grandyang)</summary>
    
    
    
    <category term="Algorithm" scheme="http://example.com/categories/Algorithm/"/>
    
    
    <category term="Algorithm" scheme="http://example.com/tags/Algorithm/"/>
    
    <category term="Leetcode" scheme="http://example.com/tags/Leetcode/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2021/02/14/hello-world/"/>
    <id>http://example.com/2021/02/14/hello-world/</id>
    <published>2021-02-13T16:00:00.000Z</published>
    <updated>2021-07-24T06:25:23.797Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><p>[TOC]</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Install-hexo"><a href="#Install-hexo" class="headerlink" title="Install hexo"></a>Install hexo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure><h3 id="Create-myblog"><a href="#Create-myblog" class="headerlink" title="Create myblog"></a>Create myblog</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init myblog</span><br></pre></td></tr></table></figure><p><strong>å‡ºç° hexo init å¤±è´¥é—®é¢˜ï¼Œ<a href="https://blog.csdn.net/qq_43580193/article/details/117341489?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_baidulandingword-0&spm=1001.2101.3001.4242">è§£å†³æ–¹æ³•</a>æ›¿æ¢Githubè¿æ¥</strong></p><h3 id="å°†Hexoéƒ¨ç½²åˆ°GitHub"><a href="#å°†Hexoéƒ¨ç½²åˆ°GitHub" class="headerlink" title="å°†Hexoéƒ¨ç½²åˆ°GitHub"></a>å°†Hexoéƒ¨ç½²åˆ°GitHub</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git #å†’å·åé¢æœ‰ç©ºæ ¼</span><br><span class="line">  repository: git@github.com:xuhuigeren/xuhuigeren.github.io.git  #ssh/httpsä»“åº“åœ°å€</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><p><strong>å›åˆ° myblog æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰“å¼€ Git Bashï¼Œå®‰è£…Gitéƒ¨ç½²æ’ä»¶ï¼Œè¾“å…¥å‘½ä»¤</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p><strong>ç„¶ååˆ†åˆ«è¾“å…¥ä»¥ä¸‹ä¸‰æ¡å‘½ä»¤ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean   <span class="comment">#æ¸…é™¤ç¼“å­˜æ–‡ä»¶ db.json å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ public</span></span><br><span class="line">hexo g       <span class="comment">#ç”Ÿæˆç½‘ç«™é™æ€æ–‡ä»¶åˆ°é»˜è®¤è®¾ç½®çš„ public æ–‡ä»¶å¤¹(hexo generate çš„ç¼©å†™)</span></span><br><span class="line">hexo d       <span class="comment">#è‡ªåŠ¨ç”Ÿæˆç½‘ç«™é™æ€æ–‡ä»¶ï¼Œå¹¶éƒ¨ç½²åˆ°è®¾å®šçš„ä»“åº“(hexo deploy çš„ç¼©å†™)</span></span><br></pre></td></tr></table></figure><p><strong>å®Œæˆä»¥åï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ <a href="https://xuhuigeren.github.io/">https://xuhuigeren.github.io</a>  å°±å¯ä»¥æ‰“å¼€ä½ çš„ç½‘é¡µäº†</strong></p><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <summary type="html">Welcome to Hexo</summary>
    
    
    
    <category term="æˆ‘çš„åšå®¢" scheme="http://example.com/categories/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2/"/>
    
    
    <category term="Hexo" scheme="http://example.com/tags/Hexo/"/>
    
  </entry>
  
</feed>
